<pre class="highlight"><span class="c1"># not required by the main lib.</span>
<span class="c1"># to use this module, require &#39;rouge/cli&#39;.</span>

<span class="c1"># stdlib</span>
<span class="nb">require</span> <span class="s1">&#39;optparse&#39;</span>

<span class="c1"># gems</span>
<span class="nb">require</span> <span class="s1">&#39;thor&#39;</span>

<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">class </span><span class="nc">CLI</span> <span class="o">&lt;</span> <span class="no">Thor</span>
    <span class="n">default_task</span> <span class="ss">:highlight</span>

    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="no">ARGV</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">argv</span><span class="nf">.include?</span> <span class="s1">&#39;-v&#39;</span> <span class="n">or</span> <span class="n">argv</span><span class="nf">.include?</span> <span class="s1">&#39;--version&#39;</span>
        <span class="nb">puts</span> <span class="no">Rouge</span><span class="nf">.version</span>
        <span class="nb">exit</span> <span class="mi">0</span>
      <span class="k">end</span>

      <span class="k">unless</span> <span class="sx">%w(highlight style list --help -h help)</span><span class="nf">.include?</span><span class="p">(</span><span class="n">argv</span><span class="nf">.first</span><span class="p">)</span>
        <span class="n">argv</span><span class="nf">.unshift</span> <span class="s1">&#39;highlight&#39;</span>
      <span class="k">end</span>

      <span class="k">super</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">desc</span> <span class="s1">&#39;highlight [FILE]&#39;</span><span class="p">,</span> <span class="s1">&#39;highlight some code&#39;</span>
    <span class="n">option</span> <span class="ss">:input_file</span><span class="p">,</span> <span class="ss">:aliases</span> <span class="o">=&gt;</span> <span class="s1">&#39;-i&#39;</span><span class="p">,</span>  <span class="ss">:desc</span> <span class="o">=&gt;</span> <span class="s1">&#39;the file to operate on&#39;</span>
    <span class="n">option</span> <span class="ss">:lexer</span><span class="p">,</span> <span class="ss">:aliases</span> <span class="o">=&gt;</span> <span class="s1">&#39;-l&#39;</span><span class="p">,</span>
      <span class="ss">:desc</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="s1">&#39;Which lexer to use.  If not provided, rougify will try to &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;guess based on --mimetype, the filename, and the file &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;contents.&#39;</span><span class="p">)</span>
    <span class="n">option</span> <span class="ss">:formatter</span><span class="p">,</span> <span class="ss">:aliases</span> <span class="o">=&gt;</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s1">&#39;terminal256&#39;</span><span class="p">,</span>
      <span class="ss">:desc</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="s1">&#39;Which formatter to use.&#39;</span><span class="p">)</span>
    <span class="n">option</span> <span class="ss">:mimetype</span><span class="p">,</span> <span class="ss">:aliases</span> <span class="o">=&gt;</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span>
      <span class="ss">:desc</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="s1">&#39;a mimetype that Rouge will use to guess the correct lexer. &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;This is ignored if --lexer is specified.&#39;</span><span class="p">)</span>
    <span class="n">option</span> <span class="ss">:lexer_opts</span><span class="p">,</span> <span class="ss">:aliases</span> <span class="o">=&gt;</span> <span class="s1">&#39;-L&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:hash</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="p">{},</span>
      <span class="ss">:desc</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="s1">&#39;a hash of options to pass to the lexer.&#39;</span><span class="p">)</span>
    <span class="n">option</span> <span class="ss">:formatter_opts</span><span class="p">,</span> <span class="ss">:aliases</span> <span class="o">=&gt;</span> <span class="s1">&#39;-F&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:hash</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="p">{},</span>
      <span class="ss">:desc</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="s1">&#39;a hash of options to pass to the formatter.&#39;</span><span class="p">)</span>
    <span class="k">def </span><span class="nf">highlight</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="n">filename</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:file</span><span class="o">]</span> <span class="o">||</span> <span class="n">file</span>
      <span class="n">source</span> <span class="o">=</span> <span class="n">filename</span> <span class="p">?</span> <span class="no">File</span><span class="nf">.read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="p">:</span> <span class="vg">$stdin</span><span class="nf">.read</span>

      <span class="k">if</span> <span class="n">options</span><span class="o">[</span><span class="ss">:lexer</span><span class="o">]</span><span class="nf">.nil?</span>
        <span class="n">lexer_class</span> <span class="o">=</span> <span class="no">Lexer</span><span class="nf">.guess</span><span class="p">(</span>
          <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="n">filename</span><span class="p">,</span>
          <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="n">options</span><span class="o">[</span><span class="ss">:mimetype</span><span class="o">]</span><span class="p">,</span>
          <span class="ss">:source</span>   <span class="o">=&gt;</span> <span class="n">source</span><span class="p">,</span>
        <span class="p">)</span>
      <span class="k">else</span>
        <span class="n">lexer_class</span> <span class="o">=</span> <span class="no">Lexer</span><span class="nf">.find</span><span class="p">(</span><span class="n">options</span><span class="o">[</span><span class="ss">:lexer</span><span class="o">]</span><span class="p">)</span>
        <span class="k">raise</span> <span class="s2">&quot;unknown lexer: </span><span class="si">#{</span><span class="n">options</span><span class="o">[</span><span class="ss">:lexer</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">unless</span> <span class="n">lexer_class</span>
      <span class="k">end</span>

      <span class="n">formatter_class</span> <span class="o">=</span> <span class="no">Formatter</span><span class="nf">.find</span><span class="p">(</span><span class="n">options</span><span class="o">[</span><span class="ss">:formatter</span><span class="o">]</span><span class="p">)</span>

      <span class="c1"># only HTML is supported for now</span>
      <span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter_class</span><span class="nf">.new</span><span class="p">(</span><span class="n">normalize_hash_keys</span><span class="p">(</span><span class="n">options</span><span class="o">[</span><span class="ss">:formatter_opts</span><span class="o">]</span><span class="p">))</span>
      <span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer_class</span><span class="nf">.new</span><span class="p">(</span><span class="n">normalize_hash_keys</span><span class="p">(</span><span class="n">options</span><span class="o">[</span><span class="ss">:lexer_opts</span><span class="o">]</span><span class="p">))</span>

      <span class="nb">puts</span> <span class="no">Rouge</span><span class="nf">.highlight</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">desc</span> <span class="s1">&#39;style THEME&#39;</span><span class="p">,</span> <span class="s1">&#39;render THEME as css&#39;</span>
    <span class="n">option</span> <span class="ss">:scope</span><span class="p">,</span> <span class="ss">:desc</span> <span class="o">=&gt;</span> <span class="s2">&quot;a css selector to scope the styles to&quot;</span>
    <span class="k">def </span><span class="nf">style</span><span class="p">(</span><span class="n">theme_name</span><span class="o">=</span><span class="s1">&#39;thankful_eyes&#39;</span><span class="p">)</span>
      <span class="n">theme</span> <span class="o">=</span> <span class="no">Theme</span><span class="nf">.find</span><span class="p">(</span><span class="n">theme_name</span><span class="p">)</span>
      <span class="k">raise</span> <span class="s2">&quot;unknown theme: </span><span class="si">#{</span><span class="n">theme_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">unless</span> <span class="n">theme</span>

      <span class="nb">puts</span> <span class="n">theme</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span><span class="nf">.render</span>
    <span class="k">end</span>

    <span class="n">desc</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;list the available lexers, formatters, and styles&#39;</span>
    <span class="k">def </span><span class="nf">list</span>
      <span class="nb">puts</span> <span class="s2">&quot;== Available Lexers ==&quot;</span>
      <span class="n">all_lexers</span> <span class="o">=</span> <span class="no">Lexer</span><span class="nf">.all</span>
      <span class="n">max_len</span> <span class="o">=</span> <span class="n">all_lexers</span><span class="nf">.map</span> <span class="p">{</span> <span class="o">|</span><span class="n">l</span><span class="o">|</span> <span class="n">l</span><span class="nf">.tag.size</span> <span class="p">}</span><span class="nf">.max</span>

      <span class="no">Lexer</span><span class="nf">.all.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">lexer</span><span class="o">|</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">lexer</span><span class="nf">.desc</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">lexer</span><span class="nf">.aliases.any?</span>
          <span class="n">desc</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; [aliases: </span><span class="si">#{</span><span class="n">lexer</span><span class="nf">.aliases.join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">end</span>
        <span class="nb">puts</span> <span class="s2">&quot;%s: %s&quot;</span> <span class="o">%</span> <span class="o">[</span><span class="n">lexer</span><span class="nf">.tag</span><span class="p">,</span> <span class="n">desc</span><span class="o">]</span>
        <span class="nb">puts</span>
      <span class="k">end</span>
    <span class="k">end</span>

  <span class="kp">private</span>
    <span class="c1"># TODO: does Thor do this for me?</span>
    <span class="k">def </span><span class="nf">normalize_hash_keys</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>
      <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="nb">hash</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span>
        <span class="n">new_key</span> <span class="o">=</span> <span class="n">k</span><span class="nf">.tr</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="nf">.to_sym</span>
        <span class="n">out</span><span class="o">[</span><span class="n">new_key</span><span class="o">]</span> <span class="o">=</span> <span class="n">v</span>
      <span class="k">end</span>

      <span class="n">out</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="c1"># A Formatter takes a token stream and formats it for human viewing.</span>
  <span class="k">class </span><span class="nc">Formatter</span>
    <span class="c1"># @private</span>
    <span class="no">REGISTRY</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Specify or get the unique tag for this formatter.  This is used</span>
    <span class="c1"># for specifying a formatter in `rougify`.</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">tag</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="k">return</span> <span class="vi">@tag</span> <span class="k">unless</span> <span class="n">tag</span>
      <span class="no">REGISTRY</span><span class="o">[</span><span class="n">tag</span><span class="o">]</span> <span class="o">=</span> <span class="nb">self</span>

      <span class="vi">@tag</span> <span class="o">=</span> <span class="n">tag</span>
    <span class="k">end</span>

    <span class="c1"># Find a formatter class given a unique tag.</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
      <span class="no">REGISTRY</span><span class="o">[</span><span class="n">tag</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="c1"># Format a token stream.  Delegates to {#format}.</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">format</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
      <span class="kp">new</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span><span class="nf">.format</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Format a token stream.</span>
    <span class="k">def </span><span class="nf">format</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
      <span class="n">enum_for</span><span class="p">(</span><span class="ss">:stream</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span><span class="nf">.to_a.join</span>
    <span class="k">end</span>

    <span class="c1"># @deprecated Use {#format} instead.</span>
    <span class="k">def </span><span class="nf">render</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
      <span class="nb">warn</span> <span class="s1">&#39;Formatter#render is deprecated, use #format instead.&#39;</span>
      <span class="nb">format</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># @abstract</span>
    <span class="c1"># yield strings that, when concatenated, form the formatted output</span>
    <span class="k">def </span><span class="nf">stream</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">raise</span> <span class="s1">&#39;abstract&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># stdlib</span>
<span class="nb">require</span> <span class="s1">&#39;cgi&#39;</span>

<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Formatters</span>
    <span class="c1"># Transforms a token stream into HTML output.</span>
    <span class="k">class </span><span class="nc">HTML</span> <span class="o">&lt;</span> <span class="no">Formatter</span>
      <span class="n">tag</span> <span class="s1">&#39;html&#39;</span>

      <span class="c1"># @option opts :css_class</span>
      <span class="c1"># A css class to be used for the generated &lt;pre&gt; tag.</span>
      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="vi">@css_class</span> <span class="o">=</span> <span class="n">opts</span><span class="o">[</span><span class="ss">:css_class</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;highlight&#39;</span>
        <span class="vi">@line_numbers</span> <span class="o">=</span> <span class="n">opts</span><span class="nf">.fetch</span><span class="p">(</span><span class="ss">:line_numbers</span><span class="p">)</span> <span class="p">{</span> <span class="kp">false</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="c1"># @yield the html output.</span>
      <span class="k">def </span><span class="nf">stream</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="vi">@line_numbers</span>
          <span class="n">stream_tableized</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="n">stream_untableized</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">stream_untableized</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="k">yield</span> <span class="s2">&quot;&lt;pre class=</span><span class="si">#{</span><span class="vi">@css_class</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
        <span class="n">tokens</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
          <span class="n">span</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="k">yield</span> <span class="s1">&#39;&lt;/pre&gt;&#39;</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">stream_tableized</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="n">num_lines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">tokens</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
          <span class="n">num_lines</span> <span class="o">+=</span> <span class="n">val</span><span class="nf">.scan</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">)</span><span class="nf">.size</span>
          <span class="n">span</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">str</span><span class="o">|</span> <span class="n">code</span> <span class="o">&lt;&lt;</span> <span class="n">str</span> <span class="p">}</span>
        <span class="k">end</span>

        <span class="c1"># generate a string of newline-separated line numbers for the gutter</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="n">num_lines</span><span class="nf">.times.map</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
          <span class="sx">%&lt;&lt;div class=&quot;lineno&quot;&gt;#{x+1}&lt;/div&gt;&gt;</span>
        <span class="k">end</span><span class="nf">.join</span>

        <span class="k">yield</span> <span class="s2">&quot;&lt;table class=</span><span class="si">#{</span><span class="vi">@css_class</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&gt;&lt;tbody&gt;&lt;tr&gt;&quot;</span>

        <span class="c1"># the &quot;gl&quot; class applies the style for Generic.Lineno</span>
        <span class="k">yield</span> <span class="s1">&#39;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre&gt;&#39;</span>
        <span class="k">yield</span> <span class="n">numbers</span>
        <span class="k">yield</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/td&gt;&#39;</span>

        <span class="k">yield</span> <span class="s1">&#39;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&#39;</span>
        <span class="k">yield</span> <span class="n">code</span>
        <span class="k">yield</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/td&gt;&#39;</span>

        <span class="k">yield</span> <span class="s1">&#39;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&#39;</span>
      <span class="k">end</span>

    <span class="kp">private</span>
      <span class="k">def </span><span class="nf">span</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="c1"># TODO: properly html-encode val</span>
        <span class="n">val</span> <span class="o">=</span> <span class="no">CGI</span><span class="nf">.escape_html</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">case</span> <span class="n">tok</span><span class="nf">.shortname</span>
        <span class="k">when</span> <span class="s1">&#39;&#39;</span>
          <span class="k">yield</span> <span class="n">val</span>
        <span class="k">when</span> <span class="kp">nil</span>
          <span class="k">raise</span> <span class="s2">&quot;unknown token: </span><span class="si">#{</span><span class="n">tok</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span>
          <span class="k">yield</span> <span class="s1">&#39;&lt;span class=&#39;</span>
          <span class="k">yield</span> <span class="n">tok</span><span class="nf">.shortname.inspect</span>
          <span class="k">yield</span> <span class="s1">&#39;&gt;&#39;</span>
          <span class="k">yield</span> <span class="n">val</span>
          <span class="k">yield</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Formatters</span>
    <span class="c1"># A formatter for 256-color terminals</span>
    <span class="k">class </span><span class="nc">Terminal256</span> <span class="o">&lt;</span> <span class="no">Formatter</span>
      <span class="n">tag</span> <span class="s1">&#39;terminal256&#39;</span>

      <span class="c1"># @private</span>
      <span class="kp">attr_reader</span> <span class="ss">:theme</span>


      <span class="c1"># @option opts :theme</span>
      <span class="c1">#   (default is thankful_eyes) the theme to render with.</span>
      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="vi">@theme</span> <span class="o">=</span> <span class="n">opts</span><span class="o">[</span><span class="ss">:theme</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;thankful_eyes&#39;</span>
        <span class="vi">@theme</span> <span class="o">=</span> <span class="no">Theme</span><span class="nf">.find</span><span class="p">(</span><span class="vi">@theme</span><span class="p">)</span> <span class="k">if</span> <span class="vi">@theme</span><span class="nf">.is_a?</span> <span class="nb">String</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">stream</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="n">tokens</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
          <span class="n">escape</span> <span class="o">=</span> <span class="n">escape_sequence</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
          <span class="k">yield</span> <span class="n">escape</span><span class="nf">.style_string</span>
          <span class="k">yield</span> <span class="n">val</span>
          <span class="k">yield</span> <span class="n">escape</span><span class="nf">.reset_string</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">class </span><span class="nc">EscapeSequence</span>
        <span class="kp">attr_reader</span> <span class="ss">:style</span>
        <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
          <span class="vi">@style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="k">end</span>

        <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">xterm_colors</span>
          <span class="vi">@xterm_colors</span> <span class="o">||=</span> <span class="o">[]</span><span class="nf">.tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
            <span class="c1"># colors 0..15: 16 basic colors</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="o">]</span> <span class="c1"># 0</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="o">]</span> <span class="c1"># 1</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x00</span><span class="o">]</span> <span class="c1"># 2</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x00</span><span class="o">]</span> <span class="c1"># 3</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xee</span><span class="o">]</span> <span class="c1"># 4</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xcd</span><span class="o">]</span> <span class="c1"># 5</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xcd</span><span class="o">]</span> <span class="c1"># 6</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xe5</span><span class="o">]</span> <span class="c1"># 7</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="o">]</span> <span class="c1"># 8</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="o">]</span> <span class="c1"># 9</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="o">]</span> <span class="c1"># 10</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="o">]</span> <span class="c1"># 11</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0xff</span><span class="o">]</span> <span class="c1"># 12</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="o">]</span> <span class="c1"># 13</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="o">]</span> <span class="c1"># 14</span>
            <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="o">]</span> <span class="c1"># 15</span>

            <span class="c1"># colors 16..232: the 6x6x6 color cube</span>
            <span class="n">valuerange</span> <span class="o">=</span> <span class="o">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0xff</span><span class="o">]</span>

            <span class="mi">217</span><span class="nf">.times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
              <span class="n">r</span> <span class="o">=</span> <span class="n">valuerange</span><span class="o">[</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">36</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="o">]</span>
              <span class="n">g</span> <span class="o">=</span> <span class="n">valuerange</span><span class="o">[</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="o">]</span>
              <span class="n">b</span> <span class="o">=</span> <span class="n">valuerange</span><span class="o">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">6</span><span class="o">]</span>
              <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="o">]</span>
            <span class="k">end</span>

            <span class="c1"># colors 233..253: grayscale</span>
            <span class="mi">1</span><span class="nf">.upto</span> <span class="mi">22</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
              <span class="n">v</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span>
              <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">]</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="k">def </span><span class="nf">fg</span>
          <span class="k">return</span> <span class="vi">@fg</span> <span class="k">if</span> <span class="n">instance_variable_defined?</span> <span class="ss">:@fg</span>
          <span class="vi">@fg</span> <span class="o">=</span> <span class="n">style</span><span class="nf">.fg</span> <span class="o">&amp;&amp;</span> <span class="nb">self</span><span class="nf">.class.color_index</span><span class="p">(</span><span class="n">style</span><span class="nf">.fg</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="k">def </span><span class="nf">bg</span>
          <span class="k">return</span> <span class="vi">@bg</span> <span class="k">if</span> <span class="n">instance_variable_defined?</span> <span class="ss">:@bg</span>
          <span class="vi">@bg</span> <span class="o">=</span> <span class="n">style</span><span class="nf">.bg</span> <span class="o">&amp;&amp;</span> <span class="nb">self</span><span class="nf">.class.color_index</span><span class="p">(</span><span class="n">style</span><span class="nf">.bg</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="k">def </span><span class="nf">style_string</span>
          <span class="vi">@style_string</span> <span class="o">||=</span> <span class="k">begin</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="o">[]</span>

            <span class="n">attrs</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="s1">&#39;38&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="nf">.to_s</span><span class="o">]</span> <span class="k">if</span> <span class="n">fg</span>
            <span class="n">attrs</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="s1">&#39;45&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="n">bg</span><span class="nf">.to_s</span><span class="o">]</span> <span class="k">if</span> <span class="n">bg</span>
            <span class="n">attrs</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;01&#39;</span> <span class="k">if</span> <span class="n">style</span><span class="o">[</span><span class="ss">:bold</span><span class="o">]</span>
            <span class="n">attrs</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;04&#39;</span> <span class="k">if</span> <span class="n">style</span><span class="o">[</span><span class="ss">:italic</span><span class="o">]</span> <span class="c1"># underline, but hey, whatevs</span>
            <span class="n">escape</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="k">def </span><span class="nf">reset_string</span>
          <span class="vi">@reset_string</span> <span class="o">||=</span> <span class="k">begin</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="o">[]</span>
            <span class="n">attrs</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;39&#39;</span> <span class="k">if</span> <span class="n">fg</span> <span class="c1"># fg reset</span>
            <span class="n">attrs</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;49&#39;</span> <span class="k">if</span> <span class="n">bg</span> <span class="c1"># bg reset</span>
            <span class="n">attrs</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="k">if</span> <span class="n">style</span><span class="o">[</span><span class="ss">:bold</span><span class="o">]</span> <span class="o">||</span> <span class="n">style</span><span class="o">[</span><span class="ss">:italic</span><span class="o">]</span>

            <span class="n">escape</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">end</span>

      <span class="kp">private</span>
        <span class="k">def </span><span class="nf">escape</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
          <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">attrs</span><span class="nf">.empty?</span>
          <span class="s2">&quot;</span><span class="se">\e</span><span class="s2">[</span><span class="si">#{</span><span class="n">attrs</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">m&quot;</span>
        <span class="k">end</span>

        <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">color_index</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
          <span class="vi">@color_index_cache</span> <span class="o">||=</span> <span class="p">{}</span>
          <span class="vi">@color_index_cache</span><span class="o">[</span><span class="n">color</span><span class="o">]</span> <span class="o">||=</span> <span class="n">closest_color</span><span class="p">(</span><span class="o">*</span><span class="n">get_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
        <span class="k">end</span>

        <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">get_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
          <span class="n">color</span> <span class="o">=</span> <span class="vg">$1</span> <span class="k">if</span> <span class="n">color</span> <span class="o">=~</span> <span class="sr">/#([0-9a-f]+)/i</span>
          <span class="n">hexes</span> <span class="o">=</span> <span class="k">case</span> <span class="n">color</span><span class="nf">.size</span>
          <span class="k">when</span> <span class="mi">3</span>
            <span class="n">color</span><span class="nf">.chars.map</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">c</span><span class="si">}#{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
          <span class="k">when</span> <span class="mi">6</span>
            <span class="n">color</span><span class="nf">.scan</span> <span class="sr">/../</span>
          <span class="k">else</span>
            <span class="k">raise</span> <span class="s2">&quot;invalid color: </span><span class="si">#{</span><span class="n">color</span><span class="si">}</span><span class="s2">&quot;</span>
          <span class="k">end</span>

          <span class="n">hexes</span><span class="nf">.map</span> <span class="p">{</span> <span class="o">|</span><span class="n">h</span><span class="o">|</span> <span class="n">h</span><span class="nf">.to_i</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">end</span>

        <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">closest_color</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
          <span class="n">distance</span> <span class="o">=</span> <span class="mi">257</span> <span class="o">*</span> <span class="mi">257</span> <span class="o">*</span> <span class="mi">3</span> <span class="c1"># (max distance, from #000000 to #ffffff)</span>

          <span class="n">match</span> <span class="o">=</span> <span class="mi">0</span>

          <span class="n">xterm_colors</span><span class="nf">.each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">cg</span><span class="p">,</span> <span class="n">cb</span><span class="p">),</span> <span class="n">i</span><span class="o">|</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">cr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="n">cg</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">cb</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">next</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">distance</span>

            <span class="n">match</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">d</span>
          <span class="k">end</span>

          <span class="n">match</span>
        <span class="k">end</span>
      <span class="k">end</span>

    <span class="c1"># private</span>
      <span class="k">def </span><span class="nf">escape_sequence</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="vi">@escape_sequences</span> <span class="o">||=</span> <span class="p">{}</span>
        <span class="vi">@escape_sequences</span><span class="o">[</span><span class="n">token</span><span class="nf">.name</span><span class="o">]</span> <span class="o">||=</span>
          <span class="no">EscapeSequence</span><span class="nf">.new</span><span class="p">(</span><span class="n">get_style</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">get_style</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text_style</span> <span class="k">if</span> <span class="n">token</span><span class="nf">.name</span> <span class="o">==</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">theme</span><span class="nf">.get_own_style</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">||</span> <span class="n">text_style</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">text_style</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">theme</span><span class="nf">.get_style</span><span class="p">(</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Text&#39;</span><span class="o">]</span><span class="p">)</span>
        <span class="c1"># don&#39;t highlight text backgrounds</span>
        <span class="n">style</span><span class="nf">.delete</span> <span class="ss">:bg</span>
        <span class="n">style</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># stdlib</span>
<span class="nb">require</span> <span class="s1">&#39;strscan&#39;</span>

<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="c1"># @abstract</span>
  <span class="c1"># A lexer transforms text into a stream of `[token, chunk]` pairs.</span>
  <span class="k">class </span><span class="nc">Lexer</span>
    <span class="k">class </span><span class="o">&lt;&lt;</span> <span class="nb">self</span>
      <span class="c1"># Lexes `stream` with the given options.  The lex is delegated to a</span>
      <span class="c1"># new instance.</span>
      <span class="c1">#</span>
      <span class="c1"># @see #lex</span>
      <span class="k">def </span><span class="nf">lex</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="p">{},</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="kp">new</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span><span class="nf">.lex</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">default_options</span><span class="p">(</span><span class="n">o</span><span class="o">=</span><span class="p">{})</span>
        <span class="vi">@default_options</span> <span class="o">||=</span> <span class="p">{}</span>
        <span class="vi">@default_options</span><span class="nf">.merge!</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="vi">@default_options</span>
      <span class="k">end</span>

      <span class="c1"># Given a string, return the correct lexer class.</span>
      <span class="k">def </span><span class="nf">find</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="n">registry</span><span class="o">[</span><span class="nb">name</span><span class="nf">.to_s</span><span class="o">]</span>
      <span class="k">end</span>

      <span class="c1"># Find a lexer, with fancy shiny features.</span>
      <span class="c1">#</span>
      <span class="c1"># * The string you pass can include CGI-style options</span>
      <span class="c1">#</span>
      <span class="c1">#     Lexer.find_fancy(&#39;erb?parent=tex&#39;)</span>
      <span class="c1">#</span>
      <span class="c1"># * You can pass the special name &#39;guess&#39; so we guess for you,</span>
      <span class="c1">#   and you can pass a second argument of the code to guess by</span>
      <span class="c1">#</span>
      <span class="c1">#     Lexer.find_fancy(&#39;guess&#39;, &quot;#!/bin/bash\necho Hello, world&quot;)</span>
      <span class="c1">#</span>
      <span class="c1"># This is used in the Redcarpet plugin as well as Rouge&#39;s own</span>
      <span class="c1"># markdown lexer for highlighting internal code blocks.</span>
      <span class="c1">#</span>
      <span class="k">def </span><span class="nf">find_fancy</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
        <span class="nb">name</span><span class="p">,</span> <span class="n">opts</span> <span class="o">=</span> <span class="n">str</span> <span class="p">?</span> <span class="n">str</span><span class="nf">.split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span> <span class="o">[</span><span class="kp">nil</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">]</span>

        <span class="c1"># parse the options hash from a cgi-style string</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="no">CGI</span><span class="nf">.parse</span><span class="p">(</span><span class="n">opts</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="nf">.map</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">vals</span><span class="o">|</span>
          <span class="o">[</span> <span class="n">k</span><span class="nf">.to_sym</span><span class="p">,</span> <span class="n">vals</span><span class="nf">.empty?</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="n">vals</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">]</span>
        <span class="k">end</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">[</span><span class="n">opts</span><span class="o">]</span>

        <span class="n">lexer_class</span> <span class="o">=</span> <span class="k">case</span> <span class="nb">name</span>
        <span class="k">when</span> <span class="s1">&#39;guess&#39;</span><span class="p">,</span> <span class="kp">nil</span>
          <span class="nb">self</span><span class="nf">.guess</span><span class="p">(</span><span class="ss">:source</span> <span class="o">=&gt;</span> <span class="n">code</span><span class="p">,</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="n">opts</span><span class="o">[</span><span class="ss">:mimetype</span><span class="o">]</span><span class="p">)</span>
        <span class="k">when</span> <span class="nb">String</span>
          <span class="nb">self</span><span class="nf">.find</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="n">lexer_class</span> <span class="o">&amp;&amp;</span> <span class="n">lexer_class</span><span class="nf">.new</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># Specify or get this lexer&#39;s description.</span>
      <span class="k">def </span><span class="nf">desc</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="ss">:absent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="ss">:absent</span>
          <span class="vi">@desc</span>
        <span class="k">else</span>
          <span class="vi">@desc</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="c1"># Specify or get the path name containing a small demo for</span>
      <span class="c1"># this lexer (can be overriden by {demo}).</span>
      <span class="k">def </span><span class="nf">demo_file</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="ss">:absent</span><span class="p">)</span>
        <span class="k">return</span> <span class="vi">@demo_file</span> <span class="o">=</span> <span class="no">Pathname</span><span class="nf">.new</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">unless</span> <span class="n">arg</span> <span class="o">==</span> <span class="ss">:absent</span>

        <span class="vi">@demo_file</span> <span class="o">=</span> <span class="no">Pathname</span><span class="nf">.new</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span><span class="nf">.dirname.join</span><span class="p">(</span><span class="s1">&#39;demos&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># Specify or get a small demo string for this lexer</span>
      <span class="k">def </span><span class="nf">demo</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="ss">:absent</span><span class="p">)</span>
        <span class="k">return</span> <span class="vi">@demo</span> <span class="o">=</span> <span class="n">arg</span> <span class="k">unless</span> <span class="n">arg</span> <span class="o">==</span> <span class="ss">:absent</span>

        <span class="vi">@demo</span> <span class="o">=</span> <span class="no">File</span><span class="nf">.read</span><span class="p">(</span><span class="n">demo_file</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># @return a list of all lexers.</span>
      <span class="k">def </span><span class="nf">all</span>
        <span class="n">registry</span><span class="nf">.values.uniq</span>
      <span class="k">end</span>

      <span class="c1"># Guess which lexer to use based on a hash of info.</span>
      <span class="c1">#</span>
      <span class="c1"># @option info :mimetype</span>
      <span class="c1">#   A mimetype to guess by</span>
      <span class="c1"># @option info :filename</span>
      <span class="c1">#   A filename to guess by</span>
      <span class="c1"># @option info :source</span>
      <span class="c1">#   The source itself, which, if guessing by mimetype or filename</span>
      <span class="c1">#   fails, will be searched for shebangs, &lt;!DOCTYPE ...&gt; tags, and</span>
      <span class="c1">#   other hints.</span>
      <span class="c1">#</span>
      <span class="c1"># @see Lexer.analyze_text</span>
      <span class="k">def </span><span class="nf">guess</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">by_mimetype</span> <span class="o">=</span> <span class="n">guess_by_mimetype</span><span class="p">(</span><span class="n">info</span><span class="o">[</span><span class="ss">:mimetype</span><span class="o">]</span><span class="p">)</span> <span class="k">if</span> <span class="n">info</span><span class="o">[</span><span class="ss">:mimetype</span><span class="o">]</span>
        <span class="k">return</span> <span class="n">by_mimetype</span> <span class="k">if</span> <span class="n">by_mimetype</span>

        <span class="n">by_filename</span> <span class="o">=</span> <span class="n">guess_by_filename</span><span class="p">(</span><span class="n">info</span><span class="o">[</span><span class="ss">:filename</span><span class="o">]</span><span class="p">)</span> <span class="k">if</span> <span class="n">info</span><span class="o">[</span><span class="ss">:filename</span><span class="o">]</span>
        <span class="k">return</span> <span class="n">by_filename</span> <span class="k">if</span> <span class="n">by_filename</span>

        <span class="n">by_source</span> <span class="o">=</span> <span class="n">guess_by_source</span><span class="p">(</span><span class="n">info</span><span class="o">[</span><span class="ss">:source</span><span class="o">]</span><span class="p">)</span> <span class="k">if</span> <span class="n">info</span><span class="o">[</span><span class="ss">:source</span><span class="o">]</span>
        <span class="k">return</span> <span class="n">by_source</span> <span class="k">if</span> <span class="n">by_source</span>

        <span class="c1"># guessing failed, just parse it as text</span>
        <span class="k">return</span> <span class="no">Lexers</span><span class="o">::</span><span class="no">Text</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">guess_by_mimetype</span><span class="p">(</span><span class="n">mt</span><span class="p">)</span>
        <span class="n">registry</span><span class="nf">.values.detect</span> <span class="k">do</span> <span class="o">|</span><span class="n">lexer</span><span class="o">|</span>
          <span class="n">lexer</span><span class="nf">.mimetypes.include?</span> <span class="n">mt</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">guess_by_filename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="no">File</span><span class="nf">.basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">registry</span><span class="nf">.values.detect</span> <span class="k">do</span> <span class="o">|</span><span class="n">lexer</span><span class="o">|</span>
          <span class="n">lexer</span><span class="nf">.filenames.any?</span> <span class="k">do</span> <span class="o">|</span><span class="n">pattern</span><span class="o">|</span>
            <span class="no">File</span><span class="nf">.fnmatch?</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">FNM_DOTMATCH</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">guess_by_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">assert_utf8!</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

        <span class="n">source</span> <span class="o">=</span> <span class="no">TextAnalyzer</span><span class="nf">.new</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

        <span class="n">best_result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">best_match</span> <span class="o">=</span> <span class="kp">nil</span>
        <span class="n">registry</span><span class="nf">.values.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">lexer</span><span class="o">|</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">lexer</span><span class="nf">.analyze_text</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span>
          <span class="k">return</span> <span class="n">lexer</span> <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">1</span>

          <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="n">best_result</span>
            <span class="n">best_match</span> <span class="o">=</span> <span class="n">lexer</span>
            <span class="n">best_result</span> <span class="o">=</span> <span class="n">result</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">best_match</span>
      <span class="k">end</span>

      <span class="c1"># @private</span>
      <span class="k">def </span><span class="nf">register</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">lexer</span><span class="p">)</span>
        <span class="n">registry</span><span class="o">[</span><span class="nb">name</span><span class="nf">.to_s</span><span class="o">]</span> <span class="o">=</span> <span class="n">lexer</span>
      <span class="k">end</span>

      <span class="c1"># Used to specify or get the canonical name of this lexer class.</span>
      <span class="c1">#</span>
      <span class="c1"># @example</span>
      <span class="c1">#   class MyLexer &lt; Lexer</span>
      <span class="c1">#     tag &#39;foo&#39;</span>
      <span class="c1">#   end</span>
      <span class="c1">#</span>
      <span class="c1">#   MyLexer.tag # =&gt; &#39;foo&#39;</span>
      <span class="c1">#</span>
      <span class="c1">#   Lexer.find(&#39;foo&#39;) # =&gt; MyLexer</span>
      <span class="k">def </span><span class="nf">tag</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
        <span class="k">return</span> <span class="vi">@tag</span> <span class="k">if</span> <span class="n">t</span><span class="nf">.nil?</span>

        <span class="vi">@tag</span> <span class="o">=</span> <span class="n">t</span><span class="nf">.to_s</span>
        <span class="no">Lexer</span><span class="nf">.register</span><span class="p">(</span><span class="vi">@tag</span><span class="p">,</span> <span class="nb">self</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># Used to specify alternate names this lexer class may be found by.</span>
      <span class="c1">#</span>
      <span class="c1"># @example</span>
      <span class="c1">#   class Erb &lt; Lexer</span>
      <span class="c1">#     tag &#39;erb&#39;</span>
      <span class="c1">#     aliases &#39;eruby&#39;, &#39;rhtml&#39;</span>
      <span class="c1">#   end</span>
      <span class="c1">#</span>
      <span class="c1">#   Lexer.find(&#39;eruby&#39;) # =&gt; Erb</span>
      <span class="k">def </span><span class="nf">aliases</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">args</span><span class="nf">.map!</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:to_s</span><span class="p">)</span>
        <span class="n">args</span><span class="nf">.each</span> <span class="p">{</span> <span class="o">|</span><span class="n">arg</span><span class="o">|</span> <span class="no">Lexer</span><span class="nf">.register</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">self</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">(</span><span class="vi">@aliases</span> <span class="o">||=</span> <span class="o">[]</span><span class="p">)</span><span class="nf">.concat</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># Specify a list of filename globs associated with this lexer.</span>
      <span class="c1">#</span>
      <span class="c1"># @example</span>
      <span class="c1">#   class Ruby &lt; Lexer</span>
      <span class="c1">#     filenames &#39;*.rb&#39;, &#39;*.ruby&#39;, &#39;Gemfile&#39;, &#39;Rakefile&#39;</span>
      <span class="c1">#   end</span>
      <span class="k">def </span><span class="nf">filenames</span><span class="p">(</span><span class="o">*</span><span class="n">fnames</span><span class="p">)</span>
        <span class="p">(</span><span class="vi">@filenames</span> <span class="o">||=</span> <span class="o">[]</span><span class="p">)</span><span class="nf">.concat</span><span class="p">(</span><span class="n">fnames</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># Specify a list of mimetypes associated with this lexer.</span>
      <span class="c1">#</span>
      <span class="c1"># @example</span>
      <span class="c1">#   class Html &lt; Lexer</span>
      <span class="c1">#     mimetypes &#39;text/html&#39;, &#39;application/xhtml+xml&#39;</span>
      <span class="c1">#   end</span>
      <span class="k">def </span><span class="nf">mimetypes</span><span class="p">(</span><span class="o">*</span><span class="n">mts</span><span class="p">)</span>
        <span class="p">(</span><span class="vi">@mimetypes</span> <span class="o">||=</span> <span class="o">[]</span><span class="p">)</span><span class="nf">.concat</span><span class="p">(</span><span class="n">mts</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># @private</span>
      <span class="k">def </span><span class="nf">assert_utf8!</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">if</span> <span class="sx">%w(US-ASCII UTF-8)</span><span class="nf">.include?</span> <span class="n">str</span><span class="nf">.encoding.name</span>
        <span class="k">raise</span> <span class="no">EncodingError</span><span class="nf">.new</span><span class="p">(</span>
          <span class="s2">&quot;Bad encoding: </span><span class="si">#{</span><span class="n">str</span><span class="nf">.encoding.names.join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span> <span class="o">+</span>
          <span class="s2">&quot;Please convert your string to UTF-8.&quot;</span>
        <span class="p">)</span>
      <span class="k">end</span>

    <span class="kp">private</span>
      <span class="k">def </span><span class="nf">registry</span>
        <span class="vi">@registry</span> <span class="o">||=</span> <span class="p">{}</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># -*- instance methods -*- #</span>

    <span class="c1"># Create a new lexer with the given options.  Individual lexers may</span>
    <span class="c1"># specify extra options.  The only current globally accepted option</span>
    <span class="c1"># is `:debug`.</span>
    <span class="c1">#</span>
    <span class="c1"># @option opts :debug</span>
    <span class="c1">#   Prints debug information to stdout.  The particular info depends</span>
    <span class="c1">#   on the lexer in question.  In regex lexers, this will log the</span>
    <span class="c1">#   state stack at the beginning of each step, along with each regex</span>
    <span class="c1">#   tried and each stream consumed.  Try it, it&#39;s pretty useful.</span>
    <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
      <span class="n">options</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># get and/or specify the options for this lexer.</span>
    <span class="k">def </span><span class="nf">options</span><span class="p">(</span><span class="n">o</span><span class="o">=</span><span class="p">{})</span>
      <span class="p">(</span><span class="vi">@options</span> <span class="o">||=</span> <span class="p">{})</span><span class="nf">.merge!</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

      <span class="nb">self</span><span class="nf">.class.default_options.merge</span><span class="p">(</span><span class="vi">@options</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># get or specify one option for this lexer</span>
    <span class="k">def </span><span class="nf">option</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="ss">:absent</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="ss">:absent</span>
        <span class="n">options</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>
      <span class="k">else</span>
        <span class="n">options</span><span class="p">({</span> <span class="n">k</span> <span class="o">=&gt;</span> <span class="n">v</span> <span class="p">})</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># Leave a debug message if the `:debug` option is set.  The message</span>
    <span class="c1"># is given as a block because some debug messages contain calculated</span>
    <span class="c1"># information that is unnecessary for lexing in the real world.</span>
    <span class="c1">#</span>
    <span class="c1"># @example</span>
    <span class="c1">#   debug { &quot;hello, world!&quot; }</span>
    <span class="k">def </span><span class="nf">debug</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="nb">puts</span><span class="p">(</span><span class="n">b</span><span class="nf">.call</span><span class="p">)</span> <span class="k">if</span> <span class="n">option</span> <span class="ss">:debug</span>
    <span class="k">end</span>

    <span class="c1"># @abstract</span>
    <span class="c1">#</span>
    <span class="c1"># Called after each lex is finished.  The default implementation</span>
    <span class="c1"># is a noop.</span>
    <span class="k">def </span><span class="nf">reset!</span>
    <span class="k">end</span>

    <span class="c1"># Given a string, yield [token, chunk] pairs.  If no block is given,</span>
    <span class="c1"># an enumerator is returned.</span>
    <span class="c1">#</span>
    <span class="c1"># @option opts :continue</span>
    <span class="c1">#   Continue the lex from the previous state (i.e. don&#39;t call #reset!)</span>
    <span class="k">def </span><span class="nf">lex</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="p">{},</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">enum_for</span><span class="p">(</span><span class="ss">:lex</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span> <span class="k">unless</span> <span class="nb">block_given?</span>

      <span class="no">Lexer</span><span class="nf">.assert_utf8!</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

      <span class="n">reset!</span> <span class="k">unless</span> <span class="n">opts</span><span class="o">[</span><span class="ss">:continue</span><span class="o">]</span>

      <span class="c1"># consolidate consecutive tokens of the same type</span>
      <span class="n">last_token</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="n">last_val</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="n">stream_tokens</span><span class="p">(</span><span class="no">StringScanner</span><span class="nf">.new</span><span class="p">(</span><span class="n">string</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
        <span class="k">next</span> <span class="k">if</span> <span class="n">val</span><span class="nf">.empty?</span>

        <span class="k">if</span> <span class="n">tok</span> <span class="o">==</span> <span class="n">last_token</span>
          <span class="n">last_val</span> <span class="o">&lt;&lt;</span> <span class="n">val</span>
          <span class="k">next</span>
        <span class="k">end</span>

        <span class="n">b</span><span class="nf">.call</span><span class="p">(</span><span class="n">last_token</span><span class="p">,</span> <span class="n">last_val</span><span class="p">)</span> <span class="k">if</span> <span class="n">last_token</span>
        <span class="n">last_token</span> <span class="o">=</span> <span class="n">tok</span>
        <span class="n">last_val</span> <span class="o">=</span> <span class="n">val</span>
      <span class="k">end</span>

      <span class="n">b</span><span class="nf">.call</span><span class="p">(</span><span class="n">last_token</span><span class="p">,</span> <span class="n">last_val</span><span class="p">)</span> <span class="k">if</span> <span class="n">last_token</span>
    <span class="k">end</span>

    <span class="c1"># delegated to {Lexer.tag}</span>
    <span class="k">def </span><span class="nf">tag</span>
      <span class="nb">self</span><span class="nf">.class.tag</span>
    <span class="k">end</span>

    <span class="c1"># @abstract</span>
    <span class="c1">#</span>
    <span class="c1"># Yield `[token, chunk]` pairs, given a prepared input stream.  This</span>
    <span class="c1"># must be implemented.</span>
    <span class="c1">#</span>
    <span class="c1"># @param [StringScanner] stream</span>
    <span class="c1">#   the stream</span>
    <span class="k">def </span><span class="nf">stream_tokens</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">raise</span> <span class="s1">&#39;abstract&#39;</span>
    <span class="k">end</span>

    <span class="c1"># @abstract</span>
    <span class="c1">#</span>
    <span class="c1"># Return a number between 0 and 1 indicating the likelihood that</span>
    <span class="c1"># the text given should be lexed with this lexer.  The default</span>
    <span class="c1"># implementation returns 0.</span>
    <span class="c1">#</span>
    <span class="c1"># @param [TextAnalyzer] text</span>
    <span class="c1">#   the text to be analyzed, with a couple of handy methods on it,</span>
    <span class="c1">#   like {TextAnalyzer#shebang?} and {TextAnalyzer#doctype?}</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
      <span class="mi">0</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">C</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">tag</span> <span class="s1">&#39;c&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.c&#39;</span><span class="p">,</span> <span class="s1">&#39;*.h&#39;</span><span class="p">,</span> <span class="s1">&#39;*.idc&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-chdr&#39;</span><span class="p">,</span> <span class="s1">&#39;text/x-csrc&#39;</span>

      <span class="n">desc</span> <span class="s2">&quot;The C programming language&quot;</span>

      <span class="c1"># optional comment or whitespace</span>
      <span class="n">ws</span> <span class="o">=</span> <span class="sr">%r((?:</span><span class="se">\s</span><span class="sr">|//.*?</span><span class="se">\n</span><span class="sr">|/[*].*?[*]/)+)</span>
      <span class="nb">id</span> <span class="o">=</span> <span class="sr">/[a-zA-Z_][a-zA-Z0-9_]*/</span>

      <span class="n">keywords</span> <span class="o">=</span> <span class="sx">%w(
        auto break case const continue default do else enum extern
        for goto if register restricted return sizeof static struct
        switch typedef union volatile virtual while
      )</span>

      <span class="n">keywords_type</span> <span class="o">=</span> <span class="sx">%w(int long float short double char unsigned signed void)</span>

      <span class="n">__reserved</span> <span class="o">=</span> <span class="sx">%w(
        asm int8 based except int16 stdcall cdecl fastcall int32
        declspec finally int61 try leave
      )</span>

      <span class="n">state</span> <span class="ss">:whitespace</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/^#if\s+0\b/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:if_0</span>
        <span class="n">rule</span> <span class="sr">/^#/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:macro</span>
        <span class="n">rule</span> <span class="sr">/^</span><span class="si">#{</span><span class="n">ws</span><span class="si">}</span><span class="sr">#if\s+0\b/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:if_0</span>
        <span class="n">rule</span> <span class="sr">/^</span><span class="si">#{</span><span class="n">ws</span><span class="si">}</span><span class="sr">#/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:macro</span>
        <span class="n">rule</span> <span class="sr">/^(\s*)(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">:(?!:))/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Label&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span> <span class="c1"># line continuation</span>
        <span class="n">rule</span> <span class="sr">%r(//(</span><span class="se">\n</span><span class="sr">|(.|</span><span class="se">\n</span><span class="sr">)*?[^</span><span class="se">\\</span><span class="sr">]</span><span class="se">\n</span><span class="sr">))</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/(</span><span class="se">\\\n</span><span class="sr">)?[*](.|</span><span class="se">\n</span><span class="sr">)*?[*](</span><span class="se">\\\n</span><span class="sr">)?/)</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:statements</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/L?&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:string</span>
        <span class="n">rule</span> <span class="sr">%r(L?&#39;(</span><span class="se">\\</span><span class="sr">.|</span><span class="se">\\</span><span class="sr">[0-7]{1,3}|</span><span class="se">\\</span><span class="sr">x[a-f0-9]{1,2}|[^</span><span class="se">\\</span><span class="sr">&#39;</span><span class="se">\n</span><span class="sr">])&#39;)i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>
        <span class="n">rule</span> <span class="sr">%r((</span><span class="se">\d</span><span class="sr">+</span><span class="se">\.\d</span><span class="sr">*|</span><span class="se">\.\d</span><span class="sr">+|</span><span class="se">\d</span><span class="sr">+)[e][+-]?</span><span class="se">\d</span><span class="sr">+[lu]*)i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[0-9a-f]+[lu]*/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/0[0-7]+[lu]*/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+[lu]*/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\*</span><span class="sr">/)</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([~!%^&amp;*+=</span><span class="se">\|</span><span class="sr">?:&lt;&gt;/-])</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[()\[\],.]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/\bcase\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:case</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords_type</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Type&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:_{0,2}inline|naked|restrict|thread|typename)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Reserved&#39;</span>
        <span class="n">rule</span> <span class="sr">/__(?:</span><span class="si">#{</span><span class="n">__reserved</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Reserved&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:true|false|NULL)\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:case</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/:/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:statements</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:whitespace</span>

        <span class="c1"># functions</span>
        <span class="n">rule</span> <span class="sr">%r(
          ([</span><span class="se">\w</span><span class="sr">*</span><span class="se">\s</span><span class="sr">]+?[</span><span class="se">\s</span><span class="sr">*]) # return arguments
          (</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)          # function name
          (</span><span class="se">\s</span><span class="sr">*</span><span class="se">\(</span><span class="sr">[^;]*?</span><span class="se">\)</span><span class="sr">)  # signature
          (</span><span class="si">#{</span><span class="n">ws</span><span class="si">}</span><span class="sr">)({)         # open brace
        )mx</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="c1"># TODO: do this better.</span>
          <span class="n">delegate</span> <span class="n">C</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
          <span class="n">delegate</span> <span class="n">C</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
          <span class="n">delegate</span> <span class="n">C</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span>
          <span class="n">push</span> <span class="ss">:function</span>
        <span class="k">end</span>

        <span class="c1"># function declarations</span>
        <span class="n">rule</span> <span class="sr">%r(
          ([</span><span class="se">\w</span><span class="sr">*</span><span class="se">\s</span><span class="sr">]+?[</span><span class="se">\s</span><span class="sr">*]) # return arguments
          (</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)          # function name
          (</span><span class="se">\s</span><span class="sr">*</span><span class="se">\(</span><span class="sr">[^;]*?</span><span class="se">\)</span><span class="sr">)  # signature
          (</span><span class="si">#{</span><span class="n">ws</span><span class="si">}</span><span class="sr">)(;)       # semicolon
        )mx</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="c1"># TODO: do this better.</span>
          <span class="n">delegate</span> <span class="n">C</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Function&#39;</span>
          <span class="n">delegate</span> <span class="n">C</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
          <span class="n">delegate</span> <span class="n">C</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:statement</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:statement</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:statement</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/;/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:whitespace</span>
        <span class="n">mixin</span> <span class="ss">:statements</span>
        <span class="n">rule</span> <span class="sr">/[{}]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:function</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:whitespace</span>
        <span class="n">mixin</span> <span class="ss">:statements</span>
        <span class="n">rule</span> <span class="sr">/;/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/{/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:function</span>
        <span class="n">rule</span> <span class="sr">/}/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:string</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\\([\\abfnrtv&quot;&#39;]|x[a-fA-F0-9]{2,4}|[0-7]{1,3})/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^\\&quot;\n]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\\n/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span> <span class="c1"># stray backslash</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:macro</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r([^/</span><span class="se">\n</span><span class="sr">]+)</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/[*].*?[*]/)m</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiliine&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(//.*$)</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/)</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?&lt;=\\)\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:if_0</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/^\s*#if.*?(?&lt;!\\)\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:if_0</span>
        <span class="n">rule</span> <span class="sr">/^\s*#el(?:se|if).*\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/^\s*#endif.*?(?&lt;!\\)\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Clojure</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Clojure programming language (clojure.org)&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;clojure&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;clj&#39;</span>

      <span class="n">filenames</span> <span class="s1">&#39;*.clj&#39;</span>

      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-clojure&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-clojure&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">keywords</span>
        <span class="vi">@keywords</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          fn def defn defmacro defmethod defmulti defn- defstruct if
          cond let for
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">builtins</span>
        <span class="vi">@builtins</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          . ..  * + - -&gt; / &lt; &lt;= = == &gt; &gt;= accessor agent agent-errors
          aget alength all-ns alter and append-child apply array-map
          aset aset-boolean aset-byte aset-char aset-double aset-float
          aset-int aset-long aset-short assert assoc await await-for bean
          binding bit-and bit-not bit-or bit-shift-left bit-shift-right
          bit-xor boolean branch?  butlast byte cast char children
          class clear-agent-errors comment commute comp comparator
          complement concat conj cons constantly construct-proxy
          contains? count create-ns create-struct cycle dec  deref
          difference disj dissoc distinct doall doc dorun doseq dosync
          dotimes doto double down drop drop-while edit end? ensure eval
          every? false? ffirst file-seq filter find find-doc find-ns
          find-var first float flush fnseq frest gensym get-proxy-class
          get hash-map hash-set identical? identity if-let import in-ns
          inc index insert-child insert-left insert-right inspect-table
          inspect-tree instance? int interleave intersection into
          into-array iterate join key keys keyword keyword? last lazy-cat
          lazy-cons left lefts line-seq list* list load load-file locking
          long loop macroexpand macroexpand-1 make-array make-node map
          map-invert map? mapcat max max-key memfn merge merge-with meta
          min min-key name namespace neg? new newline next nil? node not
          not-any? not-every? not= ns-imports ns-interns ns-map ns-name
          ns-publics ns-refers ns-resolve ns-unmap nth nthrest or parse
          partial path peek pop pos? pr pr-str print print-str println
          println-str prn prn-str project proxy proxy-mappings quot
          rand rand-int range re-find re-groups re-matcher re-matches
          re-pattern re-seq read read-line reduce ref ref-set refer rem
          remove remove-method remove-ns rename rename-keys repeat replace
          replicate resolve rest resultset-seq reverse rfirst right
          rights root rrest rseq second select select-keys send send-off
          seq seq-zip seq? set short slurp some sort sort-by sorted-map
          sorted-map-by sorted-set special-symbol? split-at split-with
          str string?  struct struct-map subs subvec symbol symbol?
          sync take take-nth take-while test time to-array to-array-2d
          tree-seq true? union up update-proxy val vals var-get var-set
          var? vector vector-zip vector? when when-first when-let
          when-not with-local-vars with-meta with-open with-out-str
          xml-seq xml-zip zero? zipmap zipper&#39;
        )</span>
      <span class="k">end</span>

      <span class="n">identifier</span> <span class="o">=</span> <span class="sr">%r([</span><span class="se">\w</span><span class="sr">!$%*+,&lt;=&gt;?/.-]+)</span>

      <span class="k">def </span><span class="nf">name_token</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;Keyword&#39;</span> <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.keywords.include?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;Name.Builtin&#39;</span> <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.builtins.include?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="kp">nil</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/;.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text.Whitespace&#39;</span>

        <span class="n">rule</span> <span class="sr">/-?\d+\.\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/-?\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x-?[0-9a-fA-F]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>

        <span class="n">rule</span> <span class="sr">/&quot;(\\.|[^&quot;])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\(.|[a-z]+)/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>

        <span class="n">rule</span> <span class="sr">/:</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Constant&#39;</span>

        <span class="n">rule</span> <span class="sr">/~@|[`\&#39;#^~&amp;]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="n">rule</span> <span class="sr">/(\()(\s*)(</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">)/m</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Text.Whitespace&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
          <span class="n">token</span><span class="p">(</span><span class="n">name_token</span><span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="n">identifier</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="n">name_token</span><span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="k">end</span>

        <span class="c1"># vectors</span>
        <span class="n">rule</span> <span class="sr">/[\[\]]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="c1"># maps</span>
        <span class="n">rule</span> <span class="sr">/[{}]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="c1"># parentheses</span>
        <span class="n">rule</span> <span class="sr">/[()]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Coffeescript</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">tag</span> <span class="s1">&#39;coffeescript&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;coffee&#39;</span><span class="p">,</span> <span class="s1">&#39;coffee-script&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.coffee&#39;</span><span class="p">,</span> <span class="s1">&#39;Cakefile&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/coffeescript&#39;</span>

      <span class="n">desc</span> <span class="s1">&#39;The Coffeescript programming language (coffeescript.org)&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span> <span class="s1">&#39;coffee&#39;</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">keywords</span>
        <span class="vi">@keywords</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          for in of while break return continue switch when then if else
          throw try catch finally new delete typeof instanceof super
          extends this class by
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">constants</span>
        <span class="vi">@constants</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          true false yes no on off null NaN Infinity undefined
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">builtins</span>
        <span class="vi">@builtins</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          Array Boolean Date Error Function Math netscape Number Object
          Packages RegExp String sun decodeURI decodeURIComponent
          encodeURI encodeURIComponent eval isFinite isNaN parseFloat
          parseInt document window
        )</span>
      <span class="k">end</span>

      <span class="nb">id</span> <span class="o">=</span> <span class="sr">/[$a-zA-Z_][a-zA-Z0-9_]*/</span>
      <span class="n">lval</span> <span class="o">=</span> <span class="sr">/@?</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">([.]</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)*/</span>

      <span class="n">state</span> <span class="ss">:comments_and_whitespace</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/###.*?###/m</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/#.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:multiline_regex</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:comments_and_whitespace</span>
        <span class="n">rule</span> <span class="sr">%r(///([gim]+</span><span class="se">\b</span><span class="sr">|</span><span class="se">\B</span><span class="sr">))</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(/)</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([^/#]+)</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:slash_starts_regex</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:comments_and_whitespace</span>
        <span class="n">rule</span> <span class="sr">%r(///)</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:multiline_regex</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">%r(
          /(</span><span class="se">\\</span><span class="sr">.|[^</span><span class="se">\[</span><span class="sr">/</span><span class="se">\\\n</span><span class="sr">]|</span><span class="se">\[</span><span class="sr">(</span><span class="se">\\</span><span class="sr">.|[^</span><span class="se">\]\\\n</span><span class="sr">])*</span><span class="se">\]</span><span class="sr">)+/ # a regex
          ([gim]+</span><span class="se">\b</span><span class="sr">|</span><span class="se">\B</span><span class="sr">)
        )x</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">%r(^(?=</span><span class="se">\s</span><span class="sr">|/|&lt;!--))</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:slash_starts_regex</span> <span class="p">}</span>
        <span class="n">mixin</span> <span class="ss">:comments_and_whitespace</span>
        <span class="n">rule</span> <span class="sr">%r(
          [+][+]|--|~|&amp;&amp;|</span><span class="se">\b</span><span class="sr">and</span><span class="se">\b</span><span class="sr">|</span><span class="se">\b</span><span class="sr">or</span><span class="se">\b</span><span class="sr">|</span><span class="se">\b</span><span class="sr">is</span><span class="se">\b</span><span class="sr">|</span><span class="se">\b</span><span class="sr">isnt</span><span class="se">\b</span><span class="sr">|</span><span class="se">\b</span><span class="sr">not</span><span class="se">\b</span><span class="sr">|[?]|:|=|
          [|][|]|</span><span class="se">\\</span><span class="sr">(?=</span><span class="se">\n</span><span class="sr">)|(&lt;&lt;|&gt;&gt;&gt;?|==?|!=?|[-&lt;&gt;+*`%&amp;|^/])=?
        )x</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:slash_starts_regex</span>

        <span class="n">rule</span> <span class="sr">/[-=]&gt;/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>

        <span class="n">rule</span> <span class="sr">/(@)([ \t]*)(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Variable.Instance&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Attribute&#39;</span>
          <span class="n">push</span> <span class="ss">:slash_starts_regex</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/([.])([ \t]*)(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Attribute&#39;</span>
          <span class="n">push</span> <span class="ss">:slash_starts_regex</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">(?=\s*:)/</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span> <span class="ss">:slash_starts_regex</span>

        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Other&#39;</span><span class="p">,</span> <span class="ss">:slash_starts_regex</span>

        <span class="n">rule</span> <span class="sr">/[{(\[;,]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:slash_starts_regex</span>
        <span class="n">rule</span> <span class="sr">/[})\].]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="n">rule</span> <span class="sr">/\d+[.]\d+([eE]\d+)?[fd]?/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[0-9a-fA-F]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;&quot;&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:tdqs</span>
        <span class="n">rule</span> <span class="sr">/&#39;&#39;&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:tsqs</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:dqs</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:sqs</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:strings</span> <span class="k">do</span>
        <span class="c1"># all coffeescript strings are multi-line</span>
        <span class="n">rule</span> <span class="sr">/[^#\\&#39;&quot;]+/m</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>

        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/#/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:double_strings</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">mixin</span> <span class="ss">:has_interpolation</span>
        <span class="n">mixin</span> <span class="ss">:strings</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:single_strings</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">mixin</span> <span class="ss">:strings</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:interpolation</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/}/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:has_interpolation</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[#][{]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:interpolation</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:dqs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:double_strings</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:tdqs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;&quot;&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">mixin</span> <span class="ss">:double_strings</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:sqs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:single_strings</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:tsqs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;&#39;&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">mixin</span> <span class="ss">:single_strings</span>
      <span class="k">end</span>

      <span class="n">postprocess</span> <span class="s1">&#39;Name&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
        <span class="k">if</span> <span class="n">tok</span><span class="nf">.name</span> <span class="o">==</span> <span class="s1">&#39;Name.Attribute&#39;</span>
          <span class="c1"># pass. leave attributes alone.</span>
        <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.keywords.include?</span> <span class="n">val</span>
          <span class="n">tok</span> <span class="o">=</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.constants.include?</span> <span class="n">val</span>
          <span class="n">tok</span> <span class="o">=</span> <span class="s1">&#39;Name.Constant&#39;</span>
        <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.builtins.include?</span> <span class="n">val</span>
          <span class="n">tok</span> <span class="o">=</span> <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="k">end</span>

        <span class="n">token</span> <span class="n">tok</span><span class="p">,</span> <span class="n">val</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># stdlib</span>
<span class="nb">require</span> <span class="s1">&#39;set&#39;</span>

<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">CommonLisp</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Common Lisp variant of Lisp (common-lisp.net)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;common_lisp&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;cl&#39;</span><span class="p">,</span> <span class="s1">&#39;common-lisp&#39;</span>

      <span class="n">filenames</span> <span class="s1">&#39;*.cl&#39;</span><span class="p">,</span> <span class="s1">&#39;*.lisp&#39;</span><span class="p">,</span> <span class="s1">&#39;*.el&#39;</span> <span class="c1"># used for Elisp too</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-common-lisp&#39;</span>

      <span class="c1"># 638 functions</span>
      <span class="no">BUILTIN_FUNCTIONS</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
        &lt; &lt;= = &gt; &gt;= - / /= * + 1- 1+ abort abs acons acos acosh add-method
        adjoin adjustable-array-p adjust-array allocate-instance
        alpha-char-p alphanumericp append apply apropos apropos-list
        aref arithmetic-error-operands arithmetic-error-operation
        array-dimension array-dimensions array-displacement
        array-element-type array-has-fill-pointer-p array-in-bounds-p
        arrayp array-rank array-row-major-index array-total-size
        ash asin asinh assoc assoc-if assoc-if-not atan atanh atom
        bit bit-and bit-andc1 bit-andc2 bit-eqv bit-ior bit-nand
        bit-nor bit-not bit-orc1 bit-orc2 bit-vector-p bit-xor boole
        both-case-p boundp break broadcast-stream-streams butlast
        byte byte-position byte-size caaaar caaadr caaar caadar
        caaddr caadr caar cadaar cadadr cadar caddar cadddr caddr
        cadr call-next-method car cdaaar cdaadr cdaar cdadar cdaddr
        cdadr cdar cddaar cddadr cddar cdddar cddddr cdddr cddr cdr
        ceiling cell-error-name cerror change-class char char&lt; char&lt;=
        char= char&gt; char&gt;= char/= character characterp char-code
        char-downcase char-equal char-greaterp char-int char-lessp
        char-name char-not-equal char-not-greaterp char-not-lessp
        char-upcase cis class-name class-of clear-input clear-output
        close clrhash code-char coerce compile compiled-function-p
        compile-file compile-file-pathname compiler-macro-function
        complement complex complexp compute-applicable-methods
        compute-restarts concatenate concatenated-stream-streams conjugate
        cons consp constantly constantp continue copy-alist copy-list
        copy-pprint-dispatch copy-readtable copy-seq copy-structure
        copy-symbol copy-tree cos cosh count count-if count-if-not
        decode-float decode-universal-time delete delete-duplicates
        delete-file delete-if delete-if-not delete-package denominator
        deposit-field describe describe-object digit-char digit-char-p
        directory directory-namestring disassemble documentation dpb
        dribble echo-stream-input-stream echo-stream-output-stream
        ed eighth elt encode-universal-time endp enough-namestring
        ensure-directories-exist ensure-generic-function eq
        eql equal equalp error eval evenp every exp export expt
        fboundp fceiling fdefinition ffloor fifth file-author
        file-error-pathname file-length file-namestring file-position
        file-string-length file-write-date fill fill-pointer find
        find-all-symbols find-class find-if find-if-not find-method
        find-package find-restart find-symbol finish-output first
        float float-digits floatp float-precision float-radix
        float-sign floor fmakunbound force-output format fourth
        fresh-line fround ftruncate funcall function-keywords
        function-lambda-expression functionp gcd gensym gentemp get
        get-decoded-time get-dispatch-macro-character getf gethash
        get-internal-real-time get-internal-run-time get-macro-character
        get-output-stream-string get-properties get-setf-expansion
        get-universal-time graphic-char-p hash-table-count hash-table-p
        hash-table-rehash-size hash-table-rehash-threshold
        hash-table-size hash-table-test host-namestring identity
        imagpart import initialize-instance input-stream-p inspect
        integer-decode-float integer-length integerp interactive-stream-p
        intern intersection invalid-method-error invoke-debugger
        invoke-restart invoke-restart-interactively isqrt keywordp
        last lcm ldb ldb-test ldiff length lisp-implementation-type
        lisp-implementation-version list list* list-all-packages listen
        list-length listp load load-logical-pathname-translations
        log logand logandc1 logandc2 logbitp logcount logeqv
        logical-pathname logical-pathname-translations logior
        lognand lognor lognot logorc1 logorc2 logtest logxor
        long-site-name lower-case-p machine-instance machine-type
        machine-version macroexpand macroexpand-1 macro-function
        make-array make-broadcast-stream make-concatenated-stream
        make-condition make-dispatch-macro-character make-echo-stream
        make-hash-table make-instance make-instances-obsolete make-list
        make-load-form make-load-form-saving-slots make-package
        make-pathname make-random-state make-sequence make-string
        make-string-input-stream make-string-output-stream make-symbol
        make-synonym-stream make-two-way-stream makunbound map mapc
        mapcan mapcar mapcon maphash map-into mapl maplist mask-field
        max member member-if member-if-not merge merge-pathnames
        method-combination-error method-qualifiers min minusp mismatch mod
        muffle-warning name-char namestring nbutlast nconc next-method-p
        nintersection ninth no-applicable-method no-next-method not notany
        notevery nreconc nreverse nset-difference nset-exclusive-or
        nstring-capitalize nstring-downcase nstring-upcase nsublis
        nsubst nsubst-if nsubst-if-not nsubstitute nsubstitute-if
        nsubstitute-if-not nth nthcdr null numberp numerator nunion
        oddp open open-stream-p output-stream-p package-error-package
        package-name package-nicknames packagep package-shadowing-symbols
        package-used-by-list package-use-list pairlis parse-integer
        parse-namestring pathname pathname-device pathname-directory
        pathname-host pathname-match-p pathname-name pathnamep
        pathname-type pathname-version peek-char phase plusp
        position position-if position-if-not pprint pprint-dispatch
        pprint-fill pprint-indent pprint-linear pprint-newline pprint-tab
        pprint-tabular prin1 prin1-to-string princ princ-to-string print
        print-object probe-file proclaim provide random random-state-p
        rassoc rassoc-if rassoc-if-not rational rationalize rationalp
        read read-byte read-char read-char-no-hang read-delimited-list
        read-from-string read-line read-preserving-whitespace
        read-sequence readtable-case readtablep realp realpart
        reduce reinitialize-instance rem remhash remove
        remove-duplicates remove-if remove-if-not remove-method
        remprop rename-file rename-package replace require rest
        restart-name revappend reverse room round row-major-aref
        rplaca rplacd sbit scale-float schar search second set
        set-difference set-dispatch-macro-character set-exclusive-or
        set-macro-character set-pprint-dispatch set-syntax-from-char
        seventh shadow shadowing-import shared-initialize
        short-site-name signal signum simple-bit-vector-p
        simple-condition-format-arguments simple-condition-format-control
        simple-string-p simple-vector-p sin sinh sixth sleep slot-boundp
        slot-exists-p slot-makunbound slot-missing slot-unbound slot-value
        software-type software-version some sort special-operator-p
        sqrt stable-sort standard-char-p store-value stream-element-type
        stream-error-stream stream-external-format streamp string string&lt;
        string&lt;= string= string&gt; string&gt;= string/= string-capitalize
        string-downcase string-equal string-greaterp string-left-trim
        string-lessp string-not-equal string-not-greaterp string-not-lessp
        stringp string-right-trim string-trim string-upcase sublis subseq
        subsetp subst subst-if subst-if-not substitute substitute-if
        substitute-if-not subtypepsvref sxhash symbol-function
        symbol-name symbolp symbol-package symbol-plist symbol-value
        synonym-stream-symbol syntax: tailp tan tanh tenth terpri third
        translate-logical-pathname translate-pathname tree-equal truename
        truncate two-way-stream-input-stream two-way-stream-output-stream
        type-error-datum type-error-expected-type type-of
        typep unbound-slot-instance unexport unintern union
        unread-char unuse-package update-instance-for-different-class
        update-instance-for-redefined-class upgraded-array-element-type
        upgraded-complex-part-type upper-case-p use-package
        user-homedir-pathname use-value values values-list vector vectorp
        vector-pop vector-push vector-push-extend warn wild-pathname-p
        write write-byte write-char write-line write-sequence write-string
        write-to-string yes-or-no-p y-or-n-p zerop
      )</span><span class="nf">.freeze</span>

      <span class="no">SPECIAL_FORMS</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
        block catch declare eval-when flet function go if labels lambda
        let let* load-time-value locally macrolet multiple-value-call
        multiple-value-prog1 progn progv quote return-from setq
        symbol-macrolet tagbody the throw unwind-protect
      )</span>

      <span class="no">MACROS</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
        and assert call-method case ccase check-type cond ctypecase decf
        declaim defclass defconstant defgeneric define-compiler-macro
        define-condition define-method-combination define-modify-macro
        define-setf-expander define-symbol-macro defmacro defmethod
        defpackage defparameter defsetf defstruct deftype defun defvar
        destructuring-bind do do* do-all-symbols do-external-symbols
        dolist do-symbols dotimes ecase etypecase formatter
        handler-bind handler-case ignore-errors incf in-package
        lambda loop loop-finish make-method multiple-value-bind
        multiple-value-list multiple-value-setq nth-value or pop
        pprint-exit-if-list-exhausted pprint-logical-block pprint-pop
        print-unreadable-object prog prog* prog1 prog2 psetf psetq
        push pushnew remf restart-bind restart-case return rotatef
        setf shiftf step time trace typecase unless untrace when
        with-accessors with-compilation-unit with-condition-restarts
        with-hash-table-iterator with-input-from-string with-open-file
        with-open-stream with-output-to-string with-package-iterator
        with-simple-restart with-slots with-standard-io-syntax
      )</span>

      <span class="no">LAMBDA_LIST_KEYWORDS</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
        &amp;allow-other-keys &amp;aux &amp;body &amp;environment &amp;key &amp;optional &amp;rest
        &amp;whole
      )</span>

      <span class="no">DECLARATIONS</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
        dynamic-extent ignore optimize ftype inline special ignorable
        notinline type
      )</span>

      <span class="no">BUILTIN_TYPES</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
        atom boolean base-char base-string bignum bit compiled-function
        extended-char fixnum keyword nil signed-byte short-float
        single-float double-float long-float simple-array
        simple-base-string simple-bit-vector simple-string simple-vector
        standard-char unsigned-byte

        arithmetic-error cell-error condition control-error
        division-by-zero end-of-file error file-error
        floating-point-inexact floating-point-overflow
        floating-point-underflow floating-point-invalid-operation
        parse-error package-error print-not-readable program-error
        reader-error serious-condition simple-condition simple-error
        simple-type-error simple-warning stream-error storage-condition
        style-warning type-error unbound-variable unbound-slot
        undefined-function warning
      )</span>

      <span class="no">BUILTIN_CLASSES</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
        array broadcast-stream bit-vector built-in-class character
        class complex concatenated-stream cons echo-stream file-stream
        float function generic-function hash-table integer list
        logical-pathname method-combination method null number package
        pathname ratio rational readtable real random-state restart
        sequence standard-class standard-generic-function standard-method
        standard-object string-stream stream string structure-class
        structure-object symbol synonym-stream t two-way-stream vector
      )</span>

      <span class="n">postprocess</span> <span class="s1">&#39;Name.Variable&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="k">if</span> <span class="no">BUILTIN_FUNCTIONS</span><span class="nf">.include?</span> <span class="n">val</span>
          <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="k">elsif</span> <span class="no">SPECIAL_FORMS</span><span class="nf">.include?</span> <span class="n">val</span>
          <span class="s1">&#39;Keyword&#39;</span>
        <span class="k">elsif</span> <span class="no">MACROS</span><span class="nf">.include?</span> <span class="n">val</span>
          <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="k">elsif</span> <span class="no">LAMBDA_LIST_KEYWORDS</span><span class="nf">.include?</span> <span class="n">val</span>
          <span class="s1">&#39;Keyword&#39;</span>
        <span class="k">elsif</span> <span class="no">DECLARATIONS</span><span class="nf">.include?</span> <span class="n">val</span>
          <span class="s1">&#39;Keyword&#39;</span>
        <span class="k">elsif</span> <span class="no">BUILTIN_TYPES</span><span class="nf">.include?</span> <span class="n">val</span>
          <span class="s1">&#39;Keyword.Type&#39;</span>
        <span class="k">elsif</span> <span class="no">BUILTIN_CLASSES</span><span class="nf">.include?</span> <span class="n">val</span>
          <span class="s1">&#39;Name.Class&#39;</span>
        <span class="k">else</span>
          <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="k">end</span>

        <span class="n">token</span> <span class="n">tok</span><span class="p">,</span> <span class="n">val</span>
      <span class="k">end</span>

      <span class="n">nonmacro</span> <span class="o">=</span> <span class="sr">/\\.|[a-zA-Z0-9!$%&amp;*+-\/&lt;=&gt;?@\[\]^_{}~]/</span>
      <span class="n">constituent</span> <span class="o">=</span> <span class="sr">/</span><span class="si">#{</span><span class="n">nonmacro</span><span class="si">}</span><span class="sr">|[#.:]/</span>
      <span class="n">terminated</span> <span class="o">=</span> <span class="sr">/(?=[ &quot;&#39;()\n,;`])/</span> <span class="c1"># whitespace or terminating macro chars</span>
      <span class="n">symbol</span> <span class="o">=</span> <span class="sr">/(\|[^\|]+\||</span><span class="si">#{</span><span class="n">nonmacro</span><span class="si">}#{</span><span class="n">constituent</span><span class="si">}</span><span class="sr">*)/</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/;.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/#\|/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:multiline_comment</span>

        <span class="c1"># encoding comment</span>
        <span class="n">rule</span> <span class="sr">/#\d*Y.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Special&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\.|[^&quot;\\])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>

        <span class="n">rule</span> <span class="sr">/[:&#39;]</span><span class="si">#{</span><span class="n">symbol</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>
        <span class="n">rule</span> <span class="sr">/[&#39;`]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="c1"># numbers</span>
        <span class="n">rule</span> <span class="sr">/[-+]?\d+\.?</span><span class="si">#{</span><span class="n">terminated</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([-+]?</span><span class="se">\d</span><span class="sr">+/</span><span class="se">\d</span><span class="sr">+</span><span class="si">#{</span><span class="n">terminated</span><span class="si">}</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(
          [-+]?
          (</span><span class="se">\d</span><span class="sr">*</span><span class="se">\.\d</span><span class="sr">+([defls][-+]?</span><span class="se">\d</span><span class="sr">+)?
          |</span><span class="se">\d</span><span class="sr">+(</span><span class="se">\.\d</span><span class="sr">*)?[defls][-+]?</span><span class="se">\d</span><span class="sr">+)
          </span><span class="si">#{</span><span class="n">terminated</span><span class="si">}</span><span class="sr">
        )x</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>

        <span class="c1"># sharpsign strings and characters</span>
        <span class="n">rule</span> <span class="sr">/#\\.</span><span class="si">#{</span><span class="n">terminated</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>
        <span class="n">rule</span> <span class="sr">/#\\</span><span class="si">#{</span><span class="n">symbol</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>

        <span class="n">rule</span> <span class="sr">/#\(/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:root</span>

        <span class="c1"># bitstring</span>
        <span class="n">rule</span> <span class="sr">/#\d*\*[01]*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Other&#39;</span>

        <span class="c1"># uninterned symbol</span>
        <span class="n">rule</span> <span class="sr">/#:</span><span class="si">#{</span><span class="n">symbol</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>

        <span class="c1"># read-time and load-time evaluation</span>
        <span class="n">rule</span> <span class="sr">/#[.,]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="c1"># function shorthand</span>
        <span class="n">rule</span> <span class="sr">/#&#39;/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>

        <span class="c1"># binary rational</span>
        <span class="n">rule</span> <span class="sr">/#b[+-]?[01]+(\/[01]+)?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span>

        <span class="c1"># octal rational</span>
        <span class="n">rule</span> <span class="sr">/#o[+-]?[0-7]+(\/[0-7]+)?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>

        <span class="c1"># hex rational</span>
        <span class="n">rule</span> <span class="sr">/#x[+-]?[0-9a-f]+(\/[0-9a-f]+)?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span>

        <span class="c1"># complex</span>
        <span class="n">rule</span> <span class="sr">/(#c)(\()/i</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.Number&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:root</span>
        <span class="k">end</span>

        <span class="c1"># arrays and structures</span>
        <span class="n">rule</span> <span class="sr">/(#(?:\d+a|s))(\()/i</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.Other&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:root</span>
        <span class="k">end</span>

        <span class="c1"># path</span>
        <span class="n">rule</span> <span class="sr">/#p?&quot;(\\.|[^&quot;])*&quot;/i</span>

        <span class="c1"># reference</span>
        <span class="n">rule</span> <span class="sr">/#\d+[=#]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="c1"># read-time comment</span>
        <span class="n">rule</span> <span class="sr">/#+nil</span><span class="si">#{</span><span class="n">terminated</span><span class="si">}</span><span class="sr">\s*\(/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:commented_form</span>

        <span class="c1"># read-time conditional</span>
        <span class="n">rule</span> <span class="sr">/#[+-]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="c1"># special operators that should have been parsed already</span>
        <span class="n">rule</span> <span class="sr">/(,@|,|\.)/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="c1"># special constants</span>
        <span class="n">rule</span> <span class="sr">/(t|nil)</span><span class="si">#{</span><span class="n">terminated</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Constant&#39;</span>

        <span class="c1"># functions and variables</span>
        <span class="c1"># note that these get filtered through in stream_tokens</span>
        <span class="n">rule</span> <span class="sr">/\*</span><span class="si">#{</span><span class="n">symbol</span><span class="si">}</span><span class="sr">\*/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Global&#39;</span>
        <span class="n">rule</span> <span class="n">symbol</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>

        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:root</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span> <span class="k">do</span>
          <span class="k">if</span> <span class="n">stack</span><span class="nf">.empty?</span>
            <span class="n">token</span> <span class="s1">&#39;Error&#39;</span>
          <span class="k">else</span>
            <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
            <span class="n">pop!</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:multiline_comment</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/#\|/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:multiline_comment</span>
        <span class="n">rule</span> <span class="sr">/\|#/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^\|#]+/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\|#]/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:commented_form</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:commented_form</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Cpp</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The C++ programming language&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;cpp&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;c++&#39;</span>
      <span class="c1"># the many varied filenames of c++ source files...</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.cpp&#39;</span><span class="p">,</span> <span class="s1">&#39;*.hpp&#39;</span><span class="p">,</span>
                <span class="s1">&#39;*.c++&#39;</span><span class="p">,</span> <span class="s1">&#39;*.h++&#39;</span><span class="p">,</span>
                <span class="s1">&#39;*.cc&#39;</span><span class="p">,</span>  <span class="s1">&#39;*.hh&#39;</span><span class="p">,</span>
                <span class="s1">&#39;*.cxx&#39;</span><span class="p">,</span> <span class="s1">&#39;*.hxx&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-c++hdr&#39;</span><span class="p">,</span> <span class="s1">&#39;text/x-c++src&#39;</span>

      <span class="n">keywords</span> <span class="o">=</span> <span class="sx">%w(
        asm auto break case catch const const_cast continue
        default delete do dynamic_cast else enum explicit export
        extern for friend goto if mutable namespace new operator
        private protected public register reinterpret_cast return
        restrict sizeof static static_cast struct switch template
        this throw throws try typedef typeid typename union using
        volatile virtual while
      )</span>

      <span class="n">keywords_type</span> <span class="o">=</span> <span class="sx">%w(
        bool int long float short double char unsigned signed void wchar_t
      )</span>

      <span class="n">__reserved</span> <span class="o">=</span> <span class="sx">%w(
        asm int8 based except int16 stdcall cdecl fastcall int32 declspec
        finally int64 try leave wchar_t w64 virtual_inheritance uuidof
        unaligned super single_inheritance raise noop multiple_inheritance
        m128i m128d m128 m64 interface identifier forceinline event assume
      )</span>

      <span class="c1"># optional comments or whitespace</span>
      <span class="n">ws</span> <span class="o">=</span> <span class="sr">%r((?:</span><span class="se">\s</span><span class="sr">|//.*?</span><span class="se">\n</span><span class="sr">|/[*].*?[*]/)+)</span>
      <span class="nb">id</span> <span class="o">=</span> <span class="sr">/[a-zA-Z_][a-zA-Z0-9]*/</span>

      <span class="n">state</span> <span class="ss">:whitespace</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/^#if\s+0/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:if_0</span>
        <span class="n">rule</span> <span class="sr">/^#/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:macro</span>
        <span class="n">rule</span> <span class="sr">/^</span><span class="si">#{</span><span class="n">ws</span><span class="si">}</span><span class="sr">#if\s+0\b/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:if_0</span>
        <span class="n">rule</span> <span class="sr">/^</span><span class="si">#{</span><span class="n">ws</span><span class="si">}</span><span class="sr">#/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:macro</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/(</span><span class="se">\\\n</span><span class="sr">)?/(</span><span class="se">\n</span><span class="sr">|(.|</span><span class="se">\n</span><span class="sr">)*?[^</span><span class="se">\\</span><span class="sr">]</span><span class="se">\n</span><span class="sr">))</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/(</span><span class="se">\\\n</span><span class="sr">)?[*](.|</span><span class="se">\n</span><span class="sr">)*?[*](</span><span class="se">\\\n</span><span class="sr">)?/)</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:whitespace</span>

        <span class="n">rule</span> <span class="sr">/L?&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:string</span>
        <span class="n">rule</span> <span class="sr">%r(L?&#39;(</span><span class="se">\\</span><span class="sr">.|</span><span class="se">\\</span><span class="sr">[0-7]{1,3}|</span><span class="se">\\</span><span class="sr">x[a-f0-9]{1,2}|[^</span><span class="se">\\</span><span class="sr">&#39;</span><span class="se">\n</span><span class="sr">])&#39;)i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>
        <span class="n">rule</span> <span class="sr">%r((</span><span class="se">\d</span><span class="sr">+</span><span class="se">\.\d</span><span class="sr">*|</span><span class="se">\.\d</span><span class="sr">+|</span><span class="se">\d</span><span class="sr">+)[e][+-]?</span><span class="se">\d</span><span class="sr">+[lu]*)i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[0-9a-f]+[lu]*/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/0[0-7]+[lu]*/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+[lu]*/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\*</span><span class="sr">/)</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([~!%^&amp;*+=</span><span class="se">\|</span><span class="sr">?:&lt;&gt;/-])</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[()\[\],.;{}]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span> <span class="sr">/class\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:classname</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords_type</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Type&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:_{0,2}inline|naked|thread)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Reserved&#39;</span>
        <span class="n">rule</span> <span class="sr">/__(?:</span><span class="si">#{</span><span class="n">__reserved</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyoword.Reserved&#39;</span>
        <span class="c1"># Offload C++ extensions, http://offload.codeplay.com/</span>
        <span class="n">rule</span> <span class="sr">/(?:__offload|__blockingoffload|__outer)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Pseudo&#39;</span>

        <span class="n">rule</span> <span class="sr">/(true|false)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Constant&#39;</span>
        <span class="n">rule</span> <span class="sr">/NULL\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">:(?!:)/</span><span class="p">,</span> <span class="s1">&#39;Name.Label&#39;</span>
        <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:classname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>

        <span class="c1"># template specification</span>
        <span class="n">rule</span> <span class="sr">/\s*(?=&gt;)/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:whitespace</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:string</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\\([\\abfnrtv&quot;&#39;]|x[a-fA-F0-9]{2,4}|[0-7]{1,3})/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^\\&quot;\n]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\\n/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span> <span class="c1"># stray backslash</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:macro</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r([^/</span><span class="se">\n</span><span class="sr">]+)</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/[*].*?[*]/)m</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiliine&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(//.*$)</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/)</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?&lt;=\\)\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:if_0</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/^\s*#if.*?(?&lt;!\\)\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:if_0</span>
        <span class="n">rule</span> <span class="sr">/^\s*#el(?:se|if).*\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/^\s*#endif.*?(?&lt;!\\)\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">CSS</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Cascading Style Sheets, used to style web pages&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;css&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.css&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/css&#39;</span>

      <span class="n">identifier</span> <span class="o">=</span> <span class="sr">/[a-zA-Z0-9_-]+/</span>
      <span class="n">number</span> <span class="o">=</span> <span class="sr">/-?(?:[0-9]+(\.[0-9]+)?|\.[0-9]+)/</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">attributes</span>
        <span class="vi">@attributes</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          azimuth background background-attachment background-color
          background-image background-position background-repeat
          border border-bottom border-bottom-color border-bottom-style
          border-bottom-width border-collapse border-color border-left
          border-left-color border-left-style border-left-width
          border-right border-right-color border-right-style
          border-right-width border-spacing border-style border-top
          border-top-color border-top-style border-top-width
          border-width bottom caption-side clear clip color content
          counter-increment counter-reset cue cue-after cue-before cursor
          direction display elevation empty-cells float font font-family
          font-size font-size-adjust font-stretch font-style font-variant
          font-weight height left letter-spacing line-height list-style
          list-style-image list-style-position list-style-type margin
          margin-bottom margin-left margin-right margin-top marker-offset
          marks max-height max-width min-height min-width opacity orphans
          outline outline-color outline-style outline-width overflow-x
          overflow-y padding padding-bottom padding-left padding-right
          padding-top page page-break-after page-break-before
          page-break-inside pause pause-after pause-before pitch
          pitch-range play-during position quotes richness right size
          speak speak-header speak-numeral speak-punctuation speech-rate
          src stress table-layout text-align text-decoration text-indent
          text-shadow text-transform top unicode-bidi vertical-align
          visibility voice-family volume white-space widows width
          word-spacing z-index
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">builtins</span>
        <span class="vi">@builtins</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          above absolute always armenian aural auto avoid left bottom
          baseline behind below bidi-override blink block bold bolder
          both bottom capitalize center center-left center-right circle
          cjk-ideographic close-quote collapse condensed continuous crop
          cross crosshair cursive dashed decimal decimal-leading-zero
          default digits disc dotted double e-resize embed expanded
          extra-condensed extra-expanded fantasy far-left far-right fast
          faster fixed georgian groove hebrew help hidden hide high higher
          hiragana hiragana-iroha icon inherit inline inline-table inset
          inside invert italic justify katakana katakana-iroha landscape
          large larger left left-side leftwards level lighter line-through
          list-item loud low lower lower-alpha lower-greek lower-roman
          lowercase ltr medium message-box middle mix monospace n-resize
          narrower ne-resize no-close-quote no-open-quote no-repeat none
          normal nowrap nw-resize oblique once open-quote outset outside
          overline pointer portrait px relative repeat repeat-x repeat-y
          rgb ridge right right-side rightwards s-resize sans-serif scroll
          se-resize semi-condensed semi-expanded separate serif show
          silent slow slower small-caps small-caption smaller soft solid
          spell-out square static status-bar super sw-resize table-caption
          table-cell table-column table-column-group table-footer-group
          table-header-group table-row table-row-group text text-bottom
          text-top thick thin top transparent ultra-condensed
          ultra-expanded underline upper-alpha upper-latin upper-roman
          uppercase url visible w-resize wait wider x-fast x-high x-large
          x-loud x-low x-small x-soft xx-large xx-small yes
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">constants</span>
        <span class="vi">@constants</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          indigo gold firebrick indianred yellow darkolivegreen
          darkseagreen mediumvioletred mediumorchid chartreuse
          mediumslateblue black springgreen crimson lightsalmon brown
          turquoise olivedrab cyan silver skyblue gray darkturquoise
          goldenrod darkgreen darkviolet darkgray lightpink teal
          darkmagenta lightgoldenrodyellow lavender yellowgreen thistle
          violet navy orchid blue ghostwhite honeydew cornflowerblue
          darkblue darkkhaki mediumpurple cornsilk red bisque slategray
          darkcyan khaki wheat deepskyblue darkred steelblue aliceblue
          gainsboro mediumturquoise floralwhite coral purple lightgrey
          lightcyan darksalmon beige azure lightsteelblue oldlace
          greenyellow royalblue lightseagreen mistyrose sienna lightcoral
          orangered navajowhite lime palegreen burlywood seashell
          mediumspringgreen fuchsia papayawhip blanchedalmond peru
          aquamarine white darkslategray ivory dodgerblue lemonchiffon
          chocolate orange forestgreen slateblue olive mintcream
          antiquewhite darkorange cadetblue moccasin limegreen saddlebrown
          darkslateblue lightskyblue deeppink plum aqua darkgoldenrod
          maroon sandybrown magenta tan rosybrown pink lightblue
          palevioletred mediumseagreen dimgray powderblue seagreen snow
          mediumblue midnightblue paleturquoise palegoldenrod whitesmoke
          darkorchid salmon lightslategray lawngreen lightgreen tomato
          hotpink lightyellow lavenderblush linen mediumaquamarine green
          blueviolet peachpuff
        )</span>
      <span class="k">end</span>

      <span class="c1"># source: http://www.w3.org/TR/CSS21/syndata.html#vendor-keyword-history</span>
      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">vendor_prefixes</span>
        <span class="vi">@vendor_prefixes</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          -ah- -atsc- -hp- -khtml- -moz- -ms- -o- -rim- -ro- -tc- -wap-
          -webkit- -xv- mso- prince-
        )</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:basics</span>
        <span class="n">rule</span> <span class="sr">/{/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:stanza</span>
        <span class="n">rule</span> <span class="sr">/:</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Decorator&#39;</span>
        <span class="n">rule</span> <span class="sr">/\.</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span>
        <span class="n">rule</span> <span class="sr">/#</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="n">rule</span> <span class="sr">/@</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:at_rule</span>
        <span class="n">rule</span> <span class="n">identifier</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([~^*!%&amp;</span><span class="se">\[\]</span><span class="sr">()&lt;&gt;|+=@:;,./?-])</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:value</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:basics</span>
        <span class="n">rule</span> <span class="sr">/url\(.*?\)/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span>
        <span class="n">rule</span> <span class="sr">/#[0-9a-f]{1,6}/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span> <span class="c1"># colors</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">number</span><span class="si">}</span><span class="sr">(?:em|px|%|pt|pc|in|mm|m|ex|s)?\b/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\[\]():\/.]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\\\|\\&quot;|[^&quot;])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;(\\\\|\\&#39;|[^&#39;])*&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.constants.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Name.Constant&#39;</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.builtins.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Name.Builtin&#39;</span>
          <span class="k">else</span>
            <span class="n">token</span> <span class="s1">&#39;Name&#39;</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:at_rule</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/{(?=\s*</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">\s*:)/m</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:at_stanza</span>
        <span class="n">rule</span> <span class="sr">/{/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:at_body</span>
        <span class="n">rule</span> <span class="sr">/;/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:value</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:at_body</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:at_content</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:at_stanza</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:at_content</span>
        <span class="n">mixin</span> <span class="ss">:stanza</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:at_content</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/}/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">pop!</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:basics</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/</span><span class="se">\*</span><span class="sr">(?:.*?)</span><span class="se">\*</span><span class="sr">/)m</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:stanza</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:basics</span>
        <span class="n">rule</span> <span class="sr">/}/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/(</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">)(\s*)(:)/m</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.attributes.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
            <span class="n">group</span> <span class="s1">&#39;Name.Label&#39;</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.vendor_prefixes.any?</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="nf">.start_with?</span><span class="p">(</span><span class="nb">p</span><span class="p">)</span> <span class="p">}</span>
            <span class="n">group</span> <span class="s1">&#39;Name.Label&#39;</span>
          <span class="k">else</span>
            <span class="n">group</span> <span class="s1">&#39;Name.Property&#39;</span>
          <span class="k">end</span>

          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>

          <span class="n">push</span> <span class="ss">:stanza_value</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:stanza_value</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/;/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/(?=})/</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
        <span class="n">rule</span> <span class="sr">/!important\b/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/^@.*?$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">mixin</span> <span class="ss">:value</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Diff</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Lexes unified diffs or patches&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;diff&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;patch&#39;</span><span class="p">,</span> <span class="s1">&#39;udiff&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.diff&#39;</span><span class="p">,</span> <span class="s1">&#39;*.patch&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-diff&#39;</span><span class="p">,</span> <span class="s1">&#39;text/x-patch&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>   <span class="k">if</span> <span class="n">text</span><span class="nf">.start_with?</span><span class="p">(</span><span class="s1">&#39;Index: &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>   <span class="k">if</span> <span class="n">text</span><span class="nf">.start_with?</span><span class="p">(</span><span class="s1">&#39;diff &#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">9</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/\A---.*?\n\+\+\+/m</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:header</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/^diff .*?\n(?=---|\+\+\+)/m</span><span class="p">,</span> <span class="s1">&#39;Generic.Heading&#39;</span>
        <span class="n">rule</span> <span class="sr">/^--- .*?\n/</span><span class="p">,</span> <span class="s1">&#39;Generic.Deleted&#39;</span>
        <span class="n">rule</span> <span class="sr">/^\+\+\+ .*?\n/</span><span class="p">,</span> <span class="s1">&#39;Generic.Inserted&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:diff</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/@@ -\d+,\d+ \+\d+,\d+ @@.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Generic.Heading&#39;</span>
        <span class="n">rule</span> <span class="sr">/^\+.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Generic.Inserted&#39;</span>
        <span class="n">rule</span> <span class="sr">/^-.*?\n/</span><span class="p">,</span>  <span class="s1">&#39;Generic.Deleted&#39;</span>
        <span class="n">rule</span> <span class="sr">/^ .*?\n/</span><span class="p">,</span>  <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/^.*?\n/</span><span class="p">,</span>   <span class="s1">&#39;Error&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:header</span>
        <span class="n">mixin</span> <span class="ss">:diff</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">ERB</span> <span class="o">&lt;</span> <span class="no">TemplateLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Embedded ruby template files&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;erb&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;eruby&#39;</span><span class="p">,</span> <span class="s1">&#39;rhtml&#39;</span>

      <span class="n">filenames</span> <span class="s1">&#39;*.erb&#39;</span><span class="p">,</span> <span class="s1">&#39;*.erubis&#39;</span><span class="p">,</span> <span class="s1">&#39;*.rhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;*.eruby&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">4</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/&lt;%.*%&gt;/</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="vi">@ruby_lexer</span> <span class="o">=</span> <span class="no">Ruby</span><span class="nf">.new</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>

        <span class="k">super</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">start</span> <span class="k">do</span>
        <span class="n">parent</span><span class="nf">.reset!</span>
        <span class="vi">@ruby_lexer</span><span class="nf">.reset!</span>
      <span class="k">end</span>

      <span class="nb">open</span>  <span class="o">=</span> <span class="sr">/&lt;%%|&lt;%=|&lt;%#|&lt;%-|&lt;%/</span>
      <span class="n">close</span> <span class="o">=</span> <span class="sr">/%%&gt;|-%&gt;|%&gt;/</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&lt;%#/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:comment</span>

        <span class="n">rule</span> <span class="nb">open</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:ruby</span>

        <span class="n">rule</span> <span class="sr">/.+?(?=</span><span class="si">#{</span><span class="nb">open</span><span class="si">}</span><span class="sr">)|.+/m</span> <span class="k">do</span>
          <span class="n">delegate</span> <span class="n">parent</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:comment</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="n">close</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/.+(?=</span><span class="si">#{</span><span class="n">close</span><span class="si">}</span><span class="sr">)|.+/m</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:ruby</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="n">close</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>

        <span class="n">rule</span> <span class="sr">/.+?(?=</span><span class="si">#{</span><span class="n">close</span><span class="si">}</span><span class="sr">)|.+/m</span> <span class="k">do</span>
          <span class="n">delegate</span> <span class="vi">@ruby_lexer</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Factor</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Factor, the practical stack language (factorcode.org)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;factor&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.factor&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-factor&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span> <span class="s1">&#39;factor&#39;</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">builtins</span>
        <span class="vi">@builtins</span> <span class="o">||=</span> <span class="p">{}</span><span class="nf">.tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">builtins</span><span class="o">|</span>
          <span class="n">builtins</span><span class="o">[</span><span class="ss">:kernel</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            or 2bi 2tri while wrapper nip 4dip wrapper? bi*
            callstack&gt;array both? hashcode die dupd callstack
            callstack? 3dup tri@ pick curry build ?execute 3bi prepose
            &gt;boolean if clone eq? tri* ? = swapd 2over 2keep 3keep clear
            2dup when not tuple? dup 2bi* 2tri* call tri-curry object bi@
            do unless* if* loop bi-curry* drop when* assert= retainstack
            assert? -rot execute 2bi@ 2tri@ boa with either? 3drop bi
            curry?  datastack until 3dip over 3curry tri-curry* tri-curry@
            swap and 2nip throw bi-curry (clone) hashcode* compose 2dip if
            3tri unless compose? tuple keep 2curry equal? assert tri 2drop
            most &lt;wrapper&gt; boolean? identity-hashcode identity-tuple?
            null new dip bi-curry@ rot xor identity-tuple boolean
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:assocs</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            ?at assoc? assoc-clone-like assoc= delete-at* assoc-partition
            extract-keys new-assoc value? assoc-size map&gt;assoc push-at
            assoc-like key? assoc-intersect assoc-refine update
            assoc-union assoc-combine at* assoc-empty? at+ set-at
            assoc-all? assoc-subset?  assoc-hashcode change-at assoc-each
            assoc-diff zip values value-at rename-at inc-at enum? at cache
            assoc&gt;map &lt;enum&gt; assoc assoc-map enum value-at* assoc-map-as
            &gt;alist assoc-filter-as clear-assoc assoc-stack maybe-set-at
            substitute assoc-filter 2cache delete-at assoc-find keys
            assoc-any? unzip
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:combinators</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            case execute-effect no-cond no-case? 3cleave&gt;quot 2cleave
            cond&gt;quot wrong-values? no-cond? cleave&gt;quot no-case case&gt;quot
            3cleave wrong-values to-fixed-point alist&gt;quot case-find
            cond cleave call-effect 2cleave&gt;quot recursive-hashcode
            linear-case-quot spread spread&gt;quot
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:math</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            number= if-zero next-power-of-2 each-integer ?1+
            fp-special? imaginary-part unless-zero float&gt;bits number?
            fp-infinity? bignum? fp-snan? denominator fp-bitwise= *
            + power-of-2? - u&gt;= / &gt;= bitand log2-expects-positive &lt;
            log2 &gt; integer? number bits&gt;double 2/ zero? (find-integer)
            bits&gt;float float? shift ratio? even? ratio fp-sign bitnot
            &gt;fixnum complex? /i /f byte-array&gt;bignum when-zero sgn &gt;bignum
            next-float u&lt; u&gt; mod recip rational find-last-integer &gt;float
            (all-integers?) 2^ times integer fixnum? neg fixnum sq bignum
            (each-integer) bit? fp-qnan? find-integer complex &lt;fp-nan&gt;
            real double&gt;bits bitor rem fp-nan-payload all-integers?
            real-part log2-expects-positive? prev-float align unordered?
            float fp-nan? abs bitxor u&lt;= odd? &lt;= /mod rational? &gt;integer
            real? numerator
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:sequences</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            member-eq? append assert-sequence= find-last-from
            trim-head-slice clone-like 3sequence assert-sequence? map-as
            last-index-from reversed index-from cut* pad-tail
            remove-eq! concat-as but-last snip trim-tail nths
            nth 2selector sequence slice?  &lt;slice&gt; partition
            remove-nth tail-slice empty? tail* if-empty
            find-from virtual-sequence? member? set-length
            drop-prefix unclip unclip-last-slice iota map-sum
            bounds-error? sequence-hashcode-step selector-for
            accumulate-as map start midpoint@ (accumulate) rest-slice
            prepend fourth sift accumulate! new-sequence follow map! like
            first4 1sequence reverse slice unless-empty padding virtual@
            repetition? set-last index 4sequence max-length set-second
            immutable-sequence first2 first3 replicate-as reduce-index
            unclip-slice supremum suffix! insert-nth trim-tail-slice
            tail 3append short count suffix concat flip filter sum
            immutable? reverse! 2sequence map-integers delete-all start*
            indices snip-slice check-slice sequence?  head map-find
            filter! append-as reduce sequence= halves collapse-slice
            interleave 2map filter-as binary-reduce slice-error? product
            bounds-check? bounds-check harvest immutable virtual-exemplar
            find produce remove pad-head last replicate set-fourth
            remove-eq shorten reversed?  map-find-last 3map-as
            2unclip-slice shorter? 3map find-last head-slice pop* 2map-as
            tail-slice* but-last-slice 2map-reduce iota? collector-for
            accumulate each selector append! new-resizable cut-slice
            each-index head-slice* 2reverse-each sequence-hashcode
            pop set-nth ?nth &lt;flat-slice&gt; second join when-empty
            collector immutable-sequence? &lt;reversed&gt; all? 3append-as
            virtual-sequence subseq? remove-nth! push-either new-like
            length last-index push-if 2all? lengthen assert-sequence
            copy map-reduce move third first 3each tail? set-first prefix
            bounds-error any? &lt;repetition&gt; trim-slice exchange surround
            2reduce cut change-nth min-length set-third produce-as
            push-all head? delete-slice rest sum-lengths 2each head*
            infimum remove! glue slice-error subseq trim replace-slice
            push repetition map-index trim-head unclip-last mismatch
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:namespaces</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            global +@ change set-namestack change-global init-namespaces
            on off set-global namespace set with-scope bind with-variable
            inc dec counter initialize namestack get get-global make-assoc
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:arrays</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            &lt;array&gt; 2array 3array pair &gt;array 1array 4array pair?
            array resize-array array?
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:io</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            +character+ bad-seek-type? readln each-morsel
            stream-seek read print with-output-stream contents
            write1 stream-write1 stream-copy stream-element-type
            with-input-stream stream-print stream-read stream-contents
            stream-tell tell-output bl seek-output bad-seek-type nl
            stream-nl write flush stream-lines +byte+ stream-flush
            read1 seek-absolute? stream-read1 lines stream-readln
            stream-read-until each-line seek-end with-output-stream*
            seek-absolute with-streams seek-input seek-relative?
            input-stream stream-write read-partial seek-end?
            seek-relative error-stream read-until with-input-stream*
            with-streams* tell-input each-block output-stream
            stream-read-partial each-stream-block each-stream-line
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:strings</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            resize-string &gt;string &lt;string&gt; 1string string string?
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:vectors</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            with-return restarts return-continuation with-datastack
            recover rethrow-restarts &lt;restart&gt; ifcc set-catchstack
            &gt;continuation&lt; cleanup ignore-errors restart?
            compute-restarts attempt-all-error error-thread
            continue &lt;continuation&gt; attempt-all-error? condition?
            &lt;condition&gt; throw-restarts error catchstack continue-with
            thread-error-hook continuation rethrow callcc1
            error-continuation callcc0 attempt-all condition
            continuation? restart return
          )</span>

          <span class="n">builtins</span><span class="o">[</span><span class="ss">:continuations</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
            with-return restarts return-continuation with-datastack
            recover rethrow-restarts &lt;restart&gt; ifcc set-catchstack
            &gt;continuation&lt; cleanup ignore-errors restart?
            compute-restarts attempt-all-error error-thread
            continue &lt;continuation&gt; attempt-all-error? condition?
            &lt;condition&gt; throw-restarts error catchstack continue-with
            thread-error-hook continuation rethrow callcc1
            error-continuation callcc0 attempt-all condition
            continuation? restart return
          )</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/(:|::|MACRO:|MEMO:|GENERIC:|HELP:)(\s+)(\S+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(M:|HOOK:|GENERIC#)(\s+)(\S+)(\s+)(\S+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/\((?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:stack_effect</span>
        <span class="n">rule</span> <span class="sr">/;(?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>

        <span class="n">rule</span> <span class="sr">/(USING:)((?:\s|\\\s)+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:import</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(IN:|USE:|UNUSE:|QUALIFIED:|QUALIFIED-WITH:)(\s+)(\S+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Namespace&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(FROM:|EXCLUDE:)(\s+)(\S+)(\s+)(=&gt;)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(?:ALIAS|DEFER|FORGET|POSTPONE):/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Namespace&#39;</span>

        <span class="n">rule</span> <span class="sr">/(TUPLE:)(\s+)(\S+)(\s+)(&lt;)(\s+)(\S+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span>
          <span class="n">push</span> <span class="ss">:slots</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(TUPLE:)(\s+)(\S+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span>
          <span class="n">push</span> <span class="ss">:slots</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(UNION:|INTERSECTION:)(\s+)(\S+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(PREDICATE:)(\s+)(\S+)(\s+)(&lt;)(\s+)(\S+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(C:)(\s+)(\S+)(\s+)(\S+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">%r(
          (INSTANCE|SLOT|MIXIN|SINGLETONS?|CONSTANT|SYMBOLS?|ERROR|SYNTAX
           |ALIEN|TYPEDEF|FUNCTION|STRUCT):
        )x</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>

        <span class="n">rule</span> <span class="sr">/(?:&lt;PRIVATE|PRIVATE&gt;)/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Namespace&#39;</span>

        <span class="n">rule</span> <span class="sr">/(MAIN:)(\s+)(\S+)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="k">end</span>

        <span class="c1"># strings</span>
        <span class="n">rule</span> <span class="sr">/&quot;&quot;&quot;\s+.*?\s+&quot;&quot;&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\.|[^\\])*?&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/(CHAR:)(\s+)(\\[\\abfnrstv]*|\S)(?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>

        <span class="c1"># comments</span>
        <span class="n">rule</span> <span class="sr">/!\s+.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
        <span class="n">rule</span> <span class="sr">/#!\s+.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>

        <span class="c1"># booleans</span>
        <span class="n">rule</span> <span class="sr">/[tf](?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Name.Constant&#39;</span>

        <span class="c1"># numbers</span>
        <span class="n">rule</span> <span class="sr">/-?\d+\.\d+(?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/-?\d+(?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>

        <span class="n">rule</span> <span class="sr">/HEX:\s+[a-fA-F\d]+(?=\s)/m</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/BIN:\s+[01]+(?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Bin&#39;</span>
        <span class="n">rule</span> <span class="sr">/OCT:\s+[0-7]+(?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>

        <span class="n">rule</span> <span class="sr">%r([-+/*=&lt;&gt;^](?=</span><span class="se">\s</span><span class="sr">))</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="n">rule</span> <span class="sr">/(?:deprecated|final|foldable|flushable|inline|recursive)(?=\s)/</span><span class="p">,</span>
          <span class="s1">&#39;Keyword&#39;</span>

        <span class="c1"># words, to be postprocessed for builtins and things</span>
        <span class="n">rule</span> <span class="sr">/\S+/</span><span class="p">,</span> <span class="s1">&#39;Postprocess.Word&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:stack_effect</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:stack_effect</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>

        <span class="n">rule</span> <span class="sr">/--/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="n">rule</span> <span class="sr">/\S+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:slots</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/;(?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\S+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:import</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/;(?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\S+/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span>
      <span class="k">end</span>

      <span class="n">postprocess</span> <span class="s1">&#39;Postprocess.Word&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.builtins.values.any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="n">b</span><span class="nf">.include?</span> <span class="n">val</span> <span class="p">}</span>
          <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="k">else</span>
          <span class="s1">&#39;Name&#39;</span>
        <span class="k">end</span>

        <span class="n">token</span> <span class="n">tok</span><span class="p">,</span> <span class="n">val</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Groovy</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s1">&#39;The Groovy programming language (groovy.codehaus.org)&#39;</span>
      <span class="n">tag</span> <span class="s1">&#39;groovy&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.groovy&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-groovy&#39;</span>

      <span class="n">ws</span> <span class="o">=</span> <span class="sr">%r((?:</span><span class="se">\s</span><span class="sr">|//.*?</span><span class="se">\n</span><span class="sr">|/[*].*?[*]/)+)</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">keywords</span>
        <span class="vi">@keywords</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          assert break case catch continue default do else finally for
          if goto instanceof new return switch this throw try while in as
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">declarations</span>
        <span class="vi">@declarations</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          abstract const enum extends final implements native private
          protected public static strictfp super synchronized throws
          transient volatile
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">types</span>
        <span class="vi">@types</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          def boolean byte char double float int long short void
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">constants</span>
        <span class="vi">@constants</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(true false null)</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r(^
          (</span><span class="se">\s</span><span class="sr">*(?:</span><span class="se">\w</span><span class="sr">[</span><span class="se">\w\d</span><span class="sr">.</span><span class="se">\[\]</span><span class="sr">]*</span><span class="se">\s</span><span class="sr">+)+?) # return arguments
          (</span><span class="se">\w</span><span class="sr">[</span><span class="se">\w\d</span><span class="sr">]*) # method name
          (</span><span class="se">\s</span><span class="sr">*) (</span><span class="se">\(</span><span class="sr">) # signature start
        )x</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">delegate</span> <span class="nb">self</span><span class="nf">.clone</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span>
        <span class="k">end</span>

        <span class="c1"># whitespace</span>
        <span class="n">rule</span> <span class="sr">/[^\S\n]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(//.*?</span><span class="se">\n</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/[*].*?[*]/)</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/@\w[\w\d.]*/</span><span class="p">,</span> <span class="s1">&#39;Name.Decorator&#39;</span>
        <span class="n">rule</span> <span class="sr">/(class|interface)\b/</span><span class="p">,</span>  <span class="s1">&#39;Keyword.Declaration&#39;</span><span class="p">,</span> <span class="ss">:class</span>
        <span class="n">rule</span> <span class="sr">/package\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">,</span> <span class="ss">:import</span>
        <span class="n">rule</span> <span class="sr">/import\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">,</span> <span class="ss">:import</span>

        <span class="n">rule</span> <span class="sr">/&quot;(\\\\|\\&quot;|[^&quot;])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;(\\\\|\\&#39;|[^&#39;])*&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\$</span><span class="sr">/((?!/</span><span class="se">\$</span><span class="sr">).)*/</span><span class="se">\$</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">&quot;|[^/])*/)</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;\\.&#39;|&#39;[^\\]&#39;|&#39;\\u[0-9a-f]{4}&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>
        <span class="n">rule</span> <span class="sr">/(\.)([a-zA-Z_][a-zA-Z0-9_]*)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Attribute&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[a-zA-Z_][a-zA-Z0-9_]*:/</span><span class="p">,</span> <span class="s1">&#39;Name.Label&#39;</span>
        <span class="n">rule</span> <span class="sr">/[a-zA-Z_\$][a-zA-Z0-9_]*/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.keywords.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.declarations.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword.Declaration&#39;</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.types.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword.Type&#39;</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.constants.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword.Constant&#39;</span>
          <span class="k">else</span>
            <span class="n">token</span> <span class="s1">&#39;Name&#39;</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">%r([~^*!%&amp;</span><span class="se">\[\]</span><span class="sr">(){}&lt;&gt;</span><span class="se">\|</span><span class="sr">+=:;,./?-])</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="c1"># numbers</span>
        <span class="n">rule</span> <span class="sr">/\d+\.\d+([eE]\d+)?[fd]?/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[0-9a-f]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/[0-9]+L?/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:class</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\w[\w\d]*/</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:import</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\w\d.]+[*]?/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="c1"># A lexer for the Haml templating system for Ruby.</span>
    <span class="c1"># @see http://haml.info</span>
    <span class="k">class </span><span class="nc">Haml</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="kp">include</span> <span class="no">Indentation</span>

      <span class="n">desc</span> <span class="s2">&quot;The Haml templating system for Ruby (haml.info)&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;haml&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;HAML&#39;</span>

      <span class="n">filenames</span> <span class="s1">&#39;*.haml&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-haml&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.start_with?</span> <span class="s1">&#39;!!!&#39;</span>
      <span class="k">end</span>

      <span class="c1"># @option opts :filters</span>
      <span class="c1">#   A hash of filter name to lexer of how various filters should be</span>
      <span class="c1">#   highlighted.  By default, :javascript, :css, :ruby, and :erb</span>
      <span class="c1">#   are supported.</span>
      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="p">(</span><span class="n">opts</span><span class="nf">.delete</span><span class="p">(</span><span class="ss">:filters</span><span class="p">)</span> <span class="o">||</span> <span class="p">{})</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">lexer</span><span class="o">|</span>
          <span class="k">unless</span> <span class="n">lexer</span><span class="nf">.respond_to?</span> <span class="ss">:lex</span>
            <span class="n">lexer</span> <span class="o">=</span> <span class="no">Lexer</span><span class="nf">.find</span><span class="p">(</span><span class="n">lexer</span><span class="p">)</span> <span class="n">or</span> <span class="k">raise</span> <span class="s2">&quot;unknown lexer: </span><span class="si">#{</span><span class="n">lexer</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
          <span class="k">end</span>

          <span class="nb">self</span><span class="nf">.filters</span><span class="o">[</span><span class="nb">name</span><span class="nf">.to_s</span><span class="o">]</span> <span class="o">=</span> <span class="n">lexer</span>
        <span class="k">end</span>

        <span class="k">super</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">ruby</span>
        <span class="vi">@ruby</span> <span class="o">||=</span> <span class="no">Ruby</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">html</span>
        <span class="vi">@html</span> <span class="o">||=</span> <span class="no">HTML</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">filters</span>
        <span class="vi">@filters</span> <span class="o">||=</span> <span class="p">{</span>
          <span class="s1">&#39;javascript&#39;</span> <span class="o">=&gt;</span> <span class="no">Javascript</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">),</span>
          <span class="s1">&#39;css&#39;</span> <span class="o">=&gt;</span> <span class="no">CSS</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">),</span>
          <span class="s1">&#39;ruby&#39;</span> <span class="o">=&gt;</span> <span class="n">ruby</span><span class="p">,</span>
          <span class="s1">&#39;erb&#39;</span> <span class="o">=&gt;</span> <span class="no">ERB</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">),</span>
          <span class="s1">&#39;markdown&#39;</span> <span class="o">=&gt;</span> <span class="no">Markdown</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">),</span>
          <span class="c1"># TODO</span>
          <span class="c1"># &#39;sass&#39; =&gt; Sass.new(options),</span>
          <span class="c1"># &#39;textile&#39; =&gt; Textile.new(options),</span>
          <span class="c1"># &#39;maruku&#39; =&gt; Maruku.new(options),</span>
        <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">start</span> <span class="p">{</span> <span class="n">ruby</span><span class="nf">.reset!</span><span class="p">;</span> <span class="n">html</span><span class="nf">.reset!</span> <span class="p">}</span>

      <span class="n">identifier</span> <span class="o">=</span> <span class="sr">/[\w:-]+/</span>
      <span class="n">ruby_var</span> <span class="o">=</span> <span class="sr">/[a-z]\w*/</span>

      <span class="c1"># Haml can include &quot; |\n&quot; anywhere,</span>
      <span class="c1"># which is ignored and used to wrap long lines.</span>
      <span class="c1"># To accomodate this, use this custom faux dot instead.</span>
      <span class="n">dot</span> <span class="o">=</span> <span class="sr">/[ ]\|\n(?=.*[ ]\|)|./</span>

      <span class="c1"># In certain places, a comma at the end of the line</span>
      <span class="c1"># allows line wrapping as well.</span>
      <span class="n">comma_dot</span> <span class="o">=</span> <span class="sr">/,\s*\n|</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">/</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s*\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\s*/</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">indentation</span><span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:content</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:css</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/%</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">;</span> <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:tag</span> <span class="p">}</span>
        <span class="n">rule</span> <span class="sr">/!!!</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">*\n/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(
          (/) (</span><span class="se">\[</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">*?</span><span class="se">\]</span><span class="sr">) (</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">*</span><span class="se">\n</span><span class="sr">)
        )x</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Comment&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Comment.Special&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Comment&#39;</span>
          <span class="n">pop!</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">%r(/</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">*</span><span class="se">\n</span><span class="sr">)</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Comment&#39;</span>
          <span class="n">pop!</span>
          <span class="n">starts_block</span> <span class="ss">:html_comment_block</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/-#</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">*\n/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Comment&#39;</span>
          <span class="n">pop!</span>
          <span class="n">starts_block</span> <span class="ss">:haml_comment_block</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/-/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">reset_stack</span>
          <span class="n">push</span> <span class="ss">:ruby_line</span>
        <span class="k">end</span>

        <span class="c1"># filters</span>
        <span class="n">rule</span> <span class="sr">/:(</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">*)\n/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Decorator&#39;</span>
          <span class="n">pop!</span>
          <span class="n">starts_block</span> <span class="ss">:filter_block</span>

          <span class="n">filter_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="nf">.strip</span>

          <span class="vi">@filter_lexer</span> <span class="o">=</span> <span class="nb">self</span><span class="nf">.filters</span><span class="o">[</span><span class="n">filter_name</span><span class="o">]</span>
          <span class="vi">@filter_lexer</span><span class="nf">.reset!</span> <span class="k">unless</span> <span class="vi">@filter_lexer</span><span class="nf">.nil?</span>

          <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    haml: filter </span><span class="si">#{</span><span class="n">filter_name</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="vi">@filter_lexer</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="k">end</span>

        <span class="n">mixin</span> <span class="ss">:eval_or_plain</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:css</span> <span class="k">do</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\.</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">;</span> <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:tag</span> <span class="p">}</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/#</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">;</span> <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:tag</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:tag</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:css</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\{</span><span class="si">#{</span><span class="n">comma_dot</span><span class="si">}</span><span class="sr">*?\}/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">ruby</span> <span class="p">}</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\[</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">*?\]/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">ruby</span> <span class="p">}</span>
        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:html_attributes</span>
        <span class="n">rule</span> <span class="sr">/\s*\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>

        <span class="c1"># whitespace chompers</span>
        <span class="n">rule</span> <span class="sr">/[&lt;&gt;]{1,2}(?=[ \t=])/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="n">mixin</span> <span class="ss">:eval_or_plain</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:plain</span> <span class="k">do</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/([^#\n]|#[^{\n]|(\\\\)*\\#\{)+/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">html</span> <span class="p">}</span>
        <span class="n">mixin</span> <span class="ss">:interpolation</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">reset_stack</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:eval_or_plain</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[&amp;!]?==/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:plain</span>
        <span class="n">rule</span> <span class="sr">/[&amp;!]?[=!]/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">reset_stack</span>
          <span class="n">push</span> <span class="ss">:ruby_line</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:plain</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:ruby_line</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/,[ \t]*\n/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">ruby</span> <span class="p">}</span>
        <span class="n">rule</span> <span class="sr">/[ ]\|[ \t]*\n/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/.*?(?=(,$| \|)?[ \t]*$)/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">ruby</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:html_attributes</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">identifier</span><span class="si">}</span><span class="sr">\s*=/</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span> <span class="ss">:html_attribute_value</span>
        <span class="n">rule</span> <span class="n">identifier</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:html_attribute_value</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="n">ruby_var</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/@</span><span class="si">#{</span><span class="n">ruby_var</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Instance&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\$</span><span class="si">#{</span><span class="n">ruby_var</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Global&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/&#39;(\\\\|\\&#39;|[^&#39;\n])*&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\\\|\\&quot;|[^&quot;\n])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:html_comment_block</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">+/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
        <span class="n">mixin</span> <span class="ss">:indented_block</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:haml_comment_block</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">+/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">mixin</span> <span class="ss">:indented_block</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:filter_block</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/([^#\n]|#[^{\n]|(\\\\)*\\#\{)+/</span> <span class="k">do</span>
          <span class="k">if</span> <span class="vi">@filter_lexer</span>
            <span class="n">delegate</span> <span class="vi">@filter_lexer</span>
          <span class="k">else</span>
            <span class="n">token</span> <span class="s1">&#39;Name.Decorator&#39;</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">mixin</span> <span class="ss">:interpolation</span>
        <span class="n">mixin</span> <span class="ss">:indented_block</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:interpolation</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(#\{)(</span><span class="si">#{</span><span class="n">dot</span><span class="si">}</span><span class="sr">*?)(\})/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">delegate</span> <span class="n">ruby</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:indented_block</span> <span class="k">do</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">reset_stack</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Handlebars</span> <span class="o">&lt;</span> <span class="no">TemplateLexer</span>
      <span class="n">desc</span> <span class="s1">&#39;the Handlebars and Mustache templating languages&#39;</span>
      <span class="n">tag</span> <span class="s1">&#39;handlebars&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;hbs&#39;</span><span class="p">,</span> <span class="s1">&#39;mustache&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.handlebars&#39;</span><span class="p">,</span> <span class="s1">&#39;*.hbs&#39;</span><span class="p">,</span> <span class="s1">&#39;*.mustache&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-handlebars&#39;</span><span class="p">,</span> <span class="s1">&#39;text/x-mustache&#39;</span>

      <span class="nb">id</span> <span class="o">=</span> <span class="sr">%r([</span><span class="se">\w</span><span class="sr">$-]+)</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="c1"># escaped slashes</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\\{+/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">parent</span> <span class="p">}</span>

        <span class="c1"># block comments</span>
        <span class="n">rule</span> <span class="sr">/{{!--/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:comment</span>
        <span class="n">rule</span> <span class="sr">/{{!.*?}}/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>

        <span class="n">rule</span> <span class="sr">/{{{?/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span>
          <span class="n">push</span> <span class="ss">:stache</span>
          <span class="n">push</span> <span class="ss">:open_sym</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">/(.+?)(?=\\|{{)/m</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">parent</span> <span class="p">}</span>

        <span class="c1"># if we get here, there&#39;s no more mustache tags, so we eat</span>
        <span class="c1"># the rest of the doc</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/.+/m</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">parent</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:comment</span> <span class="k">do</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/{{/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Comment&#39;</span><span class="p">;</span> <span class="n">push</span> <span class="p">}</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/}}/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Comment&#39;</span><span class="p">;</span> <span class="n">pop!</span> <span class="p">}</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/[^{}]+/m</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Comment&#39;</span> <span class="p">}</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/[{}]/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Comment&#39;</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:stache</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/}}}?/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[=]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\[\]]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/[.](?=[}\s])/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">/[.][.]/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([/.])</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\.|.)*?&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;(\\.|.)*?&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+(?=}\s)/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span>
        <span class="n">rule</span> <span class="sr">/(true|false)(?=[}\s])/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Constant&#39;</span>
        <span class="n">rule</span> <span class="sr">/else(?=[}\s])/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span> <span class="sr">/this(?=[}\s])/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin.Pseudo&#39;</span>
        <span class="n">rule</span> <span class="sr">/@</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span>
        <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:open_sym</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r([#/])</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:block_name</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[&gt;^&amp;]/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:block_name</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/if(?=[}\s])/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Haskell</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Haskell programming language (haskell.org)&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;haskell&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;hs&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.hs&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-haskell&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span><span class="p">(</span><span class="s1">&#39;runhaskell&#39;</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">reserved</span> <span class="o">=</span> <span class="sx">%w(
        _ case class data default deriving do else if in
        infix[lr]? instance let newtype of then type where
      )</span>

      <span class="n">ascii</span> <span class="o">=</span> <span class="sx">%w(
        NUL SOH [SE]TX EOT ENQ ACK BEL BS HT LF VT FF CR S[OI] DLE
        DC[1-4] NAK SYN ETB CAN EM SUB ESC [FGRU]S SP DEL
      )</span>

      <span class="n">state</span> <span class="ss">:basic</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/{-#/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:comment_preproc</span>
        <span class="n">rule</span> <span class="sr">/{-/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:comment</span>
        <span class="n">rule</span> <span class="sr">/^--\s+\|.*?$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Doc&#39;</span>
        <span class="c1"># this is complicated in order to support custom symbols</span>
        <span class="c1"># like --&gt;</span>
        <span class="n">rule</span> <span class="sr">/--(?![!#\$\%&amp;*+.\/&lt;=&gt;?@\^\|_~]).*?$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
      <span class="k">end</span>

      <span class="c1"># nested commenting</span>
      <span class="n">state</span> <span class="ss">:comment</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/-}/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/{-/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:comment</span>
        <span class="n">rule</span> <span class="sr">/[^-{}]+/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/[-{}]/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:comment_preproc</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/-}/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/{-/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:comment</span>
        <span class="n">rule</span> <span class="sr">/[^-{}]+/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/[-{}]/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:basic</span>

        <span class="n">rule</span> <span class="sr">/\bimport\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Reserved&#39;</span><span class="p">,</span> <span class="ss">:import</span>
        <span class="n">rule</span> <span class="sr">/\bmodule\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Reserved&#39;</span><span class="p">,</span> <span class="ss">:module</span>
        <span class="n">rule</span> <span class="sr">/\berror\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Exception&#39;</span>
        <span class="n">rule</span> <span class="sr">/\b(?:</span><span class="si">#{</span><span class="n">reserved</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Reserved&#39;</span>
        <span class="c1"># not sure why, but ^ doesn&#39;t work here</span>
        <span class="c1"># rule /^[_a-z][\w&#39;]*/, &#39;Name.Function&#39;</span>
        <span class="n">rule</span> <span class="sr">/[_a-z][\w&#39;]*/</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span>
        <span class="n">rule</span> <span class="sr">/[A-Z][\w&#39;]*/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Type&#39;</span>

        <span class="c1"># lambda operator</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\\</span><span class="sr">(?![:!#</span><span class="se">\$\%</span><span class="sr">&amp;*+.</span><span class="se">\\</span><span class="sr">/&lt;=&gt;?@^</span><span class="se">\|</span><span class="sr">~-]+))</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="c1"># special operators</span>
        <span class="n">rule</span> <span class="sr">%r((&lt;-|::|-&gt;|=&gt;|=)(?![:!#</span><span class="se">\$\%</span><span class="sr">&amp;*+.</span><span class="se">\\</span><span class="sr">/&lt;=&gt;?@^</span><span class="se">\|</span><span class="sr">~-]+))</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="c1"># constructor/type operators</span>
        <span class="n">rule</span> <span class="sr">%r(:[:!#</span><span class="se">\$\%</span><span class="sr">&amp;*+.</span><span class="se">\\</span><span class="sr">/&lt;=&gt;?@^</span><span class="se">\|</span><span class="sr">~-]*)</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="c1"># other operators</span>
        <span class="n">rule</span> <span class="sr">%r([:!#</span><span class="se">\$\%</span><span class="sr">&amp;*+.</span><span class="se">\\</span><span class="sr">/&lt;=&gt;?@^</span><span class="se">\|</span><span class="sr">~-]+)</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="n">rule</span> <span class="sr">/\d+e[+-]?\d+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+\.\d+(e[+-]?\d+)?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0o[0-7]+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[\da-f]+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>

        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span><span class="p">,</span> <span class="ss">:character</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:string</span>

        <span class="n">rule</span> <span class="sr">/\[\s*\]/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Type&#39;</span>
        <span class="n">rule</span> <span class="sr">/\(\s*\)/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\[\](),;`{}]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:import</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:string</span>
        <span class="n">rule</span> <span class="sr">/\bqualified\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="c1"># import X as Y</span>
        <span class="n">rule</span> <span class="sr">/([A-Z][\w.]*)(\s+)(as)(\s+)([A-Z][a-zA-Z0-9_.]*)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Namespace&#39;</span> <span class="c1"># X</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span> <span class="c1"># as</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name&#39;</span> <span class="c1"># Y</span>
          <span class="n">pop!</span>
        <span class="k">end</span>

        <span class="c1"># import X hiding (functions)</span>
        <span class="n">rule</span> <span class="sr">/([A-Z][\w.]*)(\s+)(hiding)(\s+)(\()/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Namespace&#39;</span> <span class="c1"># X</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span> <span class="c1"># hiding</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span> <span class="c1"># (</span>
          <span class="n">pop!</span>
          <span class="n">push</span> <span class="ss">:funclist</span>
        <span class="k">end</span>

        <span class="c1"># import X (functions)</span>
        <span class="n">rule</span> <span class="sr">/([A-Z][\w.]*)(\s+)(\()/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Namespace&#39;</span> <span class="c1"># X</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span> <span class="c1"># (</span>
          <span class="n">pop!</span>
          <span class="n">push</span> <span class="ss">:funclist</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[\w.]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:module</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="c1"># module Foo (functions)</span>
        <span class="n">rule</span> <span class="sr">/([A-Z][\w.]*)(\s+)(\()/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Namespace&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:funclist</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/\bwhere\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Reserved&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>

        <span class="n">rule</span> <span class="sr">/[A-Z][a-zA-Z0-9_.]*/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:funclist</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:basic</span>
        <span class="n">rule</span> <span class="sr">/[A-Z]\w*/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Type&#39;</span>
        <span class="n">rule</span> <span class="sr">/(_[\w\&#39;]+|[a-z][\w\&#39;]*)/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="n">rule</span> <span class="sr">/,/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/[:!#\$\%&amp;*+.\\\/&lt;=&gt;?@^\|~-]+/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:funclist</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:character</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
          <span class="n">push</span> <span class="ss">:character_end</span>
          <span class="n">push</span> <span class="ss">:escape</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/./</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String.Char&#39;</span>
          <span class="n">pop!</span>
          <span class="n">push</span> <span class="ss">:character_end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:character_end</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/./</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:string</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\\/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:escape</span>
        <span class="n">rule</span> <span class="sr">/[^\\&quot;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:escape</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[abfnrtv&quot;&#39;&amp;\\]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\^[\]\[A-Z@\^_]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">ascii</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/o[0-7]+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/x[\da-f]/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\s+\\/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">HTML</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;HTML, the markup language of the web&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;html&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.htm&#39;</span><span class="p">,</span> <span class="s1">&#39;*.html&#39;</span><span class="p">,</span> <span class="s1">&#39;*.xhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;*.xslt&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="s1">&#39;application/xhtml+xml&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.doctype?</span><span class="p">(</span><span class="sr">/\bhtml\b/i</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/&lt;\s*html\b/</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[^&lt;&amp;]+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/&amp;\S*?;/</span><span class="p">,</span> <span class="s1">&#39;Name.Entity&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;!DOCTYPE .*?&gt;/i</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;!\[CDATA\[.*?\]\]&gt;/m</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;!--/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:comment</span>
        <span class="n">rule</span> <span class="sr">/&lt;\?.*?\?&gt;/m</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span> <span class="c1"># php? really?</span>

        <span class="n">rule</span> <span class="sr">/&lt;\s*script\s*/m</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Tag&#39;</span>
          <span class="n">push</span> <span class="ss">:script_content</span>
          <span class="n">push</span> <span class="ss">:tag</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/&lt;\s*style\s*/m</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Tag&#39;</span>
          <span class="n">push</span> <span class="ss">:style_content</span>
          <span class="n">push</span> <span class="ss">:tag</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">%r(&lt;</span><span class="se">\s</span><span class="sr">*[a-zA-Z0-9:]+)</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span> <span class="ss">:tag</span> <span class="c1"># opening tags</span>
        <span class="n">rule</span> <span class="sr">%r(&lt;</span><span class="se">\s</span><span class="sr">*/</span><span class="se">\s</span><span class="sr">*[a-zA-Z0-9:]+</span><span class="se">\s</span><span class="sr">*&gt;)</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span> <span class="c1"># closing tags</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:comment</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[^-]+/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
        <span class="n">rule</span> <span class="sr">/--&gt;/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/-/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:tag</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[a-zA-Z0-9_:-]+\s*=/m</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span> <span class="ss">:attr</span>
        <span class="n">rule</span> <span class="sr">/[a-zA-Z0-9_:-]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/?</span><span class="se">\s</span><span class="sr">*&gt;)m</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:attr</span> <span class="k">do</span>
        <span class="c1"># TODO: are backslash escapes valid here?</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:dq</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/&#39;/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:sq</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[^\s&gt;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:dq</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^&quot;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:sq</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^&#39;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:script_content</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r(&lt;</span><span class="se">\s</span><span class="sr">*/</span><span class="se">\s</span><span class="sr">*script</span><span class="se">\s</span><span class="sr">*&gt;)m</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(.*?(?=&lt;</span><span class="se">\s</span><span class="sr">*/</span><span class="se">\s</span><span class="sr">*script</span><span class="se">\s</span><span class="sr">*&gt;))m</span> <span class="k">do</span>
          <span class="n">delegate</span> <span class="no">Javascript</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:style_content</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r(&lt;</span><span class="se">\s</span><span class="sr">*/</span><span class="se">\s</span><span class="sr">*style</span><span class="se">\s</span><span class="sr">*&gt;)m</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(.*(?=&lt;</span><span class="se">\s</span><span class="sr">*/</span><span class="se">\s</span><span class="sr">*style</span><span class="se">\s</span><span class="sr">*&gt;))m</span> <span class="k">do</span>
          <span class="n">delegate</span> <span class="no">CSS</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Java</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Java programming language (java.com)&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;java&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.java&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-java&#39;</span>

      <span class="n">keywords</span> <span class="o">=</span> <span class="sx">%w(
        assert break case catch continue default do else finally for
        if goto instanceof new return switch this throw try while
      )</span>

      <span class="n">declarations</span> <span class="o">=</span> <span class="sx">%w(
        abstract const enum extends final implements native private protected
        public static strictfp super synchronized throws transient volatile
      )</span>

      <span class="n">types</span> <span class="o">=</span> <span class="sx">%w(boolean byte char double float int long short void)</span>

      <span class="nb">id</span> <span class="o">=</span> <span class="sr">/[a-zA-Z_][a-zA-Z0-9_]*/</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r(^
          (</span><span class="se">\s</span><span class="sr">*(?:[a-zA-Z_][a-zA-Z0-9_.</span><span class="se">\[\]</span><span class="sr">]*</span><span class="se">\s</span><span class="sr">+)+?) # return arguments
          ([a-zA-Z_][a-zA-Z0-9_]*)                  # method name
          (</span><span class="se">\s</span><span class="sr">*)(</span><span class="se">\(</span><span class="sr">)                                 # signature start
        )mx</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="c1"># TODO: do this better, this shouldn&#39;t need a delegation</span>
          <span class="n">delegate</span> <span class="no">Java</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(//.*?$)</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/</span><span class="se">\*</span><span class="sr">.*?</span><span class="se">\*</span><span class="sr">/)m</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/@</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Decorator&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">declarations</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Declaration&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">types</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Type&#39;</span>
        <span class="n">rule</span> <span class="sr">/package\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Namespace&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:true|false|null)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Constant&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:class|interface)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Declaration&#39;</span><span class="p">,</span> <span class="ss">:class</span>
        <span class="n">rule</span> <span class="sr">/import\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">,</span> <span class="ss">:import</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\\\|\\&quot;|[^&quot;])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;(?:\\.|[^\\]|\\u[0-9a-f]{4})&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>
        <span class="n">rule</span> <span class="sr">/(\.)(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Attribute&#39;</span>
        <span class="k">end</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">:/</span><span class="p">,</span> <span class="s1">&#39;Name.Label&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$?</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span>
        <span class="n">rule</span> <span class="sr">/[~^*!%&amp;\[\](){}&lt;&gt;\|+=:;,.\/?-]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[0-9][0-9]*\.[0-9]+([eE][0-9]+)?[fd]?/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[0-9a-f]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/[0-9]+L?/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="c1"># rule /\n/, &#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:class</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:import</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[a-z0-9_.]+\*?/i</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Javascript</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;JavaScript, the browser scripting language&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;javascript&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;js&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.js&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;application/javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-javascript&#39;</span><span class="p">,</span>
                <span class="s1">&#39;text/javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;text/x-javascript&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span><span class="p">(</span><span class="s1">&#39;jsc&#39;</span><span class="p">)</span>
        <span class="c1"># TODO: rhino, spidermonkey, etc</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:comments_and_whitespace</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;!--/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span> <span class="c1"># really...?</span>
        <span class="n">rule</span> <span class="sr">%r(//.*?</span><span class="se">\n</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/</span><span class="se">\*</span><span class="sr">.*?</span><span class="se">\*</span><span class="sr">/)</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:slash_starts_regex</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:comments_and_whitespace</span>

        <span class="n">rule</span> <span class="sr">%r(
          / # opening slash
          ( </span><span class="se">\\</span><span class="sr">. # escape sequences
          | [^/</span><span class="se">\\\n</span><span class="sr">] # regular characters
          | </span><span class="se">\[</span><span class="sr"> (</span><span class="se">\\</span><span class="sr">. | [^</span><span class="se">\]\\\n</span><span class="sr">])* </span><span class="se">\]</span><span class="sr"> # character classes
          )+
          / # closing slash
          (?:[gim]+</span><span class="se">\b</span><span class="sr">|</span><span class="se">\B</span><span class="sr">) # flags
        )x</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>

        <span class="c1"># if it&#39;s not matched by the above r.e., it&#39;s not</span>
        <span class="c1"># a valid expression, so we use :bad_regex to eat until the</span>
        <span class="c1"># end of the line.</span>
        <span class="n">rule</span> <span class="sr">%r(/)</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span><span class="p">,</span> <span class="ss">:bad_regex</span>
        <span class="n">rule</span> <span class="sr">//</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:bad_regex</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[^\n]+/</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">keywords</span>
        <span class="vi">@keywords</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          for in while do break return continue switch case default
          if else throw try catch finally new delete typeof instanceof
          void this
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">declarations</span>
        <span class="vi">@declarations</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(var let with function)</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">reserved</span>
        <span class="vi">@reserved</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          abstract boolean byte char class const debugger double enum
          export extends final float goto implements import int interface
          long native package private protected public short static
          super synchronized throws transient volatile
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">constants</span>
        <span class="vi">@constants</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(true false null NaN Infinity undefined)</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">builtins</span>
        <span class="vi">@builtins</span> <span class="o">||=</span> <span class="sx">%w(
          Array Boolean Date Error Function Math netscape
          Number Object Packages RegExp String sun decodeURI
          decodeURIComponent encodeURI encodeURIComponent
          Error eval isFinite isNaN parseFloat parseInt document this
          window
        )</span>
      <span class="k">end</span>

      <span class="nb">id</span> <span class="o">=</span> <span class="sr">/[$a-zA-Z_][a-zA-Z0-9_]*/</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\A\s*#!.*?\n/m</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">%r((?&lt;=</span><span class="se">\n</span><span class="sr">)(?=</span><span class="se">\s</span><span class="sr">|/|&lt;!--))</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:slash_starts_regex</span>
        <span class="n">mixin</span> <span class="ss">:comments_and_whitespace</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\+\+</span><span class="sr"> | -- | ~ | &amp;&amp; | </span><span class="se">\|\|</span><span class="sr"> | </span><span class="se">\\</span><span class="sr">(?=</span><span class="se">\n</span><span class="sr">) | &lt;&lt; | &gt;&gt;&gt;? | ===
               | !== )x</span><span class="p">,</span>
          <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:slash_starts_regex</span>
        <span class="n">rule</span> <span class="sr">%r([-&lt;&gt;+*%&amp;|</span><span class="se">\^</span><span class="sr">/!=]=?)</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:slash_starts_regex</span>
        <span class="n">rule</span> <span class="sr">/[(\[;,]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:slash_starts_regex</span>
        <span class="n">rule</span> <span class="sr">/[)\].]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="n">rule</span> <span class="sr">/[?]/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:ternary</span>
          <span class="n">push</span> <span class="ss">:slash_starts_regex</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[{](?=\s*(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">|&quot;[^\n]*?&quot;)\s*:)/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:object</span>

        <span class="n">rule</span> <span class="sr">/[{]/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:block</span>
          <span class="n">push</span> <span class="ss">:slash_starts_regex</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="nb">id</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.keywords.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span>
            <span class="n">push</span> <span class="ss">:slash_starts_regex</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.declarations.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword.Declaration&#39;</span>
            <span class="n">push</span> <span class="ss">:slash_starts_regex</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.reserved.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword.Reserved&#39;</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.constants.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword.Constant&#39;</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.builtins.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Name.Builtin&#39;</span>
          <span class="k">else</span>
            <span class="n">token</span> <span class="s1">&#39;Name.Other&#39;</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[0-9][0-9]*\.[0-9]+([eE][0-9]+)?[fd]?/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[0-9a-fA-F]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/[0-9]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\\\|\\&quot;|[^&quot;])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;(\\\\|\\&#39;|[^&#39;])*&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
      <span class="k">end</span>

      <span class="c1"># braced parts that aren&#39;t object literals</span>
      <span class="n">state</span> <span class="ss">:block</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)(\s*)(:)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Label&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[}]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="c1"># object literals</span>
      <span class="n">state</span> <span class="ss">:object</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[}]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)(\s*)(:)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="k">end</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="c1"># ternary expressions, where &lt;id&gt;: is not a label!</span>
      <span class="n">state</span> <span class="ss">:ternary</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/:/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class </span><span class="nc">JSON</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;JavaScript Object Notation (json.org)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;json&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.json&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;application/json&#39;</span>

      <span class="c1"># TODO: is this too much of a performance hit?  JSON is quite simple,</span>
      <span class="c1"># so I&#39;d think this wouldn&#39;t be too bad, but for large documents this</span>
      <span class="c1"># could mean doing two full lexes.</span>
      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/\A\s*{/m</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="nf">.lexes_cleanly?</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:whitespace</span>
        <span class="c1"># special case for empty objects</span>
        <span class="n">rule</span> <span class="sr">/(\{)(\s*)(\})/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text.Whitespace&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="k">end</span>
        <span class="n">rule</span> <span class="sr">/{/</span><span class="p">,</span>  <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:object_key</span>
        <span class="n">rule</span> <span class="sr">/\[/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:array</span>
        <span class="n">rule</span> <span class="sr">/-?(?:0|[1-9]\d*)\.\d+(?:e[+-]\d+)?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/-?(?:0|[1-9]\d*)(?:e[+-]\d+)?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">mixin</span> <span class="ss">:has_string</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:whitespace</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text.Whitespace&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:has_string</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\.|[^&quot;])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:object_key</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:whitespace</span>
        <span class="n">rule</span> <span class="sr">/:/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:object_val</span>
        <span class="n">rule</span> <span class="sr">/}/</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:has_string</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:object_val</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/,/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/}/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">pop!</span><span class="p">;</span> <span class="n">pop!</span> <span class="p">}</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:array</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/,/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Make</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Makefile syntax&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;make&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;makefile&#39;</span><span class="p">,</span> <span class="s1">&#39;mf&#39;</span><span class="p">,</span> <span class="s1">&#39;gnumake&#39;</span><span class="p">,</span> <span class="s1">&#39;bsdmake&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.make&#39;</span><span class="p">,</span> <span class="s1">&#39;Makefile&#39;</span><span class="p">,</span> <span class="s1">&#39;makefile&#39;</span><span class="p">,</span> <span class="s1">&#39;Makefile.*&#39;</span><span class="p">,</span> <span class="s1">&#39;GNUmakefile&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-makefile&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">2</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/^\.PHONY:/</span>
      <span class="k">end</span>

      <span class="n">bsd_special</span> <span class="o">=</span> <span class="sx">%w(
        include undef error warning if else elif endif for endfor
      )</span>

      <span class="n">gnu_special</span> <span class="o">=</span> <span class="sx">%w(
        ifeq ifneq ifdef ifndef else endif include -include define endef :
      )</span>

      <span class="n">line</span> <span class="o">=</span> <span class="sr">/(?:\\.|\\\n|[^\\\n])*/m</span>

      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="k">super</span>
        <span class="vi">@shell</span> <span class="o">=</span> <span class="no">Shell</span><span class="nf">.new</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">start</span> <span class="p">{</span> <span class="vi">@shell</span><span class="nf">.reset!</span> <span class="p">}</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/#.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>

        <span class="n">rule</span> <span class="sr">/(export)(\s+)(?=[a-zA-Z0-9_\${}\t -]+\n)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:export</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/export\s+/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>

        <span class="c1"># assignment</span>
        <span class="n">rule</span> <span class="sr">/([a-zA-Z0-9_${}.-]+)(\s*)([!?:+]?=)/m</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
          <span class="n">push</span> <span class="ss">:shell_line</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/&quot;(\\\\|\\.|[^&quot;\\])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;(\\\\|\\.|[^&#39;\\])*&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/([^\n:]+)(:+)([ \t]*)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Label&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:block_header</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:export</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[\w\${}-]/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:block_header</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[^,\\\n#]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="n">rule</span> <span class="sr">/,/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/#.*?/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:block_body</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:block_body</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(\t[\t ]*)([@-]?)/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:shell_line</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@shell</span><span class="nf">.reset!</span><span class="p">;</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:shell</span> <span class="k">do</span>
        <span class="c1"># macro interpolation</span>
        <span class="n">rule</span> <span class="sr">/\$\(\s*[a-z_]\w*\s*\)/i</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="c1"># $(shell ...)</span>
        <span class="n">rule</span> <span class="sr">/(\$\()(\s*)(shell)(\s+)/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:shell_expr</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">/\\./m</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="vi">@shell</span> <span class="p">}</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="sr">/\$\(|\(|\)|\n|\\/</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/.+?(?=</span><span class="si">#{</span><span class="n">stop</span><span class="si">}</span><span class="sr">)/m</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="vi">@shell</span> <span class="p">}</span>
        <span class="n">rule</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="vi">@shell</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:shell_expr</span> <span class="k">do</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\(/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="vi">@shell</span><span class="p">;</span> <span class="n">push</span> <span class="p">}</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:shell</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:shell_line</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:shell</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Markdown</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Markdown, a light-weight markup language for authors&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;markdown&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;md&#39;</span><span class="p">,</span> <span class="s1">&#39;mkd&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.markdown&#39;</span><span class="p">,</span> <span class="s1">&#39;*.md&#39;</span><span class="p">,</span> <span class="s1">&#39;*.mkd&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-markdown&#39;</span>

      <span class="k">def </span><span class="nf">html</span>
        <span class="vi">@html</span> <span class="o">||=</span> <span class="no">HTML</span><span class="nf">.new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">start</span> <span class="p">{</span> <span class="n">html</span><span class="nf">.reset!</span> <span class="p">}</span>

      <span class="n">edot</span> <span class="o">=</span> <span class="sr">/\\.|[^\\\n]/</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="c1"># YAML frontmatter</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\A(---\s*\n.*?\n?)^(---\s*$\n?)/m</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="no">YAML</span> <span class="p">}</span>

        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>

        <span class="n">rule</span> <span class="sr">/^[\S ]+\n(?:---*)\n/</span><span class="p">,</span> <span class="s1">&#39;Generic.Heading&#39;</span>
        <span class="n">rule</span> <span class="sr">/^[\S ]+\n(?:===*)\n/</span><span class="p">,</span> <span class="s1">&#39;Generic.Subheading&#39;</span>

        <span class="n">rule</span> <span class="sr">/^#(?=[^#]).*?$/</span><span class="p">,</span> <span class="s1">&#39;Generic.Heading&#39;</span>
        <span class="n">rule</span> <span class="sr">/^##*.*?$/</span><span class="p">,</span> <span class="s1">&#39;Generic.Subheading&#39;</span>

        <span class="c1"># TODO: syntax highlight the code block, github style</span>
        <span class="n">rule</span> <span class="sr">/(\n[ \t]*)(```|~~~)(.*?)(\n.*?)(\2)/m</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">sublexer</span> <span class="o">=</span> <span class="no">Lexer</span><span class="nf">.find_fancy</span><span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="nf">.strip</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">)</span>
          <span class="n">sublexer</span> <span class="o">||=</span> <span class="no">Text</span><span class="nf">.new</span><span class="p">(</span><span class="ss">:token</span> <span class="o">=&gt;</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span><span class="p">)</span>

          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Label&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
          <span class="n">delegate</span> <span class="n">sublexer</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/\n\n((    |\t).*?\n|\n)+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span>

        <span class="n">rule</span> <span class="sr">/(`+)</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*\1/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span>

        <span class="c1"># various uses of * are in order of precedence</span>

        <span class="c1"># line breaks</span>
        <span class="n">rule</span> <span class="sr">/^(\s*[*]){3,}\s*$/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/^(\s*[-]){3,}\s*$/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="c1"># bulleted lists</span>
        <span class="n">rule</span> <span class="sr">/^\s*[*+-](?=\s)/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="c1"># numbered lists</span>
        <span class="n">rule</span> <span class="sr">/^\s*\d+\./</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="c1"># blockquotes</span>
        <span class="n">rule</span> <span class="sr">/^\s*&gt;.*?$/</span><span class="p">,</span> <span class="s1">&#39;Generic.Traceback&#39;</span>

        <span class="c1"># link references</span>
        <span class="c1"># [foo]: bar &quot;baz&quot;</span>
        <span class="n">rule</span> <span class="sr">%r(^
          (</span><span class="se">\s</span><span class="sr">*) # leading whitespace
          (</span><span class="se">\[</span><span class="sr">) (</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">+?) (</span><span class="se">\]</span><span class="sr">) # the reference
          (</span><span class="se">\s</span><span class="sr">*) (:) # colon
        )x</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>

          <span class="n">push</span> <span class="ss">:title</span>
          <span class="n">push</span> <span class="ss">:url</span>
        <span class="k">end</span>

        <span class="c1"># links and images</span>
        <span class="n">rule</span> <span class="sr">/(!?\[)(</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">+?)(\])/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Variable&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:link</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[*][*]</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?[*][*]/</span><span class="p">,</span> <span class="s1">&#39;Generic.Strong&#39;</span>
        <span class="n">rule</span> <span class="sr">/__</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?__/</span><span class="p">,</span> <span class="s1">&#39;Generic.Strong&#39;</span>

        <span class="n">rule</span> <span class="sr">/[*]</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?[*]/</span><span class="p">,</span> <span class="s1">&#39;Generic.Emph&#39;</span>
        <span class="n">rule</span> <span class="sr">/_</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?_/</span><span class="p">,</span> <span class="s1">&#39;Generic.Emph&#39;</span>

        <span class="c1"># Automatic links</span>
        <span class="n">rule</span> <span class="sr">/&lt;.*?@.+[.].+&gt;/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">%r[&lt;(https?|mailto|ftp)://</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?&gt;]</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>


        <span class="n">rule</span> <span class="sr">/[^\\`\[*\n&amp;&lt;]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="c1"># inline html</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/&amp;\S*;/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">html</span> <span class="p">}</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/&lt;</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?&gt;/</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">html</span> <span class="p">}</span>
        <span class="n">rule</span> <span class="sr">/[&amp;&lt;]/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:link</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(\[)(</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?)(\])/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">pop!</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[(]/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">push</span> <span class="ss">:inline_title</span>
          <span class="n">push</span> <span class="ss">:inline_url</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[ \t]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:url</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[ \t]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="c1"># the url</span>
        <span class="n">rule</span> <span class="sr">/(&lt;)(</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?)(&gt;)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Tag&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.String.Other&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Tag&#39;</span>
          <span class="n">pop!</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/\S+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:title</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?&quot;/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?&#39;/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span>
        <span class="n">rule</span> <span class="sr">/[(]</span><span class="si">#{</span><span class="n">edot</span><span class="si">}</span><span class="sr">*?[)]/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span>
        <span class="n">rule</span> <span class="sr">/\s*(?=[&quot;&#39;()])/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:inline_title</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[)]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:title</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:inline_url</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[^&lt;\s)]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">mixin</span> <span class="ss">:url</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Perl</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Perl scripting language (perl.org)&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;perl&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;pl&#39;</span>

      <span class="n">filenames</span> <span class="s1">&#39;*.pl&#39;</span><span class="p">,</span> <span class="s1">&#39;*.pm&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-perl&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-perl&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span> <span class="s1">&#39;perl&#39;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">9</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.include?</span> <span class="s1">&#39;my $&#39;</span>
      <span class="k">end</span>

      <span class="n">keywords</span> <span class="o">=</span> <span class="sx">%w(
        case continue do else elsif for foreach if last my next our
        redo reset then unless until while use print new BEGIN CHECK
        INIT END return
      )</span>

      <span class="n">builtins</span> <span class="o">=</span> <span class="sx">%w(
        abs accept alarm atan2 bind binmode bless caller chdir chmod
        chomp chop chown chr chroot close closedir connect continue cos
        crypt dbmclose dbmopen defined delete die dump each endgrent
        endhostent endnetent endprotoent endpwent endservent eof eval
        exec exists exit exp fcntl fileno flock fork format formline getc
        getgrent getgrgid getgrnam gethostbyaddr gethostbyname gethostent
        getlogin getnetbyaddr getnetbyname getnetent getpeername
        getpgrp getppid getpriority getprotobyname getprotobynumber
        getprotoent getpwent getpwnam getpwuid getservbyname getservbyport
        getservent getsockname getsockopt glob gmtime goto grep hex
        import index int ioctl join keys kill last lc lcfirst length
        link listen local localtime log lstat map mkdir msgctl msgget
        msgrcv msgsnd my next no oct open opendir ord our pack package
        pipe pop pos printf prototype push quotemeta rand read readdir
        readline readlink readpipe recv redo ref rename require reverse
        rewinddir rindex rmdir scalar seek seekdir select semctl semget
        semop send setgrent sethostent setnetent setpgrp setpriority
        setprotoent setpwent setservent setsockopt shift shmctl shmget
        shmread shmwrite shutdown sin sleep socket socketpair sort splice
        split sprintf sqrt srand stat study substr symlink syscall sysopen
        sysread sysseek system syswrite tell telldir tie tied time times
        tr truncate uc ucfirst umask undef unlink unpack unshift untie
        utime values vec wait waitpid wantarray warn write
      )</span>

      <span class="n">re_tok</span> <span class="o">=</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>

      <span class="n">state</span> <span class="ss">:balanced_regex</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r(/(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">/|[^/])*/[egimosx]*)m</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(!(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">!|[^!])*![egimosx]*)m</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\\</span><span class="sr">(</span><span class="se">\\\\</span><span class="sr">|[^</span><span class="se">\\</span><span class="sr">])*</span><span class="se">\\</span><span class="sr">[egimosx]*)m</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r({(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">}|[^}])*}[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(&lt;(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">&gt;|[^&gt;])*&gt;[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\[</span><span class="sr">(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\\]</span><span class="sr">|[^</span><span class="se">\]</span><span class="sr">])*</span><span class="se">\]</span><span class="sr">[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\(</span><span class="sr">(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\\)</span><span class="sr">|[^</span><span class="se">\)</span><span class="sr">])*</span><span class="se">\)</span><span class="sr">[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(@(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\\@</span><span class="sr">|[^</span><span class="se">\@</span><span class="sr">])*@[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(%(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\\%</span><span class="sr">|[^</span><span class="se">\%</span><span class="sr">])*%[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\$</span><span class="sr">(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\\$</span><span class="sr">|[^</span><span class="se">\$</span><span class="sr">])*</span><span class="se">\$</span><span class="sr">[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/#.*?$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/^=[a-zA-Z0-9]+\s+.*?\n=cut/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>

        <span class="n">rule</span> <span class="sr">/(format)(\s+)([a-zA-Z0-9_]+)(\s*)(=)(\s*\n)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>

          <span class="n">push</span> <span class="ss">:format</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(?:eq|lt|gt|le|ge|ne|not|and|or|cmp)\b/</span><span class="p">,</span> <span class="s1">&#39;Operator.Word&#39;</span>

        <span class="c1"># common delimiters</span>
        <span class="n">rule</span> <span class="sr">%r(s/(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">/|[^/])*/(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">/|[^/])*/[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span>
        <span class="n">rule</span> <span class="sr">%r(s!(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">!|[^!])*!(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">!|[^!])*![egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span>
        <span class="n">rule</span> <span class="sr">%r(s</span><span class="se">\\</span><span class="sr">(</span><span class="se">\\\\</span><span class="sr">|[^</span><span class="se">\\</span><span class="sr">])*</span><span class="se">\\</span><span class="sr">(</span><span class="se">\\\\</span><span class="sr">|[^</span><span class="se">\\</span><span class="sr">])*</span><span class="se">\\</span><span class="sr">[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span>
        <span class="n">rule</span> <span class="sr">%r(s@(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">@|[^@])*@(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">@|[^@])*@[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span>
        <span class="n">rule</span> <span class="sr">%r(s%(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">%|[^%])*%(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">%|[^%])*%[egimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span>

        <span class="c1"># balanced delimiters</span>
        <span class="n">rule</span> <span class="sr">%r(s{(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">}|[^}])*}</span><span class="se">\s</span><span class="sr">*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:balanced_regex</span>
        <span class="n">rule</span> <span class="sr">%r(s&lt;(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">&gt;|[^&gt;])*&gt;</span><span class="se">\s</span><span class="sr">*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:balanced_regex</span>
        <span class="n">rule</span> <span class="sr">%r(s</span><span class="se">\[</span><span class="sr">(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\\]</span><span class="sr">|[^</span><span class="se">\]</span><span class="sr">])*</span><span class="se">\]\s</span><span class="sr">*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:balanced_regex</span>
        <span class="n">rule</span> <span class="sr">%r(s</span><span class="se">\(</span><span class="sr">(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\\)</span><span class="sr">|[^</span><span class="se">\)</span><span class="sr">])*</span><span class="se">\)\s</span><span class="sr">*)</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:balanced_regex</span>

        <span class="n">rule</span> <span class="sr">%r(m?/(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">/|[^/</span><span class="se">\n</span><span class="sr">])*/[gcimosx]*)</span><span class="p">,</span> <span class="n">re_tok</span>
        <span class="n">rule</span> <span class="sr">%r(m(?=[/!</span><span class="se">\\</span><span class="sr">{&lt;</span><span class="se">\[\(</span><span class="sr">@%</span><span class="se">\$</span><span class="sr">]))</span><span class="p">,</span> <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:balanced_regex</span>
        <span class="n">rule</span> <span class="sr">%r(((?&lt;==~)|(?&lt;=</span><span class="se">\(</span><span class="sr">))</span><span class="se">\s</span><span class="sr">*/(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">/|[^/])*/[gcimosx]*)</span><span class="p">,</span>
          <span class="n">re_tok</span><span class="p">,</span> <span class="ss">:balanced_regex</span>

        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">builtins</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="n">rule</span> <span class="sr">/((__(DATA|DIE|WARN)__)|(STD(IN|OUT|ERR)))\b/</span><span class="p">,</span>
          <span class="s1">&#39;Name.Builtin.Pseudo&#39;</span>

        <span class="n">rule</span> <span class="sr">/&lt;&lt;([\&#39;&quot;]?)([a-zA-Z_][a-zA-Z0-9_]*)\1;?\n.*?\n\2\n/m</span><span class="p">,</span>
          <span class="s1">&#39;Literal.String&#39;</span>

        <span class="n">rule</span> <span class="sr">/__END__\b/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:end_part</span>
        <span class="n">rule</span> <span class="sr">/\$\^[ADEFHILMOPSTWX]/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Global&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$[\\&quot;\[\]&#39;&amp;`+*.,;=%~?@$!&lt;&gt;(^\|\/-](?!\w)/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Global&#39;</span>
        <span class="n">rule</span> <span class="sr">/[$@%#]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:varname</span>

        <span class="n">rule</span> <span class="sr">/0_?[0-7]+(_[0-7]+)*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[0-9A-Fa-f]+(_[0-9A-Fa-f]+)*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/0b[01]+(_[01]+)*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Bin&#39;</span>
        <span class="n">rule</span> <span class="sr">/(\d*(_\d*)*\.\d+(_\d*)*|\d+(_\d*)*\.\d+(_\d*)*)(e[+-]?\d+)?/i</span><span class="p">,</span>
          <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+(_\d*)*e[+-]?\d+(_\d*)*/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+(_\d+)*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>

        <span class="n">rule</span> <span class="sr">/&#39;(\\\\|\\&#39;|[^&#39;])*&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;(\\\\|\\&quot;|[^&quot;])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/`(\\\\|\\`|[^`])*`/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;([^\s&gt;]+)&gt;/</span><span class="p">,</span> <span class="n">re_tok</span>
        <span class="n">rule</span> <span class="sr">/(q|qq|qw|qr|qx)\{/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span> <span class="ss">:cb_string</span>
        <span class="n">rule</span> <span class="sr">/(q|qq|qw|qr|qx)\(/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span> <span class="ss">:rb_string</span>
        <span class="n">rule</span> <span class="sr">/(q|qq|qw|qr|qx)\[/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span> <span class="ss">:sb_string</span>
        <span class="n">rule</span> <span class="sr">/(q|qq|qw|qr|qx)&lt;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span> <span class="ss">:lt_string</span>
        <span class="n">rule</span> <span class="sr">/(q|qq|qw|qr|qx)([^a-zA-Z0-9])(.|\n)*?\2/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span>

        <span class="n">rule</span> <span class="sr">/package\s+/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:modulename</span>
        <span class="n">rule</span> <span class="sr">/sub\s+/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:funcname</span>
        <span class="n">rule</span> <span class="sr">/\[\]|\*\*|::|&lt;&lt;|&gt;&gt;|&gt;=|&lt;=|&lt;=&gt;|={3}|!=|=~|!~|&amp;&amp;?|\|\||\.{1,3}/</span><span class="p">,</span>
          <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[-+\/*%=&lt;&gt;&amp;^\|!\\~]=?/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[()\[\]:;,&lt;&gt;\/?{}]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/(?=\w)/</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:name</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:format</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\.\n/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:name_common</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\w+::/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\w:]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:varname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\{/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span> <span class="c1"># hash syntax</span>
        <span class="n">rule</span> <span class="sr">/\)|,/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span> <span class="c1"># arg specifier</span>
        <span class="n">mixin</span> <span class="ss">:name_common</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:name</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:name_common</span>
        <span class="n">rule</span> <span class="sr">/[A-Z_]+(?=[^a-zA-Z0-9_])/</span><span class="p">,</span> <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/(?=\W)/</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:modulename</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[a-z_]\w*/i</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:funcname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[a-zA-Z_]\w*[!?]?/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="c1"># argument declaration</span>
        <span class="n">rule</span> <span class="sr">/(\([$@%]*\))(\s*)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/.*?{/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/;/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="o">[[</span><span class="ss">:cb</span><span class="p">,</span> <span class="s1">&#39;\{&#39;</span><span class="p">,</span> <span class="s1">&#39;\}&#39;</span><span class="o">]</span><span class="p">,</span>
       <span class="o">[</span><span class="ss">:rb</span><span class="p">,</span> <span class="s1">&#39;\(&#39;</span><span class="p">,</span> <span class="s1">&#39;\)&#39;</span><span class="o">]</span><span class="p">,</span>
       <span class="o">[</span><span class="ss">:sb</span><span class="p">,</span> <span class="s1">&#39;\[&#39;</span><span class="p">,</span> <span class="s1">&#39;\]&#39;</span><span class="o">]</span><span class="p">,</span>
       <span class="o">[</span><span class="ss">:lt</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span>  <span class="s1">&#39;&gt;&#39;</span><span class="o">]]</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="nb">open</span><span class="p">,</span> <span class="n">close</span><span class="o">|</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="s1">&#39;Literal.String.Other&#39;</span>
        <span class="n">state</span> <span class="ss">:&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="ss">_string&quot;</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/\\[</span><span class="si">#{</span><span class="nb">open</span><span class="si">}#{</span><span class="n">close</span><span class="si">}</span><span class="sr">\\]/</span><span class="p">,</span> <span class="n">tok</span>
          <span class="n">rule</span> <span class="sr">/\\/</span><span class="p">,</span> <span class="n">tok</span>
          <span class="n">rule</span><span class="p">(</span><span class="sr">/</span><span class="si">#{</span><span class="nb">open</span><span class="si">}</span><span class="sr">/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="n">tok</span><span class="p">;</span> <span class="n">push</span> <span class="p">}</span>
          <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">close</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="n">tok</span><span class="p">,</span> <span class="ss">:pop!</span>
          <span class="n">rule</span> <span class="sr">/[^</span><span class="si">#{</span><span class="nb">open</span><span class="si">}#{</span><span class="n">close</span><span class="si">}</span><span class="sr">\\]+/</span><span class="p">,</span> <span class="n">tok</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:end_part</span> <span class="k">do</span>
        <span class="c1"># eat the rest of the stream</span>
        <span class="n">rule</span> <span class="sr">/.+/m</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># automatically generated by `rake phpbuiltins`</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">PHP</span>
      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">builtins</span>
        <span class="vi">@builtins</span> <span class="o">||=</span> <span class="p">{}</span><span class="nf">.tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Apache&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(apache_child_terminate apache_child_terminate apache_get_modules apache_get_version apache_getenv apache_lookup_uri apache_note apache_request_headers apache_reset_timeout apache_response_headers apache_setenv getallheaders virtual apache_child_terminate)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;APC&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(apc_add apc_add apc_bin_dump apc_bin_dumpfile apc_bin_load apc_bin_loadfile apc_cache_info apc_cas apc_clear_cache apc_compile_file apc_dec apc_define_constants apc_delete_file apc_delete apc_exists apc_fetch apc_inc apc_load_constants apc_sma_info apc_store apc_add)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;APD&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(apd_breakpoint apd_breakpoint apd_callstack apd_clunk apd_continue apd_croak apd_dump_function_table apd_dump_persistent_resources apd_dump_regular_resources apd_echo apd_get_active_symbols apd_set_pprof_trace apd_set_session_trace_socket apd_set_session_trace apd_set_session override_function rename_function apd_breakpoint)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Array&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(array_change_key_case array_change_key_case array_chunk array_combine array_count_values array_diff_assoc array_diff_key array_diff_uassoc array_diff_ukey array_diff array_fill_keys array_fill array_filter array_flip array_intersect_assoc array_intersect_key array_intersect_uassoc array_intersect_ukey array_intersect array_key_exists array_keys array_map array_merge_recursive array_merge array_multisort array_pad array_pop array_product array_push array_rand array_reduce array_replace_recursive array_replace array_reverse array_search array_shift array_slice array_splice array_sum array_udiff_assoc array_udiff_uassoc array_udiff array_uintersect_assoc array_uintersect_uassoc array_uintersect array_unique array_unshift array_values array_walk_recursive array_walk array arsort asort compact count current each end extract in_array key krsort ksort list natcasesort natsort next pos prev range reset rsort shuffle sizeof sort uasort uksort usort array_change_key_case)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;BBCode&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(bbcode_add_element bbcode_add_element bbcode_add_smiley bbcode_create bbcode_destroy bbcode_parse bbcode_set_arg_parser bbcode_set_flags bbcode_add_element)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;BC Math&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(bcadd bcadd bccomp bcdiv bcmod bcmul bcpow bcpowmod bcscale bcsqrt bcsub bcadd)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;bcompiler&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(bcompiler_load_exe bcompiler_load_exe bcompiler_load bcompiler_parse_class bcompiler_read bcompiler_write_class bcompiler_write_constant bcompiler_write_exe_footer bcompiler_write_file bcompiler_write_footer bcompiler_write_function bcompiler_write_functions_from_file bcompiler_write_header bcompiler_write_included_filename bcompiler_load_exe)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Bzip2&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(bzclose bzclose bzcompress bzdecompress bzerrno bzerror bzerrstr bzflush bzopen bzread bzwrite bzclose)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Cairo&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(cairo_create cairo_create cairo_font_face_get_type cairo_font_face_status cairo_font_options_create cairo_font_options_equal cairo_font_options_get_antialias cairo_font_options_get_hint_metrics cairo_font_options_get_hint_style cairo_font_options_get_subpixel_order cairo_font_options_hash cairo_font_options_merge cairo_font_options_set_antialias cairo_font_options_set_hint_metrics cairo_font_options_set_hint_style cairo_font_options_set_subpixel_order cairo_font_options_status cairo_format_stride_for_width cairo_image_surface_create_for_data cairo_image_surface_create_from_png cairo_image_surface_create cairo_image_surface_get_data cairo_image_surface_get_format cairo_image_surface_get_height cairo_image_surface_get_stride cairo_image_surface_get_width cairo_matrix_create_scale cairo_matrix_create_translate cairo_matrix_invert cairo_matrix_multiply cairo_matrix_rotate cairo_matrix_transform_distance cairo_matrix_transform_point cairo_matrix_translate cairo_pattern_add_color_stop_rgb cairo_pattern_add_color_stop_rgba cairo_pattern_create_for_surface cairo_pattern_create_linear cairo_pattern_create_radial cairo_pattern_create_rgb cairo_pattern_create_rgba cairo_pattern_get_color_stop_count cairo_pattern_get_color_stop_rgba cairo_pattern_get_extend cairo_pattern_get_filter cairo_pattern_get_linear_points cairo_pattern_get_matrix cairo_pattern_get_radial_circles cairo_pattern_get_rgba cairo_pattern_get_surface cairo_pattern_get_type cairo_pattern_set_extend cairo_pattern_set_filter cairo_pattern_set_matrix cairo_pattern_status cairo_pdf_surface_create cairo_pdf_surface_set_size cairo_ps_get_levels cairo_ps_level_to_string cairo_ps_surface_create cairo_ps_surface_dsc_begin_page_setup cairo_ps_surface_dsc_begin_setup cairo_ps_surface_dsc_comment cairo_ps_surface_get_eps cairo_ps_surface_restrict_to_level cairo_ps_surface_set_eps cairo_ps_surface_set_size cairo_scaled_font_create cairo_scaled_font_extents cairo_scaled_font_get_ctm cairo_scaled_font_get_font_face cairo_scaled_font_get_font_matrix cairo_scaled_font_get_font_options cairo_scaled_font_get_scale_matrix cairo_scaled_font_get_type cairo_scaled_font_glyph_extents cairo_scaled_font_status cairo_scaled_font_text_extents cairo_surface_copy_page cairo_surface_create_similar cairo_surface_finish cairo_surface_flush cairo_surface_get_content cairo_surface_get_device_offset cairo_surface_get_font_options cairo_surface_get_type cairo_surface_mark_dirty_rectangle cairo_surface_mark_dirty cairo_surface_set_device_offset cairo_surface_set_fallback_resolution cairo_surface_show_page cairo_surface_status cairo_surface_write_to_png cairo_svg_surface_create cairo_svg_surface_restrict_to_version cairo_svg_version_to_string cairo_create)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Calendar&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(cal_days_in_month cal_days_in_month cal_from_jd cal_info cal_to_jd easter_date easter_days FrenchToJD GregorianToJD JDDayOfWeek JDMonthName JDToFrench JDToGregorian jdtojewish JDToJulian jdtounix JewishToJD JulianToJD unixtojd cal_days_in_month)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;chdb&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(chdb_create chdb_create chdb_create)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Classkit&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(classkit_import classkit_import classkit_method_add classkit_method_copy classkit_method_redefine classkit_method_remove classkit_method_rename classkit_import)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Classes/Object&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(__autoload __autoload call_user_method_array call_user_method class_alias class_exists get_called_class get_class_methods get_class_vars get_class get_declared_classes get_declared_interfaces get_declared_traits get_object_vars get_parent_class interface_exists is_a is_subclass_of method_exists property_exists trait_exists __autoload)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;COM&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(com_addref com_addref com_create_guid com_event_sink com_get_active_object com_get com_invoke com_isenum com_load_typelib com_load com_message_pump com_print_typeinfo com_propget com_propput com_propset com_release com_set variant_abs variant_add variant_and variant_cast variant_cat variant_cmp variant_date_from_timestamp variant_date_to_timestamp variant_div variant_eqv variant_fix variant_get_type variant_idiv variant_imp variant_int variant_mod variant_mul variant_neg variant_not variant_or variant_pow variant_round variant_set_type variant_set variant_sub variant_xor com_addref)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Crack&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(crack_check crack_check crack_closedict crack_getlastmessage crack_opendict crack_check)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Ctype&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ctype_alnum ctype_alnum ctype_alpha ctype_cntrl ctype_digit ctype_graph ctype_lower ctype_print ctype_punct ctype_space ctype_upper ctype_xdigit ctype_alnum)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;CUBRID&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(cubrid_bind cubrid_bind cubrid_close_prepare cubrid_close_request cubrid_col_get cubrid_col_size cubrid_column_names cubrid_column_types cubrid_commit cubrid_connect_with_url cubrid_connect cubrid_current_oid cubrid_disconnect cubrid_drop cubrid_error_code_facility cubrid_error_code cubrid_error_msg cubrid_execute cubrid_fetch cubrid_free_result cubrid_get_autocommit cubrid_get_charset cubrid_get_class_name cubrid_get_client_info cubrid_get_db_parameter cubrid_get_query_timeout cubrid_get_server_info cubrid_get cubrid_insert_id cubrid_is_instance cubrid_lob_close cubrid_lob_export cubrid_lob_get cubrid_lob_send cubrid_lob_size cubrid_lob2_bind cubrid_lob2_close cubrid_lob2_export cubrid_lob2_import cubrid_lob2_new cubrid_lob2_read cubrid_lob2_seek64 cubrid_lob2_seek cubrid_lob2_size64 cubrid_lob2_size cubrid_lob2_tell64 cubrid_lob2_tell cubrid_lob2_write cubrid_lock_read cubrid_lock_write cubrid_move_cursor cubrid_next_result cubrid_num_cols cubrid_num_rows cubrid_pconnect_with_url cubrid_pconnect cubrid_prepare cubrid_put cubrid_rollback cubrid_schema cubrid_seq_drop cubrid_seq_insert cubrid_seq_put cubrid_set_add cubrid_set_autocommit cubrid_set_db_parameter cubrid_set_drop cubrid_set_query_timeout cubrid_version cubrid_bind)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;cURL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(curl_close curl_close curl_copy_handle curl_errno curl_error curl_exec curl_getinfo curl_init curl_multi_add_handle curl_multi_close curl_multi_exec curl_multi_getcontent curl_multi_info_read curl_multi_init curl_multi_remove_handle curl_multi_select curl_setopt_array curl_setopt curl_version curl_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Cyrus&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(cyrus_authenticate cyrus_authenticate cyrus_bind cyrus_close cyrus_connect cyrus_query cyrus_unbind cyrus_authenticate)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Date/Time&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(checkdate checkdate date_add date_create_from_format date_create date_date_set date_default_timezone_get date_default_timezone_set date_diff date_format date_get_last_errors date_interval_create_from_date_string date_interval_format date_isodate_set date_modify date_offset_get date_parse_from_format date_parse date_sub date_sun_info date_sunrise date_sunset date_time_set date_timestamp_get date_timestamp_set date_timezone_get date_timezone_set date getdate gettimeofday gmdate gmmktime gmstrftime idate localtime microtime mktime strftime strptime strtotime time timezone_abbreviations_list timezone_identifiers_list timezone_location_get timezone_name_from_abbr timezone_name_get timezone_offset_get timezone_open timezone_transitions_get timezone_version_get checkdate)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;DBA&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(dba_close dba_close dba_delete dba_exists dba_fetch dba_firstkey dba_handlers dba_insert dba_key_split dba_list dba_nextkey dba_open dba_optimize dba_popen dba_replace dba_sync dba_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;dBase&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(dbase_add_record dbase_add_record dbase_close dbase_create dbase_delete_record dbase_get_header_info dbase_get_record_with_names dbase_get_record dbase_numfields dbase_numrecords dbase_open dbase_pack dbase_replace_record dbase_add_record)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;DB++&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(dbplus_add dbplus_add dbplus_aql dbplus_chdir dbplus_close dbplus_curr dbplus_errcode dbplus_errno dbplus_find dbplus_first dbplus_flush dbplus_freealllocks dbplus_freelock dbplus_freerlocks dbplus_getlock dbplus_getunique dbplus_info dbplus_last dbplus_lockrel dbplus_next dbplus_open dbplus_prev dbplus_rchperm dbplus_rcreate dbplus_rcrtexact dbplus_rcrtlike dbplus_resolve dbplus_restorepos dbplus_rkeys dbplus_ropen dbplus_rquery dbplus_rrename dbplus_rsecindex dbplus_runlink dbplus_rzap dbplus_savepos dbplus_setindex dbplus_setindexbynumber dbplus_sql dbplus_tcl dbplus_tremove dbplus_undo dbplus_undoprepare dbplus_unlockrel dbplus_unselect dbplus_update dbplus_xlockrel dbplus_xunlockrel dbplus_add)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;dbx&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(dbx_close dbx_close dbx_compare dbx_connect dbx_error dbx_escape_string dbx_fetch_row dbx_query dbx_sort dbx_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Direct IO&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(dio_close dio_close dio_fcntl dio_open dio_read dio_seek dio_stat dio_tcsetattr dio_truncate dio_write dio_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Directory&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(chdir chdir chroot closedir dir getcwd opendir readdir rewinddir scandir chdir)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;DOM&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(dom_import_simplexml dom_import_simplexml dom_import_simplexml)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;.NET&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(dotnet_load dotnet_load dotnet_load)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Eio&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(eio_busy eio_busy eio_cancel eio_chmod eio_chown eio_close eio_custom eio_dup2 eio_event_loop eio_fallocate eio_fchmod eio_fchown eio_fdatasync eio_fstat eio_fstatvfs eio_fsync eio_ftruncate eio_futime eio_get_event_stream eio_get_last_error eio_grp_add eio_grp_cancel eio_grp_limit eio_grp eio_init eio_link eio_lstat eio_mkdir eio_mknod eio_nop eio_npending eio_nready eio_nreqs eio_nthreads eio_open eio_poll eio_read eio_readahead eio_readdir eio_readlink eio_realpath eio_rename eio_rmdir eio_seek eio_sendfile eio_set_max_idle eio_set_max_parallel eio_set_max_poll_reqs eio_set_max_poll_time eio_set_min_parallel eio_stat eio_statvfs eio_symlink eio_sync_file_range eio_sync eio_syncfs eio_truncate eio_unlink eio_utime eio_write eio_busy)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Enchant&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(enchant_broker_describe enchant_broker_describe enchant_broker_dict_exists enchant_broker_free_dict enchant_broker_free enchant_broker_get_error enchant_broker_init enchant_broker_list_dicts enchant_broker_request_dict enchant_broker_request_pwl_dict enchant_broker_set_ordering enchant_dict_add_to_personal enchant_dict_add_to_session enchant_dict_check enchant_dict_describe enchant_dict_get_error enchant_dict_is_in_session enchant_dict_quick_check enchant_dict_store_replacement enchant_dict_suggest enchant_broker_describe)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Error Handling&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(debug_backtrace debug_backtrace debug_print_backtrace error_get_last error_log error_reporting restore_error_handler restore_exception_handler set_error_handler set_exception_handler trigger_error user_error debug_backtrace)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Program execution&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(escapeshellarg escapeshellarg escapeshellcmd exec passthru proc_close proc_get_status proc_nice proc_open proc_terminate shell_exec system escapeshellarg)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Exif&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(exif_imagetype exif_imagetype exif_read_data exif_tagname exif_thumbnail read_exif_data exif_imagetype)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Expect&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(expect_expectl expect_expectl expect_popen expect_expectl)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;FAM&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(fam_cancel_monitor fam_cancel_monitor fam_close fam_monitor_collection fam_monitor_directory fam_monitor_file fam_next_event fam_open fam_pending fam_resume_monitor fam_suspend_monitor fam_cancel_monitor)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;FrontBase&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(fbsql_affected_rows fbsql_affected_rows fbsql_autocommit fbsql_blob_size fbsql_change_user fbsql_clob_size fbsql_close fbsql_commit fbsql_connect fbsql_create_blob fbsql_create_clob fbsql_create_db fbsql_data_seek fbsql_database_password fbsql_database fbsql_db_query fbsql_db_status fbsql_drop_db fbsql_errno fbsql_error fbsql_fetch_array fbsql_fetch_assoc fbsql_fetch_field fbsql_fetch_lengths fbsql_fetch_object fbsql_fetch_row fbsql_field_flags fbsql_field_len fbsql_field_name fbsql_field_seek fbsql_field_table fbsql_field_type fbsql_free_result fbsql_get_autostart_info fbsql_hostname fbsql_insert_id fbsql_list_dbs fbsql_list_fields fbsql_list_tables fbsql_next_result fbsql_num_fields fbsql_num_rows fbsql_password fbsql_pconnect fbsql_query fbsql_read_blob fbsql_read_clob fbsql_result fbsql_rollback fbsql_rows_fetched fbsql_select_db fbsql_set_characterset fbsql_set_lob_mode fbsql_set_password fbsql_set_transaction fbsql_start_db fbsql_stop_db fbsql_table_name fbsql_tablename fbsql_username fbsql_warnings fbsql_affected_rows)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;FDF&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(fdf_add_doc_javascript fdf_add_doc_javascript fdf_add_template fdf_close fdf_create fdf_enum_values fdf_errno fdf_error fdf_get_ap fdf_get_attachment fdf_get_encoding fdf_get_file fdf_get_flags fdf_get_opt fdf_get_status fdf_get_value fdf_get_version fdf_header fdf_next_field_name fdf_open_string fdf_open fdf_remove_item fdf_save_string fdf_save fdf_set_ap fdf_set_encoding fdf_set_file fdf_set_flags fdf_set_javascript_action fdf_set_on_import_javascript fdf_set_opt fdf_set_status fdf_set_submit_form_action fdf_set_target_frame fdf_set_value fdf_set_version fdf_add_doc_javascript)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Fileinfo&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(finfo_buffer finfo_buffer finfo_close finfo_file finfo_open finfo_set_flags mime_content_type finfo_buffer)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;filePro&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(filepro_fieldcount filepro_fieldcount filepro_fieldname filepro_fieldtype filepro_fieldwidth filepro_retrieve filepro_rowcount filepro filepro_fieldcount)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Filesystem&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(basename basename chgrp chmod chown clearstatcache copy delete dirname disk_free_space disk_total_space diskfreespace fclose feof fflush fgetc fgetcsv fgets fgetss file_exists file_get_contents file_put_contents file fileatime filectime filegroup fileinode filemtime fileowner fileperms filesize filetype flock fnmatch fopen fpassthru fputcsv fputs fread fscanf fseek fstat ftell ftruncate fwrite glob is_dir is_executable is_file is_link is_readable is_uploaded_file is_writable is_writeable lchgrp lchown link linkinfo lstat mkdir move_uploaded_file parse_ini_file parse_ini_string pathinfo pclose popen readfile readlink realpath_cache_get realpath_cache_size realpath rename rewind rmdir set_file_buffer stat symlink tempnam tmpfile touch umask unlink basename)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Filter&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(filter_has_var filter_has_var filter_id filter_input_array filter_input filter_list filter_var_array filter_var filter_has_var)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;FriBiDi&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(fribidi_log2vis fribidi_log2vis fribidi_log2vis)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;FTP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ftp_alloc ftp_alloc ftp_cdup ftp_chdir ftp_chmod ftp_close ftp_connect ftp_delete ftp_exec ftp_fget ftp_fput ftp_get_option ftp_get ftp_login ftp_mdtm ftp_mkdir ftp_nb_continue ftp_nb_fget ftp_nb_fput ftp_nb_get ftp_nb_put ftp_nlist ftp_pasv ftp_put ftp_pwd ftp_quit ftp_raw ftp_rawlist ftp_rename ftp_rmdir ftp_set_option ftp_site ftp_size ftp_ssl_connect ftp_systype ftp_alloc)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Function handling&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(call_user_func_array call_user_func_array call_user_func create_function forward_static_call_array forward_static_call func_get_arg func_get_args func_num_args function_exists get_defined_functions register_shutdown_function register_tick_function unregister_tick_function call_user_func_array)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;GeoIP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(geoip_continent_code_by_name geoip_continent_code_by_name geoip_country_code_by_name geoip_country_code3_by_name geoip_country_name_by_name geoip_database_info geoip_db_avail geoip_db_filename geoip_db_get_all_info geoip_id_by_name geoip_isp_by_name geoip_org_by_name geoip_record_by_name geoip_region_by_name geoip_region_name_by_code geoip_time_zone_by_country_and_region geoip_continent_code_by_name)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Gettext&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(bind_textdomain_codeset bind_textdomain_codeset bindtextdomain dcgettext dcngettext dgettext dngettext gettext ngettext textdomain bind_textdomain_codeset)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;GMP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(gmp_abs gmp_abs gmp_add gmp_and gmp_clrbit gmp_cmp gmp_com gmp_div_q gmp_div_qr gmp_div_r gmp_div gmp_divexact gmp_fact gmp_gcd gmp_gcdext gmp_hamdist gmp_init gmp_intval gmp_invert gmp_jacobi gmp_legendre gmp_mod gmp_mul gmp_neg gmp_nextprime gmp_or gmp_perfect_square gmp_popcount gmp_pow gmp_powm gmp_prob_prime gmp_random gmp_scan0 gmp_scan1 gmp_setbit gmp_sign gmp_sqrt gmp_sqrtrem gmp_strval gmp_sub gmp_testbit gmp_xor gmp_abs)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;GnuPG&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(gnupg_adddecryptkey gnupg_adddecryptkey gnupg_addencryptkey gnupg_addsignkey gnupg_cleardecryptkeys gnupg_clearencryptkeys gnupg_clearsignkeys gnupg_decrypt gnupg_decryptverify gnupg_encrypt gnupg_encryptsign gnupg_export gnupg_geterror gnupg_getprotocol gnupg_import gnupg_init gnupg_keyinfo gnupg_setarmor gnupg_seterrormode gnupg_setsignmode gnupg_sign gnupg_verify gnupg_adddecryptkey)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Gupnp&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(gupnp_context_get_host_ip gupnp_context_get_host_ip gupnp_context_get_port gupnp_context_get_subscription_timeout gupnp_context_host_path gupnp_context_new gupnp_context_set_subscription_timeout gupnp_context_timeout_add gupnp_context_unhost_path gupnp_control_point_browse_start gupnp_control_point_browse_stop gupnp_control_point_callback_set gupnp_control_point_new gupnp_device_action_callback_set gupnp_device_info_get_service gupnp_device_info_get gupnp_root_device_get_available gupnp_root_device_get_relative_location gupnp_root_device_new gupnp_root_device_set_available gupnp_root_device_start gupnp_root_device_stop gupnp_service_action_get gupnp_service_action_return_error gupnp_service_action_return gupnp_service_action_set gupnp_service_freeze_notify gupnp_service_info_get_introspection gupnp_service_info_get gupnp_service_introspection_get_state_variable gupnp_service_notify gupnp_service_proxy_action_get gupnp_service_proxy_action_set gupnp_service_proxy_add_notify gupnp_service_proxy_callback_set gupnp_service_proxy_get_subscribed gupnp_service_proxy_remove_notify gupnp_service_proxy_set_subscribed gupnp_service_thaw_notify gupnp_context_get_host_ip)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Hash&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(hash_algos hash_algos hash_copy hash_file hash_final hash_hmac_file hash_hmac hash_init hash_pbkdf2 hash_update_file hash_update_stream hash_update hash hash_algos)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;HTTP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(http_cache_etag http_cache_etag http_cache_last_modified http_chunked_decode http_deflate http_inflate http_build_cookie http_date http_get_request_body_stream http_get_request_body http_get_request_headers http_match_etag http_match_modified http_match_request_header http_support http_negotiate_charset http_negotiate_content_type http_negotiate_language ob_deflatehandler ob_etaghandler ob_inflatehandler http_parse_cookie http_parse_headers http_parse_message http_parse_params http_persistent_handles_clean http_persistent_handles_count http_persistent_handles_ident http_get http_head http_post_data http_post_fields http_put_data http_put_file http_put_stream http_request_body_encode http_request_method_exists http_request_method_name http_request_method_register http_request_method_unregister http_request http_redirect http_send_content_disposition http_send_content_type http_send_data http_send_file http_send_last_modified http_send_status http_send_stream http_throttle http_build_str http_build_url http_cache_etag)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Hyperwave&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(hw_Array2Objrec hw_Array2Objrec hw_changeobject hw_Children hw_ChildrenObj hw_Close hw_Connect hw_connection_info hw_cp hw_Deleteobject hw_DocByAnchor hw_DocByAnchorObj hw_Document_Attributes hw_Document_BodyTag hw_Document_Content hw_Document_SetContent hw_Document_Size hw_dummy hw_EditText hw_Error hw_ErrorMsg hw_Free_Document hw_GetAnchors hw_GetAnchorsObj hw_GetAndLock hw_GetChildColl hw_GetChildCollObj hw_GetChildDocColl hw_GetChildDocCollObj hw_GetObject hw_GetObjectByQuery hw_GetObjectByQueryColl hw_GetObjectByQueryCollObj hw_GetObjectByQueryObj hw_GetParents hw_GetParentsObj hw_getrellink hw_GetRemote hw_getremotechildren hw_GetSrcByDestObj hw_GetText hw_getusername hw_Identify hw_InCollections hw_Info hw_InsColl hw_InsDoc hw_insertanchors hw_InsertDocument hw_InsertObject hw_mapid hw_Modifyobject hw_mv hw_New_Document hw_objrec2array hw_Output_Document hw_pConnect hw_PipeDocument hw_Root hw_setlinkroot hw_stat hw_Unlock hw_Who hw_Array2Objrec)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Hyperwave API&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(hwapi_attribute_new hwapi_content_new hwapi_hgcsp hwapi_object_new)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Firebird/InterBase&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ibase_add_user ibase_add_user ibase_affected_rows ibase_backup ibase_blob_add ibase_blob_cancel ibase_blob_close ibase_blob_create ibase_blob_echo ibase_blob_get ibase_blob_import ibase_blob_info ibase_blob_open ibase_close ibase_commit_ret ibase_commit ibase_connect ibase_db_info ibase_delete_user ibase_drop_db ibase_errcode ibase_errmsg ibase_execute ibase_fetch_assoc ibase_fetch_object ibase_fetch_row ibase_field_info ibase_free_event_handler ibase_free_query ibase_free_result ibase_gen_id ibase_maintain_db ibase_modify_user ibase_name_result ibase_num_fields ibase_num_params ibase_param_info ibase_pconnect ibase_prepare ibase_query ibase_restore ibase_rollback_ret ibase_rollback ibase_server_info ibase_service_attach ibase_service_detach ibase_set_event_handler ibase_timefmt ibase_trans ibase_wait_event ibase_add_user)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;IBM DB2&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(db2_autocommit db2_autocommit db2_bind_param db2_client_info db2_close db2_column_privileges db2_columns db2_commit db2_conn_error db2_conn_errormsg db2_connect db2_cursor_type db2_escape_string db2_exec db2_execute db2_fetch_array db2_fetch_assoc db2_fetch_both db2_fetch_object db2_fetch_row db2_field_display_size db2_field_name db2_field_num db2_field_precision db2_field_scale db2_field_type db2_field_width db2_foreign_keys db2_free_result db2_free_stmt db2_get_option db2_last_insert_id db2_lob_read db2_next_result db2_num_fields db2_num_rows db2_pclose db2_pconnect db2_prepare db2_primary_keys db2_procedure_columns db2_procedures db2_result db2_rollback db2_server_info db2_set_option db2_special_columns db2_statistics db2_stmt_error db2_stmt_errormsg db2_table_privileges db2_tables db2_autocommit)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;iconv&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(iconv_get_encoding iconv_get_encoding iconv_mime_decode_headers iconv_mime_decode iconv_mime_encode iconv_set_encoding iconv_strlen iconv_strpos iconv_strrpos iconv_substr iconv ob_iconv_handler iconv_get_encoding)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;ID3&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(id3_get_frame_long_name id3_get_frame_long_name id3_get_frame_short_name id3_get_genre_id id3_get_genre_list id3_get_genre_name id3_get_tag id3_get_version id3_remove_tag id3_set_tag id3_get_frame_long_name)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Informix&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ifx_affected_rows ifx_affected_rows ifx_blobinfile_mode ifx_byteasvarchar ifx_close ifx_connect ifx_copy_blob ifx_create_blob ifx_create_char ifx_do ifx_error ifx_errormsg ifx_fetch_row ifx_fieldproperties ifx_fieldtypes ifx_free_blob ifx_free_char ifx_free_result ifx_get_blob ifx_get_char ifx_getsqlca ifx_htmltbl_result ifx_nullformat ifx_num_fields ifx_num_rows ifx_pconnect ifx_prepare ifx_query ifx_textasvarchar ifx_update_blob ifx_update_char ifxus_close_slob ifxus_create_slob ifxus_free_slob ifxus_open_slob ifxus_read_slob ifxus_seek_slob ifxus_tell_slob ifxus_write_slob ifx_affected_rows)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;IIS&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(iis_add_server iis_add_server iis_get_dir_security iis_get_script_map iis_get_server_by_comment iis_get_server_by_path iis_get_server_rights iis_get_service_state iis_remove_server iis_set_app_settings iis_set_dir_security iis_set_script_map iis_set_server_rights iis_start_server iis_start_service iis_stop_server iis_stop_service iis_add_server)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;GD and Image&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(gd_info gd_info getimagesize getimagesizefromstring image_type_to_extension image_type_to_mime_type image2wbmp imagealphablending imageantialias imagearc imagechar imagecharup imagecolorallocate imagecolorallocatealpha imagecolorat imagecolorclosest imagecolorclosestalpha imagecolorclosesthwb imagecolordeallocate imagecolorexact imagecolorexactalpha imagecolormatch imagecolorresolve imagecolorresolvealpha imagecolorset imagecolorsforindex imagecolorstotal imagecolortransparent imageconvolution imagecopy imagecopymerge imagecopymergegray imagecopyresampled imagecopyresized imagecreate imagecreatefromgd2 imagecreatefromgd2part imagecreatefromgd imagecreatefromgif imagecreatefromjpeg imagecreatefrompng imagecreatefromstring imagecreatefromwbmp imagecreatefromxbm imagecreatefromxpm imagecreatetruecolor imagedashedline imagedestroy imageellipse imagefill imagefilledarc imagefilledellipse imagefilledpolygon imagefilledrectangle imagefilltoborder imagefilter imagefontheight imagefontwidth imageftbbox imagefttext imagegammacorrect imagegd2 imagegd imagegif imagegrabscreen imagegrabwindow imageinterlace imageistruecolor imagejpeg imagelayereffect imageline imageloadfont imagepalettecopy imagepng imagepolygon imagepsbbox imagepsencodefont imagepsextendfont imagepsfreefont imagepsloadfont imagepsslantfont imagepstext imagerectangle imagerotate imagesavealpha imagesetbrush imagesetpixel imagesetstyle imagesetthickness imagesettile imagestring imagestringup imagesx imagesy imagetruecolortopalette imagettfbbox imagettftext imagetypes imagewbmp imagexbm iptcembed iptcparse jpeg2wbmp png2wbmp gd_info)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;IMAP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(imap_8bit imap_8bit imap_alerts imap_append imap_base64 imap_binary imap_body imap_bodystruct imap_check imap_clearflag_full imap_close imap_create imap_createmailbox imap_delete imap_deletemailbox imap_errors imap_expunge imap_fetch_overview imap_fetchbody imap_fetchheader imap_fetchmime imap_fetchstructure imap_fetchtext imap_gc imap_get_quota imap_get_quotaroot imap_getacl imap_getmailboxes imap_getsubscribed imap_header imap_headerinfo imap_headers imap_last_error imap_list imap_listmailbox imap_listscan imap_listsubscribed imap_lsub imap_mail_compose imap_mail_copy imap_mail_move imap_mail imap_mailboxmsginfo imap_mime_header_decode imap_msgno imap_num_msg imap_num_recent imap_open imap_ping imap_qprint imap_rename imap_renamemailbox imap_reopen imap_rfc822_parse_adrlist imap_rfc822_parse_headers imap_rfc822_write_address imap_savebody imap_scan imap_scanmailbox imap_search imap_set_quota imap_setacl imap_setflag_full imap_sort imap_status imap_subscribe imap_thread imap_timeout imap_uid imap_undelete imap_unsubscribe imap_utf7_decode imap_utf7_encode imap_utf8 imap_8bit)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;inclued&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(inclued_get_data inclued_get_data inclued_get_data)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;PHP Options/Info&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(assert_options assert_options assert dl extension_loaded gc_collect_cycles gc_disable gc_enable gc_enabled get_cfg_var get_current_user get_defined_constants get_extension_funcs get_include_path get_included_files get_loaded_extensions get_magic_quotes_gpc get_magic_quotes_runtime get_required_files getenv getlastmod getmygid getmyinode getmypid getmyuid getopt getrusage ini_alter ini_get_all ini_get ini_restore ini_set magic_quotes_runtime main memory_get_peak_usage memory_get_usage php_ini_loaded_file php_ini_scanned_files php_logo_guid php_sapi_name php_uname phpcredits phpinfo phpversion putenv restore_include_path set_include_path set_magic_quotes_runtime set_time_limit sys_get_temp_dir version_compare zend_logo_guid zend_thread_id zend_version assert_options)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Ingres&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ingres_autocommit_state ingres_autocommit_state ingres_autocommit ingres_charset ingres_close ingres_commit ingres_connect ingres_cursor ingres_errno ingres_error ingres_errsqlstate ingres_escape_string ingres_execute ingres_fetch_array ingres_fetch_assoc ingres_fetch_object ingres_fetch_proc_return ingres_fetch_row ingres_field_length ingres_field_name ingres_field_nullable ingres_field_precision ingres_field_scale ingres_field_type ingres_free_result ingres_next_error ingres_num_fields ingres_num_rows ingres_pconnect ingres_prepare ingres_query ingres_result_seek ingres_rollback ingres_set_environment ingres_unbuffered_query ingres_autocommit_state)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Inotify&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(inotify_add_watch inotify_add_watch inotify_init inotify_queue_len inotify_read inotify_rm_watch inotify_add_watch)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Grapheme&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(grapheme_extract grapheme_extract grapheme_stripos grapheme_stristr grapheme_strlen grapheme_strpos grapheme_strripos grapheme_strrpos grapheme_strstr grapheme_substr grapheme_extract)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;intl&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(idn_to_utf8 intl_error_name intl_error_name intl_get_error_code intl_get_error_message intl_is_failure idn_to_utf8 intl_error_name)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;IDN&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(grapheme_substr idn_to_ascii idn_to_ascii idn_to_unicode idn_to_utf8 grapheme_substr idn_to_ascii)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Java&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(java_last_exception_clear java_last_exception_clear java_last_exception_get java_last_exception_clear)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;JSON&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(json_decode json_decode json_encode json_last_error json_decode)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Judy&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(judy_type judy_type judy_version judy_type)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;KADM5&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(kadm5_chpass_principal kadm5_chpass_principal kadm5_create_principal kadm5_delete_principal kadm5_destroy kadm5_flush kadm5_get_policies kadm5_get_principal kadm5_get_principals kadm5_init_with_password kadm5_modify_principal kadm5_chpass_principal)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;LDAP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ldap_8859_to_t61 ldap_8859_to_t61 ldap_add ldap_bind ldap_close ldap_compare ldap_connect ldap_control_paged_result_response ldap_control_paged_result ldap_count_entries ldap_delete ldap_dn2ufn ldap_err2str ldap_errno ldap_error ldap_explode_dn ldap_first_attribute ldap_first_entry ldap_first_reference ldap_free_result ldap_get_attributes ldap_get_dn ldap_get_entries ldap_get_option ldap_get_values_len ldap_get_values ldap_list ldap_mod_add ldap_mod_del ldap_mod_replace ldap_modify ldap_next_attribute ldap_next_entry ldap_next_reference ldap_parse_reference ldap_parse_result ldap_read ldap_rename ldap_sasl_bind ldap_search ldap_set_option ldap_set_rebind_proc ldap_sort ldap_start_tls ldap_t61_to_8859 ldap_unbind ldap_8859_to_t61)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Libevent&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(event_add event_add event_base_free event_base_loop event_base_loopbreak event_base_loopexit event_base_new event_base_priority_init event_base_set event_buffer_base_set event_buffer_disable event_buffer_enable event_buffer_fd_set event_buffer_free event_buffer_new event_buffer_priority_set event_buffer_read event_buffer_set_callback event_buffer_timeout_set event_buffer_watermark_set event_buffer_write event_del event_free event_new event_set event_add)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;libxml&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(libxml_clear_errors libxml_clear_errors libxml_disable_entity_loader libxml_get_errors libxml_get_last_error libxml_set_external_entity_loader libxml_set_streams_context libxml_use_internal_errors libxml_clear_errors)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;LZF&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(lzf_compress lzf_compress lzf_decompress lzf_optimized_for lzf_compress)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Mail&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ezmlm_hash ezmlm_hash mail ezmlm_hash)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Mailparse&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mailparse_determine_best_xfer_encoding mailparse_determine_best_xfer_encoding mailparse_msg_create mailparse_msg_extract_part_file mailparse_msg_extract_part mailparse_msg_extract_whole_part_file mailparse_msg_free mailparse_msg_get_part_data mailparse_msg_get_part mailparse_msg_get_structure mailparse_msg_parse_file mailparse_msg_parse mailparse_rfc822_parse_addresses mailparse_stream_encode mailparse_uudecode_all mailparse_determine_best_xfer_encoding)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Math&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(abs abs acos acosh asin asinh atan2 atan atanh base_convert bindec ceil cos cosh decbin dechex decoct deg2rad exp expm1 floor fmod getrandmax hexdec hypot is_finite is_infinite is_nan lcg_value log10 log1p log max min mt_getrandmax mt_rand mt_srand octdec pi pow rad2deg rand round sin sinh sqrt srand tan tanh abs)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;MaxDB&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(maxdb_affected_rows maxdb_affected_rows maxdb_autocommit maxdb_bind_param maxdb_bind_result maxdb_change_user maxdb_character_set_name maxdb_client_encoding maxdb_close_long_data maxdb_close maxdb_commit maxdb_connect_errno maxdb_connect_error maxdb_connect maxdb_data_seek maxdb_debug maxdb_disable_reads_from_master maxdb_disable_rpl_parse maxdb_dump_debug_info maxdb_embedded_connect maxdb_enable_reads_from_master maxdb_enable_rpl_parse maxdb_errno maxdb_error maxdb_escape_string maxdb_execute maxdb_fetch_array maxdb_fetch_assoc maxdb_fetch_field_direct maxdb_fetch_field maxdb_fetch_fields maxdb_fetch_lengths maxdb_fetch_object maxdb_fetch_row maxdb_fetch maxdb_field_count maxdb_field_seek maxdb_field_tell maxdb_free_result maxdb_get_client_info maxdb_get_client_version maxdb_get_host_info maxdb_get_metadata maxdb_get_proto_info maxdb_get_server_info maxdb_get_server_version maxdb_info maxdb_init maxdb_insert_id maxdb_kill maxdb_master_query maxdb_more_results maxdb_multi_query maxdb_next_result maxdb_num_fields maxdb_num_rows maxdb_options maxdb_param_count maxdb_ping maxdb_prepare maxdb_query maxdb_real_connect maxdb_real_escape_string maxdb_real_query maxdb_report maxdb_rollback maxdb_rpl_parse_enabled maxdb_rpl_probe maxdb_rpl_query_type maxdb_select_db maxdb_send_long_data maxdb_send_query maxdb_server_end maxdb_server_init maxdb_set_opt maxdb_sqlstate maxdb_ssl_set maxdb_stat maxdb_stmt_affected_rows maxdb_stmt_bind_param maxdb_stmt_bind_result maxdb_stmt_close_long_data maxdb_stmt_close maxdb_stmt_data_seek maxdb_stmt_errno maxdb_stmt_error maxdb_stmt_execute maxdb_stmt_fetch maxdb_stmt_free_result maxdb_stmt_init maxdb_stmt_num_rows maxdb_stmt_param_count maxdb_stmt_prepare maxdb_stmt_reset maxdb_stmt_result_metadata maxdb_stmt_send_long_data maxdb_stmt_sqlstate maxdb_stmt_store_result maxdb_store_result maxdb_thread_id maxdb_thread_safe maxdb_use_result maxdb_warning_count maxdb_affected_rows)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Multibyte String&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mb_check_encoding mb_check_encoding mb_convert_case mb_convert_encoding mb_convert_kana mb_convert_variables mb_decode_mimeheader mb_decode_numericentity mb_detect_encoding mb_detect_order mb_encode_mimeheader mb_encode_numericentity mb_encoding_aliases mb_ereg_match mb_ereg_replace_callback mb_ereg_replace mb_ereg_search_getpos mb_ereg_search_getregs mb_ereg_search_init mb_ereg_search_pos mb_ereg_search_regs mb_ereg_search_setpos mb_ereg_search mb_ereg mb_eregi_replace mb_eregi mb_get_info mb_http_input mb_http_output mb_internal_encoding mb_language mb_list_encodings mb_output_handler mb_parse_str mb_preferred_mime_name mb_regex_encoding mb_regex_set_options mb_send_mail mb_split mb_strcut mb_strimwidth mb_stripos mb_stristr mb_strlen mb_strpos mb_strrchr mb_strrichr mb_strripos mb_strrpos mb_strstr mb_strtolower mb_strtoupper mb_strwidth mb_substitute_character mb_substr_count mb_substr mb_check_encoding)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Mcrypt&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mcrypt_cbc mcrypt_cbc mcrypt_cfb mcrypt_create_iv mcrypt_decrypt mcrypt_ecb mcrypt_enc_get_algorithms_name mcrypt_enc_get_block_size mcrypt_enc_get_iv_size mcrypt_enc_get_key_size mcrypt_enc_get_modes_name mcrypt_enc_get_supported_key_sizes mcrypt_enc_is_block_algorithm_mode mcrypt_enc_is_block_algorithm mcrypt_enc_is_block_mode mcrypt_enc_self_test mcrypt_encrypt mcrypt_generic_deinit mcrypt_generic_end mcrypt_generic_init mcrypt_generic mcrypt_get_block_size mcrypt_get_cipher_name mcrypt_get_iv_size mcrypt_get_key_size mcrypt_list_algorithms mcrypt_list_modes mcrypt_module_close mcrypt_module_get_algo_block_size mcrypt_module_get_algo_key_size mcrypt_module_get_supported_key_sizes mcrypt_module_is_block_algorithm_mode mcrypt_module_is_block_algorithm mcrypt_module_is_block_mode mcrypt_module_open mcrypt_module_self_test mcrypt_ofb mdecrypt_generic mcrypt_cbc)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;MCVE&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(m_checkstatus m_checkstatus m_completeauthorizations m_connect m_connectionerror m_deletetrans m_destroyconn m_destroyengine m_getcell m_getcellbynum m_getcommadelimited m_getheader m_initconn m_initengine m_iscommadelimited m_maxconntimeout m_monitor m_numcolumns m_numrows m_parsecommadelimited m_responsekeys m_responseparam m_returnstatus m_setblocking m_setdropfile m_setip m_setssl_cafile m_setssl_files m_setssl m_settimeout m_sslcert_gen_hash m_transactionssent m_transinqueue m_transkeyval m_transnew m_transsend m_uwait m_validateidentifier m_verifyconnection m_verifysslcert m_checkstatus)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Memcache&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(memcache_debug memcache_debug memcache_debug)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Mhash&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mhash_count mhash_count mhash_get_block_size mhash_get_hash_name mhash_keygen_s2k mhash mhash_count)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Ming&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ming_keypress ming_keypress ming_setcubicthreshold ming_setscale ming_setswfcompression ming_useconstants ming_useswfversion ming_keypress)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Misc.&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(connection_aborted connection_aborted connection_status connection_timeout constant define defined die eval exit get_browser __halt_compiler highlight_file highlight_string ignore_user_abort pack php_check_syntax php_strip_whitespace show_source sleep sys_getloadavg time_nanosleep time_sleep_until uniqid unpack usleep connection_aborted)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;mnoGoSearch&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(udm_add_search_limit udm_add_search_limit udm_alloc_agent_array udm_alloc_agent udm_api_version udm_cat_list udm_cat_path udm_check_charset udm_check_stored udm_clear_search_limits udm_close_stored udm_crc32 udm_errno udm_error udm_find udm_free_agent udm_free_ispell_data udm_free_res udm_get_doc_count udm_get_res_field udm_get_res_param udm_hash32 udm_load_ispell_data udm_open_stored udm_set_agent_param udm_add_search_limit)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Mongo&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(bson_decode bson_decode bson_encode bson_decode)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;mqseries&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mqseries_back mqseries_back mqseries_begin mqseries_close mqseries_cmit mqseries_conn mqseries_connx mqseries_disc mqseries_get mqseries_inq mqseries_open mqseries_put1 mqseries_put mqseries_set mqseries_strerror mqseries_back)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Msession&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(msession_connect msession_connect msession_count msession_create msession_destroy msession_disconnect msession_find msession_get_array msession_get_data msession_get msession_inc msession_list msession_listvar msession_lock msession_plugin msession_randstr msession_set_array msession_set_data msession_set msession_timeout msession_uniq msession_unlock msession_connect)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;mSQL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(msql_affected_rows msql_affected_rows msql_close msql_connect msql_create_db msql_createdb msql_data_seek msql_db_query msql_dbname msql_drop_db msql_error msql_fetch_array msql_fetch_field msql_fetch_object msql_fetch_row msql_field_flags msql_field_len msql_field_name msql_field_seek msql_field_table msql_field_type msql_fieldflags msql_fieldlen msql_fieldname msql_fieldtable msql_fieldtype msql_free_result msql_list_dbs msql_list_fields msql_list_tables msql_num_fields msql_num_rows msql_numfields msql_numrows msql_pconnect msql_query msql_regcase msql_result msql_select_db msql_tablename msql msql_affected_rows)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Mssql&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mssql_bind mssql_bind mssql_close mssql_connect mssql_data_seek mssql_execute mssql_fetch_array mssql_fetch_assoc mssql_fetch_batch mssql_fetch_field mssql_fetch_object mssql_fetch_row mssql_field_length mssql_field_name mssql_field_seek mssql_field_type mssql_free_result mssql_free_statement mssql_get_last_message mssql_guid_string mssql_init mssql_min_error_severity mssql_min_message_severity mssql_next_result mssql_num_fields mssql_num_rows mssql_pconnect mssql_query mssql_result mssql_rows_affected mssql_select_db mssql_bind)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;MySQL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mysql_affected_rows mysql_affected_rows mysql_client_encoding mysql_close mysql_connect mysql_create_db mysql_data_seek mysql_db_name mysql_db_query mysql_drop_db mysql_errno mysql_error mysql_escape_string mysql_fetch_array mysql_fetch_assoc mysql_fetch_field mysql_fetch_lengths mysql_fetch_object mysql_fetch_row mysql_field_flags mysql_field_len mysql_field_name mysql_field_seek mysql_field_table mysql_field_type mysql_free_result mysql_get_client_info mysql_get_host_info mysql_get_proto_info mysql_get_server_info mysql_info mysql_insert_id mysql_list_dbs mysql_list_fields mysql_list_processes mysql_list_tables mysql_num_fields mysql_num_rows mysql_pconnect mysql_ping mysql_query mysql_real_escape_string mysql_result mysql_select_db mysql_set_charset mysql_stat mysql_tablename mysql_thread_id mysql_unbuffered_query mysql_affected_rows)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Aliases and deprecated Mysqli&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mysqli_bind_param mysqli_bind_param mysqli_bind_result mysqli_client_encoding mysqli_connect mysqli_disable_rpl_parse mysqli_enable_reads_from_master mysqli_enable_rpl_parse mysqli_escape_string mysqli_execute mysqli_fetch mysqli_get_cache_stats mysqli_get_metadata mysqli_master_query mysqli_param_count mysqli_report mysqli_rpl_parse_enabled mysqli_rpl_probe mysqli_send_long_data mysqli_set_opt mysqli_slave_query mysqli_bind_param)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Mysqlnd_ms&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mysqlnd_ms_get_last_gtid mysqlnd_ms_get_last_gtid mysqlnd_ms_get_last_used_connection mysqlnd_ms_get_stats mysqlnd_ms_match_wild mysqlnd_ms_query_is_select mysqlnd_ms_set_qos mysqlnd_ms_set_user_pick_server mysqlnd_ms_get_last_gtid)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;mysqlnd_qc&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mysqlnd_qc_clear_cache mysqlnd_qc_clear_cache mysqlnd_qc_get_available_handlers mysqlnd_qc_get_cache_info mysqlnd_qc_get_core_stats mysqlnd_qc_get_normalized_query_trace_log mysqlnd_qc_get_query_trace_log mysqlnd_qc_set_cache_condition mysqlnd_qc_set_is_select mysqlnd_qc_set_storage_handler mysqlnd_qc_set_user_handlers mysqlnd_qc_clear_cache)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Mysqlnd_uh&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(mysqlnd_uh_convert_to_mysqlnd mysqlnd_uh_convert_to_mysqlnd mysqlnd_uh_set_connection_proxy mysqlnd_uh_set_statement_proxy mysqlnd_uh_convert_to_mysqlnd)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Ncurses&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ncurses_addch ncurses_addch ncurses_addchnstr ncurses_addchstr ncurses_addnstr ncurses_addstr ncurses_assume_default_colors ncurses_attroff ncurses_attron ncurses_attrset ncurses_baudrate ncurses_beep ncurses_bkgd ncurses_bkgdset ncurses_border ncurses_bottom_panel ncurses_can_change_color ncurses_cbreak ncurses_clear ncurses_clrtobot ncurses_clrtoeol ncurses_color_content ncurses_color_set ncurses_curs_set ncurses_def_prog_mode ncurses_def_shell_mode ncurses_define_key ncurses_del_panel ncurses_delay_output ncurses_delch ncurses_deleteln ncurses_delwin ncurses_doupdate ncurses_echo ncurses_echochar ncurses_end ncurses_erase ncurses_erasechar ncurses_filter ncurses_flash ncurses_flushinp ncurses_getch ncurses_getmaxyx ncurses_getmouse ncurses_getyx ncurses_halfdelay ncurses_has_colors ncurses_has_ic ncurses_has_il ncurses_has_key ncurses_hide_panel ncurses_hline ncurses_inch ncurses_init_color ncurses_init_pair ncurses_init ncurses_insch ncurses_insdelln ncurses_insertln ncurses_insstr ncurses_instr ncurses_isendwin ncurses_keyok ncurses_keypad ncurses_killchar ncurses_longname ncurses_meta ncurses_mouse_trafo ncurses_mouseinterval ncurses_mousemask ncurses_move_panel ncurses_move ncurses_mvaddch ncurses_mvaddchnstr ncurses_mvaddchstr ncurses_mvaddnstr ncurses_mvaddstr ncurses_mvcur ncurses_mvdelch ncurses_mvgetch ncurses_mvhline ncurses_mvinch ncurses_mvvline ncurses_mvwaddstr ncurses_napms ncurses_new_panel ncurses_newpad ncurses_newwin ncurses_nl ncurses_nocbreak ncurses_noecho ncurses_nonl ncurses_noqiflush ncurses_noraw ncurses_pair_content ncurses_panel_above ncurses_panel_below ncurses_panel_window ncurses_pnoutrefresh ncurses_prefresh ncurses_putp ncurses_qiflush ncurses_raw ncurses_refresh ncurses_replace_panel ncurses_reset_prog_mode ncurses_reset_shell_mode ncurses_resetty ncurses_savetty ncurses_scr_dump ncurses_scr_init ncurses_scr_restore ncurses_scr_set ncurses_scrl ncurses_show_panel ncurses_slk_attr ncurses_slk_attroff ncurses_slk_attron ncurses_slk_attrset ncurses_slk_clear ncurses_slk_color ncurses_slk_init ncurses_slk_noutrefresh ncurses_slk_refresh ncurses_slk_restore ncurses_slk_set ncurses_slk_touch ncurses_standend ncurses_standout ncurses_start_color ncurses_termattrs ncurses_termname ncurses_timeout ncurses_top_panel ncurses_typeahead ncurses_ungetch ncurses_ungetmouse ncurses_update_panels ncurses_use_default_colors ncurses_use_env ncurses_use_extended_names ncurses_vidattr ncurses_vline ncurses_waddch ncurses_waddstr ncurses_wattroff ncurses_wattron ncurses_wattrset ncurses_wborder ncurses_wclear ncurses_wcolor_set ncurses_werase ncurses_wgetch ncurses_whline ncurses_wmouse_trafo ncurses_wmove ncurses_wnoutrefresh ncurses_wrefresh ncurses_wstandend ncurses_wstandout ncurses_wvline ncurses_addch)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Gopher&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(gopher_parsedir gopher_parsedir gopher_parsedir)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Network&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(checkdnsrr checkdnsrr closelog define_syslog_variables dns_check_record dns_get_mx dns_get_record fsockopen gethostbyaddr gethostbyname gethostbynamel gethostname getmxrr getprotobyname getprotobynumber getservbyname getservbyport header_register_callback header_remove header headers_list headers_sent http_response_code inet_ntop inet_pton ip2long long2ip openlog pfsockopen setcookie setrawcookie socket_get_status socket_set_blocking socket_set_timeout syslog checkdnsrr)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Newt&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(newt_bell newt_bell newt_button_bar newt_button newt_centered_window newt_checkbox_get_value newt_checkbox_set_flags newt_checkbox_set_value newt_checkbox_tree_add_item newt_checkbox_tree_find_item newt_checkbox_tree_get_current newt_checkbox_tree_get_entry_value newt_checkbox_tree_get_multi_selection newt_checkbox_tree_get_selection newt_checkbox_tree_multi newt_checkbox_tree_set_current newt_checkbox_tree_set_entry_value newt_checkbox_tree_set_entry newt_checkbox_tree_set_width newt_checkbox_tree newt_checkbox newt_clear_key_buffer newt_cls newt_compact_button newt_component_add_callback newt_component_takes_focus newt_create_grid newt_cursor_off newt_cursor_on newt_delay newt_draw_form newt_draw_root_text newt_entry_get_value newt_entry_set_filter newt_entry_set_flags newt_entry_set newt_entry newt_finished newt_form_add_component newt_form_add_components newt_form_add_hot_key newt_form_destroy newt_form_get_current newt_form_run newt_form_set_background newt_form_set_height newt_form_set_size newt_form_set_timer newt_form_set_width newt_form_watch_fd newt_form newt_get_screen_size newt_grid_add_components_to_form newt_grid_basic_window newt_grid_free newt_grid_get_size newt_grid_h_close_stacked newt_grid_h_stacked newt_grid_place newt_grid_set_field newt_grid_simple_window newt_grid_v_close_stacked newt_grid_v_stacked newt_grid_wrapped_window_at newt_grid_wrapped_window newt_init newt_label_set_text newt_label newt_listbox_append_entry newt_listbox_clear_selection newt_listbox_clear newt_listbox_delete_entry newt_listbox_get_current newt_listbox_get_selection newt_listbox_insert_entry newt_listbox_item_count newt_listbox_select_item newt_listbox_set_current_by_key newt_listbox_set_current newt_listbox_set_data newt_listbox_set_entry newt_listbox_set_width newt_listbox newt_listitem_get_data newt_listitem_set newt_listitem newt_open_window newt_pop_help_line newt_pop_window newt_push_help_line newt_radio_get_current newt_radiobutton newt_redraw_help_line newt_reflow_text newt_refresh newt_resize_screen newt_resume newt_run_form newt_scale_set newt_scale newt_scrollbar_set newt_set_help_callback newt_set_suspend_callback newt_suspend newt_textbox_get_num_lines newt_textbox_reflowed newt_textbox_set_height newt_textbox_set_text newt_textbox newt_vertical_scrollbar newt_wait_for_key newt_win_choice newt_win_entries newt_win_menu newt_win_message newt_win_messagev newt_win_ternary newt_bell)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;YP/NIS&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(yp_all yp_all yp_cat yp_err_string yp_errno yp_first yp_get_default_domain yp_master yp_match yp_next yp_order yp_all)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Lotus Notes&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(notes_body notes_body notes_copy_db notes_create_db notes_create_note notes_drop_db notes_find_note notes_header_info notes_list_msgs notes_mark_read notes_mark_unread notes_nav_create notes_search notes_unread notes_version notes_body)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;NSAPI&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(nsapi_request_headers nsapi_request_headers nsapi_response_headers nsapi_virtual nsapi_request_headers)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;OAuth&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(oauth_get_sbs oauth_get_sbs oauth_urlencode oauth_get_sbs)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Object Aggregation&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(aggregate_info aggregate_info aggregate_methods_by_list aggregate_methods_by_regexp aggregate_methods aggregate_properties_by_list aggregate_properties_by_regexp aggregate_properties aggregate aggregation_info deaggregate aggregate_info)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;OCI8&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(oci_bind_array_by_name oci_bind_by_name oci_cancel oci_client_version oci_close oci_commit oci_connect oci_define_by_name oci_error oci_execute oci_fetch_all oci_fetch_array oci_fetch_assoc oci_fetch_object oci_fetch_row oci_fetch oci_field_is_null oci_field_name oci_field_precision oci_field_scale oci_field_size oci_field_type_raw oci_field_type oci_free_statement oci_internal_debug oci_lob_copy oci_lob_is_equal oci_new_collection oci_new_connect oci_new_cursor oci_new_descriptor oci_num_fields oci_num_rows oci_parse oci_password_change oci_pconnect oci_result oci_rollback oci_server_version oci_set_action oci_set_client_identifier oci_set_client_info oci_set_edition oci_set_module_name oci_set_prefetch oci_statement_type)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;OpenAL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(openal_buffer_create openal_buffer_create openal_buffer_data openal_buffer_destroy openal_buffer_get openal_buffer_loadwav openal_context_create openal_context_current openal_context_destroy openal_context_process openal_context_suspend openal_device_close openal_device_open openal_listener_get openal_listener_set openal_source_create openal_source_destroy openal_source_get openal_source_pause openal_source_play openal_source_rewind openal_source_set openal_source_stop openal_stream openal_buffer_create)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;OpenSSL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(openssl_cipher_iv_length openssl_cipher_iv_length openssl_csr_export_to_file openssl_csr_export openssl_csr_get_public_key openssl_csr_get_subject openssl_csr_new openssl_csr_sign openssl_decrypt openssl_dh_compute_key openssl_digest openssl_encrypt openssl_error_string openssl_free_key openssl_get_cipher_methods openssl_get_md_methods openssl_get_privatekey openssl_get_publickey openssl_open openssl_pkcs12_export_to_file openssl_pkcs12_export openssl_pkcs12_read openssl_pkcs7_decrypt openssl_pkcs7_encrypt openssl_pkcs7_sign openssl_pkcs7_verify openssl_pkey_export_to_file openssl_pkey_export openssl_pkey_free openssl_pkey_get_details openssl_pkey_get_private openssl_pkey_get_public openssl_pkey_new openssl_private_decrypt openssl_private_encrypt openssl_public_decrypt openssl_public_encrypt openssl_random_pseudo_bytes openssl_seal openssl_sign openssl_verify openssl_x509_check_private_key openssl_x509_checkpurpose openssl_x509_export_to_file openssl_x509_export openssl_x509_free openssl_x509_parse openssl_x509_read openssl_cipher_iv_length)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Output Control&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(flush flush ob_clean ob_end_clean ob_end_flush ob_flush ob_get_clean ob_get_contents ob_get_flush ob_get_length ob_get_level ob_get_status ob_gzhandler ob_implicit_flush ob_list_handlers ob_start output_add_rewrite_var output_reset_rewrite_vars flush)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Ovrimos SQL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ovrimos_close ovrimos_close ovrimos_commit ovrimos_connect ovrimos_cursor ovrimos_exec ovrimos_execute ovrimos_fetch_into ovrimos_fetch_row ovrimos_field_len ovrimos_field_name ovrimos_field_num ovrimos_field_type ovrimos_free_result ovrimos_longreadlen ovrimos_num_fields ovrimos_num_rows ovrimos_prepare ovrimos_result_all ovrimos_result ovrimos_rollback ovrimos_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Paradox&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(px_close px_close px_create_fp px_date2string px_delete_record px_delete px_get_field px_get_info px_get_parameter px_get_record px_get_schema px_get_value px_insert_record px_new px_numfields px_numrecords px_open_fp px_put_record px_retrieve_record px_set_blob_file px_set_parameter px_set_tablename px_set_targetencoding px_set_value px_timestamp2string px_update_record px_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Parsekit&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(parsekit_compile_file parsekit_compile_file parsekit_compile_string parsekit_func_arginfo parsekit_compile_file)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;PCNTL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(pcntl_alarm pcntl_alarm pcntl_exec pcntl_fork pcntl_getpriority pcntl_setpriority pcntl_signal_dispatch pcntl_signal pcntl_sigprocmask pcntl_sigtimedwait pcntl_sigwaitinfo pcntl_wait pcntl_waitpid pcntl_wexitstatus pcntl_wifexited pcntl_wifsignaled pcntl_wifstopped pcntl_wstopsig pcntl_wtermsig pcntl_alarm)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;PCRE&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(preg_filter preg_filter preg_grep preg_last_error preg_match_all preg_match preg_quote preg_replace_callback preg_replace preg_split preg_filter)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;PDF&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(PDF_activate_item PDF_activate_item PDF_add_annotation PDF_add_bookmark PDF_add_launchlink PDF_add_locallink PDF_add_nameddest PDF_add_note PDF_add_outline PDF_add_pdflink PDF_add_table_cell PDF_add_textflow PDF_add_thumbnail PDF_add_weblink PDF_arc PDF_arcn PDF_attach_file PDF_begin_document PDF_begin_font PDF_begin_glyph PDF_begin_item PDF_begin_layer PDF_begin_page_ext PDF_begin_page PDF_begin_pattern PDF_begin_template_ext PDF_begin_template PDF_circle PDF_clip PDF_close_image PDF_close_pdi_page PDF_close_pdi PDF_close PDF_closepath_fill_stroke PDF_closepath_stroke PDF_closepath PDF_concat PDF_continue_text PDF_create_3dview PDF_create_action PDF_create_annotation PDF_create_bookmark PDF_create_field PDF_create_fieldgroup PDF_create_gstate PDF_create_pvf PDF_create_textflow PDF_curveto PDF_define_layer PDF_delete_pvf PDF_delete_table PDF_delete_textflow PDF_delete PDF_encoding_set_char PDF_end_document PDF_end_font PDF_end_glyph PDF_end_item PDF_end_layer PDF_end_page_ext PDF_end_page PDF_end_pattern PDF_end_template PDF_endpath PDF_fill_imageblock PDF_fill_pdfblock PDF_fill_stroke PDF_fill_textblock PDF_fill PDF_findfont PDF_fit_image PDF_fit_pdi_page PDF_fit_table PDF_fit_textflow PDF_fit_textline PDF_get_apiname PDF_get_buffer PDF_get_errmsg PDF_get_errnum PDF_get_font PDF_get_fontname PDF_get_fontsize PDF_get_image_height PDF_get_image_width PDF_get_majorversion PDF_get_minorversion PDF_get_parameter PDF_get_pdi_parameter PDF_get_pdi_value PDF_get_value PDF_info_font PDF_info_matchbox PDF_info_table PDF_info_textflow PDF_info_textline PDF_initgraphics PDF_lineto PDF_load_3ddata PDF_load_font PDF_load_iccprofile PDF_load_image PDF_makespotcolor PDF_moveto PDF_new PDF_open_ccitt PDF_open_file PDF_open_gif PDF_open_image_file PDF_open_image PDF_open_jpeg PDF_open_memory_image PDF_open_pdi_document PDF_open_pdi_page PDF_open_pdi PDF_open_tiff PDF_pcos_get_number PDF_pcos_get_stream PDF_pcos_get_string PDF_place_image PDF_place_pdi_page PDF_process_pdi PDF_rect PDF_restore PDF_resume_page PDF_rotate PDF_save PDF_scale PDF_set_border_color PDF_set_border_dash PDF_set_border_style PDF_set_char_spacing PDF_set_duration PDF_set_gstate PDF_set_horiz_scaling PDF_set_info_author PDF_set_info_creator PDF_set_info_keywords PDF_set_info_subject PDF_set_info_title PDF_set_info PDF_set_layer_dependency PDF_set_leading PDF_set_parameter PDF_set_text_matrix PDF_set_text_pos PDF_set_text_rendering PDF_set_text_rise PDF_set_value PDF_set_word_spacing PDF_setcolor PDF_setdash PDF_setdashpattern PDF_setflat PDF_setfont PDF_setgray_fill PDF_setgray_stroke PDF_setgray PDF_setlinecap PDF_setlinejoin PDF_setlinewidth PDF_setmatrix PDF_setmiterlimit PDF_setpolydash PDF_setrgbcolor_fill PDF_setrgbcolor_stroke PDF_setrgbcolor PDF_shading_pattern PDF_shading PDF_shfill PDF_show_boxed PDF_show_xy PDF_show PDF_skew PDF_stringwidth PDF_stroke PDF_suspend_page PDF_translate PDF_utf16_to_utf8 PDF_utf32_to_utf16 PDF_utf8_to_utf16 PDF_activate_item)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;PostgreSQL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(pg_affected_rows pg_affected_rows pg_cancel_query pg_client_encoding pg_close pg_connect pg_connection_busy pg_connection_reset pg_connection_status pg_convert pg_copy_from pg_copy_to pg_dbname pg_delete pg_end_copy pg_escape_bytea pg_escape_identifier pg_escape_literal pg_escape_string pg_execute pg_fetch_all_columns pg_fetch_all pg_fetch_array pg_fetch_assoc pg_fetch_object pg_fetch_result pg_fetch_row pg_field_is_null pg_field_name pg_field_num pg_field_prtlen pg_field_size pg_field_table pg_field_type_oid pg_field_type pg_free_result pg_get_notify pg_get_pid pg_get_result pg_host pg_insert pg_last_error pg_last_notice pg_last_oid pg_lo_close pg_lo_create pg_lo_export pg_lo_import pg_lo_open pg_lo_read_all pg_lo_read pg_lo_seek pg_lo_tell pg_lo_unlink pg_lo_write pg_meta_data pg_num_fields pg_num_rows pg_options pg_parameter_status pg_pconnect pg_ping pg_port pg_prepare pg_put_line pg_query_params pg_query pg_result_error_field pg_result_error pg_result_seek pg_result_status pg_select pg_send_execute pg_send_prepare pg_send_query_params pg_send_query pg_set_client_encoding pg_set_error_verbosity pg_trace pg_transaction_status pg_tty pg_unescape_bytea pg_untrace pg_update pg_version pg_affected_rows)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;POSIX&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(posix_access posix_access posix_ctermid posix_errno posix_get_last_error posix_getcwd posix_getegid posix_geteuid posix_getgid posix_getgrgid posix_getgrnam posix_getgroups posix_getlogin posix_getpgid posix_getpgrp posix_getpid posix_getppid posix_getpwnam posix_getpwuid posix_getrlimit posix_getsid posix_getuid posix_initgroups posix_isatty posix_kill posix_mkfifo posix_mknod posix_setegid posix_seteuid posix_setgid posix_setpgid posix_setsid posix_setuid posix_strerror posix_times posix_ttyname posix_uname posix_access)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Printer&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(printer_abort printer_abort printer_close printer_create_brush printer_create_dc printer_create_font printer_create_pen printer_delete_brush printer_delete_dc printer_delete_font printer_delete_pen printer_draw_bmp printer_draw_chord printer_draw_elipse printer_draw_line printer_draw_pie printer_draw_rectangle printer_draw_roundrect printer_draw_text printer_end_doc printer_end_page printer_get_option printer_list printer_logical_fontheight printer_open printer_select_brush printer_select_font printer_select_pen printer_set_option printer_start_doc printer_start_page printer_write printer_abort)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Proctitle&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(setproctitle setproctitle setthreadtitle setproctitle)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;PS&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ps_add_bookmark ps_add_bookmark ps_add_launchlink ps_add_locallink ps_add_note ps_add_pdflink ps_add_weblink ps_arc ps_arcn ps_begin_page ps_begin_pattern ps_begin_template ps_circle ps_clip ps_close_image ps_close ps_closepath_stroke ps_closepath ps_continue_text ps_curveto ps_delete ps_end_page ps_end_pattern ps_end_template ps_fill_stroke ps_fill ps_findfont ps_get_buffer ps_get_parameter ps_get_value ps_hyphenate ps_include_file ps_lineto ps_makespotcolor ps_moveto ps_new ps_open_file ps_open_image_file ps_open_image ps_open_memory_image ps_place_image ps_rect ps_restore ps_rotate ps_save ps_scale ps_set_border_color ps_set_border_dash ps_set_border_style ps_set_info ps_set_parameter ps_set_text_pos ps_set_value ps_setcolor ps_setdash ps_setflat ps_setfont ps_setgray ps_setlinecap ps_setlinejoin ps_setlinewidth ps_setmiterlimit ps_setoverprintmode ps_setpolydash ps_shading_pattern ps_shading ps_shfill ps_show_boxed ps_show_xy2 ps_show_xy ps_show2 ps_show ps_string_geometry ps_stringwidth ps_stroke ps_symbol_name ps_symbol_width ps_symbol ps_translate ps_add_bookmark)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Pspell&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(pspell_add_to_personal pspell_add_to_personal pspell_add_to_session pspell_check pspell_clear_session pspell_config_create pspell_config_data_dir pspell_config_dict_dir pspell_config_ignore pspell_config_mode pspell_config_personal pspell_config_repl pspell_config_runtogether pspell_config_save_repl pspell_new_config pspell_new_personal pspell_new pspell_save_wordlist pspell_store_replacement pspell_suggest pspell_add_to_personal)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;qtdom&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(qdom_error qdom_error qdom_tree qdom_error)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Radius&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(radius_acct_open radius_acct_open radius_add_server radius_auth_open radius_close radius_config radius_create_request radius_cvt_addr radius_cvt_int radius_cvt_string radius_demangle_mppe_key radius_demangle radius_get_attr radius_get_vendor_attr radius_put_addr radius_put_attr radius_put_int radius_put_string radius_put_vendor_addr radius_put_vendor_attr radius_put_vendor_int radius_put_vendor_string radius_request_authenticator radius_send_request radius_server_secret radius_strerror radius_acct_open)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Rar&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(rar_wrapper_cache_stats rar_wrapper_cache_stats rar_wrapper_cache_stats)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Readline&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(readline_add_history readline_add_history readline_callback_handler_install readline_callback_handler_remove readline_callback_read_char readline_clear_history readline_completion_function readline_info readline_list_history readline_on_new_line readline_read_history readline_redisplay readline_write_history readline readline_add_history)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Recode&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(recode_file recode_file recode_string recode recode_file)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;POSIX Regex&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ereg_replace ereg_replace ereg eregi_replace eregi split spliti sql_regcase ereg_replace)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;RPM Reader&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(rpm_close rpm_close rpm_get_tag rpm_is_valid rpm_open rpm_version rpm_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;RRD&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(rrd_create rrd_create rrd_error rrd_fetch rrd_first rrd_graph rrd_info rrd_last rrd_lastupdate rrd_restore rrd_tune rrd_update rrd_version rrd_xport rrd_create)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;runkit&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(runkit_class_adopt runkit_class_emancipate runkit_constant_add runkit_constant_redefine runkit_constant_remove runkit_function_add runkit_function_copy runkit_function_redefine runkit_function_remove runkit_function_rename runkit_import runkit_lint_file runkit_lint runkit_method_add runkit_method_copy runkit_method_redefine runkit_method_remove runkit_method_rename runkit_return_value_used runkit_sandbox_output_handler runkit_superglobals)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SAM&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w()</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SCA&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w()</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SDO DAS XML&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w()</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SDO&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w()</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SDO-DAS-Relational&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w()</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Semaphore&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ftok ftok msg_get_queue msg_queue_exists msg_receive msg_remove_queue msg_send msg_set_queue msg_stat_queue sem_acquire sem_get sem_release sem_remove shm_attach shm_detach shm_get_var shm_has_var shm_put_var shm_remove_var shm_remove ftok)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Session PgSQL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(session_pgsql_add_error session_pgsql_add_error session_pgsql_get_error session_pgsql_get_field session_pgsql_reset session_pgsql_set_field session_pgsql_status session_pgsql_add_error)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Session&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(session_cache_expire session_cache_expire session_cache_limiter session_commit session_decode session_destroy session_encode session_get_cookie_params session_id session_is_registered session_module_name session_name session_regenerate_id session_register_shutdown session_register session_save_path session_set_cookie_params session_set_save_handler session_start session_status session_unregister session_unset session_write_close session_cache_expire)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Shared Memory&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(shmop_close shmop_close shmop_delete shmop_open shmop_read shmop_size shmop_write shmop_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SimpleXML&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(simplexml_import_dom simplexml_import_dom simplexml_load_file simplexml_load_string simplexml_import_dom)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SNMP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(snmp_get_quick_print snmp_get_quick_print snmp_get_valueretrieval snmp_read_mib snmp_set_enum_print snmp_set_oid_numeric_print snmp_set_oid_output_format snmp_set_quick_print snmp_set_valueretrieval snmp2_get snmp2_getnext snmp2_real_walk snmp2_set snmp2_walk snmp3_get snmp3_getnext snmp3_real_walk snmp3_set snmp3_walk snmpget snmpgetnext snmprealwalk snmpset snmpwalk snmpwalkoid snmp_get_quick_print)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SOAP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(is_soap_fault is_soap_fault use_soap_error_handler is_soap_fault)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Socket&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(socket_accept socket_accept socket_bind socket_clear_error socket_close socket_connect socket_create_listen socket_create_pair socket_create socket_get_option socket_getpeername socket_getsockname socket_import_stream socket_last_error socket_listen socket_read socket_recv socket_recvfrom socket_select socket_send socket_sendto socket_set_block socket_set_nonblock socket_set_option socket_shutdown socket_strerror socket_write socket_accept)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Solr&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(solr_get_version solr_get_version solr_get_version)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SPL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(class_implements class_implements class_parents class_uses iterator_apply iterator_count iterator_to_array spl_autoload_call spl_autoload_extensions spl_autoload_functions spl_autoload_register spl_autoload_unregister spl_autoload spl_classes spl_object_hash class_implements)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SPPLUS&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(calcul_hmac calcul_hmac calculhmac nthmac signeurlpaiement calcul_hmac)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SQLite&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(sqlite_array_query sqlite_array_query sqlite_busy_timeout sqlite_changes sqlite_close sqlite_column sqlite_create_aggregate sqlite_create_function sqlite_current sqlite_error_string sqlite_escape_string sqlite_exec sqlite_factory sqlite_fetch_all sqlite_fetch_array sqlite_fetch_column_types sqlite_fetch_object sqlite_fetch_single sqlite_fetch_string sqlite_field_name sqlite_has_more sqlite_has_prev sqlite_key sqlite_last_error sqlite_last_insert_rowid sqlite_libencoding sqlite_libversion sqlite_next sqlite_num_fields sqlite_num_rows sqlite_open sqlite_popen sqlite_prev sqlite_query sqlite_rewind sqlite_seek sqlite_single_query sqlite_udf_decode_binary sqlite_udf_encode_binary sqlite_unbuffered_query sqlite_valid sqlite_array_query)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SQLSRV&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(sqlsrv_begin_transaction sqlsrv_begin_transaction sqlsrv_cancel sqlsrv_client_info sqlsrv_close sqlsrv_commit sqlsrv_configure sqlsrv_connect sqlsrv_errors sqlsrv_execute sqlsrv_fetch_array sqlsrv_fetch_object sqlsrv_fetch sqlsrv_field_metadata sqlsrv_free_stmt sqlsrv_get_config sqlsrv_get_field sqlsrv_has_rows sqlsrv_next_result sqlsrv_num_fields sqlsrv_num_rows sqlsrv_prepare sqlsrv_query sqlsrv_rollback sqlsrv_rows_affected sqlsrv_send_stream_data sqlsrv_server_info sqlsrv_begin_transaction)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;ssdeep&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ssdeep_fuzzy_compare ssdeep_fuzzy_compare ssdeep_fuzzy_hash_filename ssdeep_fuzzy_hash ssdeep_fuzzy_compare)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SSH2&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ssh2_auth_hostbased_file ssh2_auth_hostbased_file ssh2_auth_none ssh2_auth_password ssh2_auth_pubkey_file ssh2_connect ssh2_exec ssh2_fetch_stream ssh2_fingerprint ssh2_methods_negotiated ssh2_publickey_add ssh2_publickey_init ssh2_publickey_list ssh2_publickey_remove ssh2_scp_recv ssh2_scp_send ssh2_sftp_lstat ssh2_sftp_mkdir ssh2_sftp_readlink ssh2_sftp_realpath ssh2_sftp_rename ssh2_sftp_rmdir ssh2_sftp_stat ssh2_sftp_symlink ssh2_sftp_unlink ssh2_sftp ssh2_shell ssh2_tunnel ssh2_auth_hostbased_file)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Statistic&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(stats_absolute_deviation stats_absolute_deviation stats_cdf_beta stats_cdf_binomial stats_cdf_cauchy stats_cdf_chisquare stats_cdf_exponential stats_cdf_f stats_cdf_gamma stats_cdf_laplace stats_cdf_logistic stats_cdf_negative_binomial stats_cdf_noncentral_chisquare stats_cdf_noncentral_f stats_cdf_poisson stats_cdf_t stats_cdf_uniform stats_cdf_weibull stats_covariance stats_den_uniform stats_dens_beta stats_dens_cauchy stats_dens_chisquare stats_dens_exponential stats_dens_f stats_dens_gamma stats_dens_laplace stats_dens_logistic stats_dens_negative_binomial stats_dens_normal stats_dens_pmf_binomial stats_dens_pmf_hypergeometric stats_dens_pmf_poisson stats_dens_t stats_dens_weibull stats_harmonic_mean stats_kurtosis stats_rand_gen_beta stats_rand_gen_chisquare stats_rand_gen_exponential stats_rand_gen_f stats_rand_gen_funiform stats_rand_gen_gamma stats_rand_gen_ibinomial_negative stats_rand_gen_ibinomial stats_rand_gen_int stats_rand_gen_ipoisson stats_rand_gen_iuniform stats_rand_gen_noncenral_chisquare stats_rand_gen_noncentral_f stats_rand_gen_noncentral_t stats_rand_gen_normal stats_rand_gen_t stats_rand_get_seeds stats_rand_phrase_to_seeds stats_rand_ranf stats_rand_setall stats_skew stats_standard_deviation stats_stat_binomial_coef stats_stat_correlation stats_stat_gennch stats_stat_independent_t stats_stat_innerproduct stats_stat_noncentral_t stats_stat_paired_t stats_stat_percentile stats_stat_powersum stats_variance stats_absolute_deviation)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Stomp&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(stomp_connect_error stomp_connect_error stomp_version stomp_connect_error)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Stream&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(set_socket_blocking set_socket_blocking stream_bucket_append stream_bucket_make_writeable stream_bucket_new stream_bucket_prepend stream_context_create stream_context_get_default stream_context_get_options stream_context_get_params stream_context_set_default stream_context_set_option stream_context_set_params stream_copy_to_stream stream_encoding stream_filter_append stream_filter_prepend stream_filter_register stream_filter_remove stream_get_contents stream_get_filters stream_get_line stream_get_meta_data stream_get_transports stream_get_wrappers stream_is_local stream_notification_callback stream_register_wrapper stream_resolve_include_path stream_select stream_set_blocking stream_set_chunk_size stream_set_read_buffer stream_set_timeout stream_set_write_buffer stream_socket_accept stream_socket_client stream_socket_enable_crypto stream_socket_get_name stream_socket_pair stream_socket_recvfrom stream_socket_sendto stream_socket_server stream_socket_shutdown stream_supports_lock stream_wrapper_register stream_wrapper_restore stream_wrapper_unregister set_socket_blocking)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;String&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(addcslashes addcslashes addslashes bin2hex chop chr chunk_split convert_cyr_string convert_uudecode convert_uuencode count_chars crc32 crypt echo explode fprintf get_html_translation_table hebrev hebrevc hex2bin html_entity_decode htmlentities htmlspecialchars_decode htmlspecialchars implode join lcfirst levenshtein localeconv ltrim md5_file md5 metaphone money_format nl_langinfo nl2br number_format ord parse_str print printf quoted_printable_decode quoted_printable_encode quotemeta rtrim setlocale sha1_file sha1 similar_text soundex sprintf sscanf str_getcsv str_ireplace str_pad str_repeat str_replace str_rot13 str_shuffle str_split str_word_count strcasecmp strchr strcmp strcoll strcspn strip_tags stripcslashes stripos stripslashes stristr strlen strnatcasecmp strnatcmp strncasecmp strncmp strpbrk strpos strrchr strrev strripos strrpos strspn strstr strtok strtolower strtoupper strtr substr_compare substr_count substr_replace substr trim ucfirst ucwords vfprintf vprintf vsprintf wordwrap addcslashes)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SVN&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(svn_add svn_add svn_auth_get_parameter svn_auth_set_parameter svn_blame svn_cat svn_checkout svn_cleanup svn_client_version svn_commit svn_delete svn_diff svn_export svn_fs_abort_txn svn_fs_apply_text svn_fs_begin_txn2 svn_fs_change_node_prop svn_fs_check_path svn_fs_contents_changed svn_fs_copy svn_fs_delete svn_fs_dir_entries svn_fs_file_contents svn_fs_file_length svn_fs_is_dir svn_fs_is_file svn_fs_make_dir svn_fs_make_file svn_fs_node_created_rev svn_fs_node_prop svn_fs_props_changed svn_fs_revision_prop svn_fs_revision_root svn_fs_txn_root svn_fs_youngest_rev svn_import svn_log svn_ls svn_mkdir svn_repos_create svn_repos_fs_begin_txn_for_commit svn_repos_fs_commit_txn svn_repos_fs svn_repos_hotcopy svn_repos_open svn_repos_recover svn_revert svn_status svn_update svn_add)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;SWF&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(swf_actiongeturl swf_actiongeturl swf_actiongotoframe swf_actiongotolabel swf_actionnextframe swf_actionplay swf_actionprevframe swf_actionsettarget swf_actionstop swf_actiontogglequality swf_actionwaitforframe swf_addbuttonrecord swf_addcolor swf_closefile swf_definebitmap swf_definefont swf_defineline swf_definepoly swf_definerect swf_definetext swf_endbutton swf_enddoaction swf_endshape swf_endsymbol swf_fontsize swf_fontslant swf_fonttracking swf_getbitmapinfo swf_getfontinfo swf_getframe swf_labelframe swf_lookat swf_modifyobject swf_mulcolor swf_nextid swf_oncondition swf_openfile swf_ortho2 swf_ortho swf_perspective swf_placeobject swf_polarview swf_popmatrix swf_posround swf_pushmatrix swf_removeobject swf_rotate swf_scale swf_setfont swf_setframe swf_shapearc swf_shapecurveto3 swf_shapecurveto swf_shapefillbitmapclip swf_shapefillbitmaptile swf_shapefilloff swf_shapefillsolid swf_shapelinesolid swf_shapelineto swf_shapemoveto swf_showframe swf_startbutton swf_startdoaction swf_startshape swf_startsymbol swf_textwidth swf_translate swf_viewport swf_actiongeturl)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Swish&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w()</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Sybase&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(sybase_affected_rows sybase_affected_rows sybase_close sybase_connect sybase_data_seek sybase_deadlock_retry_count sybase_fetch_array sybase_fetch_assoc sybase_fetch_field sybase_fetch_object sybase_fetch_row sybase_field_seek sybase_free_result sybase_get_last_message sybase_min_client_severity sybase_min_error_severity sybase_min_message_severity sybase_min_server_severity sybase_num_fields sybase_num_rows sybase_pconnect sybase_query sybase_result sybase_select_db sybase_set_message_handler sybase_unbuffered_query sybase_affected_rows)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Taint&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(is_tainted is_tainted taint untaint is_tainted)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;TCP&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(tcpwrap_check tcpwrap_check tcpwrap_check)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Tidy&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(ob_tidyhandler ob_tidyhandler tidy_access_count tidy_config_count tidy_error_count tidy_get_output tidy_load_config tidy_reset_config tidy_save_config tidy_set_encoding tidy_setopt tidy_warning_count ob_tidyhandler)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Tokenizer&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(token_get_all token_get_all token_name token_get_all)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Trader&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(trader_acos trader_acos trader_ad trader_add trader_adosc trader_adx trader_adxr trader_apo trader_aroon trader_aroonosc trader_asin trader_atan trader_atr trader_avgprice trader_bbands trader_beta trader_bop trader_cci trader_cdl2crows trader_cdl3blackcrows trader_cdl3inside trader_cdl3linestrike trader_cdl3outside trader_cdl3starsinsouth trader_cdl3whitesoldiers trader_cdlabandonedbaby trader_cdladvanceblock trader_cdlbelthold trader_cdlbreakaway trader_cdlclosingmarubozu trader_cdlconcealbabyswall trader_cdlcounterattack trader_cdldarkcloudcover trader_cdldoji trader_cdldojistar trader_cdldragonflydoji trader_cdlengulfing trader_cdleveningdojistar trader_cdleveningstar trader_cdlgapsidesidewhite trader_cdlgravestonedoji trader_cdlhammer trader_cdlhangingman trader_cdlharami trader_cdlharamicross trader_cdlhighwave trader_cdlhikkake trader_cdlhikkakemod trader_cdlhomingpigeon trader_cdlidentical3crows trader_cdlinneck trader_cdlinvertedhammer trader_cdlkicking trader_cdlkickingbylength trader_cdlladderbottom trader_cdllongleggeddoji trader_cdllongline trader_cdlmarubozu trader_cdlmatchinglow trader_cdlmathold trader_cdlmorningdojistar trader_cdlmorningstar trader_cdlonneck trader_cdlpiercing trader_cdlrickshawman trader_cdlrisefall3methods trader_cdlseparatinglines trader_cdlshootingstar trader_cdlshortline trader_cdlspinningtop trader_cdlstalledpattern trader_cdlsticksandwich trader_cdltakuri trader_cdltasukigap trader_cdlthrusting trader_cdltristar trader_cdlunique3river trader_cdlupsidegap2crows trader_cdlxsidegap3methods trader_ceil trader_cmo trader_correl trader_cos trader_cosh trader_dema trader_div trader_dx trader_ema trader_errno trader_exp trader_floor trader_get_compat trader_get_unstable_period trader_ht_dcperiod trader_ht_dcphase trader_ht_phasor trader_ht_sine trader_ht_trendline trader_ht_trendmode trader_kama trader_linearreg_angle trader_linearreg_intercept trader_linearreg_slope trader_linearreg trader_ln trader_log10 trader_ma trader_macd trader_macdext trader_macdfix trader_mama trader_mavp trader_max trader_maxindex trader_medprice trader_mfi trader_midpoint trader_midprice trader_min trader_minindex trader_minmax trader_minmaxindex trader_minus_di trader_minus_dm trader_mom trader_mult trader_natr trader_obv trader_plus_di trader_plus_dm trader_ppo trader_roc trader_rocp trader_rocr100 trader_rocr trader_rsi trader_sar trader_sarext trader_set_compat trader_set_unstable_period trader_sin trader_sinh trader_sma trader_sqrt trader_stddev trader_stoch trader_stochf trader_stochrsi trader_sub trader_sum trader_t3 trader_tan trader_tanh trader_tema trader_trange trader_trima trader_trix trader_tsf trader_typprice trader_ultosc trader_var trader_wclprice trader_willr trader_wma trader_acos)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;ODBC&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(odbc_autocommit odbc_autocommit odbc_binmode odbc_close_all odbc_close odbc_columnprivileges odbc_columns odbc_commit odbc_connect odbc_cursor odbc_data_source odbc_do odbc_error odbc_errormsg odbc_exec odbc_execute odbc_fetch_array odbc_fetch_into odbc_fetch_object odbc_fetch_row odbc_field_len odbc_field_name odbc_field_num odbc_field_precision odbc_field_scale odbc_field_type odbc_foreignkeys odbc_free_result odbc_gettypeinfo odbc_longreadlen odbc_next_result odbc_num_fields odbc_num_rows odbc_pconnect odbc_prepare odbc_primarykeys odbc_procedurecolumns odbc_procedures odbc_result_all odbc_result odbc_rollback odbc_setoption odbc_specialcolumns odbc_statistics odbc_tableprivileges odbc_tables odbc_autocommit)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;URL&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(base64_decode base64_decode base64_encode get_headers get_meta_tags http_build_query parse_url rawurldecode rawurlencode urldecode urlencode base64_decode)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Variable handling&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(debug_zval_dump debug_zval_dump doubleval empty floatval get_defined_vars get_resource_type gettype import_request_variables intval is_array is_bool is_callable is_double is_float is_int is_integer is_long is_null is_numeric is_object is_real is_resource is_scalar is_string isset print_r serialize settype strval unserialize unset var_dump var_export debug_zval_dump)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;vpopmail&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(vpopmail_add_alias_domain_ex vpopmail_add_alias_domain_ex vpopmail_add_alias_domain vpopmail_add_domain_ex vpopmail_add_domain vpopmail_add_user vpopmail_alias_add vpopmail_alias_del_domain vpopmail_alias_del vpopmail_alias_get_all vpopmail_alias_get vpopmail_auth_user vpopmail_del_domain_ex vpopmail_del_domain vpopmail_del_user vpopmail_error vpopmail_passwd vpopmail_set_user_quota vpopmail_add_alias_domain_ex)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;W32api&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(w32api_deftype w32api_deftype w32api_init_dtype w32api_invoke_function w32api_register_function w32api_set_call_method w32api_deftype)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;WDDX&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(wddx_add_vars wddx_add_vars wddx_deserialize wddx_packet_end wddx_packet_start wddx_serialize_value wddx_serialize_vars wddx_add_vars)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;win32ps&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(win32_ps_list_procs win32_ps_list_procs win32_ps_stat_mem win32_ps_stat_proc win32_ps_list_procs)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;win32service&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(win32_continue_service win32_continue_service win32_create_service win32_delete_service win32_get_last_control_message win32_pause_service win32_query_service_status win32_set_service_status win32_start_service_ctrl_dispatcher win32_start_service win32_stop_service win32_continue_service)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;WinCache&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(wincache_fcache_fileinfo wincache_fcache_fileinfo wincache_fcache_meminfo wincache_lock wincache_ocache_fileinfo wincache_ocache_meminfo wincache_refresh_if_changed wincache_rplist_fileinfo wincache_rplist_meminfo wincache_scache_info wincache_scache_meminfo wincache_ucache_add wincache_ucache_cas wincache_ucache_clear wincache_ucache_dec wincache_ucache_delete wincache_ucache_exists wincache_ucache_get wincache_ucache_inc wincache_ucache_info wincache_ucache_meminfo wincache_ucache_set wincache_unlock wincache_fcache_fileinfo)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;xattr&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(xattr_get xattr_get xattr_list xattr_remove xattr_set xattr_supported xattr_get)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;xdiff&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(xdiff_file_bdiff_size xdiff_file_bdiff_size xdiff_file_bdiff xdiff_file_bpatch xdiff_file_diff_binary xdiff_file_diff xdiff_file_merge3 xdiff_file_patch_binary xdiff_file_patch xdiff_file_rabdiff xdiff_string_bdiff_size xdiff_string_bdiff xdiff_string_bpatch xdiff_string_diff_binary xdiff_string_diff xdiff_string_merge3 xdiff_string_patch_binary xdiff_string_patch xdiff_string_rabdiff xdiff_file_bdiff_size)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Xhprof&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(xhprof_disable xhprof_disable xhprof_enable xhprof_sample_disable xhprof_sample_enable xhprof_disable)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;XML Parser&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(utf8_decode utf8_decode utf8_encode xml_error_string xml_get_current_byte_index xml_get_current_column_number xml_get_current_line_number xml_get_error_code xml_parse_into_struct xml_parse xml_parser_create_ns xml_parser_create xml_parser_free xml_parser_get_option xml_parser_set_option xml_set_character_data_handler xml_set_default_handler xml_set_element_handler xml_set_end_namespace_decl_handler xml_set_external_entity_ref_handler xml_set_notation_decl_handler xml_set_object xml_set_processing_instruction_handler xml_set_start_namespace_decl_handler xml_set_unparsed_entity_decl_handler utf8_decode)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;XML-RPC&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(xmlrpc_decode_request xmlrpc_decode_request xmlrpc_decode xmlrpc_encode_request xmlrpc_encode xmlrpc_get_type xmlrpc_is_fault xmlrpc_parse_method_descriptions xmlrpc_server_add_introspection_data xmlrpc_server_call_method xmlrpc_server_create xmlrpc_server_destroy xmlrpc_server_register_introspection_callback xmlrpc_server_register_method xmlrpc_set_type xmlrpc_decode_request)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;XMLWriter&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(XMLWriter::endAttribute XMLWriter::endAttribute XMLWriter::endCData XMLWriter::endComment XMLWriter::endDocument XMLWriter::endDTDAttlist XMLWriter::endDTDElement XMLWriter::endDTDEntity XMLWriter::endDTD XMLWriter::endElement XMLWriter::endPI XMLWriter::flush XMLWriter::fullEndElement XMLWriter::openMemory XMLWriter::openURI XMLWriter::outputMemory XMLWriter::setIndentString XMLWriter::setIndent XMLWriter::startAttributeNS XMLWriter::startAttribute XMLWriter::startCData XMLWriter::startComment XMLWriter::startDocument XMLWriter::startDTDAttlist XMLWriter::startDTDElement XMLWriter::startDTDEntity XMLWriter::startDTD XMLWriter::startElementNS XMLWriter::startElement XMLWriter::startPI XMLWriter::text XMLWriter::writeAttributeNS XMLWriter::writeAttribute XMLWriter::writeCData XMLWriter::writeComment XMLWriter::writeDTDAttlist XMLWriter::writeDTDElement XMLWriter::writeDTDEntity XMLWriter::writeDTD XMLWriter::writeElementNS XMLWriter::writeElement XMLWriter::writePI XMLWriter::writeRaw XMLWriter::endAttribute)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;XSLT (PHP 4)&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(xslt_backend_info xslt_backend_info xslt_backend_name xslt_backend_version xslt_create xslt_errno xslt_error xslt_free xslt_getopt xslt_process xslt_set_base xslt_set_encoding xslt_set_error_handler xslt_set_log xslt_set_object xslt_set_sax_handler xslt_set_sax_handlers xslt_set_scheme_handler xslt_set_scheme_handlers xslt_setopt xslt_backend_info)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Yaml&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(yaml_emit_file yaml_emit_file yaml_emit yaml_parse_file yaml_parse_url yaml_parse yaml_emit_file)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;YAZ&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(yaz_addinfo yaz_addinfo yaz_ccl_conf yaz_ccl_parse yaz_close yaz_connect yaz_database yaz_element yaz_errno yaz_error yaz_es_result yaz_es yaz_get_option yaz_hits yaz_itemorder yaz_present yaz_range yaz_record yaz_scan_result yaz_scan yaz_schema yaz_search yaz_set_option yaz_sort yaz_syntax yaz_wait yaz_addinfo)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Zip&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(zip_close zip_close zip_entry_close zip_entry_compressedsize zip_entry_compressionmethod zip_entry_filesize zip_entry_name zip_entry_open zip_entry_read zip_open zip_read zip_close)</span>
          <span class="n">b</span><span class="o">[</span><span class="s2">&quot;Zlib&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(gzclose gzclose gzcompress gzdecode gzdeflate gzencode gzeof gzfile gzgetc gzgets gzgetss gzinflate gzopen gzpassthru gzputs gzread gzrewind gzseek gztell gzuncompress gzwrite readgzfile zlib_decode zlib_encode zlib_get_coding_type gzclose)</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">PHP</span> <span class="o">&lt;</span> <span class="no">TemplateLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The PHP scripting language (php.net)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;php&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span> <span class="s1">&#39;php3&#39;</span><span class="p">,</span> <span class="s1">&#39;php4&#39;</span><span class="p">,</span> <span class="s1">&#39;php5&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.php&#39;</span><span class="p">,</span> <span class="s1">&#39;*.php[345]&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-php&#39;</span>

      <span class="n">default_options</span> <span class="ss">:parent</span> <span class="o">=&gt;</span> <span class="s1">&#39;html&#39;</span>

      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="c1"># if truthy, the lexer starts highlighting with php code</span>
        <span class="c1"># (no &lt;?php required)</span>
        <span class="vi">@start_inline</span> <span class="o">=</span> <span class="n">opts</span><span class="nf">.delete</span><span class="p">(</span><span class="ss">:start_inline</span><span class="p">)</span>
        <span class="vi">@funcnamehighlighting</span> <span class="o">=</span> <span class="n">opts</span><span class="nf">.delete</span><span class="p">(</span><span class="ss">:funcnamehighlighting</span><span class="p">)</span> <span class="p">{</span> <span class="kp">true</span> <span class="p">}</span>
        <span class="vi">@disabledmodules</span> <span class="o">=</span> <span class="n">opts</span><span class="nf">.delete</span><span class="p">(</span><span class="ss">:disabledmodules</span><span class="p">)</span> <span class="p">{</span> <span class="o">[]</span> <span class="p">}</span>

        <span class="k">super</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">builtins</span>
        <span class="nb">load</span> <span class="no">Pathname</span><span class="nf">.new</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span><span class="nf">.dirname.join</span><span class="p">(</span><span class="s1">&#39;php/builtins.rb&#39;</span><span class="p">)</span>
        <span class="nb">self</span><span class="nf">.builtins</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">builtins</span>
        <span class="k">return</span> <span class="o">[]</span> <span class="k">unless</span> <span class="vi">@funcnamehighlighting</span>

        <span class="vi">@builtins</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new.tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">builtins</span><span class="o">|</span>
          <span class="nb">self</span><span class="nf">.class.builtins.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">mod</span><span class="p">,</span> <span class="n">fns</span><span class="o">|</span>
            <span class="k">next</span> <span class="k">if</span> <span class="vi">@disabledmodules</span><span class="nf">.include?</span> <span class="n">mod</span>
            <span class="n">builtins</span><span class="nf">.merge</span><span class="p">(</span><span class="n">fns</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">start_inline?</span>
        <span class="o">!!</span><span class="vi">@start_inline</span>
      <span class="k">end</span>

      <span class="n">start</span> <span class="k">do</span>
        <span class="n">push</span> <span class="ss">:php</span> <span class="k">if</span> <span class="n">start_inline?</span>
      <span class="k">end</span>

      <span class="n">keywords</span> <span class="o">=</span> <span class="sx">%w(
        and E_PARSE old_function E_ERROR or as E_WARNING parent eval
        PHP_OS break exit case extends PHP_VERSION cfunction FALSE
        print for require continue foreach require_once declare return
        default static do switch die stdClass echo else TRUE elseif
        var empty if xor enddeclare include virtual endfor include_once
        while endforeach global __FILE__ endif list __LINE__ endswitch
        new __sleep endwhile not array __wakeup E_ALL NULL final
        php_user_filter interface implements public private protected
        abstract clone try catch throw this use namespace
      )</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&lt;\?(php|=)?/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:php</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/.*?(?=&lt;\?)|.*/m</span><span class="p">)</span> <span class="p">{</span> <span class="n">delegate</span> <span class="n">parent</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:php</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\?&gt;/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="c1"># heredocs</span>
        <span class="n">rule</span> <span class="sr">/&lt;&lt;&lt;(&#39;?)([a-z_]\w*)\1\n.*?\n\2;?\n/im</span><span class="p">,</span> <span class="s1">&#39;String&#39;</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/#.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(//.*?</span><span class="se">\n</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="c1"># empty comment, otherwise seen as the start of a docstring</span>
        <span class="n">rule</span> <span class="sr">%r(/</span><span class="se">\*\*</span><span class="sr">/)</span>
        <span class="n">rule</span> <span class="sr">%r(/</span><span class="se">\*\*</span><span class="sr">.*?</span><span class="se">\*</span><span class="sr">/)m</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Doc&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/</span><span class="se">\*</span><span class="sr">.*?</span><span class="se">\*</span><span class="sr">/)m</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/(-&gt;|::)(\s*)([a-zA-Z_][a-zA-Z0-9_]*)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Attribute&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[~!%^&amp;*+=\|:.&lt;&gt;\/?@-]+/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\[\]{}();,]+/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/class\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:classname</span>
        <span class="c1"># anonymous functions</span>
        <span class="n">rule</span> <span class="sr">/(function)(\s*)(?=\()/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
        <span class="k">end</span>

        <span class="c1"># named functions</span>
        <span class="n">rule</span> <span class="sr">/(function)(\s+)(&amp;?)(\s*)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:funcname</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(const)(\s+)([a-zA-Z_]\w*)/i</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Constant&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span> <span class="sr">/(true|false|null)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Constant&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$\{\$+[a-z_]\w*\}/i</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$+[a-z_]\w*/i</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>

        <span class="c1"># may be intercepted for builtin highlighting</span>
        <span class="n">rule</span> <span class="sr">/[\\a-z_][\\\w]*/i</span><span class="p">,</span> <span class="s1">&#39;Name.Other&#39;</span>

        <span class="n">rule</span> <span class="sr">/(\d+\.\d*|\d*\.\d+)(e[+-]?\d+)?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+e[+-]?\d+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0[0-7]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[a-f0-9]+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;([^&#39;\\]*(?:\\.[^&#39;\\]*)*)&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/`([^`\\]*(?:\\.[^`\\]*)*)`/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:string</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:classname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[a-z_][\\\w]*/i</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:funcname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[a-z_]\w*/i</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:string</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^\\{$&quot;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\([nrt\&quot;$\\]|[0-7]{1,3}|x[0-9A-Fa-f]{1,2})/</span><span class="p">,</span>
          <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$[a-zA-Z_][a-zA-Z0-9_]*(\[\S+\]|-&gt;[a-zA-Z_][a-zA-Z0-9_]*)?/</span>

        <span class="n">lsi</span> <span class="o">=</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span>
        <span class="n">rule</span> <span class="sr">/\{\$\{/</span><span class="p">,</span> <span class="n">lsi</span><span class="p">,</span> <span class="ss">:interp_double</span>
        <span class="n">rule</span> <span class="sr">/\{(?=\$)/</span><span class="p">,</span> <span class="n">lsi</span><span class="p">,</span> <span class="ss">:interp_single</span>
        <span class="n">rule</span> <span class="sr">/(\{)(\S+)(\})/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="n">lsi</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="n">lsi</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[${\\]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:interp_double</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\}\}/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:php</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:interp_single</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\}/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:php</span>
      <span class="k">end</span>

      <span class="n">postprocess</span> <span class="s1">&#39;Name.Other&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="s1">&#39;Name.Builtin&#39;</span> <span class="k">if</span> <span class="n">builtins</span><span class="nf">.include?</span> <span class="n">val</span>

        <span class="n">token</span> <span class="n">tok</span><span class="p">,</span> <span class="n">val</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Python</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Python programming language (python.org)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;python&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;py&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.py&#39;</span><span class="p">,</span> <span class="s1">&#39;*.pyw&#39;</span><span class="p">,</span> <span class="s1">&#39;*.sc&#39;</span><span class="p">,</span> <span class="s1">&#39;SConstruct&#39;</span><span class="p">,</span> <span class="s1">&#39;SConscript&#39;</span><span class="p">,</span> <span class="s1">&#39;*.tac&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-python&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-python&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span><span class="p">(</span><span class="sr">/pythonw?(3|2(\.\d)?)?/</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">keywords</span> <span class="o">=</span> <span class="sx">%w(
        assert break continue del elif else except exec
        finally for global if lambda pass print raise
        return try while yield as with
      )</span>

      <span class="n">builtins</span> <span class="o">=</span> <span class="sx">%w(
        __import__ abs all any apply basestring bin bool buffer
        bytearray bytes callable chr classmethod cmp coerce compile
        complex delattr dict dir divmod enumerate eval execfile exit
        file filter float frozenset getattr globals hasattr hash hex id
        input int intern isinstance issubclass iter len list locals
        long map max min next object oct open ord pow property range
        raw_input reduce reload repr reversed round set setattr slice
        sorted staticmethod str sum super tuple type unichr unicode
        vars xrange zip
      )</span>

      <span class="n">builtins_pseudo</span> <span class="o">=</span> <span class="sx">%w(self None Ellipsis NotImplemented False True)</span>

      <span class="n">exceptions</span> <span class="o">=</span> <span class="sx">%w(
        ArithmeticError AssertionError AttributeError
        BaseException DeprecationWarning EOFError EnvironmentError
        Exception FloatingPointError FutureWarning GeneratorExit IOError
        ImportError ImportWarning IndentationError IndexError KeyError
        KeyboardInterrupt LookupError MemoryError NameError
        NotImplemented NotImplementedError OSError OverflowError
        OverflowWarning PendingDeprecationWarning ReferenceError
        RuntimeError RuntimeWarning StandardError StopIteration
        SyntaxError SyntaxWarning SystemError SystemExit TabError
        TypeError UnboundLocalError UnicodeDecodeError
        UnicodeEncodeError UnicodeError UnicodeTranslateError
        UnicodeWarning UserWarning ValueError VMSError Warning
        WindowsError ZeroDivisionError
      )</span>

      <span class="n">identifier</span> <span class="o">=</span>        <span class="sr">/[a-z_][a-z0-9_]*/i</span>
      <span class="n">dotted_identifier</span> <span class="o">=</span> <span class="sr">/[a-z_.][a-z0-9_.]*/i</span>
      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\n+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/^(:)(\s*)([ru]{,2}&quot;&quot;&quot;.*?&quot;&quot;&quot;)/mi</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.String.Doc&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[^\S\n]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/#.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\[\]{}:(),;]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/(in|is|and|or|not)\b/</span><span class="p">,</span> <span class="s1">&#39;Operator.Word&#39;</span>
        <span class="n">rule</span> <span class="sr">/!=|==|&lt;&lt;|&gt;&gt;|[-~+\/*%=&lt;&gt;&amp;^|.]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>

        <span class="n">rule</span> <span class="sr">/(def)((?:\s|\\\s)+)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span> <span class="c1"># def</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span> <span class="c1"># whitespae</span>
          <span class="n">push</span> <span class="ss">:funcname</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(class)((?:\s|\\\s)+)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:classname</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(from)((?:\s|\\\s)+)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword.Namespace&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:fromimport</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(import)((?:\s|\\\s)+)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword.Namespace&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:import</span>
        <span class="k">end</span>

        <span class="c1"># using negative lookbehind so we don&#39;t match property names</span>
        <span class="n">rule</span> <span class="sr">/(?&lt;!\.)(?:</span><span class="si">#{</span><span class="n">builtins</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?&lt;!\.)(?:</span><span class="si">#{</span><span class="n">builtins_pseudo</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin.Pseudo&#39;</span>

        <span class="c1"># TODO: not in python 3</span>
        <span class="n">rule</span> <span class="sr">/`.*?`/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:r|ur|ru)&quot;&quot;&quot;/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:tdqs</span>
        <span class="n">rule</span> <span class="sr">/(?:r|ur|ru)&#39;&#39;&#39;/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:tsqs</span>
        <span class="n">rule</span> <span class="sr">/(?:r|ur|ru)&quot;/i</span><span class="p">,</span>   <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:dqs</span>
        <span class="n">rule</span> <span class="sr">/(?:r|ur|ru)&#39;/i</span><span class="p">,</span>   <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:sqs</span>
        <span class="n">rule</span> <span class="sr">/u?&quot;&quot;&quot;/i</span><span class="p">,</span>          <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:escape_tdqs</span>
        <span class="n">rule</span> <span class="sr">/u?&#39;&#39;&#39;/i</span><span class="p">,</span>          <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:escape_tsqs</span>
        <span class="n">rule</span> <span class="sr">/u?&quot;/i</span><span class="p">,</span>            <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:escape_dqs</span>
        <span class="n">rule</span> <span class="sr">/u?&#39;/i</span><span class="p">,</span>            <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:escape_sqs</span>

        <span class="n">rule</span> <span class="sr">/@</span><span class="si">#{</span><span class="n">dotted_identifier</span><span class="si">}</span><span class="sr">/i</span><span class="p">,</span> <span class="s1">&#39;Name.Decorator&#39;</span>
        <span class="n">rule</span> <span class="n">identifier</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span>

        <span class="n">rule</span> <span class="sr">/(\d+\.\d*|\d*\.\d+)(e[+-]?[0-9]+)?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+e[+-]?[0-9]+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/0[0-7]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[a-f0-9]+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+L/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer.Long&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:funcname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="n">identifier</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:classname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="n">identifier</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:import</span> <span class="k">do</span>
        <span class="c1"># non-line-terminating whitespace</span>
        <span class="n">rule</span> <span class="sr">/(?:[ \t]|\\\n)+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/as\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Namespace&#39;</span>
        <span class="n">rule</span> <span class="sr">/,/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="n">dotted_identifier</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span> <span class="c1"># anything else -&gt; go back</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:fromimport</span> <span class="k">do</span>
        <span class="c1"># non-line-terminating whitespace</span>
        <span class="n">rule</span> <span class="sr">/(?:[ \t]|\\\n)+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/import\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="n">dotted_identifier</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:strings</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/%(\([a-z0-9_]+\))?[-#0 +]*([0-9]+|[*])?(\.([0-9]+|[*]))?/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^\\&#39;&quot;%\n]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:nl</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:escape</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\\</span><span class="sr">
          ( [</span><span class="se">\\</span><span class="sr">abfnrtv&quot;&#39;]
          | </span><span class="se">\n</span><span class="sr">
          | N{.*?}
          | u[a-fA-F0-9]{4}
          | U[a-fA-F0-9]{8}
          | x[a-fA-F0-9]{2}
          | [0-7]{1,3}
          )
        )x</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:dqs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\\\\|\\&quot;|\\\n/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">mixin</span> <span class="ss">:strings</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:sqs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\\\\|\\&#39;|\\\n/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">mixin</span> <span class="ss">:strings</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:tdqs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;&quot;&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:strings</span>
        <span class="n">mixin</span> <span class="ss">:nl</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:tsqs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;&#39;&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:strings</span>
        <span class="n">mixin</span> <span class="ss">:nl</span>
      <span class="k">end</span>

      <span class="sx">%w(tdqs tsqs dqs sqs)</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">qtype</span><span class="o">|</span>
        <span class="n">state</span> <span class="ss">:&quot;escape_</span><span class="si">#{</span><span class="n">qtype</span><span class="si">}</span><span class="ss">&quot;</span> <span class="k">do</span>
          <span class="n">mixin</span> <span class="ss">:escape</span>
          <span class="n">mixin</span> <span class="ss">:&quot;</span><span class="si">#{</span><span class="n">qtype</span><span class="si">}</span><span class="ss">&quot;</span>
        <span class="k">end</span>
      <span class="k">end</span>

    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Ruby</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Ruby programming language (ruby-lang.org)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;ruby&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;rb&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.rb&#39;</span><span class="p">,</span> <span class="s1">&#39;*.ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;*.rbw&#39;</span><span class="p">,</span> <span class="s1">&#39;*.rake&#39;</span><span class="p">,</span> <span class="s1">&#39;*.gemspec&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Rakefile&#39;</span><span class="p">,</span> <span class="s1">&#39;Guardfile&#39;</span><span class="p">,</span> <span class="s1">&#39;Gemfile&#39;</span>

      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-ruby&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span> <span class="s1">&#39;ruby&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:strings</span> <span class="k">do</span>
        <span class="c1"># symbols</span>
        <span class="n">rule</span> <span class="sr">%r(
          :  # initial :
          @{0,2} # optional ivar, for :@foo and :@@foo
          [a-z_]</span><span class="se">\w</span><span class="sr">*[!?]? # the symbol
        )xi</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>

        <span class="c1"># special symbols</span>
        <span class="n">rule</span> <span class="sr">%r(:(?:</span><span class="se">\*\*</span><span class="sr">|[-+]@|[/</span><span class="se">\%</span><span class="sr">&amp;</span><span class="se">\|</span><span class="sr">^`~]|</span><span class="se">\[\]</span><span class="sr">=?|&lt;&lt;|&gt;&gt;|&lt;=?&gt;|&lt;=?|===?))</span><span class="p">,</span>
          <span class="s1">&#39;Literal.String.Symbol&#39;</span>

        <span class="n">rule</span> <span class="sr">/:&#39;(\\\\|\\&#39;|[^&#39;])*&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;(\\\\|\\&#39;|[^&#39;])*&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/:&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span> <span class="ss">:simple_sym</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:simple_string</span>
        <span class="n">rule</span> <span class="sr">/(?&lt;!\.)`/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span><span class="p">,</span> <span class="ss">:simple_backtick</span>

        <span class="c1"># %-style delimiters</span>
        <span class="c1"># %(abc), %[abc], %&lt;abc&gt;, %.abc., %r.abc., etc</span>
        <span class="n">delimiter_map</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;{&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&gt;&#39;</span> <span class="p">}</span>
        <span class="n">rule</span> <span class="sr">/%([rqswQWx])?([^\w\s])/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="nb">open</span> <span class="o">=</span> <span class="no">Regexp</span><span class="nf">.escape</span><span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">)</span>
          <span class="n">close</span> <span class="o">=</span> <span class="no">Regexp</span><span class="nf">.escape</span><span class="p">(</span><span class="n">delimiter_map</span><span class="o">[</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]]</span> <span class="o">||</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">)</span>
          <span class="n">interp</span> <span class="o">=</span> <span class="sr">/[rQWx]/</span> <span class="o">===</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">toktype</span> <span class="o">=</span> <span class="s1">&#39;Literal.String.Other&#39;</span>

          <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    open: </span><span class="si">#{</span><span class="nb">open</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
          <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    close: </span><span class="si">#{</span><span class="n">close</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>

          <span class="c1"># regexes</span>
          <span class="k">if</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span>
            <span class="n">toktype</span> <span class="o">=</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
            <span class="n">push</span> <span class="ss">:regex_flags</span>
          <span class="k">end</span>

          <span class="n">token</span> <span class="n">toktype</span>

          <span class="n">push</span> <span class="k">do</span>
            <span class="n">rule</span> <span class="sr">/\\[#</span><span class="si">#{</span><span class="nb">open</span><span class="si">}#{</span><span class="n">close</span><span class="si">}</span><span class="sr">\\]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
            <span class="c1"># nesting rules only with asymmetric delimiters</span>
            <span class="k">if</span> <span class="nb">open</span> <span class="o">!=</span> <span class="n">close</span>
              <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="nb">open</span><span class="si">}</span><span class="sr">/</span> <span class="k">do</span>
                <span class="n">token</span> <span class="n">toktype</span>
                <span class="n">push</span>
              <span class="k">end</span>
            <span class="k">end</span>
            <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">close</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="n">toktype</span><span class="p">,</span> <span class="ss">:pop!</span>

            <span class="k">if</span> <span class="n">interp</span>
              <span class="n">mixin</span> <span class="ss">:string_intp_escaped</span>
            <span class="k">else</span>
              <span class="n">rule</span> <span class="sr">/[\\#]/</span><span class="p">,</span> <span class="n">toktype</span>
            <span class="k">end</span>

            <span class="n">rule</span> <span class="sr">/[^#</span><span class="si">#{</span><span class="nb">open</span><span class="si">}#{</span><span class="n">close</span><span class="si">}</span><span class="sr">\\]+/m</span><span class="p">,</span> <span class="n">toktype</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:regex_flags</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[mixounse]*/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="c1"># double-quoted string and symbol</span>
      <span class="o">[[</span><span class="ss">:string</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="o">]</span><span class="p">,</span>
       <span class="o">[</span><span class="ss">:sym</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="o">]</span><span class="p">,</span>
       <span class="o">[</span><span class="ss">:backtick</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span><span class="p">,</span> <span class="s1">&#39;`&#39;</span><span class="o">]]</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">tok</span><span class="p">,</span> <span class="n">fin</span><span class="o">|</span>
        <span class="n">state</span> <span class="ss">:&quot;simple_</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="ss">&quot;</span> <span class="k">do</span>
          <span class="n">mixin</span> <span class="ss">:string_intp_escaped</span>
          <span class="n">rule</span> <span class="sr">/[^\\</span><span class="si">#{</span><span class="n">fin</span><span class="si">}</span><span class="sr">#]+/m</span><span class="p">,</span> <span class="n">tok</span>
          <span class="n">rule</span> <span class="sr">/[\\#]/</span><span class="p">,</span> <span class="n">tok</span>
          <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">fin</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="n">tok</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">keywords</span> <span class="o">=</span> <span class="sx">%w(
        BEGIN END alias begin break case defined\? do else elsif end
        ensure for if in next redo rescue raise retry return super then
        undef unless until when while yield
      )</span>

      <span class="n">keywords_pseudo</span> <span class="o">=</span> <span class="sx">%w(
        initialize new loop include extend raise attr_reader attr_writer
        attr_accessor attr catch throw private module_function public
        protected true false nil __FILE__ __LINE__
      )</span>

      <span class="n">builtins_g</span> <span class="o">=</span> <span class="sx">%w(
        Array Float Integer String __id__ __send__ abort ancestors
        at_exit autoload binding callcc caller catch chomp chop
        class_eval class_variables clone const_defined\? const_get
        const_missing const_set constants display dup eval exec exit
        extend fail fork format freeze getc gets global_variables gsub
        hash id included_modules inspect instance_eval instance_method
        instance_methods instance_variable_get instance_variable_set
        instance_variables lambda load local_variables loop method
        method_missing methods module_eval name object_id open p
        print printf private_class_method private_instance_methods
        private_methods proc protected_instance_methods protected_methods
        public_class_method public_instance_methods public_methods putc
        puts raise rand readline readlines require scan select self send
        set_trace_func singleton_methods sleep split sprintf srand sub
        syscall system taint test throw to_a to_s trace_var trap untaint
        untrace_var warn
      )</span>

      <span class="n">builtins_q</span> <span class="o">=</span> <span class="sx">%w(
        autoload block_given const_defined eql equal frozen
        include instance_of is_a iterator kind_of method_defined
        nil private_method_defined protected_method_defined
        public_method_defined respond_to tainted
      )</span>

      <span class="n">builtins_b</span> <span class="o">=</span> <span class="sx">%w(chomp chop exit gsub sub)</span>

      <span class="n">start</span> <span class="k">do</span>
        <span class="n">push</span> <span class="ss">:expr_start</span>
        <span class="vi">@heredoc_queue</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/#.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(=begin</span><span class="se">\b</span><span class="sr">.*?end</span><span class="se">\b</span><span class="sr">)m</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">keywords_pseudo</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Pseudo&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">%r(
          (module)
          (</span><span class="se">\s</span><span class="sr">+)
          ([a-zA-Z_][a-zA-Z0-9_]*(::[a-zA-Z_][a-zA-Z0-9_]*)*)
        )x</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Namespace&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/def\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:funcname</span>
        <span class="n">rule</span> <span class="sr">/class\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:classname</span>

        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">builtins_q</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\?/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">/(?:</span><span class="si">#{</span><span class="n">builtins_b</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)!/</span><span class="p">,</span>  <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">/(?&lt;!\.)(?:</span><span class="si">#{</span><span class="n">builtins_g</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="si">}</span><span class="sr">)\b/</span><span class="p">,</span>
          <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span> <span class="ss">:method_call</span>

        <span class="n">rule</span> <span class="sr">/__END__/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:end_part</span>

        <span class="n">rule</span> <span class="sr">/0_?[0-7]+(?:_[0-7]+)*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>
        <span class="n">rule</span> <span class="sr">/0x[0-9A-Fa-f]+(?:_[0-9A-Fa-f]+)*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/0b[01]+(?:_[01]+)*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Bin&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\d]+(?:_\d+)*/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>

        <span class="c1"># names</span>
        <span class="n">rule</span> <span class="sr">/@@[a-z_]\w*/i</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Class&#39;</span>
        <span class="n">rule</span> <span class="sr">/@[a-z_]\w*/i</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Instance&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$\w+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Global&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\$</span><span class="sr">[!@&amp;`&#39;+~=/</span><span class="se">\\</span><span class="sr">,;.&lt;&gt;_*</span><span class="se">\$</span><span class="sr">?:&quot;])</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Global&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$-[0adFiIlpvw]/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable.Global&#39;</span>
        <span class="n">rule</span> <span class="sr">/::/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="n">mixin</span> <span class="ss">:strings</span>

        <span class="c1"># char operator.  ?x evaulates to &quot;x&quot;, unless there&#39;s a digit</span>
        <span class="c1"># beforehand like x&gt;=0?n[x]:&quot;&quot;</span>
        <span class="n">rule</span> <span class="sr">%r(
          </span><span class="se">\?</span><span class="sr">(</span><span class="se">\\</span><span class="sr">[MC]-)*     # modifiers
          (</span><span class="se">\\</span><span class="sr">([</span><span class="se">\\</span><span class="sr">abefnrstv</span><span class="se">\#</span><span class="sr">&quot;&#39;]|x[a-fA-F0-9]{1,2}|[0-7]{1,3})|</span><span class="se">\S</span><span class="sr">)
          (?!</span><span class="se">\w</span><span class="sr">)
        )x</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span>

        <span class="n">mixin</span> <span class="ss">:has_heredocs</span>

        <span class="n">rule</span> <span class="sr">/[A-Z][a-zA-Z0-9_]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span> <span class="ss">:method_call</span>
        <span class="n">rule</span> <span class="sr">/(\.|::)([a-z_]\w*[!?]?|[*%&amp;^`~+-\/\[&lt;&gt;=])/</span><span class="p">,</span>
          <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">/[a-zA-Z_]\w*[?!]/</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">/[a-zA-Z_]\w*/</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="ss">:method_call</span>
        <span class="n">rule</span> <span class="sr">/\[|\]|\*\*|&lt;&lt;?|&gt;&gt;?|&gt;=|&lt;=|&lt;=&gt;|=~|={3}|!~|&amp;&amp;?|\|\||\.{1,3}/</span><span class="p">,</span>
          <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">/[-+\/*%=&lt;&gt;&amp;!^|~]=?/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">%r&lt;[({,?:</span><span class="se">\\</span><span class="sr">;/]&gt;</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">%r&lt;[)}]&gt;</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n\s*/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:expr_start</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span> <span class="c1"># NB: NOT /m</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:has_heredocs</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(?&lt;!\w)(&lt;&lt;-?)([&quot;`&#39;]?)([a-zA-Z_]\w*)(\2)/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}#{</span><span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="si">}#{</span><span class="n">m</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
          <span class="vi">@heredoc_queue</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&lt;-&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]]</span>
          <span class="n">push</span> <span class="ss">:heredoc_queue</span> <span class="k">unless</span> <span class="n">state?</span> <span class="ss">:heredoc_queue</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/(&lt;&lt;-?)([&quot;&#39;])(\2)/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}#{</span><span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="si">}#{</span><span class="n">m</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
          <span class="vi">@heredoc_queue</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&lt;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">]</span>
          <span class="n">push</span> <span class="ss">:heredoc_queue</span> <span class="k">unless</span> <span class="n">state?</span> <span class="ss">:heredoc_queue</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:heredoc_queue</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(?=\n)/</span> <span class="k">do</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:resolve_heredocs</span>
        <span class="k">end</span>

        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:resolve_heredocs</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:string_intp_escaped</span>

        <span class="n">rule</span> <span class="sr">/(\n)([^#\\\n]*)$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">tolerant</span><span class="p">,</span> <span class="n">heredoc_name</span> <span class="o">=</span> <span class="vi">@heredoc_queue</span><span class="nf">.first</span>
          <span class="n">check</span> <span class="o">=</span> <span class="n">tolerant</span> <span class="p">?</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="nf">.strip</span> <span class="p">:</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="nf">.rstrip</span>

          <span class="n">group</span> <span class="s1">&#39;Literal.String.Heredoc&#39;</span>

          <span class="c1"># check if we found the end of the heredoc</span>
          <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="n">heredoc_name</span>
            <span class="n">group</span> <span class="s1">&#39;Name.Constant&#39;</span>
            <span class="vi">@heredoc_queue</span><span class="nf">.shift</span>
            <span class="c1"># if there&#39;s no more, we&#39;re done looking.</span>
            <span class="n">pop!</span> <span class="k">if</span> <span class="vi">@heredoc_queue</span><span class="nf">.empty?</span>
          <span class="k">else</span>
            <span class="n">group</span> <span class="s1">&#39;Literal.String.Heredoc&#39;</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[#\\\n]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Heredoc&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^#\\\n]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Heredoc&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:funcname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:defexpr</span>
        <span class="n">rule</span> <span class="sr">%r(
          (?:([a-zA-Z_][</span><span class="se">\w</span><span class="sr">_]*)(</span><span class="se">\.</span><span class="sr">))?
          (
            [a-zA-Z_][</span><span class="se">\w</span><span class="sr">_]*[!?]? |
            </span><span class="se">\*\*</span><span class="sr">? | [-+]@? | [/%&amp;</span><span class="se">\|</span><span class="sr">^`~] | </span><span class="se">\[\]</span><span class="sr">=? |
            &lt;&lt; | &gt;&gt; | &lt;=?&gt; | &gt;=? | ===?
          )
        )x</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;matches: </span><span class="si">#{</span><span class="o">[</span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">3</span><span class="o">]]</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Class&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span>
          <span class="n">pop!</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:classname</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:defexpr</span>

        <span class="c1"># class &lt;&lt; expr</span>
        <span class="n">rule</span> <span class="sr">/&lt;&lt;/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[A-Z_]\w*/</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:defexpr</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(\))(\.|::)?/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span>
          <span class="n">pop!</span>
        <span class="k">end</span>
        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:defexpr</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:in_interp</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/}/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:string_intp</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\</span><span class="si">#{</span><span class="o">/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:in_interp</span>
        <span class="n">rule</span> <span class="sr">/#(@@?|\$)[a-z_]\w*/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:string_intp_escaped</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:string_intp</span>
        <span class="n">rule</span> <span class="sr">/\\([\\abefnrstv#&quot;&#39;]|x[a-fA-F0-9]{1,2}|[0-7]{1,3})/</span><span class="p">,</span>
          <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:method_call</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r((</span><span class="se">\s</span><span class="sr">+)(/)(?=</span><span class="se">\S</span><span class="sr">|</span><span class="se">\s</span><span class="sr">*/))</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
          <span class="n">pop!</span>
          <span class="n">push</span> <span class="ss">:slash_regex</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">%r((?=</span><span class="se">\s</span><span class="sr">*/))</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="si">}</span><span class="sr">

        rule(/</span><span class="o">/</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:expr_start</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:expr_start</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r((</span><span class="se">\s</span><span class="sr">*)(/))</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
          <span class="n">pop!</span>
          <span class="n">push</span> <span class="ss">:slash_regex</span>
        <span class="k">end</span>

        <span class="c1"># special case for using a single space.  Ruby demands that</span>
        <span class="c1"># these be in a single line, otherwise it would make no sense.</span>
        <span class="n">rule</span> <span class="sr">/(\s*)(%[rqswQWx]? \S* )/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.String.Other&#39;</span>
          <span class="n">pop!</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:slash_regex</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:string_intp</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\\\\</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(</span><span class="se">\\</span><span class="sr">/)</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([</span><span class="se">\\</span><span class="sr">#])</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([^</span><span class="se">\\</span><span class="sr">/#]+)m</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/)</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:regex_flags</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:end_part</span> <span class="k">do</span>
        <span class="c1"># eat up the rest of the stream as Comment.Preproc</span>
        <span class="n">rule</span> <span class="sr">/.+/m</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Sass</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="kp">include</span> <span class="no">Indentation</span>

      <span class="n">desc</span> <span class="s1">&#39;The Sass stylesheet language language (sass-lang.com)&#39;</span>

      <span class="n">tag</span> <span class="s1">&#39;sass&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.sass&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-sass&#39;</span>

      <span class="nb">id</span> <span class="o">=</span> <span class="sr">/[\w-]+/</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[ \t]*\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/[ \t]*/</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">indentation</span><span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:content</span> <span class="k">do</span>
        <span class="c1"># block comments</span>
        <span class="n">rule</span> <span class="sr">%r(//.*?</span><span class="se">\n</span><span class="sr">)</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Comment.Single&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">starts_block</span> <span class="ss">:single_comment</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">%r(/[*].*?</span><span class="se">\n</span><span class="sr">)</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">starts_block</span> <span class="ss">:multi_comment</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/@import\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:import</span>

        <span class="n">mixin</span> <span class="ss">:content_common</span>

        <span class="n">rule</span> <span class="sr">%r(=</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:value</span>
        <span class="n">rule</span> <span class="sr">%r([+]</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Name.Decorator&#39;</span><span class="p">,</span> <span class="ss">:value</span>

        <span class="n">rule</span> <span class="sr">/:/</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span> <span class="ss">:old_style_attr</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">/(?=.+?:([^a-z]|$))/</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:attribute</span> <span class="p">}</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:selector</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:single_comment</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:multi_comment</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:import</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[ \t]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\S+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:old_style_attr</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:attr_common</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:value</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:end_section</span> <span class="k">do</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">reset_stack</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="c1"># shared states with SCSS</span>
      <span class="c1"># TODO: make this less nasty to do</span>
      <span class="no">COMMON</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span>
        <span class="n">state</span> <span class="ss">:content_common</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/@for\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:for</span>
          <span class="n">rule</span> <span class="sr">/@(debug|warn|if|while)/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:value</span>
          <span class="n">rule</span> <span class="sr">/(@mixin)(\s+)(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)/</span> <span class="k">do</span>
            <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span>
            <span class="n">push</span> <span class="ss">:value</span>
          <span class="k">end</span>

          <span class="n">rule</span> <span class="sr">/@extend\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:selector</span>

          <span class="n">rule</span> <span class="sr">/(@include)(\s+)(</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)/</span> <span class="k">do</span>
            <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Decorator&#39;</span>
            <span class="n">push</span> <span class="ss">:value</span>
          <span class="k">end</span>

          <span class="n">rule</span> <span class="sr">/@</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:selector</span>

          <span class="c1"># $variable: assignment</span>
          <span class="n">rule</span> <span class="sr">/([$]</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">)([ \t]*)(:)/</span> <span class="k">do</span>
            <span class="n">group</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
            <span class="n">push</span> <span class="ss">:value</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:value</span> <span class="k">do</span>
          <span class="n">mixin</span> <span class="ss">:end_section</span>
          <span class="n">rule</span> <span class="sr">/[ \t]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">rule</span> <span class="sr">/[$]</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
          <span class="n">rule</span> <span class="sr">/url[(]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span> <span class="ss">:string_url</span>
          <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">(?=\s*[(])/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>
          <span class="n">rule</span> <span class="sr">/%</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;Name.Decorator&#39;</span>

          <span class="c1"># named literals</span>
          <span class="n">rule</span> <span class="sr">/(true|false)\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Pseudo&#39;</span>
          <span class="n">rule</span> <span class="sr">/(and|or|not)\b/</span><span class="p">,</span> <span class="s1">&#39;Operator.Word&#39;</span>

          <span class="c1"># colors and numbers</span>
          <span class="n">rule</span> <span class="sr">/#[a-z0-9]{1,6}/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
          <span class="n">rule</span> <span class="sr">/-?\d+(%|[a-z]+)?/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span>
          <span class="n">rule</span> <span class="sr">/-?\d*\.\d+(%|[a-z]+)?/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>

          <span class="n">mixin</span> <span class="ss">:has_strings</span>
          <span class="n">mixin</span> <span class="ss">:has_interp</span>

          <span class="n">rule</span> <span class="sr">/[~^*!&amp;%&lt;&gt;\|+=@:,.\/?-]+/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
          <span class="n">rule</span> <span class="sr">/[\[\]()]+/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="n">rule</span> <span class="sr">%r(/[*])</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:inline_comment</span>
          <span class="n">rule</span> <span class="sr">%r(//[^</span><span class="se">\n</span><span class="sr">]*)</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>

          <span class="c1"># identifiers</span>
          <span class="n">rule</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
            <span class="k">if</span> <span class="no">CSS</span><span class="nf">.builtins.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
              <span class="n">token</span> <span class="s1">&#39;Name.Builtin&#39;</span>
            <span class="k">elsif</span> <span class="no">CSS</span><span class="nf">.constants.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
              <span class="n">token</span> <span class="s1">&#39;Name.Constant&#39;</span>
            <span class="k">else</span>
              <span class="n">token</span> <span class="s1">&#39;Name&#39;</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:has_interp</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/[#][{]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:interpolation</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:has_strings</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:dq</span>
          <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span><span class="p">,</span> <span class="ss">:sq</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:interpolation</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/}/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
          <span class="n">mixin</span> <span class="ss">:value</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:selector</span> <span class="k">do</span>
          <span class="n">mixin</span> <span class="ss">:end_section</span>

          <span class="n">mixin</span> <span class="ss">:has_strings</span>
          <span class="n">mixin</span> <span class="ss">:has_interp</span>
          <span class="n">rule</span> <span class="sr">/[ \t]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">rule</span> <span class="sr">/:/</span><span class="p">,</span> <span class="s1">&#39;Name.Decorator&#39;</span><span class="p">,</span> <span class="ss">:pseudo_class</span>
          <span class="n">rule</span> <span class="sr">/[.]/</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span> <span class="ss">:class</span>
          <span class="n">rule</span> <span class="sr">/#/</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span> <span class="ss">:id</span>
          <span class="n">rule</span> <span class="sr">/%/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:placeholder</span>
          <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span>
          <span class="n">rule</span> <span class="sr">/&amp;/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
          <span class="n">rule</span> <span class="sr">/[~^*!&amp;\[\]()&lt;&gt;\|+=@:;,.\/?-]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:dq</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
          <span class="n">mixin</span> <span class="ss">:has_interp</span>
          <span class="n">rule</span> <span class="sr">/(\\.|#(?![{])|[^\n&quot;#])+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:sq</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
          <span class="n">mixin</span> <span class="ss">:has_interp</span>
          <span class="n">rule</span> <span class="sr">/(\\.|#(?![{])|[^\n&#39;#])+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:string_url</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/[)]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
          <span class="n">rule</span> <span class="sr">/(\\.|#(?![{])|[^\n)#])+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Other&#39;</span>
          <span class="n">mixin</span> <span class="ss">:has_interp</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:selector_piece</span> <span class="k">do</span>
          <span class="n">mixin</span> <span class="ss">:has_interp</span>
          <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:pseudo_class</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Decorator&#39;</span>
          <span class="n">mixin</span> <span class="ss">:selector_piece</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:class</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span>
          <span class="n">mixin</span> <span class="ss">:selector_piece</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:id</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Namespace&#39;</span>
          <span class="n">mixin</span> <span class="ss">:selector_piece</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:placeholder</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
          <span class="n">mixin</span> <span class="ss">:selector_piece</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:for</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/(from|to|through)/</span><span class="p">,</span> <span class="s1">&#39;Operator.Word&#39;</span>
          <span class="n">mixin</span> <span class="ss">:value</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:attr_common</span> <span class="k">do</span>
          <span class="n">mixin</span> <span class="ss">:has_interp</span>
          <span class="n">rule</span> <span class="nb">id</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
            <span class="k">if</span> <span class="no">CSS</span><span class="nf">.attributes.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
              <span class="n">token</span> <span class="s1">&#39;Name.Label&#39;</span>
            <span class="k">else</span>
              <span class="n">token</span> <span class="s1">&#39;Name.Attribute&#39;</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:attribute</span> <span class="k">do</span>
          <span class="n">mixin</span> <span class="ss">:attr_common</span>

          <span class="n">rule</span> <span class="sr">/([ \t]*)(:)/</span> <span class="k">do</span>
            <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
            <span class="n">push</span> <span class="ss">:value</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="ss">:inline_comment</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="sr">/(\\#|#(?=[^\n{])|\*(?=[^\n\/])|[^\n#*])+/</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
          <span class="n">mixin</span> <span class="ss">:has_interp</span>
          <span class="n">rule</span> <span class="sr">%r([*]/)</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="nb">class_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="no">COMMON</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Scheme</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Scheme variant of Lisp&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;scheme&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.scm&#39;</span><span class="p">,</span> <span class="s1">&#39;*.ss&#39;</span><span class="p">,</span> <span class="s1">&#39;*.rkt&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-scheme&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-scheme&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">keywords</span>
        <span class="vi">@keywords</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          lambda define if else cond and or case let let* letrec begin
          do delay set! =&gt; quote quasiquote unquote unquote-splicing
          define-syntax let-syntax letrec-syntax syntax-rules
        )</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">builtins</span>
        <span class="vi">@builtins</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          * + - / &lt; &lt;= = &gt; &gt;= abs acos angle append apply asin
          assoc assq assv atan boolean? caaaar caaadr caaar caadar
          caaddr caadr caar cadaar cadadr cadar caddar cadddr caddr
          cadr call-with-current-continuation call-with-input-file
          call-with-output-file call-with-values call/cc car cdaaar cdaadr
          cdaar cdadar cdaddr cdadr cdar cddaar cddadr cddar cdddar cddddr
          cdddr cddr cdr ceiling char-&gt;integer char-alphabetic? char-ci&lt;=?
          char-ci&lt;? char-ci=? char-ci&gt;=? char-ci&gt;? char-downcase
          char-lower-case? char-numeric? char-ready? char-upcase
          char-upper-case? char-whitespace? char&lt;=? char&lt;? char=? char&gt;=?
          char&gt;? char? close-input-port close-output-port complex? cons
          cos current-input-port current-output-port denominator
          display dynamic-wind eof-object? eq?  equal? eqv? eval
          even? exact-&gt;inexact exact? exp expt floor for-each force gcd
          imag-part inexact-&gt;exact inexact? input-port? integer-&gt;char
          integer? interaction-environment lcm length list list-&gt;string
          list-&gt;vector list-ref list-tail list?  load log magnitude
          make-polar make-rectangular make-string make-vector map
          max member memq memv min modulo negative? newline not
          null-environment null? number-&gt;string number? numerator odd?
          open-input-file open-output-file output-port? pair?  peek-char
          port? positive? procedure? quotient rational? rationalize
          read read-char real-part real?  remainder reverse round
          scheme-report-environment set-car! set-cdr! sin sqrt string
          string-&gt;list string-&gt;number string-&gt;symbol string-append
          string-ci&lt;=?  string-ci&lt;? string-ci=? string-ci&gt;=? string-ci&gt;?
          string-copy string-fill! string-length string-ref
          string-set! string&lt;=? string&lt;? string=? string&gt;=?
          string&gt;? string? substring symbol-&gt;string symbol?
          tan transcript-off transcript-on truncate values vector
          vector-&gt;list vector-fill! vector-length vector-ref
          vector-set! vector? with-input-from-file with-output-to-file
          write write-char zero?
        )</span>
      <span class="k">end</span>

      <span class="nb">id</span> <span class="o">=</span> <span class="sr">/[a-z0-9!$\%&amp;*+,\/:&lt;=&gt;?@^_~|-]+/i</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="c1"># comments</span>
        <span class="n">rule</span> <span class="sr">/;.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/-?\d+\.\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Float&#39;</span>
        <span class="n">rule</span> <span class="sr">/-?\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>

        <span class="c1"># Racket infinitites</span>
        <span class="n">rule</span> <span class="sr">/[+-]inf[.][f0]/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span>

        <span class="n">rule</span> <span class="sr">/#b[01]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Binary&#39;</span>
        <span class="n">rule</span> <span class="sr">/#o[0-7]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span>
        <span class="n">rule</span> <span class="sr">/#d[0-9]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">/#x[0-9a-f]+/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/#[ei][\d.]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Other&#39;</span>

        <span class="n">rule</span> <span class="sr">/&quot;(\\\\|\\&quot;|[^&quot;])*&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="sr">/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>
        <span class="n">rule</span> <span class="sr">/#\\([()\/&#39;&quot;._!\$%&amp; ?=+-]{1}|[a-z0-9]+)/i</span><span class="p">,</span>
          <span class="s1">&#39;Literal.String.Char&#39;</span>
        <span class="n">rule</span> <span class="sr">/#t|#f/</span><span class="p">,</span> <span class="s1">&#39;Name.Constant&#39;</span>
        <span class="n">rule</span> <span class="sr">/(?:&#39;|#|`|,@|,|\.)/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="n">rule</span> <span class="sr">/([&#39;#])(\s*)(\()/m</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:command</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>

        <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:command</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.keywords.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span>
          <span class="k">elsif</span> <span class="nb">self</span><span class="nf">.class.builtins.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
            <span class="n">token</span> <span class="s1">&#39;Name.Builtin&#39;</span>
          <span class="k">else</span>
            <span class="n">token</span> <span class="s1">&#39;Name.Function&#39;</span>
          <span class="k">end</span>

          <span class="n">pop!</span>
        <span class="k">end</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Scss</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;SCSS stylesheets (sass-lang.com)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;scss&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.scss&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-scss&#39;</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(//.*?</span><span class="se">\n</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/[*].*?[*]/)m</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">/@import\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:value</span>

        <span class="n">mixin</span> <span class="ss">:content_common</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">/(?=[^;{}][;}])/</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:attribute</span> <span class="p">}</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/(?=[^;{}:]+:[^a-z])/</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:attribute</span> <span class="p">}</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">push</span> <span class="ss">:selector</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:end_section</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/[;{}]/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">reset_stack</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="nb">instance_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="no">Sass</span><span class="o">::</span><span class="no">COMMON</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Shell</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Various shell languages, including sh and bash&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;shell&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="s1">&#39;zsh&#39;</span><span class="p">,</span> <span class="s1">&#39;ksh&#39;</span><span class="p">,</span> <span class="s1">&#39;sh&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.sh&#39;</span><span class="p">,</span> <span class="s1">&#39;*.bash&#39;</span><span class="p">,</span> <span class="s1">&#39;*.zsh&#39;</span><span class="p">,</span> <span class="s1">&#39;*.ksh&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;application/x-sh&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-shellscript&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">text</span><span class="nf">.shebang?</span><span class="p">(</span><span class="sr">/(ba|z|k)?sh/</span><span class="p">)</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="k">end</span>

      <span class="no">KEYWORDS</span> <span class="o">=</span> <span class="sx">%w(
        if fi else while do done for then return function
        select continue until esac elif in
      )</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>

      <span class="no">BUILTINS</span> <span class="o">=</span> <span class="sx">%w(
        alias bg bind break builtin caller cd command compgen
        complete declare dirs disown echo enable eval exec exit
        export false fc fg getopts hash help history jobs kill let
        local logout popd printf pushd pwd read readonly set shift
        shopt source suspend test time times trap true type typeset
        ulimit umask unalias unset wait
      )</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>

      <span class="n">state</span> <span class="ss">:basic</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/#.*\n/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>

        <span class="n">rule</span> <span class="sr">/\b(</span><span class="si">#{</span><span class="no">KEYWORDS</span><span class="si">}</span><span class="sr">)\s*\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span> <span class="sr">/\bcase\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:case</span>

        <span class="n">rule</span> <span class="sr">/\b(</span><span class="si">#{</span><span class="no">BUILTINS</span><span class="si">}</span><span class="sr">)\s*\b(?!\.)/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>

        <span class="n">rule</span> <span class="sr">/(\b\w+)(=)/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Variable&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[\[\]{}()=]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/&amp;&amp;|\|\|/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="c1"># rule /\|\|/, &#39;Operator&#39;</span>

        <span class="n">rule</span> <span class="sr">/&lt;&lt;&lt;/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span> <span class="c1"># here-string</span>
        <span class="n">rule</span> <span class="sr">/&lt;&lt;-?\s*(\&#39;?)\\?(\w+)\1/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">lsh</span> <span class="o">=</span> <span class="s1">&#39;Literal.String.Heredoc&#39;</span>
          <span class="n">token</span> <span class="n">lsh</span>
          <span class="n">heredocstr</span> <span class="o">=</span> <span class="no">Regexp</span><span class="nf">.escape</span><span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">)</span>

          <span class="n">push</span> <span class="k">do</span>
            <span class="n">rule</span> <span class="sr">/\s*</span><span class="si">#{</span><span class="n">heredocstr</span><span class="si">}</span><span class="sr">\s*\n/</span><span class="p">,</span> <span class="n">lsh</span><span class="p">,</span> <span class="ss">:pop!</span>
            <span class="n">rule</span> <span class="sr">/.*?\n/</span><span class="p">,</span> <span class="n">lsh</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:double_quotes</span> <span class="k">do</span>
        <span class="c1"># NB: &quot;abc$&quot; is literally the string abc$.</span>
        <span class="c1"># Here we prevent :interp from interpreting $&quot; as a variable.</span>
        <span class="n">rule</span> <span class="sr">/(?:\$#?)?&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:interp</span>
        <span class="n">rule</span> <span class="sr">/[^&quot;`\\$]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:single_quotes</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^&#39;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:data</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$?&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:double_quotes</span>

        <span class="c1"># single quotes are much easier than double quotes - we can</span>
        <span class="c1"># literally just scan until the next single quote.</span>
        <span class="c1"># POSIX: Enclosing characters in single-quotes ( &#39;&#39; )</span>
        <span class="c1"># shall preserve the literal value of each character within the</span>
        <span class="c1"># single-quotes. A single-quote cannot occur within single-quotes.</span>
        <span class="n">rule</span> <span class="sr">/$?&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span><span class="p">,</span> <span class="ss">:single_quotes</span>

        <span class="n">rule</span> <span class="sr">/\*/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>

        <span class="n">rule</span> <span class="sr">/;/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^=\*\s{}()$&quot;\&#39;`\\&lt;]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+(?= |\Z)/</span><span class="p">,</span> <span class="s1">&#39;Number&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">mixin</span> <span class="ss">:interp</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:curly</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/}/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/:-/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span> <span class="sr">/[a-zA-Z0-9_]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^}:&quot;&#39;`$]+/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:paren</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:math</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\)\)/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r([-+*/%^|&amp;]|</span><span class="se">\*\*</span><span class="sr">|</span><span class="se">\|\|</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/\d+/</span><span class="p">,</span> <span class="s1">&#39;Number&#39;</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:case</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\besac\b/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\|/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/\)/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:case_stanza</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:case_stanza</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/;;/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:backticks</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/`/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:root</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:interp</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\$/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span> <span class="c1"># line continuation</span>
        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$\(\(/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:math</span>
        <span class="n">rule</span> <span class="sr">/\$\(/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:paren</span>
        <span class="n">rule</span> <span class="sr">/\${#?/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:curly</span>
        <span class="n">rule</span> <span class="sr">/`/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span><span class="p">,</span> <span class="ss">:backticks</span>
        <span class="n">rule</span> <span class="sr">/\$#?(\w+|.)/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:basic</span>
        <span class="n">mixin</span> <span class="ss">:data</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Smalltalk</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s1">&#39;The Smalltalk programming language&#39;</span>

      <span class="n">tag</span> <span class="s1">&#39;smalltalk&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;st&#39;</span><span class="p">,</span> <span class="s1">&#39;squeak&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.st&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-smalltalk&#39;</span>

      <span class="n">ops</span> <span class="o">=</span> <span class="sr">%r([-+*/</span><span class="se">\\</span><span class="sr">~&lt;&gt;=|&amp;!?,@%])</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(&lt;)(\w+:)(.*?)(&gt;)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="k">end</span>

        <span class="c1"># mixin :squeak_fileout</span>
        <span class="n">mixin</span> <span class="ss">:whitespaces</span>
        <span class="n">mixin</span> <span class="ss">:method_definition</span>
        <span class="n">rule</span> <span class="sr">/([|])([\w\s]*)([|])/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="k">end</span>
        <span class="n">mixin</span> <span class="ss">:objects</span>
        <span class="n">rule</span> <span class="sr">/\^|:=|_/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>

        <span class="n">rule</span> <span class="sr">/[)}\]]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:after_object</span>
        <span class="n">rule</span> <span class="sr">/[({\[!]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:method_definition</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/([a-z]\w*:)(\s*)(\w+)/i</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/^(\s*)(\b[a-z]\w*\b)(\s*)$/i</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">%r(^(</span><span class="se">\s</span><span class="sr">*)(</span><span class="si">#{</span><span class="n">ops</span><span class="si">}</span><span class="sr">+)(</span><span class="se">\s</span><span class="sr">*)(</span><span class="se">\w</span><span class="sr">+)(</span><span class="se">\s</span><span class="sr">*)$)</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:block_variables</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:whitespaces</span>
        <span class="n">rule</span> <span class="sr">/(:)(\s*)(\w+)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Operator&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[|]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>

        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:literals</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&#39;(&#39;&#39;|.)*?&#39;/m</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:after_object</span>
        <span class="n">rule</span> <span class="sr">/[$]./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Char&#39;</span><span class="p">,</span> <span class="ss">:after_object</span>
        <span class="n">rule</span> <span class="sr">/#[(]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span> <span class="ss">:parenth</span>
        <span class="n">rule</span> <span class="sr">/(\d+r)?-?\d+(\.\d+)?(e-?\d+)?/</span><span class="p">,</span>
          <span class="s1">&#39;Literal.Number&#39;</span><span class="p">,</span> <span class="ss">:after_object</span>
        <span class="n">rule</span> <span class="sr">/#(&quot;[^&quot;]*&quot;|</span><span class="si">#{</span><span class="n">ops</span><span class="si">}</span><span class="sr">+|[\w:]+)/</span><span class="p">,</span>
          <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span> <span class="ss">:after_object</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:parenth</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[)]/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:after_object</span>
        <span class="k">end</span>

        <span class="n">mixin</span> <span class="ss">:inner_parenth</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:inner_parenth</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/#[(]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span> <span class="ss">:inner_parenth</span>
        <span class="n">rule</span> <span class="sr">/[)]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:whitespaces</span>
        <span class="n">mixin</span> <span class="ss">:literals</span>
        <span class="n">rule</span> <span class="sr">/(</span><span class="si">#{</span><span class="n">ops</span><span class="si">}</span><span class="sr">|[\w:])+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:whitespaces</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/! !$/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span> <span class="c1"># squeak chunk delimiter</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;.*?&quot;/m</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:objects</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\[/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:block_variables</span>
        <span class="n">rule</span> <span class="sr">/(self|super|true|false|nil|thisContext)\b/</span><span class="p">,</span>
          <span class="s1">&#39;Name.Builtin.Pseudo&#39;</span><span class="p">,</span> <span class="ss">:after_object</span>
        <span class="n">rule</span> <span class="sr">/[A-Z]\w*(?!:)\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span> <span class="ss">:after_object</span>
        <span class="n">rule</span> <span class="sr">/[a-z]\w*(?!:)\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:after_object</span>
        <span class="n">mixin</span> <span class="ss">:literals</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:after_object</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:whitespaces</span>
        <span class="n">rule</span> <span class="sr">/(ifTrue|ifFalse|whileTrue|whileFalse|timesRepeat):/</span><span class="p">,</span>
          <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/new(?!:)\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="n">rule</span> <span class="sr">/:=|_/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[a-z]+\w*:/i</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[a-z]+\w*/i</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="n">ops</span><span class="si">}</span><span class="sr">+/</span><span class="p">,</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[.]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/;/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">SQL</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Structured Query Language, for relational databases&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;sql&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.sql&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-sql&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">keywords</span>
        <span class="vi">@keywords</span> <span class="o">||=</span> <span class="no">Set</span><span class="nf">.new</span> <span class="sx">%w(
          ABORT ABS ABSOLUTE ACCESS ADA ADD ADMIN AFTER AGGREGATE ALIAS
          ALL ALLOCATE ALTER ANALYSE ANALYZE AND ANY ARE AS ASC ASENSITIVE
          ASSERTION ASSIGNMENT ASYMMETRIC AT ATOMIC AUTHORIZATION
          AVG BACKWARD BEFORE BEGIN BETWEEN BITVAR BIT_LENGTH BOTH
          BREADTH BY C CACHE CALL CALLED CARDINALITY CASCADE CASCADED
          CASE CAST CATALOG CATALOG_NAME CHAIN CHARACTERISTICS
          CHARACTER_LENGTH CHARACTER_SET_CATALOG CHARACTER_SET_NAME
          CHARACTER_SET_SCHEMA CHAR_LENGTH CHECK CHECKED CHECKPOINT
          CLASS CLASS_ORIGIN CLOB CLOSE CLUSTER COALSECE COBOL COLLATE
          COLLATION COLLATION_CATALOG COLLATION_NAME COLLATION_SCHEMA
          COLUMN COLUMN_NAME COMMAND_FUNCTION COMMAND_FUNCTION_CODE
          COMMENT COMMIT COMMITTED COMPLETION CONDITION_NUMBER
          CONNECT CONNECTION CONNECTION_NAME CONSTRAINT CONSTRAINTS
          CONSTRAINT_CATALOG CONSTRAINT_NAME CONSTRAINT_SCHEMA
          CONSTRUCTOR CONTAINS CONTINUE CONVERSION CONVERT COPY
          CORRESPONTING COUNT CREATE CREATEDB CREATEUSER CROSS CUBE
          CURRENT CURRENT_DATE CURRENT_PATH CURRENT_ROLE CURRENT_TIME
          CURRENT_TIMESTAMP CURRENT_USER CURSOR CURSOR_NAME CYCLE DATA
          DATABASE DATETIME_INTERVAL_CODE DATETIME_INTERVAL_PRECISION
          DAY DEALLOCATE DECLARE DEFAULT DEFAULTS DEFERRABLE DEFERRED
          DEFINED DEFINER DELETE DELIMITER DELIMITERS DEREF DESC DESCRIBE
          DESCRIPTOR DESTROY DESTRUCTOR DETERMINISTIC DIAGNOSTICS
          DICTIONARY DISCONNECT DISPATCH DISTINCT DO DOMAIN DROP
          DYNAMIC DYNAMIC_FUNCTION DYNAMIC_FUNCTION_CODE EACH ELSE
          ENCODING ENCRYPTED END END-EXEC EQUALS ESCAPE EVERY EXCEPT
          ESCEPTION EXCLUDING EXCLUSIVE EXEC EXECUTE EXISTING EXISTS
          EXPLAIN EXTERNAL EXTRACT FALSE FETCH FINAL FIRST FOR FORCE
          FOREIGN FORTRAN FORWARD FOUND FREE FREEZE FROM FULL FUNCTION
          G GENERAL GENERATED GET GLOBAL GO GOTO GRANT GRANTED GROUP
          GROUPING HANDLER HAVING HIERARCHY HOLD HOST IDENTITY IGNORE
          ILIKE IMMEDIATE IMMUTABLE IMPLEMENTATION IMPLICIT IN INCLUDING
          INCREMENT INDEX INDITCATOR INFIX INHERITS INITIALIZE INITIALLY
          INNER INOUT INPUT INSENSITIVE INSERT INSTANTIABLE INSTEAD
          INTERSECT INTO INVOKER IS ISNULL ISOLATION ITERATE JOIN KEY
          KEY_MEMBER KEY_TYPE LANCOMPILER LANGUAGE LARGE LAST LATERAL
          LEADING LEFT LENGTH LESS LEVEL LIKE LIMIT LISTEN LOAD LOCAL
          LOCALTIME LOCALTIMESTAMP LOCATION LOCATOR LOCK LOWER MAP MATCH
          MAX MAXVALUE MESSAGE_LENGTH MESSAGE_OCTET_LENGTH MESSAGE_TEXT
          METHOD MIN MINUTE MINVALUE MOD MODE MODIFIES MODIFY MONTH
          MORE MOVE MUMPS NAMES NATIONAL NATURAL NCHAR NCLOB NEW NEXT
          NO NOCREATEDB NOCREATEUSER NONE NOT NOTHING NOTIFY NOTNULL
          NULL NULLABLE NULLIF OBJECT OCTET_LENGTH OF OFF OFFSET OIDS
          OLD ON ONLY OPEN OPERATION OPERATOR OPTION OPTIONS OR ORDER
          ORDINALITY OUT OUTER OUTPUT OVERLAPS OVERLAY OVERRIDING
          OWNER PAD PARAMETER PARAMETERS PARAMETER_MODE PARAMATER_NAME
          PARAMATER_ORDINAL_POSITION PARAMETER_SPECIFIC_CATALOG
          PARAMETER_SPECIFIC_NAME PARAMATER_SPECIFIC_SCHEMA PARTIAL PASCAL
          PENDANT PLACING PLI POSITION POSTFIX PRECISION PREFIX PREORDER
          PREPARE PRESERVE PRIMARY PRIOR PRIVILEGES PROCEDURAL PROCEDURE
          PUBLIC READ READS RECHECK RECURSIVE REF REFERENCES REFERENCING
          REINDEX RELATIVE RENAME REPEATABLE REPLACE RESET RESTART
          RESTRICT RESULT RETURN RETURNED_LENGTH RETURNED_OCTET_LENGTH
          RETURNED_SQLSTATE RETURNS REVOKE RIGHT ROLE ROLLBACK ROLLUP
          ROUTINE ROUTINE_CATALOG ROUTINE_NAME ROUTINE_SCHEMA ROW ROWS
          ROW_COUNT RULE SAVE_POINT SCALE SCHEMA SCHEMA_NAME SCOPE SCROLL
          SEARCH SECOND SECURITY SELECT SELF SENSITIVE SERIALIZABLE
          SERVER_NAME SESSION SESSION_USER SET SETOF SETS SHARE SHOW
          SIMILAR SIMPLE SIZE SOME SOURCE SPACE SPECIFIC SPECIFICTYPE
          SPECIFIC_NAME SQL SQLCODE SQLERROR SQLEXCEPTION SQLSTATE
          SQLWARNINIG STABLE START STATE STATEMENT STATIC STATISTICS
          STDIN STDOUT STORAGE STRICT STRUCTURE STYPE SUBCLASS_ORIGIN
          SUBLIST SUBSTRING SUM SYMMETRIC SYSID SYSTEM SYSTEM_USER
          TABLE TABLE_NAME  TEMP TEMPLATE TEMPORARY TERMINATE THAN THEN
          TIMESTAMP TIMEZONE_HOUR TIMEZONE_MINUTE TO TOAST TRAILING
          TRANSATION TRANSACTIONS_COMMITTED TRANSACTIONS_ROLLED_BACK
          TRANSATION_ACTIVE TRANSFORM TRANSFORMS TRANSLATE TRANSLATION
          TREAT TRIGGER TRIGGER_CATALOG TRIGGER_NAME TRIGGER_SCHEMA TRIM
          TRUE TRUNCATE TRUSTED TYPE UNCOMMITTED UNDER UNENCRYPTED UNION
          UNIQUE UNKNOWN UNLISTEN UNNAMED UNNEST UNTIL UPDATE UPPER
          USAGE USER USER_DEFINED_TYPE_CATALOG USER_DEFINED_TYPE_NAME
          USER_DEFINED_TYPE_SCHEMA USING VACUUM VALID VALIDATOR VALUES
          VARIABLE VERBOSE VERSION VIEW VOLATILE WHEN WHENEVER WHERE
          WITH WITHOUT WORK WRITE YEAR ZONE
        )</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/--.*?\n/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(/</span><span class="se">\*</span><span class="sr">)</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:multiline_comments</span>
        <span class="n">rule</span> <span class="sr">/\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span><span class="p">,</span> <span class="ss">:single_string</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:double_string</span>
        <span class="n">rule</span> <span class="sr">/`/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:backtick</span>

        <span class="n">rule</span> <span class="sr">/\w[\w\d]*/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="k">if</span> <span class="nb">self</span><span class="nf">.class.keywords.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.upcase</span>
            <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span>
          <span class="k">else</span>
            <span class="n">token</span> <span class="s1">&#39;Name&#39;</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">%r([+*/&lt;&gt;=~!@#%^&amp;|?^-])</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[;:()\[\],.]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:multiline_comments</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r(/[*])</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:multiline_comments</span>
        <span class="n">rule</span> <span class="sr">%r([*]/)</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">%r([^/*]+)</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
        <span class="n">rule</span> <span class="sr">%r([/*])</span><span class="p">,</span> <span class="s1">&#39;Comment.Multiline&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:backtick</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/``/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/`/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^\\`]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:single_string</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^\\&#39;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:double_string</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\./</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^\\&quot;]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">TCL</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The Tool Command Language (tcl.tk)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;tcl&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.tcl&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-tcl&#39;</span><span class="p">,</span> <span class="s1">&#39;text/x-script.tcl&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-tcl&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span> <span class="s1">&#39;tclsh&#39;</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span> <span class="s1">&#39;wish&#39;</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.shebang?</span> <span class="s1">&#39;jimsh&#39;</span>
      <span class="k">end</span>

      <span class="no">KEYWORDS</span> <span class="o">=</span> <span class="sx">%w(
        after apply array break catch continue elseif else error
        eval expr for foreach global if namespace proc rename return
        set switch then trace unset update uplevel upvar variable
        vwait while
      )</span>

      <span class="no">BUILTINS</span> <span class="o">=</span> <span class="sx">%w(
        append bgerror binary cd chan clock close concat dde dict
        encoding eof exec exit fblocked fconfigure fcopy file
        fileevent flush format gets glob history http incr info interp
        join lappend lassign lindex linsert list llength load loadTk
        lrange lrepeat lreplace lreverse lsearch lset lsort mathfunc
        mathop memory msgcat open package pid pkg::create pkg_mkIndex
        platform platform::shell puts pwd re_syntax read refchan
        regexp registry regsub scan seek socket source split string
        subst tell time tm unknown unload
      )</span>

      <span class="no">OPEN</span> <span class="o">=</span>  <span class="sx">%w| \( \[ \{ &quot; |</span>
      <span class="no">CLOSE</span> <span class="o">=</span> <span class="sx">%w| \) \] \} |</span>
      <span class="no">ALL</span> <span class="o">=</span> <span class="no">OPEN</span> <span class="o">+</span> <span class="no">CLOSE</span>
      <span class="no">END_LINE</span> <span class="o">=</span> <span class="no">CLOSE</span> <span class="o">+</span> <span class="sx">%w(; \n)</span>
      <span class="no">END_WORD</span> <span class="o">=</span> <span class="no">END_LINE</span> <span class="o">+</span> <span class="sx">%w(\s)</span>

      <span class="no">CHARS</span> <span class="o">=</span>     <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">list</span><span class="o">|</span> <span class="no">Regexp</span><span class="nf">.new</span> <span class="sx">%/[#{list.join}]/</span>  <span class="p">}</span>
      <span class="no">NOT_CHARS</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">list</span><span class="o">|</span> <span class="no">Regexp</span><span class="nf">.new</span> <span class="sx">%/[^#{list.join}]/</span> <span class="p">}</span>

      <span class="n">state</span> <span class="ss">:word</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\{\*\}/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>

        <span class="n">mixin</span> <span class="ss">:brace_abort</span>
        <span class="n">mixin</span> <span class="ss">:interp</span>
        <span class="n">rule</span> <span class="sr">/\{/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:brace</span>
        <span class="n">rule</span> <span class="sr">/\(/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span>   <span class="ss">:paren</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span>  <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:string</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="no">NOT_CHARS</span><span class="o">[</span><span class="no">END_WORD</span><span class="o">]</span><span class="si">}</span><span class="sr">+?(?=</span><span class="si">#{</span><span class="no">CHARS</span><span class="o">[</span><span class="no">OPEN</span><span class="o">+[</span><span class="s1">&#39;\\\\&#39;</span><span class="o">]]</span><span class="si">}</span><span class="sr">)/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">gen_command_state</span><span class="p">(</span><span class="nb">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">state</span><span class="p">(</span><span class="ss">:&quot;command</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="ss">&quot;</span><span class="p">)</span> <span class="k">do</span>
          <span class="n">mixin</span> <span class="ss">:word</span>

          <span class="n">rule</span> <span class="sr">/#</span><span class="si">#{</span><span class="no">NOT_CHARS</span><span class="o">[</span><span class="no">END_LINE</span><span class="o">]</span><span class="si">}</span><span class="sr">+/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>

          <span class="n">rule</span> <span class="sr">/(?=</span><span class="si">#{</span><span class="no">CHARS</span><span class="o">[</span><span class="no">END_WORD</span><span class="o">]</span><span class="si">}</span><span class="sr">)/</span> <span class="k">do</span>
            <span class="n">push</span> <span class="ss">:&quot;params</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="ss">&quot;</span>
          <span class="k">end</span>

          <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="no">NOT_CHARS</span><span class="o">[</span><span class="no">END_WORD</span><span class="o">]</span><span class="si">}</span><span class="sr">+/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
            <span class="k">if</span> <span class="no">KEYWORDS</span><span class="nf">.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
              <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span>
            <span class="k">elsif</span> <span class="no">BUILTINS</span><span class="nf">.include?</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
              <span class="n">token</span> <span class="s1">&#39;Name.Builtin&#39;</span>
            <span class="k">else</span>
              <span class="n">token</span> <span class="s1">&#39;Text&#39;</span>
            <span class="k">end</span>
          <span class="k">end</span>

          <span class="n">mixin</span> <span class="ss">:whitespace</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">gen_delimiter_states</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">close</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">gen_command_state</span><span class="p">(</span><span class="s2">&quot;_in_</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">state</span> <span class="ss">:&quot;params_in_</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="ss">&quot;</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="n">close</span> <span class="k">do</span>
            <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
            <span class="n">pop!</span><span class="p">;</span> <span class="n">pop!</span>
          <span class="k">end</span>

          <span class="c1"># mismatched delimiters.  Braced strings with mismatched</span>
          <span class="c1"># closing delimiters should be okay, since this is standard</span>
          <span class="c1"># practice, like {]]]]}</span>
          <span class="k">if</span> <span class="n">opts</span><span class="o">[</span><span class="ss">:strict</span><span class="o">]</span>
            <span class="n">rule</span> <span class="no">CHARS</span><span class="o">[</span><span class="no">CLOSE</span> <span class="o">-</span> <span class="o">[</span><span class="n">close</span><span class="o">]]</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span>
          <span class="k">else</span>
            <span class="n">rule</span> <span class="no">CHARS</span><span class="o">[</span><span class="no">CLOSE</span> <span class="o">-</span> <span class="o">[</span><span class="n">close</span><span class="o">]]</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
          <span class="k">end</span>

          <span class="n">mixin</span> <span class="ss">:params</span>
        <span class="k">end</span>

        <span class="n">state</span> <span class="nb">name</span> <span class="k">do</span>
          <span class="n">rule</span> <span class="n">close</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
          <span class="n">mixin</span> <span class="ss">:&quot;command_in_</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="ss">&quot;</span>
        <span class="k">end</span>
      <span class="k">end</span>


      <span class="c1"># tcl is freaking impossible.  If we&#39;re in braces and we encounter</span>
      <span class="c1"># a close brace, we have to drop everything and close the brace.</span>
      <span class="c1"># This is so silly things like {abc&quot;def} and {abc]def} don&#39;t b0rk</span>
      <span class="c1"># everything after them.</span>

      <span class="c1"># TODO: TCL seems to have this aborting behavior quite a lot.</span>
      <span class="c1"># such things as [ abc&quot; ] are a runtime error, but will still</span>
      <span class="c1"># parse.  Currently something like this will muck up the lex.</span>
      <span class="n">state</span> <span class="ss">:brace_abort</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/}/</span> <span class="k">do</span>
          <span class="k">if</span> <span class="n">in_state?</span> <span class="ss">:brace</span>
            <span class="n">pop!</span> <span class="k">until</span> <span class="n">state?</span> <span class="ss">:brace</span>
            <span class="n">pop!</span>
            <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="k">else</span>
            <span class="n">token</span> <span class="s1">&#39;Error&#39;</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:params</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/;/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/else|elseif|then/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">mixin</span> <span class="ss">:word</span>
        <span class="n">mixin</span> <span class="ss">:whitespace</span>
        <span class="n">rule</span> <span class="sr">/</span><span class="si">#{</span><span class="no">NOT_CHARS</span><span class="o">[</span><span class="no">END_WORD</span><span class="o">]</span><span class="si">}</span><span class="sr">+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">gen_delimiter_states</span> <span class="ss">:brace</span><span class="p">,</span>   <span class="sr">/\}/</span><span class="p">,</span> <span class="ss">:strict</span> <span class="o">=&gt;</span> <span class="kp">false</span>
      <span class="n">gen_delimiter_states</span> <span class="ss">:paren</span><span class="p">,</span>   <span class="sr">/\)/</span><span class="p">,</span> <span class="ss">:strict</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">gen_delimiter_states</span> <span class="ss">:bracket</span><span class="p">,</span> <span class="sr">/\]/</span><span class="p">,</span> <span class="ss">:strict</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">gen_command_state</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:command</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:whitespace</span> <span class="k">do</span>
        <span class="c1"># not a multiline regex because we want to capture \n sometimes</span>
        <span class="n">rule</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:interp</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\[/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:bracket</span>
        <span class="n">rule</span> <span class="sr">/\$[a-z0-9.:-]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$\{.*?\}/m</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">/\$/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="c1"># escape sequences</span>
        <span class="n">rule</span> <span class="sr">/\\[0-7]{3}/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\x[0-9a-f]{2}/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\u[0-9a-f]{4}/i</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\./m</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:string</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:interp</span>
        <span class="n">rule</span> <span class="sr">/[^\\\[\$&quot;{}]+/m</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>

        <span class="c1"># strings have to keep count of their internal braces, to support</span>
        <span class="c1"># for example { &quot;{ }&quot; }.</span>
        <span class="n">rule</span> <span class="sr">/{/</span> <span class="k">do</span>
          <span class="vi">@brace_count</span> <span class="o">||=</span> <span class="mi">0</span>
          <span class="vi">@brace_count</span> <span class="o">+=</span> <span class="mi">1</span>

          <span class="n">token</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/}/</span> <span class="k">do</span>
          <span class="k">if</span> <span class="n">in_state?</span> <span class="ss">:brace</span> <span class="n">and</span> <span class="vi">@brace_count</span><span class="nf">.to_i</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="n">pop!</span> <span class="k">until</span> <span class="n">state?</span> <span class="ss">:brace</span>
            <span class="n">pop!</span>
            <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span>
          <span class="k">else</span>
            <span class="vi">@brace_count</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">token</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">TeX</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;The TeX typesetting system&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;tex&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;TeX&#39;</span><span class="p">,</span> <span class="s1">&#39;LaTeX&#39;</span><span class="p">,</span> <span class="s1">&#39;latex&#39;</span>

      <span class="n">filenames</span> <span class="s1">&#39;*.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;*.aux&#39;</span><span class="p">,</span> <span class="s1">&#39;*.toc&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-tex&#39;</span><span class="p">,</span> <span class="s1">&#39;text/x-latex&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/\A\s*\\documentclass/</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/\A\s*\\input/</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/\A\s*\\documentstyle/</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/\A\s*\\relax/</span>
      <span class="k">end</span>

      <span class="n">command</span> <span class="o">=</span> <span class="sr">/\\([a-z]+|\s+|.)/i</span>

      <span class="n">state</span> <span class="ss">:general</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/%.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
        <span class="n">rule</span> <span class="sr">/[{}&amp;_^]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\\[/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:displaymath</span>
        <span class="n">rule</span> <span class="sr">/\\\(/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:inlinemath</span>
        <span class="n">rule</span> <span class="sr">/\$\$/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:displaymath</span>
        <span class="n">rule</span> <span class="sr">/\$/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:inlinemath</span>
        <span class="n">rule</span> <span class="sr">/\\(begin|end)\{.*?\}/</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span>

        <span class="n">rule</span> <span class="sr">/(\\verb)\b(\S)(.*?)(\2)/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">group</span> <span class="s1">&#39;Name.Builtin&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword.Pseudo&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Literal.String.Other&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Keyword.Pseudo&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="n">command</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:command</span>
        <span class="n">mixin</span> <span class="ss">:general</span>
        <span class="n">rule</span> <span class="sr">/[^\\$%&amp;_^{}]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:math</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="n">command</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">mixin</span> <span class="ss">:general</span>
        <span class="n">rule</span> <span class="sr">/[0-9]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span>
        <span class="n">rule</span> <span class="sr">/[-=!+*\/()\[\]]/</span><span class="p">,</span> <span class="s1">&#39;Operator&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^=!+*\/()\[\]\\$%&amp;_^{}0-9-]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:inlinemath</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\\)/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\$/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:math</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:displaymath</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\\\]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\$\$/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/\$/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>
        <span class="n">mixin</span> <span class="ss">:math</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:command</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\[.*?\]/</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span>
        <span class="n">rule</span> <span class="sr">/\*/</span><span class="p">,</span> <span class="s1">&#39;Keyword&#39;</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span> <span class="p">{</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">Text</span> <span class="o">&lt;</span> <span class="no">Lexer</span>
      <span class="n">desc</span> <span class="s2">&quot;A boring lexer that doesn&#39;t highlight anything&quot;</span>

      <span class="n">tag</span> <span class="s1">&#39;text&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.txt&#39;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/plain&#39;</span>

      <span class="n">default_options</span> <span class="ss">:token</span> <span class="o">=&gt;</span> <span class="s1">&#39;Text&#39;</span>

      <span class="k">def </span><span class="nf">token</span>
        <span class="vi">@token</span> <span class="o">||=</span> <span class="no">Token</span><span class="o">[</span><span class="n">option</span> <span class="ss">:token</span><span class="o">]</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">stream_tokens</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="k">yield</span> <span class="nb">self</span><span class="nf">.token</span><span class="p">,</span> <span class="n">stream</span><span class="nf">.string</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># DO NOT EDIT: automatically generated by `rake vimkeywords`.</span>
<span class="c1"># see tasks/vim.rake for more info.</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">VimL</span>
      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">keywords</span>
        <span class="vi">@keywords</span> <span class="o">||=</span> <span class="p">{</span><span class="ss">:command</span><span class="o">=&gt;[[</span><span class="s2">&quot;:p&quot;</span><span class="p">,</span> <span class="s2">&quot;:p&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Allargs&quot;</span><span class="p">,</span> <span class="s2">&quot;Allargs&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;DiffOrig&quot;</span><span class="p">,</span> <span class="s2">&quot;DiffOrig&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Error&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Man&quot;</span><span class="p">,</span> <span class="s2">&quot;Man&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;MyCommand&quot;</span><span class="p">,</span> <span class="s2">&quot;MyCommand&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Mycmd&quot;</span><span class="p">,</span> <span class="s2">&quot;Mycmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;Next&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;Print&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Ren&quot;</span><span class="p">,</span> <span class="s2">&quot;Ren&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Rena&quot;</span><span class="p">,</span> <span class="s2">&quot;Rena&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Renu&quot;</span><span class="p">,</span> <span class="s2">&quot;Renu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;TOhtml&quot;</span><span class="p">,</span> <span class="s2">&quot;TOhtml&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;XMLent&quot;</span><span class="p">,</span> <span class="s2">&quot;XMLent&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;XMLns&quot;</span><span class="p">,</span> <span class="s2">&quot;XMLns&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ab&quot;</span><span class="p">,</span> <span class="s2">&quot;ab&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="s2">&quot;abclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;abo&quot;</span><span class="p">,</span> <span class="s2">&quot;aboveleft&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;al&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ar&quot;</span><span class="p">,</span> <span class="s2">&quot;ar&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ar&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;arga&quot;</span><span class="p">,</span> <span class="s2">&quot;argadd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;argd&quot;</span><span class="p">,</span> <span class="s2">&quot;argdelete&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;argdo&quot;</span><span class="p">,</span> <span class="s2">&quot;argdo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;arge&quot;</span><span class="p">,</span> <span class="s2">&quot;argedit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;argg&quot;</span><span class="p">,</span> <span class="s2">&quot;argglobal&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;argl&quot;</span><span class="p">,</span> <span class="s2">&quot;arglocal&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;argu&quot;</span><span class="p">,</span> <span class="s2">&quot;argument&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;as&quot;</span><span class="p">,</span> <span class="s2">&quot;ascii&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;au&quot;</span><span class="p">,</span> <span class="s2">&quot;au&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;buffer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bN&quot;</span><span class="p">,</span> <span class="s2">&quot;bNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ba&quot;</span><span class="p">,</span> <span class="s2">&quot;ball&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bad&quot;</span><span class="p">,</span> <span class="s2">&quot;badd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bd&quot;</span><span class="p">,</span> <span class="s2">&quot;bdelete&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bel&quot;</span><span class="p">,</span> <span class="s2">&quot;belowright&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bf&quot;</span><span class="p">,</span> <span class="s2">&quot;bfirst&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bl&quot;</span><span class="p">,</span> <span class="s2">&quot;blast&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bm&quot;</span><span class="p">,</span> <span class="s2">&quot;bmodified&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bn&quot;</span><span class="p">,</span> <span class="s2">&quot;bnext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bo&quot;</span><span class="p">,</span> <span class="s2">&quot;botright&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bp&quot;</span><span class="p">,</span> <span class="s2">&quot;bprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;br&quot;</span><span class="p">,</span> <span class="s2">&quot;br&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;br&quot;</span><span class="p">,</span> <span class="s2">&quot;brewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;brea&quot;</span><span class="p">,</span> <span class="s2">&quot;break&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;breaka&quot;</span><span class="p">,</span> <span class="s2">&quot;breakadd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;breakd&quot;</span><span class="p">,</span> <span class="s2">&quot;breakdel&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;breakl&quot;</span><span class="p">,</span> <span class="s2">&quot;breaklist&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bro&quot;</span><span class="p">,</span> <span class="s2">&quot;browse&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;browseset&quot;</span><span class="p">,</span> <span class="s2">&quot;browseset&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bu&quot;</span><span class="p">,</span> <span class="s2">&quot;bu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;buf&quot;</span><span class="p">,</span> <span class="s2">&quot;buf&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bufdo&quot;</span><span class="p">,</span> <span class="s2">&quot;bufdo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;buffers&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bun&quot;</span><span class="p">,</span> <span class="s2">&quot;bunload&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;bw&quot;</span><span class="p">,</span> <span class="s2">&quot;bwipeout&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cN&quot;</span><span class="p">,</span> <span class="s2">&quot;cN&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cN&quot;</span><span class="p">,</span> <span class="s2">&quot;cNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cNf&quot;</span><span class="p">,</span> <span class="s2">&quot;cNf&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cNf&quot;</span><span class="p">,</span> <span class="s2">&quot;cNfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cabc&quot;</span><span class="p">,</span> <span class="s2">&quot;cabclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cad&quot;</span><span class="p">,</span> <span class="s2">&quot;cad&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cad&quot;</span><span class="p">,</span> <span class="s2">&quot;caddexpr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;caddb&quot;</span><span class="p">,</span> <span class="s2">&quot;caddbuffer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;caddf&quot;</span><span class="p">,</span> <span class="s2">&quot;caddfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cal&quot;</span><span class="p">,</span> <span class="s2">&quot;call&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;catch&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cb&quot;</span><span class="p">,</span> <span class="s2">&quot;cbuffer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;cc&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ccl&quot;</span><span class="p">,</span> <span class="s2">&quot;cclose&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cd&quot;</span><span class="p">,</span> <span class="s2">&quot;cd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ce&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cex&quot;</span><span class="p">,</span> <span class="s2">&quot;cexpr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cf&quot;</span><span class="p">,</span> <span class="s2">&quot;cfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cfir&quot;</span><span class="p">,</span> <span class="s2">&quot;cfirst&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cg&quot;</span><span class="p">,</span> <span class="s2">&quot;cgetfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cgetb&quot;</span><span class="p">,</span> <span class="s2">&quot;cgetbuffer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cgete&quot;</span><span class="p">,</span> <span class="s2">&quot;cgetexpr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;changes&quot;</span><span class="p">,</span> <span class="s2">&quot;changes&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;chd&quot;</span><span class="p">,</span> <span class="s2">&quot;chdir&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;che&quot;</span><span class="p">,</span> <span class="s2">&quot;checkpath&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;checkt&quot;</span><span class="p">,</span> <span class="s2">&quot;checktime&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cl&quot;</span><span class="p">,</span> <span class="s2">&quot;cl&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cl&quot;</span><span class="p">,</span> <span class="s2">&quot;clist&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cla&quot;</span><span class="p">,</span> <span class="s2">&quot;clast&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;clo&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cmapc&quot;</span><span class="p">,</span> <span class="s2">&quot;cmapclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cmdname&quot;</span><span class="p">,</span> <span class="s2">&quot;cmdname&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cn&quot;</span><span class="p">,</span> <span class="s2">&quot;cn&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cn&quot;</span><span class="p">,</span> <span class="s2">&quot;cnext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cnew&quot;</span><span class="p">,</span> <span class="s2">&quot;cnewer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cnf&quot;</span><span class="p">,</span> <span class="s2">&quot;cnf&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cnf&quot;</span><span class="p">,</span> <span class="s2">&quot;cnfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;co&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="s2">&quot;colder&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;colo&quot;</span><span class="p">,</span> <span class="s2">&quot;colorscheme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;com&quot;</span><span class="p">,</span> <span class="s2">&quot;com&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;comc&quot;</span><span class="p">,</span> <span class="s2">&quot;comclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;comp&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;con&quot;</span><span class="p">,</span> <span class="s2">&quot;con&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;con&quot;</span><span class="p">,</span> <span class="s2">&quot;continue&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;conf&quot;</span><span class="p">,</span> <span class="s2">&quot;confirm&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cope&quot;</span><span class="p">,</span> <span class="s2">&quot;copen&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="s2">&quot;cprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cpf&quot;</span><span class="p">,</span> <span class="s2">&quot;cpfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cq&quot;</span><span class="p">,</span> <span class="s2">&quot;cquit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cr&quot;</span><span class="p">,</span> <span class="s2">&quot;crewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cs&quot;</span><span class="p">,</span> <span class="s2">&quot;cs&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cscope&quot;</span><span class="p">,</span> <span class="s2">&quot;cscope&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cstag&quot;</span><span class="p">,</span> <span class="s2">&quot;cstag&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cuna&quot;</span><span class="p">,</span> <span class="s2">&quot;cunabbrev&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;cw&quot;</span><span class="p">,</span> <span class="s2">&quot;cwindow&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;de&quot;</span><span class="p">,</span> <span class="s2">&quot;de&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;debugg&quot;</span><span class="p">,</span> <span class="s2">&quot;debuggreedy&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;del&quot;</span><span class="p">,</span> <span class="s2">&quot;del&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;delc&quot;</span><span class="p">,</span> <span class="s2">&quot;delcommand&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;delf&quot;</span><span class="p">,</span> <span class="s2">&quot;delf&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;delf&quot;</span><span class="p">,</span> <span class="s2">&quot;delfunction&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;delm&quot;</span><span class="p">,</span> <span class="s2">&quot;delmarks&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;di&quot;</span><span class="p">,</span> <span class="s2">&quot;di&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;di&quot;</span><span class="p">,</span> <span class="s2">&quot;display&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffg&quot;</span><span class="p">,</span> <span class="s2">&quot;diffget&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffo&quot;</span><span class="p">,</span> <span class="s2">&quot;diffo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffoff&quot;</span><span class="p">,</span> <span class="s2">&quot;diffoff&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffp&quot;</span><span class="p">,</span> <span class="s2">&quot;diffp&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffpatch&quot;</span><span class="p">,</span> <span class="s2">&quot;diffpatch&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffpu&quot;</span><span class="p">,</span> <span class="s2">&quot;diffput&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffsplit&quot;</span><span class="p">,</span> <span class="s2">&quot;diffsplit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;difft&quot;</span><span class="p">,</span> <span class="s2">&quot;difft&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffthis&quot;</span><span class="p">,</span> <span class="s2">&quot;diffthis&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;diffu&quot;</span><span class="p">,</span> <span class="s2">&quot;diffupdate&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;dig&quot;</span><span class="p">,</span> <span class="s2">&quot;dig&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;dig&quot;</span><span class="p">,</span> <span class="s2">&quot;digraphs&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;dj&quot;</span><span class="p">,</span> <span class="s2">&quot;djump&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;dl&quot;</span><span class="p">,</span> <span class="s2">&quot;dlist&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;do&quot;</span><span class="p">,</span> <span class="s2">&quot;do&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;doau&quot;</span><span class="p">,</span> <span class="s2">&quot;doau&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;dr&quot;</span><span class="p">,</span> <span class="s2">&quot;drop&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="s2">&quot;dsearch&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;dsp&quot;</span><span class="p">,</span> <span class="s2">&quot;dsplit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;dwim&quot;</span><span class="p">,</span> <span class="s2">&quot;dwim&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;edit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;e:e&quot;</span><span class="p">,</span> <span class="s2">&quot;e:e&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;e:e:e&quot;</span><span class="p">,</span> <span class="s2">&quot;e:e:e&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;e:e:r&quot;</span><span class="p">,</span> <span class="s2">&quot;e:e:r&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ea&quot;</span><span class="p">,</span> <span class="s2">&quot;ea&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;earlier&quot;</span><span class="p">,</span> <span class="s2">&quot;earlier&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ec&quot;</span><span class="p">,</span> <span class="s2">&quot;ec&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;echoe&quot;</span><span class="p">,</span> <span class="s2">&quot;echoerr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;echom&quot;</span><span class="p">,</span> <span class="s2">&quot;echomsg&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;echon&quot;</span><span class="p">,</span> <span class="s2">&quot;echon&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="s2">&quot;else&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;elsei&quot;</span><span class="p">,</span> <span class="s2">&quot;elseif&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;em&quot;</span><span class="p">,</span> <span class="s2">&quot;emenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;emenu&quot;</span><span class="p">,</span> <span class="s2">&quot;emenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;en&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;endif&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;endf&quot;</span><span class="p">,</span> <span class="s2">&quot;endf&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;endf&quot;</span><span class="p">,</span> <span class="s2">&quot;endfunction&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;endfo&quot;</span><span class="p">,</span> <span class="s2">&quot;endfor&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;endfun&quot;</span><span class="p">,</span> <span class="s2">&quot;endfun&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;endt&quot;</span><span class="p">,</span> <span class="s2">&quot;endtry&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;endw&quot;</span><span class="p">,</span> <span class="s2">&quot;endwhile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ene&quot;</span><span class="p">,</span> <span class="s2">&quot;enew&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ex&quot;</span><span class="p">,</span> <span class="s2">&quot;ex&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;exi&quot;</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;exu&quot;</span><span class="p">,</span> <span class="s2">&quot;exusage&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;files&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;filet&quot;</span><span class="p">,</span> <span class="s2">&quot;filet&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;filetype&quot;</span><span class="p">,</span> <span class="s2">&quot;filetype&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fin&quot;</span><span class="p">,</span> <span class="s2">&quot;fin&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fin&quot;</span><span class="p">,</span> <span class="s2">&quot;find&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fina&quot;</span><span class="p">,</span> <span class="s2">&quot;finally&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fini&quot;</span><span class="p">,</span> <span class="s2">&quot;finish&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fir&quot;</span><span class="p">,</span> <span class="s2">&quot;first&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fix&quot;</span><span class="p">,</span> <span class="s2">&quot;fixdel&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fo&quot;</span><span class="p">,</span> <span class="s2">&quot;fold&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;foldc&quot;</span><span class="p">,</span> <span class="s2">&quot;foldclose&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;foldd&quot;</span><span class="p">,</span> <span class="s2">&quot;folddoopen&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;folddoc&quot;</span><span class="p">,</span> <span class="s2">&quot;folddoclosed&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;foldo&quot;</span><span class="p">,</span> <span class="s2">&quot;foldopen&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;for&quot;</span><span class="p">,</span> <span class="s2">&quot;for&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fu&quot;</span><span class="p">,</span> <span class="s2">&quot;fu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fu&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;fun&quot;</span><span class="p">,</span> <span class="s2">&quot;fun&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;get&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;go&quot;</span><span class="p">,</span> <span class="s2">&quot;goto&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;gr&quot;</span><span class="p">,</span> <span class="s2">&quot;grep&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;grepa&quot;</span><span class="p">,</span> <span class="s2">&quot;grepadd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;gs&quot;</span><span class="p">,</span> <span class="s2">&quot;gs&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;gui&quot;</span><span class="p">,</span> <span class="s2">&quot;gui&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;gvim&quot;</span><span class="p">,</span> <span class="s2">&quot;gvim&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;help&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ha&quot;</span><span class="p">,</span> <span class="s2">&quot;hardcopy&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;helpf&quot;</span><span class="p">,</span> <span class="s2">&quot;helpfind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;helpg&quot;</span><span class="p">,</span> <span class="s2">&quot;helpgrep&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;helpt&quot;</span><span class="p">,</span> <span class="s2">&quot;helptags&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="s2">&quot;hi&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;hid&quot;</span><span class="p">,</span> <span class="s2">&quot;hide&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;his&quot;</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ia&quot;</span><span class="p">,</span> <span class="s2">&quot;ia&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;iabc&quot;</span><span class="p">,</span> <span class="s2">&quot;iabclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;if&quot;</span><span class="p">,</span> <span class="s2">&quot;if&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ij&quot;</span><span class="p">,</span> <span class="s2">&quot;ijump&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;il&quot;</span><span class="p">,</span> <span class="s2">&quot;ilist&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;imapc&quot;</span><span class="p">,</span> <span class="s2">&quot;imapclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;intro&quot;</span><span class="p">,</span> <span class="s2">&quot;intro&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;isearch&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;isp&quot;</span><span class="p">,</span> <span class="s2">&quot;isplit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;iuna&quot;</span><span class="p">,</span> <span class="s2">&quot;iunabbrev&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;j&quot;</span><span class="p">,</span> <span class="s2">&quot;join&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ju&quot;</span><span class="p">,</span> <span class="s2">&quot;jumps&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;kee&quot;</span><span class="p">,</span> <span class="s2">&quot;keepmarks&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;keepa&quot;</span><span class="p">,</span> <span class="s2">&quot;keepa&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;keepalt&quot;</span><span class="p">,</span> <span class="s2">&quot;keepalt&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;keepj&quot;</span><span class="p">,</span> <span class="s2">&quot;keepjumps&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;list&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lN&quot;</span><span class="p">,</span> <span class="s2">&quot;lN&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lN&quot;</span><span class="p">,</span> <span class="s2">&quot;lNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lNf&quot;</span><span class="p">,</span> <span class="s2">&quot;lNf&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lNf&quot;</span><span class="p">,</span> <span class="s2">&quot;lNfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;la&quot;</span><span class="p">,</span> <span class="s2">&quot;la&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;la&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lad&quot;</span><span class="p">,</span> <span class="s2">&quot;lad&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lad&quot;</span><span class="p">,</span> <span class="s2">&quot;laddexpr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;laddb&quot;</span><span class="p">,</span> <span class="s2">&quot;laddbuffer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;laddf&quot;</span><span class="p">,</span> <span class="s2">&quot;laddfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lan&quot;</span><span class="p">,</span> <span class="s2">&quot;lan&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lan&quot;</span><span class="p">,</span> <span class="s2">&quot;language&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;later&quot;</span><span class="p">,</span> <span class="s2">&quot;later&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lb&quot;</span><span class="p">,</span> <span class="s2">&quot;lbuffer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lc&quot;</span><span class="p">,</span> <span class="s2">&quot;lcd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lch&quot;</span><span class="p">,</span> <span class="s2">&quot;lchdir&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lcl&quot;</span><span class="p">,</span> <span class="s2">&quot;lclose&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lcs&quot;</span><span class="p">,</span> <span class="s2">&quot;lcs&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lcscope&quot;</span><span class="p">,</span> <span class="s2">&quot;lcscope&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;le&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lefta&quot;</span><span class="p">,</span> <span class="s2">&quot;leftabove&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;let&quot;</span><span class="p">,</span> <span class="s2">&quot;let&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lex&quot;</span><span class="p">,</span> <span class="s2">&quot;lexpr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lf&quot;</span><span class="p">,</span> <span class="s2">&quot;lfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lfir&quot;</span><span class="p">,</span> <span class="s2">&quot;lfirst&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lg&quot;</span><span class="p">,</span> <span class="s2">&quot;lgetfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lgetb&quot;</span><span class="p">,</span> <span class="s2">&quot;lgetbuffer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lgete&quot;</span><span class="p">,</span> <span class="s2">&quot;lgetexpr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lgr&quot;</span><span class="p">,</span> <span class="s2">&quot;lgrep&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lgrepa&quot;</span><span class="p">,</span> <span class="s2">&quot;lgrepadd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;lhelpgrep&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ll&quot;</span><span class="p">,</span> <span class="s2">&quot;ll&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lla&quot;</span><span class="p">,</span> <span class="s2">&quot;llast&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lli&quot;</span><span class="p">,</span> <span class="s2">&quot;llist&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lmak&quot;</span><span class="p">,</span> <span class="s2">&quot;lmake&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lmapc&quot;</span><span class="p">,</span> <span class="s2">&quot;lmapclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lne&quot;</span><span class="p">,</span> <span class="s2">&quot;lne&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lne&quot;</span><span class="p">,</span> <span class="s2">&quot;lnext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lnew&quot;</span><span class="p">,</span> <span class="s2">&quot;lnewer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lnf&quot;</span><span class="p">,</span> <span class="s2">&quot;lnf&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lnf&quot;</span><span class="p">,</span> <span class="s2">&quot;lnfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lo&quot;</span><span class="p">,</span> <span class="s2">&quot;lo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lo&quot;</span><span class="p">,</span> <span class="s2">&quot;loadview&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;loadk&quot;</span><span class="p">,</span> <span class="s2">&quot;loadk&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;loadkeymap&quot;</span><span class="p">,</span> <span class="s2">&quot;loadkeymap&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;loc&quot;</span><span class="p">,</span> <span class="s2">&quot;lockmarks&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;locale&quot;</span><span class="p">,</span> <span class="s2">&quot;locale&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lockv&quot;</span><span class="p">,</span> <span class="s2">&quot;lockvar&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lol&quot;</span><span class="p">,</span> <span class="s2">&quot;lolder&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lop&quot;</span><span class="p">,</span> <span class="s2">&quot;lopen&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lp&quot;</span><span class="p">,</span> <span class="s2">&quot;lprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lpf&quot;</span><span class="p">,</span> <span class="s2">&quot;lpfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lr&quot;</span><span class="p">,</span> <span class="s2">&quot;lrewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="s2">&quot;ls&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lt&quot;</span><span class="p">,</span> <span class="s2">&quot;ltag&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lua&quot;</span><span class="p">,</span> <span class="s2">&quot;lua&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;luado&quot;</span><span class="p">,</span> <span class="s2">&quot;luado&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;luafile&quot;</span><span class="p">,</span> <span class="s2">&quot;luafile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lv&quot;</span><span class="p">,</span> <span class="s2">&quot;lvimgrep&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lvimgrepa&quot;</span><span class="p">,</span> <span class="s2">&quot;lvimgrepadd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;lw&quot;</span><span class="p">,</span> <span class="s2">&quot;lwindow&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;move&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ma&quot;</span><span class="p">,</span> <span class="s2">&quot;ma&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ma&quot;</span><span class="p">,</span> <span class="s2">&quot;mark&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mak&quot;</span><span class="p">,</span> <span class="s2">&quot;make&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;marks&quot;</span><span class="p">,</span> <span class="s2">&quot;marks&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mat&quot;</span><span class="p">,</span> <span class="s2">&quot;match&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;menut&quot;</span><span class="p">,</span> <span class="s2">&quot;menut&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;menut&quot;</span><span class="p">,</span> <span class="s2">&quot;menutranslate&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mes&quot;</span><span class="p">,</span> <span class="s2">&quot;mes&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;messages&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mk&quot;</span><span class="p">,</span> <span class="s2">&quot;mk&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mk&quot;</span><span class="p">,</span> <span class="s2">&quot;mkexrc&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mkdir&quot;</span><span class="p">,</span> <span class="s2">&quot;mkdir&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mks&quot;</span><span class="p">,</span> <span class="s2">&quot;mksession&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mksp&quot;</span><span class="p">,</span> <span class="s2">&quot;mkspell&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mkv&quot;</span><span class="p">,</span> <span class="s2">&quot;mkv&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mkv&quot;</span><span class="p">,</span> <span class="s2">&quot;mkvimrc&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mkvie&quot;</span><span class="p">,</span> <span class="s2">&quot;mkview&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="s2">&quot;mo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mod&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mv&quot;</span><span class="p">,</span> <span class="s2">&quot;mv&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="s2">&quot;mz&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="s2">&quot;mzscheme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;mzf&quot;</span><span class="p">,</span> <span class="s2">&quot;mzfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;nb&quot;</span><span class="p">,</span> <span class="s2">&quot;nbkey&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;nbc&quot;</span><span class="p">,</span> <span class="s2">&quot;nbclose&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;nbs&quot;</span><span class="p">,</span> <span class="s2">&quot;nbstart&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ne&quot;</span><span class="p">,</span> <span class="s2">&quot;ne&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;new&quot;</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;nkf&quot;</span><span class="p">,</span> <span class="s2">&quot;nkf&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;nmapc&quot;</span><span class="p">,</span> <span class="s2">&quot;nmapclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;noa&quot;</span><span class="p">,</span> <span class="s2">&quot;noa&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;noautocmd&quot;</span><span class="p">,</span> <span class="s2">&quot;noautocmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;noh&quot;</span><span class="p">,</span> <span class="s2">&quot;nohlsearch&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ol&quot;</span><span class="p">,</span> <span class="s2">&quot;oldfiles&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;omapc&quot;</span><span class="p">,</span> <span class="s2">&quot;omapclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;only&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;opt&quot;</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ownsyntax&quot;</span><span class="p">,</span> <span class="s2">&quot;ownsyntax&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;print&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p:&quot;</span><span class="p">,</span> <span class="s2">&quot;p:&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p:&quot;</span><span class="p">,</span> <span class="s2">&quot;p:&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p:gs&quot;</span><span class="p">,</span> <span class="s2">&quot;p:gs&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p:h&quot;</span><span class="p">,</span> <span class="s2">&quot;p:h&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p:h:h&quot;</span><span class="p">,</span> <span class="s2">&quot;p:h:h&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p:r&quot;</span><span class="p">,</span> <span class="s2">&quot;p:r&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;p:t&quot;</span><span class="p">,</span> <span class="s2">&quot;p:t&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pat&quot;</span><span class="p">,</span> <span class="s2">&quot;pat&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pat&quot;</span><span class="p">,</span> <span class="s2">&quot;pat&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pc&quot;</span><span class="p">,</span> <span class="s2">&quot;pclose&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pe&quot;</span><span class="p">,</span> <span class="s2">&quot;pe&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pe&quot;</span><span class="p">,</span> <span class="s2">&quot;perl&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ped&quot;</span><span class="p">,</span> <span class="s2">&quot;pedit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;perld&quot;</span><span class="p">,</span> <span class="s2">&quot;perldo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;po&quot;</span><span class="p">,</span> <span class="s2">&quot;pop&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;popu&quot;</span><span class="p">,</span> <span class="s2">&quot;popu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;popu&quot;</span><span class="p">,</span> <span class="s2">&quot;popup&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppop&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pr&quot;</span><span class="p">,</span> <span class="s2">&quot;pr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pre&quot;</span><span class="p">,</span> <span class="s2">&quot;preserve&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;prev&quot;</span><span class="p">,</span> <span class="s2">&quot;previous&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pro&quot;</span><span class="p">,</span> <span class="s2">&quot;pro&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;prof&quot;</span><span class="p">,</span> <span class="s2">&quot;profile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;profd&quot;</span><span class="p">,</span> <span class="s2">&quot;profdel&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;promptf&quot;</span><span class="p">,</span> <span class="s2">&quot;promptfind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;promptr&quot;</span><span class="p">,</span> <span class="s2">&quot;promptrepl&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ps&quot;</span><span class="p">,</span> <span class="s2">&quot;psearch&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptN&quot;</span><span class="p">,</span> <span class="s2">&quot;ptN&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptN&quot;</span><span class="p">,</span> <span class="s2">&quot;ptNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pta&quot;</span><span class="p">,</span> <span class="s2">&quot;ptag&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptf&quot;</span><span class="p">,</span> <span class="s2">&quot;ptfirst&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptj&quot;</span><span class="p">,</span> <span class="s2">&quot;ptjump&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptl&quot;</span><span class="p">,</span> <span class="s2">&quot;ptlast&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptn&quot;</span><span class="p">,</span> <span class="s2">&quot;ptn&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptn&quot;</span><span class="p">,</span> <span class="s2">&quot;ptnext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptp&quot;</span><span class="p">,</span> <span class="s2">&quot;ptprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ptr&quot;</span><span class="p">,</span> <span class="s2">&quot;ptrewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pts&quot;</span><span class="p">,</span> <span class="s2">&quot;ptselect&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pu&quot;</span><span class="p">,</span> <span class="s2">&quot;put&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pw&quot;</span><span class="p">,</span> <span class="s2">&quot;pwd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;py&quot;</span><span class="p">,</span> <span class="s2">&quot;py&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;py&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;py3&quot;</span><span class="p">,</span> <span class="s2">&quot;py3&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;py3&quot;</span><span class="p">,</span> <span class="s2">&quot;py3&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;py3file&quot;</span><span class="p">,</span> <span class="s2">&quot;py3file&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;pyf&quot;</span><span class="p">,</span> <span class="s2">&quot;pyfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;python3&quot;</span><span class="p">,</span> <span class="s2">&quot;python3&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;quit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;qa&quot;</span><span class="p">,</span> <span class="s2">&quot;qall&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;quita&quot;</span><span class="p">,</span> <span class="s2">&quot;quitall&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;quote&quot;</span><span class="p">,</span> <span class="s2">&quot;quote&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;r:e&quot;</span><span class="p">,</span> <span class="s2">&quot;r:e&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;r:r&quot;</span><span class="p">,</span> <span class="s2">&quot;r:r&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;r:r:r&quot;</span><span class="p">,</span> <span class="s2">&quot;r:r:r&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;re&quot;</span><span class="p">,</span> <span class="s2">&quot;re&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;rec&quot;</span><span class="p">,</span> <span class="s2">&quot;recover&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;redo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;redi&quot;</span><span class="p">,</span> <span class="s2">&quot;redir&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;redr&quot;</span><span class="p">,</span> <span class="s2">&quot;redraw&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;redraws&quot;</span><span class="p">,</span> <span class="s2">&quot;redrawstatus&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;reg&quot;</span><span class="p">,</span> <span class="s2">&quot;registers&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;resize&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ret&quot;</span><span class="p">,</span> <span class="s2">&quot;retab&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;retu&quot;</span><span class="p">,</span> <span class="s2">&quot;return&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;rew&quot;</span><span class="p">,</span> <span class="s2">&quot;rewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ri&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;rightb&quot;</span><span class="p">,</span> <span class="s2">&quot;rightbelow&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ru&quot;</span><span class="p">,</span> <span class="s2">&quot;ru&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ru&quot;</span><span class="p">,</span> <span class="s2">&quot;runtime&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;rub&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;rubyd&quot;</span><span class="p">,</span> <span class="s2">&quot;rubydo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;rubyf&quot;</span><span class="p">,</span> <span class="s2">&quot;rubyfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;rundo&quot;</span><span class="p">,</span> <span class="s2">&quot;rundo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;rv&quot;</span><span class="p">,</span> <span class="s2">&quot;rviminfo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sN&quot;</span><span class="p">,</span> <span class="s2">&quot;sNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sa&quot;</span><span class="p">,</span> <span class="s2">&quot;sargument&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sal&quot;</span><span class="p">,</span> <span class="s2">&quot;sall&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;san&quot;</span><span class="p">,</span> <span class="s2">&quot;sandbox&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sav&quot;</span><span class="p">,</span> <span class="s2">&quot;saveas&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sb&quot;</span><span class="p">,</span> <span class="s2">&quot;sbuffer&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sbN&quot;</span><span class="p">,</span> <span class="s2">&quot;sbNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sba&quot;</span><span class="p">,</span> <span class="s2">&quot;sball&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sbf&quot;</span><span class="p">,</span> <span class="s2">&quot;sbfirst&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sbl&quot;</span><span class="p">,</span> <span class="s2">&quot;sblast&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sbm&quot;</span><span class="p">,</span> <span class="s2">&quot;sbmodified&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sbn&quot;</span><span class="p">,</span> <span class="s2">&quot;sbnext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sbp&quot;</span><span class="p">,</span> <span class="s2">&quot;sbprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sbr&quot;</span><span class="p">,</span> <span class="s2">&quot;sbrewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;scrip&quot;</span><span class="p">,</span> <span class="s2">&quot;scrip&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;scrip&quot;</span><span class="p">,</span> <span class="s2">&quot;scriptnames&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;scripte&quot;</span><span class="p">,</span> <span class="s2">&quot;scriptencoding&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;scs&quot;</span><span class="p">,</span> <span class="s2">&quot;scs&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;scscope&quot;</span><span class="p">,</span> <span class="s2">&quot;scscope&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;se&quot;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;setf&quot;</span><span class="p">,</span> <span class="s2">&quot;setfiletype&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;setg&quot;</span><span class="p">,</span> <span class="s2">&quot;setglobal&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;setl&quot;</span><span class="p">,</span> <span class="s2">&quot;setlocal&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sf&quot;</span><span class="p">,</span> <span class="s2">&quot;sfind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sfir&quot;</span><span class="p">,</span> <span class="s2">&quot;sfirst&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sh&quot;</span><span class="p">,</span> <span class="s2">&quot;shell&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sig&quot;</span><span class="p">,</span> <span class="s2">&quot;sig&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sign&quot;</span><span class="p">,</span> <span class="s2">&quot;sign&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sil&quot;</span><span class="p">,</span> <span class="s2">&quot;silent&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sim&quot;</span><span class="p">,</span> <span class="s2">&quot;simalt&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sl&quot;</span><span class="p">,</span> <span class="s2">&quot;sl&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sl&quot;</span><span class="p">,</span> <span class="s2">&quot;sleep&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sla&quot;</span><span class="p">,</span> <span class="s2">&quot;slast&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sm&quot;</span><span class="p">,</span> <span class="s2">&quot;smagic&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sm&quot;</span><span class="p">,</span> <span class="s2">&quot;smap&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sme&quot;</span><span class="p">,</span> <span class="s2">&quot;sme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;smenu&quot;</span><span class="p">,</span> <span class="s2">&quot;smenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sn&quot;</span><span class="p">,</span> <span class="s2">&quot;snext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sni&quot;</span><span class="p">,</span> <span class="s2">&quot;sniff&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sno&quot;</span><span class="p">,</span> <span class="s2">&quot;snomagic&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;snoreme&quot;</span><span class="p">,</span> <span class="s2">&quot;snoreme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;snoremenu&quot;</span><span class="p">,</span> <span class="s2">&quot;snoremenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;so&quot;</span><span class="p">,</span> <span class="s2">&quot;so&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;so&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sor&quot;</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sp&quot;</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;spe&quot;</span><span class="p">,</span> <span class="s2">&quot;spe&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;spe&quot;</span><span class="p">,</span> <span class="s2">&quot;spellgood&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;spelld&quot;</span><span class="p">,</span> <span class="s2">&quot;spelldump&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;spelli&quot;</span><span class="p">,</span> <span class="s2">&quot;spellinfo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;spellr&quot;</span><span class="p">,</span> <span class="s2">&quot;spellrepall&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;spellu&quot;</span><span class="p">,</span> <span class="s2">&quot;spellundo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;spellw&quot;</span><span class="p">,</span> <span class="s2">&quot;spellwrong&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;spr&quot;</span><span class="p">,</span> <span class="s2">&quot;sprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sre&quot;</span><span class="p">,</span> <span class="s2">&quot;srewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;st&quot;</span><span class="p">,</span> <span class="s2">&quot;st&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;st&quot;</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sta&quot;</span><span class="p">,</span> <span class="s2">&quot;stag&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;star&quot;</span><span class="p">,</span> <span class="s2">&quot;star&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;star&quot;</span><span class="p">,</span> <span class="s2">&quot;startinsert&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;startg&quot;</span><span class="p">,</span> <span class="s2">&quot;startgreplace&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;startr&quot;</span><span class="p">,</span> <span class="s2">&quot;startreplace&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;stj&quot;</span><span class="p">,</span> <span class="s2">&quot;stjump&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;stopi&quot;</span><span class="p">,</span> <span class="s2">&quot;stopinsert&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sts&quot;</span><span class="p">,</span> <span class="s2">&quot;stselect&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sub&quot;</span><span class="p">,</span> <span class="s2">&quot;sub&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sub&quot;</span><span class="p">,</span> <span class="s2">&quot;sub&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sun&quot;</span><span class="p">,</span> <span class="s2">&quot;sunhide&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sunme&quot;</span><span class="p">,</span> <span class="s2">&quot;sunme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sunmenu&quot;</span><span class="p">,</span> <span class="s2">&quot;sunmenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sus&quot;</span><span class="p">,</span> <span class="s2">&quot;suspend&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sv&quot;</span><span class="p">,</span> <span class="s2">&quot;sview&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sw&quot;</span><span class="p">,</span> <span class="s2">&quot;swapname&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sy&quot;</span><span class="p">,</span> <span class="s2">&quot;sy&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;syn&quot;</span><span class="p">,</span> <span class="s2">&quot;syn&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;sync&quot;</span><span class="p">,</span> <span class="s2">&quot;sync&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;syncbind&quot;</span><span class="p">,</span> <span class="s2">&quot;syncbind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;synlist&quot;</span><span class="p">,</span> <span class="s2">&quot;synlist&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;t:r&quot;</span><span class="p">,</span> <span class="s2">&quot;t:r&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tN&quot;</span><span class="p">,</span> <span class="s2">&quot;tN&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tN&quot;</span><span class="p">,</span> <span class="s2">&quot;tNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ta&quot;</span><span class="p">,</span> <span class="s2">&quot;ta&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ta&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tab&quot;</span><span class="p">,</span> <span class="s2">&quot;tab&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabN&quot;</span><span class="p">,</span> <span class="s2">&quot;tabN&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabN&quot;</span><span class="p">,</span> <span class="s2">&quot;tabNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabc&quot;</span><span class="p">,</span> <span class="s2">&quot;tabclose&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabd&quot;</span><span class="p">,</span> <span class="s2">&quot;tabdo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabe&quot;</span><span class="p">,</span> <span class="s2">&quot;tabedit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabf&quot;</span><span class="p">,</span> <span class="s2">&quot;tabfind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabfir&quot;</span><span class="p">,</span> <span class="s2">&quot;tabfirst&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabl&quot;</span><span class="p">,</span> <span class="s2">&quot;tablast&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabm&quot;</span><span class="p">,</span> <span class="s2">&quot;tabmove&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabn&quot;</span><span class="p">,</span> <span class="s2">&quot;tabnext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabnew&quot;</span><span class="p">,</span> <span class="s2">&quot;tabnew&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabo&quot;</span><span class="p">,</span> <span class="s2">&quot;tabonly&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabp&quot;</span><span class="p">,</span> <span class="s2">&quot;tabprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabr&quot;</span><span class="p">,</span> <span class="s2">&quot;tabrewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tabs&quot;</span><span class="p">,</span> <span class="s2">&quot;tabs&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tc&quot;</span><span class="p">,</span> <span class="s2">&quot;tcl&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tcld&quot;</span><span class="p">,</span> <span class="s2">&quot;tcldo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tclf&quot;</span><span class="p">,</span> <span class="s2">&quot;tclfile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;te&quot;</span><span class="p">,</span> <span class="s2">&quot;tearoff&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tf&quot;</span><span class="p">,</span> <span class="s2">&quot;tfirst&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="s2">&quot;throw&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tj&quot;</span><span class="p">,</span> <span class="s2">&quot;tjump&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tl&quot;</span><span class="p">,</span> <span class="s2">&quot;tlast&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tm&quot;</span><span class="p">,</span> <span class="s2">&quot;tm&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tm&quot;</span><span class="p">,</span> <span class="s2">&quot;tmenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tn&quot;</span><span class="p">,</span> <span class="s2">&quot;tn&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tn&quot;</span><span class="p">,</span> <span class="s2">&quot;tnext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;topleft&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;tprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="s2">&quot;tr&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="s2">&quot;trewind&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;try&quot;</span><span class="p">,</span> <span class="s2">&quot;try&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ts&quot;</span><span class="p">,</span> <span class="s2">&quot;tselect&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tu&quot;</span><span class="p">,</span> <span class="s2">&quot;tu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;tu&quot;</span><span class="p">,</span> <span class="s2">&quot;tunmenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;undo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;un&quot;</span><span class="p">,</span> <span class="s2">&quot;un&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;una&quot;</span><span class="p">,</span> <span class="s2">&quot;unabbreviate&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;undoj&quot;</span><span class="p">,</span> <span class="s2">&quot;undojoin&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;undol&quot;</span><span class="p">,</span> <span class="s2">&quot;undolist&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;unh&quot;</span><span class="p">,</span> <span class="s2">&quot;unhide&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;unl&quot;</span><span class="p">,</span> <span class="s2">&quot;unl&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;unlo&quot;</span><span class="p">,</span> <span class="s2">&quot;unlockvar&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;uns&quot;</span><span class="p">,</span> <span class="s2">&quot;unsilent&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;ve&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ve&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;verb&quot;</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vert&quot;</span><span class="p">,</span> <span class="s2">&quot;vertical&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vi&quot;</span><span class="p">,</span> <span class="s2">&quot;vi&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vi&quot;</span><span class="p">,</span> <span class="s2">&quot;visual&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vie&quot;</span><span class="p">,</span> <span class="s2">&quot;view&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vim&quot;</span><span class="p">,</span> <span class="s2">&quot;vimgrep&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vimgrepa&quot;</span><span class="p">,</span> <span class="s2">&quot;vimgrepadd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;viu&quot;</span><span class="p">,</span> <span class="s2">&quot;viusage&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vmapc&quot;</span><span class="p">,</span> <span class="s2">&quot;vmapclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vne&quot;</span><span class="p">,</span> <span class="s2">&quot;vnew&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;vs&quot;</span><span class="p">,</span> <span class="s2">&quot;vsplit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wN&quot;</span><span class="p">,</span> <span class="s2">&quot;wNext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wa&quot;</span><span class="p">,</span> <span class="s2">&quot;wall&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wh&quot;</span><span class="p">,</span> <span class="s2">&quot;while&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;win&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;winsize&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;winc&quot;</span><span class="p">,</span> <span class="s2">&quot;wincmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;windo&quot;</span><span class="p">,</span> <span class="s2">&quot;windo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;winp&quot;</span><span class="p">,</span> <span class="s2">&quot;winpos&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wn&quot;</span><span class="p">,</span> <span class="s2">&quot;wnext&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wp&quot;</span><span class="p">,</span> <span class="s2">&quot;wprevious&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wq&quot;</span><span class="p">,</span> <span class="s2">&quot;wq&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wqa&quot;</span><span class="p">,</span> <span class="s2">&quot;wqall&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ws&quot;</span><span class="p">,</span> <span class="s2">&quot;wsverb&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wundo&quot;</span><span class="p">,</span> <span class="s2">&quot;wundo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;wv&quot;</span><span class="p">,</span> <span class="s2">&quot;wviminfo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;xit&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xa&quot;</span><span class="p">,</span> <span class="s2">&quot;xall&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xmapc&quot;</span><span class="p">,</span> <span class="s2">&quot;xmapclear&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xme&quot;</span><span class="p">,</span> <span class="s2">&quot;xme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xmenu&quot;</span><span class="p">,</span> <span class="s2">&quot;xmenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xnoreme&quot;</span><span class="p">,</span> <span class="s2">&quot;xnoreme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xnoremenu&quot;</span><span class="p">,</span> <span class="s2">&quot;xnoremenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xterm&quot;</span><span class="p">,</span> <span class="s2">&quot;xterm&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xunme&quot;</span><span class="p">,</span> <span class="s2">&quot;xunme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xunmenu&quot;</span><span class="p">,</span> <span class="s2">&quot;xunmenu&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;xwininfo&quot;</span><span class="p">,</span> <span class="s2">&quot;xwininfo&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;yank&quot;</span><span class="o">]]</span><span class="p">,</span> <span class="ss">:option</span><span class="o">=&gt;[]</span><span class="p">,</span> <span class="ss">:auto</span><span class="o">=&gt;[[</span><span class="s2">&quot;BufAdd&quot;</span><span class="p">,</span> <span class="s2">&quot;BufAdd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufCreate&quot;</span><span class="p">,</span> <span class="s2">&quot;BufCreate&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufDelete&quot;</span><span class="p">,</span> <span class="s2">&quot;BufDelete&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufEnter&quot;</span><span class="p">,</span> <span class="s2">&quot;BufEnter&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufFilePost&quot;</span><span class="p">,</span> <span class="s2">&quot;BufFilePost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufFilePre&quot;</span><span class="p">,</span> <span class="s2">&quot;BufFilePre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufHidden&quot;</span><span class="p">,</span> <span class="s2">&quot;BufHidden&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufLeave&quot;</span><span class="p">,</span> <span class="s2">&quot;BufLeave&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufNew&quot;</span><span class="p">,</span> <span class="s2">&quot;BufNew&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufNewFile&quot;</span><span class="p">,</span> <span class="s2">&quot;BufNewFile&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufRead&quot;</span><span class="p">,</span> <span class="s2">&quot;BufRead&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufReadCmd&quot;</span><span class="p">,</span> <span class="s2">&quot;BufReadCmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufReadPost&quot;</span><span class="p">,</span> <span class="s2">&quot;BufReadPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufReadPre&quot;</span><span class="p">,</span> <span class="s2">&quot;BufReadPre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufUnload&quot;</span><span class="p">,</span> <span class="s2">&quot;BufUnload&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufWinEnter&quot;</span><span class="p">,</span> <span class="s2">&quot;BufWinEnter&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufWinLeave&quot;</span><span class="p">,</span> <span class="s2">&quot;BufWinLeave&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufWipeout&quot;</span><span class="p">,</span> <span class="s2">&quot;BufWipeout&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufWrite&quot;</span><span class="p">,</span> <span class="s2">&quot;BufWrite&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufWriteCmd&quot;</span><span class="p">,</span> <span class="s2">&quot;BufWriteCmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufWritePost&quot;</span><span class="p">,</span> <span class="s2">&quot;BufWritePost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;BufWritePre&quot;</span><span class="p">,</span> <span class="s2">&quot;BufWritePre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;Cmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;CmdwinEnter&quot;</span><span class="p">,</span> <span class="s2">&quot;CmdwinEnter&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;CmdwinLeave&quot;</span><span class="p">,</span> <span class="s2">&quot;CmdwinLeave&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ColorScheme&quot;</span><span class="p">,</span> <span class="s2">&quot;ColorScheme&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;CursorHold&quot;</span><span class="p">,</span> <span class="s2">&quot;CursorHold&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;CursorHoldI&quot;</span><span class="p">,</span> <span class="s2">&quot;CursorHoldI&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;CursorMoved&quot;</span><span class="p">,</span> <span class="s2">&quot;CursorMoved&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;CursorMovedI&quot;</span><span class="p">,</span> <span class="s2">&quot;CursorMovedI&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;EncodingChanged&quot;</span><span class="p">,</span> <span class="s2">&quot;EncodingChanged&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileAppendCmd&quot;</span><span class="p">,</span> <span class="s2">&quot;FileAppendCmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileAppendPost&quot;</span><span class="p">,</span> <span class="s2">&quot;FileAppendPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileAppendPre&quot;</span><span class="p">,</span> <span class="s2">&quot;FileAppendPre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileChangedRO&quot;</span><span class="p">,</span> <span class="s2">&quot;FileChangedRO&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileChangedShell&quot;</span><span class="p">,</span> <span class="s2">&quot;FileChangedShell&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileChangedShellPost&quot;</span><span class="p">,</span> <span class="s2">&quot;FileChangedShellPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileEncoding&quot;</span><span class="p">,</span> <span class="s2">&quot;FileEncoding&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileReadCmd&quot;</span><span class="p">,</span> <span class="s2">&quot;FileReadCmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileReadPost&quot;</span><span class="p">,</span> <span class="s2">&quot;FileReadPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileReadPre&quot;</span><span class="p">,</span> <span class="s2">&quot;FileReadPre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileType&quot;</span><span class="p">,</span> <span class="s2">&quot;FileType&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileWriteCmd&quot;</span><span class="p">,</span> <span class="s2">&quot;FileWriteCmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileWritePost&quot;</span><span class="p">,</span> <span class="s2">&quot;FileWritePost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FileWritePre&quot;</span><span class="p">,</span> <span class="s2">&quot;FileWritePre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FilterReadPost&quot;</span><span class="p">,</span> <span class="s2">&quot;FilterReadPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FilterReadPre&quot;</span><span class="p">,</span> <span class="s2">&quot;FilterReadPre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FilterWritePost&quot;</span><span class="p">,</span> <span class="s2">&quot;FilterWritePost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FilterWritePre&quot;</span><span class="p">,</span> <span class="s2">&quot;FilterWritePre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FocusGained&quot;</span><span class="p">,</span> <span class="s2">&quot;FocusGained&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FocusLost&quot;</span><span class="p">,</span> <span class="s2">&quot;FocusLost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;FuncUndefined&quot;</span><span class="p">,</span> <span class="s2">&quot;FuncUndefined&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;GUIEnter&quot;</span><span class="p">,</span> <span class="s2">&quot;GUIEnter&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;GUIFailed&quot;</span><span class="p">,</span> <span class="s2">&quot;GUIFailed&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;InsertChange&quot;</span><span class="p">,</span> <span class="s2">&quot;InsertChange&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;InsertCharPre&quot;</span><span class="p">,</span> <span class="s2">&quot;InsertCharPre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;InsertEnter&quot;</span><span class="p">,</span> <span class="s2">&quot;InsertEnter&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;InsertLeave&quot;</span><span class="p">,</span> <span class="s2">&quot;InsertLeave&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;MenuPopup&quot;</span><span class="p">,</span> <span class="s2">&quot;MenuPopup&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;QuickFixCmdPost&quot;</span><span class="p">,</span> <span class="s2">&quot;QuickFixCmdPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;QuickFixCmdPre&quot;</span><span class="p">,</span> <span class="s2">&quot;QuickFixCmdPre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;RemoteReply&quot;</span><span class="p">,</span> <span class="s2">&quot;RemoteReply&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;SessionLoadPost&quot;</span><span class="p">,</span> <span class="s2">&quot;SessionLoadPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ShellCmdPost&quot;</span><span class="p">,</span> <span class="s2">&quot;ShellCmdPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;ShellFilterPost&quot;</span><span class="p">,</span> <span class="s2">&quot;ShellFilterPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;SourceCmd&quot;</span><span class="p">,</span> <span class="s2">&quot;SourceCmd&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;SourcePre&quot;</span><span class="p">,</span> <span class="s2">&quot;SourcePre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;SpellFileMissing&quot;</span><span class="p">,</span> <span class="s2">&quot;SpellFileMissing&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;StdinReadPost&quot;</span><span class="p">,</span> <span class="s2">&quot;StdinReadPost&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;StdinReadPre&quot;</span><span class="p">,</span> <span class="s2">&quot;StdinReadPre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;SwapExists&quot;</span><span class="p">,</span> <span class="s2">&quot;SwapExists&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;Syntax&quot;</span><span class="p">,</span> <span class="s2">&quot;Syntax&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;TabEnter&quot;</span><span class="p">,</span> <span class="s2">&quot;TabEnter&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;TabLeave&quot;</span><span class="p">,</span> <span class="s2">&quot;TabLeave&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;TermChanged&quot;</span><span class="p">,</span> <span class="s2">&quot;TermChanged&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;TermResponse&quot;</span><span class="p">,</span> <span class="s2">&quot;TermResponse&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="s2">&quot;User&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;UserGettingBored&quot;</span><span class="p">,</span> <span class="s2">&quot;UserGettingBored&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;VimEnter&quot;</span><span class="p">,</span> <span class="s2">&quot;VimEnter&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;VimLeave&quot;</span><span class="p">,</span> <span class="s2">&quot;VimLeave&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;VimLeavePre&quot;</span><span class="p">,</span> <span class="s2">&quot;VimLeavePre&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;VimResized&quot;</span><span class="p">,</span> <span class="s2">&quot;VimResized&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;WinEnter&quot;</span><span class="p">,</span> <span class="s2">&quot;WinEnter&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;WinLeave&quot;</span><span class="p">,</span> <span class="s2">&quot;WinLeave&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="o">]]</span><span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="n">endmodule</span> <span class="no">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">VimL</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;VimL, the scripting language for the Vim editor (vim.org)&quot;</span>
      <span class="n">tag</span> <span class="s1">&#39;viml&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;vim&#39;</span><span class="p">,</span> <span class="s1">&#39;vimscript&#39;</span><span class="p">,</span> <span class="s1">&#39;ex&#39;</span>
      <span class="n">filenames</span> <span class="s1">&#39;*.vim&#39;</span><span class="p">,</span> <span class="s1">&#39;*.vba&#39;</span><span class="p">,</span> <span class="s1">&#39;.vimrc&#39;</span><span class="p">,</span> <span class="s1">&#39;.exrc&#39;</span><span class="p">,</span> <span class="s1">&#39;.gvimrc&#39;</span><span class="p">,</span>
                <span class="s1">&#39;_vimrc&#39;</span><span class="p">,</span> <span class="s1">&#39;_exrc&#39;</span><span class="p">,</span> <span class="s1">&#39;_gvimrc&#39;</span> <span class="c1"># _ names for windows</span>

      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-vim&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">keywords</span>
        <span class="nb">load</span> <span class="no">Pathname</span><span class="nf">.new</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span><span class="nf">.dirname.join</span><span class="p">(</span><span class="s1">&#39;viml/keywords.rb&#39;</span><span class="p">)</span>
        <span class="nb">self</span><span class="nf">.keywords</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/^(\s*)(&quot;.*?)$/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Comment&#39;</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/^\s*\\/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>

        <span class="n">rule</span> <span class="sr">/[ \t]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="c1"># TODO: regexes can have other delimiters</span>
        <span class="n">rule</span> <span class="sr">%r(/(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">/|[^</span><span class="se">\n</span><span class="sr">/])*/)</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Regex&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(&quot;(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">&quot;|[^</span><span class="se">\n</span><span class="sr">&quot;])*&quot;)</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(&#39;(</span><span class="se">\\\\</span><span class="sr">|</span><span class="se">\\</span><span class="sr">&#39;|[^</span><span class="se">\n</span><span class="sr">&#39;])*&#39;)</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span>

        <span class="c1"># if it&#39;s not a string, it&#39;s a comment.</span>
        <span class="n">rule</span> <span class="sr">/(?&lt;=\s)&quot;[^-:.%#=*].*?$/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>

        <span class="n">rule</span> <span class="sr">/-?\d+/</span><span class="p">,</span> <span class="s1">&#39;Literal.Number&#39;</span>
        <span class="n">rule</span> <span class="sr">/#[0-9a-f]{6}/i</span><span class="p">,</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span>
        <span class="n">rule</span> <span class="sr">/^:/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/[():&lt;&gt;+=!\[\]{}\|,~.-]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation&#39;</span>
        <span class="n">rule</span> <span class="sr">/\b(let|if|else|endif|elseif|fun|function|endfunction)\b/</span><span class="p">,</span>
          <span class="s1">&#39;Keyword&#39;</span>

        <span class="n">rule</span> <span class="sr">/\b(NONE|bold|italic|underline|dark|light)\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Builtin&#39;</span>

        <span class="n">rule</span> <span class="sr">/[absg]:\w+\b/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">/\b\w+\b/</span><span class="p">,</span> <span class="s1">&#39;Postprocess.Name&#39;</span>

        <span class="c1"># no errors in VimL!</span>
        <span class="n">rule</span> <span class="sr">/./m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
      <span class="k">end</span>

      <span class="n">postprocess</span> <span class="s1">&#39;Postprocess.Name&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="nb">self</span><span class="nf">.class.keywords</span>

        <span class="k">if</span> <span class="n">mapping_contains?</span><span class="p">(</span><span class="n">keywords</span><span class="o">[</span><span class="ss">:command</span><span class="o">]</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
          <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="nb">name</span>
        <span class="k">elsif</span> <span class="n">mapping_contains?</span><span class="p">(</span><span class="n">keywords</span><span class="o">[</span><span class="ss">:option</span><span class="o">]</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span> <span class="nb">name</span>
        <span class="k">elsif</span> <span class="n">mapping_contains?</span><span class="p">(</span><span class="n">keywords</span><span class="o">[</span><span class="ss">:auto</span><span class="o">]</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span> <span class="nb">name</span>
        <span class="k">else</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="nb">name</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">mapping_contains?</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="n">shortest</span><span class="p">,</span> <span class="n">longest</span> <span class="o">=</span> <span class="n">find_likely_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>

        <span class="n">word</span><span class="nf">.start_with?</span><span class="p">(</span><span class="n">shortest</span><span class="p">)</span> <span class="n">and</span> <span class="n">longest</span><span class="nf">.start_with?</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># binary search through the mappings to find the one that&#39;s likely</span>
      <span class="c1"># to actually work.</span>
      <span class="k">def </span><span class="nf">find_likely_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="n">min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max</span> <span class="o">=</span> <span class="n">mapping</span><span class="nf">.size</span>

        <span class="k">until</span> <span class="n">max</span> <span class="o">==</span> <span class="n">min</span>
          <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">max</span> <span class="o">+</span> <span class="n">min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

          <span class="n">cmp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">[</span><span class="n">mid</span><span class="o">]</span>

          <span class="k">case</span> <span class="n">word</span> <span class="o">&lt;=&gt;</span> <span class="n">cmp</span>
          <span class="k">when</span> <span class="mi">1</span>
            <span class="c1"># too low</span>
            <span class="n">min</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="k">when</span> <span class="o">-</span><span class="mi">1</span>
            <span class="c1"># too high</span>
            <span class="n">max</span> <span class="o">=</span> <span class="n">mid</span>
          <span class="k">when</span> <span class="mi">0</span>
            <span class="c1"># just right, abort!</span>
            <span class="k">return</span> <span class="n">mapping</span><span class="o">[</span><span class="n">mid</span><span class="o">]</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">mapping</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">XML</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="sx">%q(&lt;desc for=&quot;this-lexer&quot;&gt;XML&lt;/desc&gt;)</span>
      <span class="n">tag</span> <span class="s1">&#39;xml&#39;</span>
      <span class="n">filenames</span> <span class="o">*</span><span class="sx">%w(*.xml *.xsl *.rss *.xslt *.xsd *.wsdl)</span>
      <span class="n">mimetypes</span> <span class="o">*</span><span class="sx">%w(
        text/xml
        application/xml
        image/svg+xml
        application/rss+xml
        application/atom+xml
      )</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span> <span class="k">if</span> <span class="n">text</span><span class="nf">.doctype?</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span> <span class="k">if</span> <span class="n">text</span><span class="o">[</span><span class="mi">0</span><span class="nf">..</span><span class="mi">1000</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">%r(&lt;.+?&gt;.*?&lt;/.+?&gt;)m</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/\A&lt;\?xml\b/</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[^&lt;&amp;]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/&amp;\S*?;/</span><span class="p">,</span> <span class="s1">&#39;Name.Entity&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;!\[CDATA\[.*?\]\]\&gt;/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;!--/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:comment</span>
        <span class="n">rule</span> <span class="sr">/&lt;\?.*?\?&gt;/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>
        <span class="n">rule</span> <span class="sr">/&lt;![^&gt;]*&gt;/</span><span class="p">,</span> <span class="s1">&#39;Comment.Preproc&#39;</span>

        <span class="c1"># open tags</span>
        <span class="n">rule</span> <span class="sr">%r(&lt;</span><span class="se">\s</span><span class="sr">*[</span><span class="se">\w</span><span class="sr">:.-]+)m</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span> <span class="ss">:tag</span>

        <span class="c1"># self-closing tags</span>
        <span class="n">rule</span> <span class="sr">%r(&lt;</span><span class="se">\s</span><span class="sr">*/</span><span class="se">\s</span><span class="sr">*[</span><span class="se">\w</span><span class="sr">:.-]+</span><span class="se">\s</span><span class="sr">*&gt;)m</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:comment</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[^-]+/m</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
        <span class="n">rule</span> <span class="sr">/--&gt;/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/-/</span><span class="p">,</span> <span class="s1">&#39;Comment&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:tag</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[\w.:-]+\s*=/m</span><span class="p">,</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span> <span class="ss">:attr</span>
        <span class="n">rule</span> <span class="sr">%r(/?</span><span class="se">\s</span><span class="sr">*&gt;)</span><span class="p">,</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:attr</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/&quot;.*?&quot;|&#39;.*?&#39;|[^\s&gt;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Lexers</span>
    <span class="k">class </span><span class="nc">YAML</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
      <span class="n">desc</span> <span class="s2">&quot;Yaml Ain&#39;t Markup Language (yaml.org)&quot;</span>
      <span class="n">mimetypes</span> <span class="s1">&#39;text/x-yaml&#39;</span>
      <span class="n">tag</span> <span class="s1">&#39;yaml&#39;</span>
      <span class="n">aliases</span> <span class="s1">&#39;yml&#39;</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">analyze_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="c1"># look for the %YAML directive</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">text</span> <span class="o">=~</span> <span class="sr">/\A\s*%YAML/m</span>
      <span class="k">end</span>

      <span class="n">filenames</span> <span class="s1">&#39;*.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;*.yml&#39;</span>
      <span class="c1"># NB: Tabs are forbidden in YAML, which is why you see things</span>
      <span class="c1"># like /[ ]+/.</span>

      <span class="c1"># reset the indentation levels</span>
      <span class="k">def </span><span class="nf">reset_indent</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    yaml: reset_indent&quot;</span> <span class="p">}</span>
        <span class="vi">@indent_stack</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="vi">@next_indent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="vi">@block_scalar_indent</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">indent</span>
        <span class="k">raise</span> <span class="s1">&#39;empty indent stack!&#39;</span> <span class="k">if</span> <span class="vi">@indent_stack</span><span class="nf">.empty?</span>
        <span class="vi">@indent_stack</span><span class="nf">.last</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">dedent?</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="n">level</span> <span class="o">&lt;</span> <span class="nb">self</span><span class="nf">.indent</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">indent?</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="n">level</span> <span class="o">&gt;</span> <span class="nb">self</span><span class="nf">.indent</span>
      <span class="k">end</span>

      <span class="c1"># Save a possible indentation level</span>
      <span class="k">def </span><span class="nf">save_indent</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    yaml: save_indent&quot;</span> <span class="p">}</span>
        <span class="n">match</span> <span class="o">=</span> <span class="vi">@last_match</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="vi">@next_indent</span> <span class="o">=</span> <span class="n">match</span><span class="nf">.size</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    yaml: indent: </span><span class="si">#{</span><span class="nb">self</span><span class="nf">.indent</span><span class="si">}</span><span class="s2">/</span><span class="si">#@next_indent</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    yaml: popping indent stack - before: </span><span class="si">#@indent_stack</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">dedent?</span><span class="p">(</span><span class="vi">@next_indent</span><span class="p">)</span>
          <span class="vi">@indent_stack</span><span class="nf">.pop</span> <span class="k">while</span> <span class="n">dedent?</span><span class="p">(</span><span class="vi">@next_indent</span><span class="p">)</span>
          <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    yaml: popping indent stack - after: </span><span class="si">#@indent_stack</span><span class="s2">&quot;</span> <span class="p">}</span>
          <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    yaml: indent: </span><span class="si">#{</span><span class="nb">self</span><span class="nf">.indent</span><span class="si">}</span><span class="s2">/</span><span class="si">#@next_indent</span><span class="s2">&quot;</span> <span class="p">}</span>

          <span class="c1"># dedenting to a state not previously indented to is an error</span>
          <span class="o">[</span><span class="n">match</span><span class="o">[</span><span class="mi">0</span><span class="nf">...self.indent</span><span class="o">]</span><span class="p">,</span> <span class="n">match</span><span class="o">[</span><span class="nb">self</span><span class="nf">.indent..</span><span class="o">-</span><span class="mi">1</span><span class="o">]]</span>
        <span class="k">else</span>
          <span class="o">[</span><span class="n">match</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">]</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">continue_indent</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    yaml: continue_indent&quot;</span> <span class="p">}</span>
        <span class="vi">@next_indent</span> <span class="o">+=</span> <span class="vi">@last_match</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.size</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">set_indent</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
        <span class="k">if</span> <span class="n">indent</span> <span class="o">&lt;</span> <span class="vi">@next_indent</span>
          <span class="vi">@indent_stack</span> <span class="o">&lt;&lt;</span> <span class="vi">@next_indent</span>
        <span class="k">end</span>

        <span class="vi">@next_indent</span> <span class="o">+=</span> <span class="vi">@last_match</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.size</span> <span class="k">unless</span> <span class="n">opts</span><span class="o">[</span><span class="ss">:implicit</span><span class="o">]</span>
      <span class="k">end</span>

      <span class="n">plain_scalar_start</span> <span class="o">=</span> <span class="sr">/[^ \t\n\r\f\v?:,\[\]{}#&amp;*!\|&gt;&#39;&quot;%@`]/</span>

      <span class="n">start</span> <span class="p">{</span> <span class="n">reset_indent</span> <span class="p">}</span>

      <span class="n">state</span> <span class="ss">:basic</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/#.*$/</span><span class="p">,</span> <span class="s1">&#39;Comment.Single&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:basic</span>

        <span class="n">rule</span> <span class="sr">/\n+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="c1"># trailing or pre-comment whitespace</span>
        <span class="n">rule</span> <span class="sr">/[ ]+(?=#|$)/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/^%YAML\b/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Tag&#39;</span>
          <span class="n">reset_indent</span>
          <span class="n">push</span> <span class="ss">:yaml_directive</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/^%TAG\b/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Tag&#39;</span>
          <span class="n">reset_indent</span>
          <span class="n">push</span> <span class="ss">:tag_directive</span>
        <span class="k">end</span>

        <span class="c1"># doc-start and doc-end indicators</span>
        <span class="n">rule</span> <span class="sr">/^(?:---|\.\.\.)(?= |$)/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Namespace&#39;</span>
          <span class="n">reset_indent</span>
          <span class="n">push</span> <span class="ss">:block_line</span>
        <span class="k">end</span>

        <span class="c1"># indentation spaces</span>
        <span class="n">rule</span> <span class="sr">/[ ]*(?!\s|$)/</span> <span class="k">do</span>
          <span class="n">text</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">save_indent</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="n">text</span>
          <span class="n">token</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">err</span>
          <span class="n">push</span> <span class="ss">:block_line</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:indentation</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:indentation</span> <span class="k">do</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/\s*?\n/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">pop!</span> <span class="mi">2</span> <span class="p">}</span>
        <span class="c1"># whitespace preceding block collection indicators</span>
        <span class="n">rule</span> <span class="sr">/[ ]+(?=[-:?](?:[ ]|$))/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">continue_indent</span>
        <span class="k">end</span>

        <span class="c1"># block collection indicators</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/[?:-](?=[ ]|$)/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span><span class="p">;</span> <span class="n">set_indent</span> <span class="p">}</span>

        <span class="c1"># the beginning of a block line</span>
        <span class="n">rule</span><span class="p">(</span><span class="sr">/[ ]*/</span><span class="p">)</span> <span class="p">{</span> <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">continue_indent</span><span class="p">;</span> <span class="n">pop!</span> <span class="p">}</span>
      <span class="k">end</span>

      <span class="c1"># indented line in the block context</span>
      <span class="n">state</span> <span class="ss">:block_line</span> <span class="k">do</span>
        <span class="c1"># line end</span>
        <span class="n">rule</span> <span class="sr">/[ ]*(?=#|$)/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[ ]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="c1"># tags, anchors, and aliases</span>
        <span class="n">mixin</span> <span class="ss">:descriptors</span>
        <span class="c1"># block collections and scalars</span>
        <span class="n">mixin</span> <span class="ss">:block_nodes</span>
        <span class="c1"># flow collections and quoed scalars</span>
        <span class="n">mixin</span> <span class="ss">:flow_nodes</span>

        <span class="c1"># a plain scalar</span>
        <span class="n">rule</span> <span class="sr">/(?=</span><span class="si">#{</span><span class="n">plain_scalar_start</span><span class="si">}</span><span class="sr">|[?:-][^ \t\n\r\f\v])/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Variable&#39;</span>
          <span class="n">push</span> <span class="ss">:plain_scalar_in_block_context</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:descriptors</span> <span class="k">do</span>
        <span class="c1"># a full-form tag</span>
        <span class="n">rule</span> <span class="sr">/!&lt;[0-9A-Za-z;\/?:@&amp;=+$,_.!~*&#39;()\[\]%-]+&gt;/</span><span class="p">,</span> <span class="s1">&#39;Keyword.Type&#39;</span>

        <span class="c1"># a tag in the form &#39;!&#39;, &#39;!suffix&#39; or &#39;!handle!suffix&#39;</span>
        <span class="n">rule</span> <span class="sr">%r(
          (?:![</span><span class="se">\w</span><span class="sr">-]+)? # handle
          !(?:[</span><span class="se">\w</span><span class="sr">;/?:@&amp;=+$,.!~*</span><span class="se">\&#39;</span><span class="sr">()</span><span class="se">\[\]</span><span class="sr">%-]*) # suffix
        )x</span><span class="p">,</span> <span class="s1">&#39;Keyword.Type&#39;</span>

        <span class="c1"># an anchor</span>
        <span class="n">rule</span> <span class="sr">/&amp;[\w-]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Label&#39;</span>

        <span class="c1"># an alias</span>
        <span class="n">rule</span> <span class="sr">/\*[\w-]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:block_nodes</span> <span class="k">do</span>
        <span class="c1"># implicit key</span>
        <span class="n">rule</span> <span class="sr">/:(?=\s|$)/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span>
          <span class="n">set_indent</span> <span class="ss">:implicit</span> <span class="o">=&gt;</span> <span class="kp">true</span>
        <span class="k">end</span>

        <span class="c1"># literal and folded scalars</span>
        <span class="n">rule</span> <span class="sr">/[\|&gt;]/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span>
          <span class="n">push</span> <span class="ss">:block_scalar_content</span>
          <span class="n">push</span> <span class="ss">:block_scalar_header</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:flow_nodes</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\[/</span><span class="p">,</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span><span class="p">,</span> <span class="ss">:flow_sequence</span>
        <span class="n">rule</span> <span class="sr">/\{/</span><span class="p">,</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span><span class="p">,</span> <span class="ss">:flow_mapping</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Single&#39;</span><span class="p">,</span> <span class="ss">:single_quoted_scalar</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span> <span class="ss">:double_quoted_scalar</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:flow_collection</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\s+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">mixin</span> <span class="ss">:basic</span>
        <span class="n">rule</span> <span class="sr">/[?:,]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span>
        <span class="n">mixin</span> <span class="ss">:descriptors</span>
        <span class="n">mixin</span> <span class="ss">:flow_nodes</span>

        <span class="n">rule</span> <span class="sr">/(?=</span><span class="si">#{</span><span class="n">plain_scalar_start</span><span class="si">}</span><span class="sr">)/</span> <span class="k">do</span>
          <span class="n">push</span> <span class="ss">:plain_scalar_in_flow_context</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:flow_sequence</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\]/</span><span class="p">,</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:flow_collection</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:flow_mapping</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\}/</span><span class="p">,</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:flow_collection</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:block_scalar_content</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\n+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="c1"># empty lines never dedent, but they might be part of the scalar.</span>
        <span class="n">rule</span> <span class="sr">/^[ ]+$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">text</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
          <span class="n">indent_size</span> <span class="o">=</span> <span class="n">text</span><span class="nf">.size</span>

          <span class="n">indent_mark</span> <span class="o">=</span> <span class="vi">@block_scalar_indent</span> <span class="o">||</span> <span class="n">indent_size</span>

          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">[</span><span class="mi">0</span><span class="nf">...indent_mark</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">[</span><span class="n">indent_mark</span><span class="nf">..</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
        <span class="k">end</span>

        <span class="c1"># TODO: ^ doesn&#39;t actually seem to affect the match at all.</span>
        <span class="c1"># Find a way to work around this limitation.</span>
        <span class="n">rule</span> <span class="sr">/^[ ]*/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span>

          <span class="n">indent_size</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.size</span>

          <span class="n">dedent_level</span> <span class="o">=</span> <span class="vi">@block_scalar_indent</span> <span class="o">||</span> <span class="nb">self</span><span class="nf">.indent</span>
          <span class="vi">@block_scalar_indent</span> <span class="o">||=</span> <span class="n">indent_size</span>

          <span class="k">if</span> <span class="n">indent_size</span> <span class="o">&lt;</span> <span class="n">dedent_level</span>
            <span class="n">pop!</span> <span class="mi">2</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[^\n\r\f\v]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Constant&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:block_scalar_header</span> <span class="k">do</span>
        <span class="c1"># optional indentation indicator and chomping flag, in either order</span>
        <span class="n">rule</span> <span class="sr">%r(
          (
            ([1-9])[+-]? | [+-]?([1-9])?
          )(?=[ ]|$)
        )x</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="vi">@block_scalar_indent</span> <span class="o">=</span> <span class="kp">nil</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:ignored_line</span>
          <span class="k">next</span> <span class="k">if</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.empty?</span>

          <span class="n">increment</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">||</span> <span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
          <span class="k">if</span> <span class="n">increment</span>
            <span class="vi">@block_scalar_indent</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">increment</span><span class="nf">.to_i</span>
          <span class="k">end</span>

          <span class="n">token</span> <span class="s1">&#39;Punctuation.Indicator&#39;</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:ignored_line</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:basic</span>
        <span class="n">rule</span> <span class="sr">/[ ]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:quoted_scalar_whitespaces</span> <span class="k">do</span>
        <span class="c1"># leading and trailing whitespace is ignored</span>
        <span class="n">rule</span> <span class="sr">/^[ ]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[ ]+$/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/\n+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>

        <span class="n">rule</span> <span class="sr">/[ ]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:single_quoted_scalar</span> <span class="k">do</span>
        <span class="n">mixin</span> <span class="ss">:quoted_scalar_whitespaces</span>
        <span class="n">rule</span> <span class="sr">/\\&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/&#39;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[^\s&#39;]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:double_quoted_scalar</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/&quot;/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">mixin</span> <span class="ss">:quoted_scalar_whitespaces</span>
        <span class="c1"># escapes</span>
        <span class="n">rule</span> <span class="sr">/\\[0abt\tn\nvfre &quot;\\N_LP]/</span><span class="p">,</span> <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/\\(?:x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/</span><span class="p">,</span>
          <span class="s1">&#39;Literal.String.Escape&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^ \t\n\r\f\v&quot;\\]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:plain_scalar_in_block_context_new_line</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/^[ ]+\n/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n+/m</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/^(?=---|\.\.\.)/</span> <span class="k">do</span>
          <span class="n">pop!</span> <span class="mi">3</span>
        <span class="k">end</span>

        <span class="c1"># dedent detection</span>
        <span class="n">rule</span> <span class="sr">/^[ ]*/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">pop!</span>

          <span class="n">indent_size</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.size</span>

          <span class="c1"># dedent = end of scalar</span>
          <span class="k">if</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.size</span> <span class="o">&lt;=</span> <span class="nb">self</span><span class="nf">.indent</span>
            <span class="n">pop!</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">save_indent</span>
            <span class="c1"># push :block_line</span>
            <span class="n">push</span> <span class="ss">:indentation</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:plain_scalar_in_block_context</span> <span class="k">do</span>
        <span class="c1"># the : indicator ends a scalar</span>
        <span class="n">rule</span> <span class="sr">/[ ]*(?=:[ \n]|:$)/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[ ]*:/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="n">rule</span> <span class="sr">/[ ]+(?=#)/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[ ]+$/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="c1"># check for new documents or dedents at the new line</span>
        <span class="n">rule</span> <span class="sr">/\n+/</span> <span class="k">do</span>
          <span class="n">token</span> <span class="s1">&#39;Text&#39;</span>
          <span class="n">push</span> <span class="ss">:plain_scalar_in_block_context_new_line</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/[ ]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
        <span class="c1"># regular non-whitespace characters</span>
        <span class="n">rule</span> <span class="sr">/[^\s:]+/</span><span class="p">,</span> <span class="s1">&#39;Literal.String&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:plain_scalar_in_flow_context</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/[ ]*(?=[,:?\[\]{}])/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/[ ]+(?=#)/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
        <span class="n">rule</span> <span class="sr">/^[ ]+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[ ]+$/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/\n+/</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span>
        <span class="n">rule</span> <span class="sr">/[ ]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
        <span class="n">rule</span> <span class="sr">/[^\s,:?\[\]{}]+/</span><span class="p">,</span> <span class="s1">&#39;Name.Variable&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:yaml_directive</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/([ ]+)(\d+\.\d+)/</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Number&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:ignored_line</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:tag_directive</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">%r(
          ([ ]+)(!|![</span><span class="se">\w</span><span class="sr">-]*!) # prefix
          ([ ]+)(!|!?[</span><span class="se">\w</span><span class="sr">;/?:@&amp;=+$,.!~*&#39;()</span><span class="se">\[\]</span><span class="sr">%-]+) # tag handle
        )x</span> <span class="k">do</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Keyword.Type&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;Text&#39;</span><span class="p">;</span> <span class="n">group</span> <span class="s1">&#39;Keyword.Type&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">push</span> <span class="ss">:ignored_line</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># this file is not require&#39;d from the root.  To use this plugin, run:</span>
<span class="c1">#</span>
<span class="c1">#    require &#39;rouge/plugins/redcarpet&#39;</span>

<span class="c1"># stdlib</span>
<span class="nb">require</span> <span class="s1">&#39;cgi&#39;</span>

<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Plugins</span>
    <span class="k">module</span> <span class="nn">Redcarpet</span>
      <span class="k">def </span><span class="nf">block_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
        <span class="n">lexer</span> <span class="o">=</span> <span class="no">Lexer</span><span class="nf">.find_fancy</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span> <span class="o">||</span> <span class="no">Lexers</span><span class="o">::</span><span class="no">Text</span>

        <span class="c1"># XXX HACK: Redcarpet strips hard tabs out of code blocks,</span>
        <span class="c1"># so we assume you&#39;re not using leading spaces that aren&#39;t tabs,</span>
        <span class="c1"># and just replace them here.</span>
        <span class="k">if</span> <span class="n">lexer</span><span class="nf">.tag</span> <span class="o">==</span> <span class="s1">&#39;make&#39;</span>
          <span class="n">code</span><span class="nf">.gsub!</span> <span class="sr">/^    /</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="k">end</span>

        <span class="n">formatter</span> <span class="o">=</span> <span class="no">Formatters</span><span class="o">::</span><span class="no">HTML</span><span class="nf">.new</span><span class="p">(</span>
          <span class="ss">:css_class</span> <span class="o">=&gt;</span> <span class="s2">&quot;highlight </span><span class="si">#{</span><span class="n">lexer</span><span class="nf">.tag</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">formatter</span><span class="nf">.format</span><span class="p">(</span><span class="n">lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="c1"># @abstract</span>
  <span class="c1"># A stateful lexer that uses sets of regular expressions to</span>
  <span class="c1"># tokenize a string.  Most lexers are instances of RegexLexer.</span>
  <span class="k">class </span><span class="nc">RegexLexer</span> <span class="o">&lt;</span> <span class="no">Lexer</span>
    <span class="c1"># A rule is a tuple of a regular expression to test, and a callback</span>
    <span class="c1"># to perform if the test succeeds.</span>
    <span class="c1">#</span>
    <span class="c1"># @see StateDSL#rule</span>
    <span class="k">class </span><span class="nc">Rule</span>
      <span class="kp">attr_reader</span> <span class="ss">:callback</span>
      <span class="kp">attr_reader</span> <span class="ss">:re</span>
      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
        <span class="vi">@re</span> <span class="o">=</span> <span class="n">re</span>
        <span class="vi">@callback</span> <span class="o">=</span> <span class="n">callback</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">inspect</span>
        <span class="s2">&quot;#&lt;Rule </span><span class="si">#{</span><span class="vi">@re</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># a State is a named set of rules that can be tested for or</span>
    <span class="c1"># mixed in.</span>
    <span class="c1">#</span>
    <span class="c1"># @see RegexLexer.state</span>
    <span class="k">class </span><span class="nc">State</span>
      <span class="kp">attr_reader</span> <span class="ss">:name</span>
      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">defn</span><span class="p">)</span>
        <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
        <span class="vi">@defn</span> <span class="o">=</span> <span class="n">defn</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">rules</span>
        <span class="vi">@rules</span> <span class="o">||=</span> <span class="o">[]</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">load!</span>
        <span class="k">return</span> <span class="nb">self</span> <span class="k">if</span> <span class="vi">@loaded</span>
        <span class="vi">@loaded</span> <span class="o">=</span> <span class="kp">true</span>
        <span class="no">StateDSL</span><span class="nf">.new</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span><span class="nf">.instance_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="vi">@defn</span><span class="p">)</span>
        <span class="nb">self</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class </span><span class="nc">StateDSL</span>
      <span class="kp">attr_reader</span> <span class="ss">:rules</span>
      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
        <span class="vi">@rules</span> <span class="o">=</span> <span class="n">rules</span>
      <span class="k">end</span>

      <span class="c1"># Define a new rule for this state.</span>
      <span class="c1">#</span>
      <span class="c1"># @overload rule(re, token, next_state=nil)</span>
      <span class="c1"># @overload rule(re, &amp;callback)</span>
      <span class="c1">#</span>
      <span class="c1"># @param [Regexp] re</span>
      <span class="c1">#   a regular expression for this rule to test.</span>
      <span class="c1"># @param [String] tok</span>
      <span class="c1">#   the token type to yield if `re` matches.</span>
      <span class="c1"># @param [#to_s] next_state</span>
      <span class="c1">#   (optional) a state to push onto the stack if `re` matches.</span>
      <span class="c1">#   If `next_state` is `:pop!`, the state stack will be popped</span>
      <span class="c1">#   instead.</span>
      <span class="c1"># @param [Proc] callback</span>
      <span class="c1">#   a block that will be evaluated in the context of the lexer</span>
      <span class="c1">#   if `re` matches.  This block has access to a number of lexer</span>
      <span class="c1">#   methods, including {RegexLexer#push}, {RegexLexer#pop!},</span>
      <span class="c1">#   {RegexLexer#token}, and {RegexLexer#delegate}.  The first</span>
      <span class="c1">#   argument can be used to access the match groups.</span>
      <span class="k">def </span><span class="nf">rule</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">tok</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="n">next_state</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">block_given?</span>
          <span class="n">next_state</span> <span class="o">=</span> <span class="n">tok</span>
        <span class="k">else</span>
          <span class="n">tok</span> <span class="o">=</span> <span class="no">Token</span><span class="o">[</span><span class="n">tok</span><span class="o">]</span>

          <span class="n">callback</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span>
            <span class="n">token</span> <span class="n">tok</span>
            <span class="k">case</span> <span class="n">next_state</span>
            <span class="k">when</span> <span class="ss">:pop!</span>
              <span class="n">pop!</span>
            <span class="k">when</span> <span class="no">Symbol</span>
              <span class="n">push</span> <span class="n">next_state</span>
            <span class="k">end</span> <span class="c1"># else pass</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="n">rules</span> <span class="o">&lt;&lt;</span> <span class="no">Rule</span><span class="nf">.new</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># Mix in the rules from another state into this state.  The rules</span>
      <span class="c1"># from the mixed-in state will be tried in order before moving on</span>
      <span class="c1"># to the rest of the rules in this state.</span>
      <span class="k">def </span><span class="nf">mixin</span><span class="p">(</span><span class="n">lexer_name</span><span class="p">)</span>
        <span class="n">rules</span> <span class="o">&lt;&lt;</span> <span class="n">lexer_name</span><span class="nf">.to_s</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># The states hash for this lexer.</span>
    <span class="c1"># @see state</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">states</span>
      <span class="vi">@states</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="k">end</span>

    <span class="c1"># The routines to run at the beginning of a fresh lex.</span>
    <span class="c1"># @see start</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">start_procs</span>
      <span class="vi">@start_procs</span> <span class="o">||=</span> <span class="no">InheritableList</span><span class="nf">.new</span><span class="p">(</span><span class="n">superclass</span><span class="nf">.start_procs</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="vi">@start_procs</span> <span class="o">=</span> <span class="o">[]</span>

    <span class="c1"># Specify an action to be run every fresh lex.</span>
    <span class="c1">#</span>
    <span class="c1"># @example</span>
    <span class="c1">#   start { puts &quot;I&#39;m lexing a new string!&quot; }</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="n">start_procs</span> <span class="o">&lt;&lt;</span> <span class="n">b</span>
    <span class="k">end</span>

    <span class="c1"># Specify a filter to be applied as the lexer yields tokens.</span>
    <span class="c1">#</span>
    <span class="c1"># @param toktype</span>
    <span class="c1">#   The token type to postprocess</span>
    <span class="c1"># @yield [tok, val]</span>
    <span class="c1">#   The token and the matched value.  The block will be evaluated in</span>
    <span class="c1">#   the context of the lexer, and it must yield an equivalent</span>
    <span class="c1">#   token/value pair, usually by calling #token.</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">postprocess</span><span class="p">(</span><span class="n">toktype</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="n">postprocesses</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="no">Token</span><span class="o">[</span><span class="n">toktype</span><span class="o">]</span><span class="p">,</span> <span class="n">b</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="c1"># where the postprocess blocks are stored.</span>
    <span class="c1"># @see postprocess</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">postprocesses</span>
      <span class="vi">@postprocesses</span> <span class="o">||=</span> <span class="no">InheritableList</span><span class="nf">.new</span><span class="p">(</span><span class="n">superclass</span><span class="nf">.postprocesses</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="vi">@postprocesses</span> <span class="o">=</span> <span class="o">[]</span>

    <span class="c1"># Define a new state for this lexer with the given name.</span>
    <span class="c1"># The block will be evaluated in the context of a {StateDSL}.</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">state</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="nf">.to_s</span>
      <span class="n">states</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span> <span class="o">=</span> <span class="no">State</span><span class="nf">.new</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># @private</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">get_state</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="nb">name</span><span class="nf">.is_a?</span> <span class="no">State</span>

      <span class="n">state</span> <span class="o">=</span> <span class="n">states</span><span class="o">[</span><span class="nb">name</span><span class="nf">.to_s</span><span class="o">]</span>
      <span class="k">raise</span> <span class="s2">&quot;unknown state: </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">unless</span> <span class="n">state</span>
      <span class="n">state</span><span class="nf">.load!</span>
    <span class="k">end</span>

    <span class="c1"># @private</span>
    <span class="k">def </span><span class="nf">get_state</span><span class="p">(</span><span class="n">state_name</span><span class="p">)</span>
      <span class="nb">self</span><span class="nf">.class.get_state</span><span class="p">(</span><span class="n">state_name</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># The state stack.  This is initially the single state `[:root]`.</span>
    <span class="c1"># It is an error for this stack to be empty.</span>
    <span class="c1"># @see #state</span>
    <span class="k">def </span><span class="nf">stack</span>
      <span class="vi">@stack</span> <span class="o">||=</span> <span class="o">[</span><span class="n">get_state</span><span class="p">(</span><span class="ss">:root</span><span class="p">)</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="c1"># The current state - i.e. one on top of the state stack.</span>
    <span class="c1">#</span>
    <span class="c1"># NB: if the state stack is empty, this will throw an error rather</span>
    <span class="c1"># than returning nil.</span>
    <span class="k">def </span><span class="nf">state</span>
      <span class="n">stack</span><span class="nf">.last</span> <span class="n">or</span> <span class="k">raise</span> <span class="s1">&#39;empty stack!&#39;</span>
    <span class="k">end</span>

    <span class="c1"># reset this lexer to its initial state.  This runs all of the</span>
    <span class="c1"># start_procs.</span>
    <span class="k">def </span><span class="nf">reset!</span>
      <span class="vi">@stack</span> <span class="o">=</span> <span class="kp">nil</span>

      <span class="nb">self</span><span class="nf">.class.start_procs.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pr</span><span class="o">|</span>
        <span class="nb">instance_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pr</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># This implements the lexer protocol, by yielding [token, value] pairs.</span>
    <span class="c1">#</span>
    <span class="c1"># The process for lexing works as follows, until the stream is empty:</span>
    <span class="c1">#</span>
    <span class="c1"># 1. We look at the state on top of the stack (which by default is</span>
    <span class="c1">#    `[:root]`).</span>
    <span class="c1"># 2. Each rule in that state is tried until one is successful.  If one</span>
    <span class="c1">#    is found, that rule&#39;s callback is evaluated - which may yield</span>
    <span class="c1">#    tokens and manipulate the state stack.  Otherwise, one character</span>
    <span class="c1">#    is consumed with an `&#39;Error&#39;` token, and we continue at (1.)</span>
    <span class="c1">#</span>
    <span class="c1"># @see #step #step (where (2.) is implemented)</span>
    <span class="k">def </span><span class="nf">stream_tokens</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="n">stream_without_postprocessing</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">processor</span> <span class="o">=</span> <span class="nb">self</span><span class="nf">.class.postprocesses.find</span> <span class="p">{</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">_</span><span class="o">|</span> <span class="n">t</span> <span class="o">===</span> <span class="n">tok</span> <span class="p">}</span>

        <span class="k">if</span> <span class="n">processor</span>
          <span class="n">with_output_stream</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">do</span>
            <span class="n">instance_exec</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">processor</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">else</span>
          <span class="k">yield</span> <span class="n">tok</span><span class="p">,</span> <span class="n">val</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># @private</span>
    <span class="k">def </span><span class="nf">stream_without_postprocessing</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">until</span> <span class="n">stream</span><span class="nf">.eos?</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;lexer: </span><span class="si">#{</span><span class="nb">self</span><span class="nf">.class.tag</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;stack: </span><span class="si">#{</span><span class="n">stack</span><span class="nf">.map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;stream: </span><span class="si">#{</span><span class="n">stream</span><span class="nf">.peek</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="n">get_state</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>

        <span class="k">if</span> <span class="o">!</span><span class="n">success</span>
          <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    no match, yielding Error&quot;</span> <span class="p">}</span>
          <span class="n">b</span><span class="nf">.call</span><span class="p">(</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Error&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">stream</span><span class="nf">.getch</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># Runs one step of the lex.  Rules in the current state are tried</span>
    <span class="c1"># until one matches, at which point its callback is called.</span>
    <span class="c1">#</span>
    <span class="c1"># @return true if a rule was tried successfully</span>
    <span class="c1"># @return false otherwise.</span>
    <span class="k">def </span><span class="nf">step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="n">state</span><span class="nf">.rules.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">rule</span><span class="o">|</span>
        <span class="k">return</span> <span class="kp">true</span> <span class="k">if</span> <span class="n">run_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="kp">false</span>
    <span class="k">end</span>

    <span class="c1"># @private</span>
    <span class="k">def </span><span class="nf">run_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">case</span> <span class="n">rule</span>
      <span class="k">when</span> <span class="nb">String</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;  entering mixin </span><span class="si">#{</span><span class="n">rule</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="n">get_state</span><span class="p">(</span><span class="n">rule</span><span class="p">),</span> <span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;  exiting  mixin </span><span class="si">#{</span><span class="n">rule</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="n">res</span>
      <span class="k">when</span> <span class="no">Rule</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;  trying </span><span class="si">#{</span><span class="n">rule</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="nb">scan</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">rule</span><span class="nf">.re</span><span class="p">)</span> <span class="k">do</span>
          <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    got </span><span class="si">#{</span><span class="n">stream</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>

          <span class="n">run_callback</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">rule</span><span class="nf">.callback</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># @private</span>
    <span class="k">def </span><span class="nf">run_callback</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">output_stream</span><span class="p">)</span>
      <span class="n">with_output_stream</span><span class="p">(</span><span class="n">output_stream</span><span class="p">)</span> <span class="k">do</span>
        <span class="vi">@group_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="vi">@last_match</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="n">instance_exec</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callback</span><span class="p">)</span>
        <span class="vi">@last_match</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># The number of successive scans permitted without consuming</span>
    <span class="c1"># the input stream.  If this is exceeded, the match fails.</span>
    <span class="no">MAX_NULL_SCANS</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="c1"># @private</span>
    <span class="k">def </span><span class="nf">scan</span><span class="p">(</span><span class="n">scanner</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="c1"># XXX HACK XXX</span>
      <span class="c1"># StringScanner&#39;s implementation of ^ is b0rken.</span>
      <span class="c1"># TODO: this doesn&#39;t cover cases like /(a|^b)/, but it&#39;s</span>
      <span class="c1"># the most common, for now...</span>
      <span class="k">return</span> <span class="kp">false</span> <span class="k">if</span> <span class="n">re</span><span class="nf">.source</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="sc">?^</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">scanner</span><span class="nf">.beginning_of_line?</span>

      <span class="vi">@null_steps</span> <span class="o">||=</span> <span class="mi">0</span>

      <span class="k">if</span> <span class="vi">@null_steps</span> <span class="o">&gt;=</span> <span class="no">MAX_NULL_SCANS</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    too many scans without consuming the string!&quot;</span> <span class="p">}</span>
        <span class="k">return</span> <span class="kp">false</span>
      <span class="k">end</span>

      <span class="n">scanner</span><span class="nf">.scan</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">scanner</span><span class="nf">.matched?</span>
        <span class="k">if</span> <span class="n">scanner</span><span class="nf">.matched_size</span> <span class="o">==</span> <span class="mi">0</span>
          <span class="vi">@null_steps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span>
          <span class="vi">@null_steps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">end</span>

        <span class="k">yield</span> <span class="nb">self</span>
        <span class="k">return</span> <span class="kp">true</span>
      <span class="k">end</span>

      <span class="k">return</span> <span class="kp">false</span>
    <span class="k">end</span>

    <span class="c1"># Yield a token.</span>
    <span class="c1">#</span>
    <span class="c1"># @param tok</span>
    <span class="c1">#   the token type</span>
    <span class="c1"># @param val</span>
    <span class="c1">#   (optional) the string value to yield.  If absent, this defaults</span>
    <span class="c1">#   to the entire last match.</span>
    <span class="k">def </span><span class="nf">token</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="ss">:__absent__</span><span class="p">)</span>
      <span class="n">val</span> <span class="o">=</span> <span class="vi">@last_match</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="ss">:__absent__</span>
      <span class="n">val</span> <span class="o">||=</span> <span class="s1">&#39;&#39;</span>

      <span class="k">raise</span> <span class="s1">&#39;no output stream&#39;</span> <span class="k">unless</span> <span class="vi">@output_stream</span>

      <span class="vi">@output_stream</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="no">Token</span><span class="o">[</span><span class="n">tok</span><span class="o">]</span><span class="p">,</span> <span class="n">val</span><span class="o">]</span> <span class="k">unless</span> <span class="n">val</span><span class="nf">.empty?</span>
    <span class="k">end</span>

    <span class="c1"># Yield a token with the next matched group.  Subsequent calls</span>
    <span class="c1"># to this method will yield subsequent groups.</span>
    <span class="k">def </span><span class="nf">group</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
      <span class="n">token</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="vi">@last_match</span><span class="o">[</span><span class="vi">@group_count</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">]</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Delegate the lex to another lexer.  The #lex method will be called</span>
    <span class="c1"># with `:continue` set to true, so that #reset! will not be called.</span>
    <span class="c1"># In this way, a single lexer can be repeatedly delegated to while</span>
    <span class="c1"># maintaining its own internal state stack.</span>
    <span class="c1">#</span>
    <span class="c1"># @param [#lex] lexer</span>
    <span class="c1">#   The lexer or lexer class to delegate to</span>
    <span class="c1"># @param [String] text</span>
    <span class="c1">#   The text to delegate.  This defaults to the last matched string.</span>
    <span class="k">def </span><span class="nf">delegate</span><span class="p">(</span><span class="n">lexer</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    delegating to </span><span class="si">#{</span><span class="n">lexer</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
      <span class="n">text</span> <span class="o">||=</span> <span class="vi">@last_match</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>

      <span class="n">lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="ss">:continue</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    delegated token: </span><span class="si">#{</span><span class="n">tok</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">val</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="n">token</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># Push a state onto the stack.  If no state name is given and you&#39;ve</span>
    <span class="c1"># passed a block, a state will be dynamically created using the</span>
    <span class="c1"># {StateDSL}.</span>
    <span class="k">def </span><span class="nf">push</span><span class="p">(</span><span class="n">state_name</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="n">push_state</span> <span class="o">=</span> <span class="k">if</span> <span class="n">state_name</span>
        <span class="n">get_state</span><span class="p">(</span><span class="n">state_name</span><span class="p">)</span>
      <span class="k">elsif</span> <span class="nb">block_given?</span>
        <span class="no">State</span><span class="nf">.new</span><span class="p">(</span><span class="n">b</span><span class="nf">.inspect</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="nf">.load!</span>
      <span class="k">else</span>
        <span class="c1"># use the top of the stack by default</span>
        <span class="nb">self</span><span class="nf">.state</span>
      <span class="k">end</span>

      <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    pushing </span><span class="si">#{</span><span class="n">push_state</span><span class="nf">.name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
      <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="n">push_state</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Pop the state stack.  If a number is passed in, it will be popped</span>
    <span class="c1"># that number of times.</span>
    <span class="k">def </span><span class="nf">pop!</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">raise</span> <span class="s1">&#39;empty stack!&#39;</span> <span class="k">if</span> <span class="n">stack</span><span class="nf">.empty?</span>

      <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    popping stack: </span><span class="si">#{</span><span class="n">times</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
      <span class="n">times</span><span class="nf">.times</span> <span class="p">{</span> <span class="n">stack</span><span class="nf">.pop</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="c1"># reset the stack back to `[:root]`.</span>
    <span class="k">def </span><span class="nf">reset_stack</span>
      <span class="n">debug</span> <span class="p">{</span> <span class="s1">&#39;    resetting stack&#39;</span> <span class="p">}</span>
      <span class="n">stack</span><span class="nf">.clear</span>
      <span class="n">stack</span><span class="nf">.push</span> <span class="n">get_state</span><span class="p">(</span><span class="ss">:root</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Check if `state_name` is in the state stack.</span>
    <span class="k">def </span><span class="nf">in_state?</span><span class="p">(</span><span class="n">state_name</span><span class="p">)</span>
      <span class="n">stack</span><span class="nf">.map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span><span class="nf">.include?</span> <span class="n">state_name</span><span class="nf">.to_s</span>
    <span class="k">end</span>

    <span class="c1"># Check if `state_name` is the state on top of the state stack.</span>
    <span class="k">def </span><span class="nf">state?</span><span class="p">(</span><span class="n">state_name</span><span class="p">)</span>
      <span class="n">state_name</span><span class="nf">.to_s</span> <span class="o">==</span> <span class="n">state</span><span class="nf">.name</span>
    <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def </span><span class="nf">with_output_stream</span><span class="p">(</span><span class="n">output_stream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="n">old_output_stream</span> <span class="o">=</span> <span class="vi">@output_stream</span>
      <span class="vi">@output_stream</span> <span class="o">=</span> <span class="no">Yielder</span><span class="nf">.new</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span>
        <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    yielding </span><span class="si">#{</span><span class="n">tok</span><span class="nf">.to_s.inspect</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">val</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
        <span class="n">output_stream</span><span class="nf">.call</span><span class="p">(</span><span class="no">Token</span><span class="o">[</span><span class="n">tok</span><span class="o">]</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">yield</span>

    <span class="k">ensure</span>
      <span class="vi">@output_stream</span> <span class="o">=</span> <span class="n">old_output_stream</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="c1"># @abstract</span>
  <span class="c1"># A TemplateLexer is one that accepts a :parent option, to specify</span>
  <span class="c1"># which language is being templated.  The lexer class can specify its</span>
  <span class="c1"># own default for the parent lexer, which is otherwise defaulted to</span>
  <span class="c1"># HTML.</span>
  <span class="k">class </span><span class="nc">TemplateLexer</span> <span class="o">&lt;</span> <span class="no">RegexLexer</span>
    <span class="c1"># the parent lexer - the one being templated.</span>
    <span class="k">def </span><span class="nf">parent</span>
      <span class="k">return</span> <span class="vi">@parent</span> <span class="k">if</span> <span class="n">instance_variable_defined?</span> <span class="ss">:@parent</span>
      <span class="vi">@parent</span> <span class="o">=</span> <span class="n">option</span><span class="p">(</span><span class="ss">:parent</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;html&#39;</span>
      <span class="k">if</span> <span class="vi">@parent</span><span class="nf">.is_a?</span> <span class="nb">String</span>
        <span class="n">lexer_class</span> <span class="o">=</span> <span class="no">Lexer</span><span class="nf">.find</span><span class="p">(</span><span class="vi">@parent</span><span class="p">)</span>
        <span class="vi">@parent</span> <span class="o">=</span> <span class="n">lexer_class</span><span class="nf">.new</span><span class="p">(</span><span class="nb">self</span><span class="nf">.options</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">start</span> <span class="p">{</span> <span class="n">parent</span><span class="nf">.reset!</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">class </span><span class="nc">TextAnalyzer</span> <span class="o">&lt;</span> <span class="nb">String</span>
    <span class="c1"># Find a shebang.  Returns nil if no shebang is present.</span>
    <span class="k">def </span><span class="nf">shebang</span>
      <span class="k">return</span> <span class="vi">@shebang</span> <span class="k">if</span> <span class="n">instance_variable_defined?</span> <span class="ss">:@shebang</span>

      <span class="nb">self</span> <span class="o">=~</span> <span class="sr">/\A\s*#!(.*)$/</span>
      <span class="vi">@shebang</span> <span class="o">=</span> <span class="vg">$1</span>
    <span class="k">end</span>

    <span class="c1"># Check if the given shebang is present.</span>
    <span class="c1">#</span>
    <span class="c1"># This normalizes things so that `text.shebang?(&#39;bash&#39;)` will detect</span>
    <span class="c1"># `#!/bash`, &#39;#!/bin/bash&#39;, &#39;#!/usr/bin/env bash&#39;, and &#39;#!/bin/bash -x&#39;</span>
    <span class="k">def </span><span class="nf">shebang?</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
      <span class="n">match</span> <span class="o">=</span> <span class="sr">/\b</span><span class="si">#{</span><span class="n">match</span><span class="si">}</span><span class="sr">(\s|$)/</span>
      <span class="n">match</span> <span class="o">===</span> <span class="n">shebang</span>
    <span class="k">end</span>

    <span class="c1"># Return the contents of the doctype tag if present, nil otherwise.</span>
    <span class="k">def </span><span class="nf">doctype</span>
      <span class="k">return</span> <span class="vi">@doctype</span> <span class="k">if</span> <span class="n">instance_variable_defined?</span> <span class="ss">:@doctype</span>

      <span class="nb">self</span> <span class="o">=~</span> <span class="sr">%r(</span><span class="se">\A\s</span><span class="sr">*
        (?:&lt;</span><span class="se">\?</span><span class="sr">.*?</span><span class="se">\?</span><span class="sr">&gt;</span><span class="se">\s</span><span class="sr">*)? # possible &lt;?xml...?&gt; tag
        &lt;!DOCTYPE</span><span class="se">\s</span><span class="sr">+(.+?)&gt;
      )xm</span>
      <span class="vi">@doctype</span> <span class="o">=</span> <span class="vg">$1</span>
    <span class="k">end</span>

    <span class="c1"># Check if the doctype matches a given regexp or string</span>
    <span class="k">def </span><span class="nf">doctype?</span><span class="p">(</span><span class="n">type</span><span class="o">=</span><span class="sr">//</span><span class="p">)</span>
      <span class="n">type</span> <span class="o">===</span> <span class="n">doctype</span>
    <span class="k">end</span>

    <span class="c1"># Return true if the result of lexing with the given lexer contains no</span>
    <span class="c1"># error tokens.</span>
    <span class="k">def </span><span class="nf">lexes_cleanly?</span><span class="p">(</span><span class="n">lexer</span><span class="p">)</span>
      <span class="n">lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span><span class="o">|</span>
        <span class="k">return</span> <span class="kp">false</span> <span class="k">if</span> <span class="n">tok</span><span class="nf">.name</span> <span class="o">==</span> <span class="s1">&#39;Error&#39;</span>
      <span class="k">end</span>

      <span class="kp">true</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">class </span><span class="nc">Theme</span>
    <span class="k">class </span><span class="nc">Style</span> <span class="o">&lt;</span> <span class="no">Hash</span>
      <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">theme</span><span class="p">,</span> <span class="n">hsh</span><span class="o">=</span><span class="p">{})</span>
        <span class="k">super</span><span class="p">()</span>
        <span class="vi">@theme</span> <span class="o">=</span> <span class="n">theme</span>
        <span class="n">merge!</span><span class="p">(</span><span class="n">hsh</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="o">[</span><span class="ss">:fg</span><span class="p">,</span> <span class="ss">:bg</span><span class="o">]</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">mode</span><span class="o">|</span>
        <span class="n">define_method</span> <span class="n">mode</span> <span class="k">do</span>
          <span class="k">return</span> <span class="nb">self</span><span class="o">[</span><span class="n">mode</span><span class="o">]</span> <span class="k">unless</span> <span class="vi">@theme</span>
          <span class="vi">@theme</span><span class="nf">.palette</span><span class="p">(</span><span class="nb">self</span><span class="o">[</span><span class="n">mode</span><span class="o">]</span><span class="p">)</span> <span class="k">if</span> <span class="nb">self</span><span class="o">[</span><span class="n">mode</span><span class="o">]</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">render</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enum_for</span><span class="p">(</span><span class="ss">:render</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span><span class="nf">.to_a.join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">unless</span> <span class="n">b</span>

        <span class="k">return</span> <span class="k">if</span> <span class="n">empty?</span>

        <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">selector</span><span class="si">}</span><span class="s2"> {&quot;</span>
        <span class="k">yield</span> <span class="s2">&quot;  color: </span><span class="si">#{</span><span class="n">fg</span><span class="si">}</span><span class="s2">;&quot;</span> <span class="k">if</span> <span class="n">fg</span>
        <span class="k">yield</span> <span class="s2">&quot;  background-color: </span><span class="si">#{</span><span class="n">bg</span><span class="si">}</span><span class="s2">;&quot;</span> <span class="k">if</span> <span class="n">bg</span>
        <span class="k">yield</span> <span class="s2">&quot;  font-weight: bold;&quot;</span> <span class="k">if</span> <span class="nb">self</span><span class="o">[</span><span class="ss">:bold</span><span class="o">]</span>
        <span class="k">yield</span> <span class="s2">&quot;  font-style: italic;&quot;</span> <span class="k">if</span> <span class="nb">self</span><span class="o">[</span><span class="ss">:italic</span><span class="o">]</span>
        <span class="k">yield</span> <span class="s2">&quot;  text-decoration: underline;&quot;</span> <span class="k">if</span> <span class="nb">self</span><span class="o">[</span><span class="ss">:underline</span><span class="o">]</span>

        <span class="p">(</span><span class="nb">self</span><span class="o">[</span><span class="ss">:rules</span><span class="o">]</span> <span class="o">||</span> <span class="o">[]</span><span class="p">)</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">rule</span><span class="o">|</span>
          <span class="k">yield</span> <span class="s2">&quot;  </span><span class="si">#{</span><span class="n">rule</span><span class="si">}</span><span class="s2">;&quot;</span>
        <span class="k">end</span>

        <span class="k">yield</span> <span class="s2">&quot;}&quot;</span>
      <span class="k">end</span>

    <span class="k">end</span>

    <span class="k">def </span><span class="nf">styles</span>
      <span class="vi">@styles</span> <span class="o">||=</span> <span class="nb">self</span><span class="nf">.class.styles.dup</span>
    <span class="k">end</span>

    <span class="vi">@palette</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">palette</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="p">{})</span>
      <span class="vi">@palette</span> <span class="o">||=</span> <span class="no">InheritableHash</span><span class="nf">.new</span><span class="p">(</span><span class="n">superclass</span><span class="nf">.palette</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">arg</span><span class="nf">.is_a?</span> <span class="no">Hash</span>
        <span class="vi">@palette</span><span class="nf">.merge!</span> <span class="n">arg</span>
        <span class="vi">@palette</span>
      <span class="k">else</span>
        <span class="k">case</span> <span class="n">arg</span>
        <span class="k">when</span> <span class="sr">/#[0-9a-f]+/i</span>
          <span class="n">arg</span>
        <span class="k">else</span>
          <span class="vi">@palette</span><span class="o">[</span><span class="n">arg</span><span class="o">]</span> <span class="n">or</span> <span class="k">raise</span> <span class="s2">&quot;not in palette: </span><span class="si">#{</span><span class="n">arg</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="vi">@styles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">styles</span>
      <span class="vi">@styles</span> <span class="o">||=</span> <span class="no">InheritableHash</span><span class="nf">.new</span><span class="p">(</span><span class="n">superclass</span><span class="nf">.styles</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">render</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{},</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="kp">new</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span><span class="nf">.render</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">class </span><span class="o">&lt;&lt;</span> <span class="nb">self</span>
      <span class="k">def </span><span class="nf">style</span><span class="p">(</span><span class="o">*</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">tokens</span><span class="nf">.last.is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="p">?</span> <span class="n">tokens</span><span class="nf">.pop</span> <span class="p">:</span> <span class="p">{}</span>

        <span class="n">style</span> <span class="o">=</span> <span class="no">Style</span><span class="nf">.new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>

        <span class="n">tokens</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="o">|</span>
          <span class="n">styles</span><span class="o">[</span><span class="n">tok</span><span class="nf">.to_s</span><span class="o">]</span> <span class="o">=</span> <span class="n">style</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">get_own_style</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="n">token</span><span class="nf">.ancestors</span> <span class="k">do</span> <span class="o">|</span><span class="n">anc</span><span class="o">|</span>
          <span class="k">return</span> <span class="n">styles</span><span class="o">[</span><span class="n">anc</span><span class="nf">.name</span><span class="o">]</span> <span class="k">if</span> <span class="n">styles</span><span class="o">[</span><span class="n">anc</span><span class="nf">.name</span><span class="o">]</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">get_style</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="n">get_own_style</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">||</span> <span class="n">style</span><span class="o">[</span><span class="s1">&#39;Text&#39;</span><span class="o">]</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">name</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
        <span class="k">return</span> <span class="vi">@name</span> <span class="k">if</span> <span class="n">n</span><span class="nf">.nil?</span>

        <span class="vi">@name</span> <span class="o">=</span> <span class="n">n</span><span class="nf">.to_s</span>
        <span class="no">Theme</span><span class="nf">.registry</span><span class="o">[</span><span class="vi">@name</span><span class="o">]</span> <span class="o">=</span> <span class="nb">self</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">find</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">registry</span><span class="o">[</span><span class="n">n</span><span class="nf">.to_s</span><span class="o">]</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">registry</span>
        <span class="vi">@registry</span> <span class="o">||=</span> <span class="p">{}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">module</span> <span class="nn">HasModes</span>
    <span class="k">def </span><span class="nf">mode</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="ss">:absent</span><span class="p">)</span>
      <span class="k">return</span> <span class="vi">@mode</span> <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="ss">:absent</span>

      <span class="vi">@modes</span> <span class="o">||=</span> <span class="p">{}</span>
      <span class="vi">@modes</span><span class="o">[</span><span class="n">arg</span><span class="o">]</span> <span class="o">||=</span> <span class="n">get_mode</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">get_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">self</span> <span class="k">if</span> <span class="nb">self</span><span class="nf">.mode</span> <span class="o">==</span> <span class="n">mode</span>

      <span class="n">new_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="nf">.name</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="no">Class</span><span class="nf">.new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">{</span> <span class="nb">name</span><span class="p">(</span><span class="n">new_name</span><span class="p">);</span> <span class="n">mode!</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">mode!</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
      <span class="vi">@mode</span> <span class="o">=</span> <span class="n">arg</span>
      <span class="nb">send</span><span class="p">(</span><span class="s2">&quot;make_</span><span class="si">#{</span><span class="n">arg</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class </span><span class="nc">CSSTheme</span> <span class="o">&lt;</span> <span class="no">Theme</span>
    <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="p">{})</span>
      <span class="vi">@scope</span> <span class="o">=</span> <span class="n">opts</span><span class="o">[</span><span class="ss">:scope</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;.highlight&#39;</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">render</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">enum_for</span><span class="p">(</span><span class="ss">:render</span><span class="p">)</span><span class="nf">.to_a.join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">unless</span> <span class="n">b</span>

      <span class="c1"># shared styles for tableized line numbers</span>
      <span class="k">yield</span> <span class="s2">&quot;table.highlight { border-spacing: 0; }&quot;</span>
      <span class="k">yield</span> <span class="s2">&quot;table.highlight pre { margin: 0; padding: 3px; }&quot;</span>
      <span class="k">yield</span> <span class="s2">&quot;table.highlight .gutter {&quot;</span>
      <span class="k">yield</span> <span class="s2">&quot;  text-align: right;&quot;</span>
      <span class="k">yield</span> <span class="s2">&quot;  padding-left: 5px;&quot;</span>
      <span class="k">yield</span> <span class="s2">&quot;  padding-right: 5px;&quot;</span>
      <span class="k">yield</span> <span class="s2">&quot;}&quot;</span>

      <span class="n">styles</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tokname</span><span class="p">,</span> <span class="n">style</span><span class="o">|</span>
        <span class="n">style</span><span class="nf">.render</span><span class="p">(</span><span class="n">css_selector</span><span class="p">(</span><span class="no">Token</span><span class="o">[</span><span class="n">tokname</span><span class="o">]</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def </span><span class="nf">css_selector</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
      <span class="n">tokens</span> <span class="o">=</span> <span class="o">[</span><span class="n">token</span><span class="o">]</span>
      <span class="n">parent</span> <span class="o">=</span> <span class="n">token</span><span class="nf">.parent</span>

      <span class="n">inflate_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="nf">.map</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="o">|</span>
        <span class="k">raise</span> <span class="s2">&quot;unknown token: </span><span class="si">#{</span><span class="n">tok</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">tok</span><span class="nf">.shortname.nil?</span>

        <span class="n">single_css_selector</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
      <span class="k">end</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">single_css_selector</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
      <span class="k">return</span> <span class="vi">@scope</span> <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Text&#39;</span><span class="o">]</span>

      <span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@scope</span><span class="si">}</span><span class="s2"> .</span><span class="si">#{</span><span class="n">token</span><span class="nf">.shortname</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>

    <span class="c1"># yield all of the tokens that should be styled the same</span>
    <span class="c1"># as the given token.  Essentially this recursively all of</span>
    <span class="c1"># the subtokens, except those which are more specifically</span>
    <span class="c1"># styled.</span>
    <span class="k">def </span><span class="nf">inflate_token</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">enum_for</span><span class="p">(</span><span class="ss">:inflate_token</span><span class="p">,</span> <span class="n">tok</span><span class="p">)</span> <span class="k">unless</span> <span class="nb">block_given?</span>

      <span class="k">yield</span> <span class="n">tok</span>
      <span class="n">tok</span><span class="nf">.sub_tokens.each</span> <span class="k">do</span> <span class="o">|</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span><span class="o">|</span>
        <span class="k">next</span> <span class="k">if</span> <span class="n">styles</span><span class="o">[</span><span class="n">st</span><span class="nf">.name</span><span class="o">]</span>

        <span class="n">inflate_token</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Themes</span>
    <span class="c1"># default base16 theme</span>
    <span class="c1"># by Chris Kempson (http://chriskempson.com)</span>
    <span class="k">class </span><span class="nc">Base16</span> <span class="o">&lt;</span> <span class="no">CSSTheme</span>
      <span class="nb">name</span> <span class="s1">&#39;base16&#39;</span>

      <span class="n">palette</span> <span class="ss">base00: </span><span class="s2">&quot;#151515&quot;</span>
      <span class="n">palette</span> <span class="ss">base01: </span><span class="s2">&quot;#202020&quot;</span>
      <span class="n">palette</span> <span class="ss">base02: </span><span class="s2">&quot;#303030&quot;</span>
      <span class="n">palette</span> <span class="ss">base03: </span><span class="s2">&quot;#505050&quot;</span>
      <span class="n">palette</span> <span class="ss">base04: </span><span class="s2">&quot;#b0b0b0&quot;</span>
      <span class="n">palette</span> <span class="ss">base05: </span><span class="s2">&quot;#d0d0d0&quot;</span>
      <span class="n">palette</span> <span class="ss">base06: </span><span class="s2">&quot;#e0e0e0&quot;</span>
      <span class="n">palette</span> <span class="ss">base07: </span><span class="s2">&quot;#f5f5f5&quot;</span>
      <span class="n">palette</span> <span class="ss">base08: </span><span class="s2">&quot;#ac4142&quot;</span>
      <span class="n">palette</span> <span class="ss">base09: </span><span class="s2">&quot;#d28445&quot;</span>
      <span class="n">palette</span> <span class="ss">base0A: </span><span class="s2">&quot;#f4bf75&quot;</span>
      <span class="n">palette</span> <span class="ss">base0B: </span><span class="s2">&quot;#90a959&quot;</span>
      <span class="n">palette</span> <span class="ss">base0C: </span><span class="s2">&quot;#75b5aa&quot;</span>
      <span class="n">palette</span> <span class="ss">base0D: </span><span class="s2">&quot;#6a9fb5&quot;</span>
      <span class="n">palette</span> <span class="ss">base0E: </span><span class="s2">&quot;#aa759f&quot;</span>
      <span class="n">palette</span> <span class="ss">base0F: </span><span class="s2">&quot;#8f5536&quot;</span>

      <span class="kp">extend</span> <span class="no">HasModes</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">light!</span>
        <span class="n">mode</span> <span class="ss">:dark</span> <span class="c1"># indicate that there is a dark variant</span>
        <span class="n">mode!</span> <span class="ss">:light</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">dark!</span>
        <span class="n">mode</span> <span class="ss">:light</span> <span class="c1"># indicate that there is a light variant</span>
        <span class="n">mode!</span> <span class="ss">:dark</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">make_dark!</span>
        <span class="n">style</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base05</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="ss">:base00</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">make_light!</span>
        <span class="n">style</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base02</span>
      <span class="k">end</span>

      <span class="n">light!</span>

      <span class="n">style</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base00</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="ss">:base08</span>
      <span class="n">style</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base03</span>

      <span class="n">style</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0A</span>

      <span class="n">style</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base05</span>

      <span class="n">style</span> <span class="s1">&#39;Generic.Inserted&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0B</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Removed&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base08</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Heading&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0D</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="ss">:base00</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>

      <span class="n">style</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0E</span>
      <span class="n">style</span> <span class="s1">&#39;Keyword.Constant&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Keyword.Type&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base09</span>

      <span class="n">style</span> <span class="s1">&#39;Keyword.Declaration&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base09</span>

      <span class="n">style</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0B</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Regex&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0C</span>

      <span class="n">style</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0F</span>

      <span class="n">style</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0A</span>

      <span class="n">style</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0D</span>

      <span class="n">style</span> <span class="s1">&#39;Literal.Number&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:base0B</span>

      <span class="k">class </span><span class="nc">Solarized</span> <span class="o">&lt;</span> <span class="no">Base16</span>
        <span class="nb">name</span> <span class="s1">&#39;base16.solarized&#39;</span>
        <span class="n">light!</span>
        <span class="c1"># author &quot;Ethan Schoonover (http://ethanschoonover.com/solarized)&quot;</span>

        <span class="n">palette</span> <span class="ss">base00: </span><span class="s2">&quot;#002b36&quot;</span>
        <span class="n">palette</span> <span class="ss">base01: </span><span class="s2">&quot;#073642&quot;</span>
        <span class="n">palette</span> <span class="ss">base02: </span><span class="s2">&quot;#586e75&quot;</span>
        <span class="n">palette</span> <span class="ss">base03: </span><span class="s2">&quot;#657b83&quot;</span>
        <span class="n">palette</span> <span class="ss">base04: </span><span class="s2">&quot;#839496&quot;</span>
        <span class="n">palette</span> <span class="ss">base05: </span><span class="s2">&quot;#93a1a1&quot;</span>
        <span class="n">palette</span> <span class="ss">base06: </span><span class="s2">&quot;#eee8d5&quot;</span>
        <span class="n">palette</span> <span class="ss">base07: </span><span class="s2">&quot;#fdf6e3&quot;</span>
        <span class="n">palette</span> <span class="ss">base08: </span><span class="s2">&quot;#dc322f&quot;</span>
        <span class="n">palette</span> <span class="ss">base09: </span><span class="s2">&quot;#cb4b16&quot;</span>
        <span class="n">palette</span> <span class="ss">base0A: </span><span class="s2">&quot;#b58900&quot;</span>
        <span class="n">palette</span> <span class="ss">base0B: </span><span class="s2">&quot;#859900&quot;</span>
        <span class="n">palette</span> <span class="ss">base0C: </span><span class="s2">&quot;#2aa198&quot;</span>
        <span class="n">palette</span> <span class="ss">base0D: </span><span class="s2">&quot;#268bd2&quot;</span>
        <span class="n">palette</span> <span class="ss">base0E: </span><span class="s2">&quot;#6c71c4&quot;</span>
        <span class="n">palette</span> <span class="ss">base0F: </span><span class="s2">&quot;#d33682&quot;</span>
      <span class="k">end</span>

      <span class="k">class </span><span class="nc">Monokai</span> <span class="o">&lt;</span> <span class="no">Base16</span>
        <span class="nb">name</span> <span class="s1">&#39;base16.monokai&#39;</span>
        <span class="n">dark!</span>

        <span class="c1"># author &quot;Wimer Hazenberg (http://www.monokai.nl)&quot;</span>
        <span class="n">palette</span> <span class="ss">base00: </span><span class="s2">&quot;#272822&quot;</span>
        <span class="n">palette</span> <span class="ss">base01: </span><span class="s2">&quot;#383830&quot;</span>
        <span class="n">palette</span> <span class="ss">base02: </span><span class="s2">&quot;#49483e&quot;</span>
        <span class="n">palette</span> <span class="ss">base03: </span><span class="s2">&quot;#75715e&quot;</span>
        <span class="n">palette</span> <span class="ss">base04: </span><span class="s2">&quot;#a59f85&quot;</span>
        <span class="n">palette</span> <span class="ss">base05: </span><span class="s2">&quot;#f8f8f2&quot;</span>
        <span class="n">palette</span> <span class="ss">base06: </span><span class="s2">&quot;#f5f4f1&quot;</span>
        <span class="n">palette</span> <span class="ss">base07: </span><span class="s2">&quot;#f9f8f5&quot;</span>
        <span class="n">palette</span> <span class="ss">base08: </span><span class="s2">&quot;#f92672&quot;</span>
        <span class="n">palette</span> <span class="ss">base09: </span><span class="s2">&quot;#fd971f&quot;</span>
        <span class="n">palette</span> <span class="ss">base0A: </span><span class="s2">&quot;#f4bf75&quot;</span>
        <span class="n">palette</span> <span class="ss">base0B: </span><span class="s2">&quot;#a6e22e&quot;</span>
        <span class="n">palette</span> <span class="ss">base0C: </span><span class="s2">&quot;#a1efe4&quot;</span>
        <span class="n">palette</span> <span class="ss">base0D: </span><span class="s2">&quot;#66d9ef&quot;</span>
        <span class="n">palette</span> <span class="ss">base0E: </span><span class="s2">&quot;#ae81ff&quot;</span>
        <span class="n">palette</span> <span class="ss">base0F: </span><span class="s2">&quot;#cc6633&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Themes</span>
    <span class="c1"># stolen from pygments</span>
    <span class="k">class </span><span class="nc">Colorful</span> <span class="o">&lt;</span> <span class="no">CSSTheme</span>
      <span class="nb">name</span> <span class="s1">&#39;colorful&#39;</span>

      <span class="n">style</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span>                      <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#bbbbbb&quot;</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="s1">&#39;#000&#39;</span>

      <span class="n">style</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span>                   <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#888&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span>           <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#579&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Comment.Special&#39;</span><span class="p">,</span>           <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#cc0000&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>

      <span class="n">style</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span>                   <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#080&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Keyword.Pseudo&#39;</span><span class="p">,</span>            <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#038&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Keyword.Type&#39;</span><span class="p">,</span>              <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#339&quot;</span>

      <span class="n">style</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span>                  <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#333&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Operator.Word&#39;</span><span class="p">,</span>             <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#000&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>

      <span class="n">style</span> <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span>              <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#007020&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span>             <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#06B&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span>                <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#B06&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span>            <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#0e84b5&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Exception&#39;</span><span class="p">,</span>            <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#F00&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span>             <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#963&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Variable.Instance&#39;</span><span class="p">,</span>    <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#33B&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Variable.Class&#39;</span><span class="p">,</span>       <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#369&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Variable.Global&#39;</span><span class="p">,</span>      <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#d70&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span>             <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#036&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Label&#39;</span><span class="p">,</span>                <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#970&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Entity&#39;</span><span class="p">,</span>               <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#800&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span>            <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#00C&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span>                  <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#070&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Decorator&#39;</span><span class="p">,</span>            <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#555&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>

      <span class="n">style</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span>            <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#fff0f0&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Char&#39;</span><span class="p">,</span>       <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#04D&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Doc&#39;</span><span class="p">,</span>        <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#D42&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span>   <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#eee&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span>     <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#666&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Regex&#39;</span><span class="p">,</span>      <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#000&quot;</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#fff0ff&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span>     <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#A60&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span>      <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#D20&quot;</span>

      <span class="n">style</span> <span class="s1">&#39;Literal.Number&#39;</span><span class="p">,</span>            <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#60E&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span><span class="p">,</span>    <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#00D&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.Number.Float&#39;</span><span class="p">,</span>      <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#60E&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span><span class="p">,</span>        <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#058&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span><span class="p">,</span>        <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#40E&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>

      <span class="n">style</span> <span class="s1">&#39;Generic.Heading&#39;</span><span class="p">,</span>           <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#000080&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Subheading&#39;</span><span class="p">,</span>        <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#800080&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Deleted&#39;</span><span class="p">,</span>           <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#A00000&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Inserted&#39;</span><span class="p">,</span>          <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#00A000&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Error&#39;</span><span class="p">,</span>             <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#FF0000&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Emph&#39;</span><span class="p">,</span>              <span class="ss">:italic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Strong&#39;</span><span class="p">,</span>            <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Prompt&#39;</span><span class="p">,</span>            <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#c65d09&quot;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Output&#39;</span><span class="p">,</span>            <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#888&quot;</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Traceback&#39;</span><span class="p">,</span>         <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#04D&quot;</span>

      <span class="n">style</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span>                     <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#F00&quot;</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="s2">&quot;#FAA&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">module</span> <span class="nn">Themes</span>
    <span class="k">class </span><span class="nc">ThankfulEyes</span> <span class="o">&lt;</span> <span class="no">CSSTheme</span>
      <span class="nb">name</span> <span class="s1">&#39;thankful_eyes&#39;</span>

      <span class="c1"># pallette, from GTKSourceView&#39;s ThankfulEyes</span>
      <span class="n">palette</span> <span class="ss">:cool_as_ice</span>    <span class="o">=&gt;</span> <span class="s1">&#39;#6c8b9f&#39;</span>
      <span class="n">palette</span> <span class="ss">:slate_blue</span>     <span class="o">=&gt;</span> <span class="s1">&#39;#4e5d62&#39;</span>
      <span class="n">palette</span> <span class="ss">:eggshell_cloud</span> <span class="o">=&gt;</span> <span class="s1">&#39;#dee5e7&#39;</span>
      <span class="n">palette</span> <span class="ss">:krasna</span>         <span class="o">=&gt;</span> <span class="s1">&#39;#122b3b&#39;</span>
      <span class="n">palette</span> <span class="ss">:aluminum1</span>      <span class="o">=&gt;</span> <span class="s1">&#39;#fefeec&#39;</span>
      <span class="n">palette</span> <span class="ss">:scarletred2</span>    <span class="o">=&gt;</span> <span class="s1">&#39;#cc0000&#39;</span>
      <span class="n">palette</span> <span class="ss">:butter3</span>        <span class="o">=&gt;</span> <span class="s1">&#39;#c4a000&#39;</span>
      <span class="n">palette</span> <span class="ss">:go_get_it</span>      <span class="o">=&gt;</span> <span class="s1">&#39;#b2fd6d&#39;</span>
      <span class="n">palette</span> <span class="ss">:chilly</span>         <span class="o">=&gt;</span> <span class="s1">&#39;#a8e1fe&#39;</span>
      <span class="n">palette</span> <span class="ss">:unicorn</span>        <span class="o">=&gt;</span> <span class="s1">&#39;#faf6e4&#39;</span>
      <span class="n">palette</span> <span class="ss">:sandy</span>          <span class="o">=&gt;</span> <span class="s1">&#39;#f6dd62&#39;</span>
      <span class="n">palette</span> <span class="ss">:pink_merengue</span>  <span class="o">=&gt;</span> <span class="s1">&#39;#f696db&#39;</span>
      <span class="n">palette</span> <span class="ss">:dune</span>           <span class="o">=&gt;</span> <span class="s1">&#39;#fff0a6&#39;</span>
      <span class="n">palette</span> <span class="ss">:backlit</span>        <span class="o">=&gt;</span> <span class="s1">&#39;#4df4ff&#39;</span>
      <span class="n">palette</span> <span class="ss">:schrill</span>        <span class="o">=&gt;</span> <span class="s1">&#39;#ffb000&#39;</span>

      <span class="n">style</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:unicorn</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="ss">:krasna</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Lineno&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:eggshell_cloud</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="ss">:slate_blue</span>

      <span class="n">style</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:cool_as_ice</span><span class="p">,</span> <span class="ss">:italic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:go_get_it</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:italic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Generic.Error&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:aluminum1</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="ss">:scarletred2</span>
      <span class="n">style</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:sandy</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:backlit</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Deleted&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:scarletred2</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Inserted&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:go_get_it</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Emph&#39;</span><span class="p">,</span> <span class="ss">:italic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Strong&#39;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Generic.Traceback&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:eggshell_cloud</span><span class="p">,</span> <span class="ss">:bg</span> <span class="o">=&gt;</span> <span class="ss">:slate_blue</span>
      <span class="n">style</span> <span class="s1">&#39;Keyword.Constant&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:pink_merengue</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Keyword.Pseudo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Keyword.Reserved&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Generic.Heading&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Generic.Subheading&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:schrill</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Keyword.Type&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Decorator&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Builtin.Pseudo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Exception&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:go_get_it</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Label&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:schrill</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.Number&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:pink_merengue</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:dune</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Literal.String.Char&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:backlit</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Entity&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s1">&#39;#999999&#39;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Text.Whitespace&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="s1">&#39;#BBBBBB&#39;</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Property&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:chilly</span>
      <span class="n">style</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span> <span class="ss">:fg</span> <span class="o">=&gt;</span> <span class="ss">:chilly</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">class </span><span class="nc">Token</span>
    <span class="kp">attr_reader</span> <span class="ss">:name</span>
    <span class="kp">attr_reader</span> <span class="ss">:parent</span>
    <span class="kp">attr_accessor</span> <span class="ss">:shortname</span>
    <span class="k">alias</span> <span class="nb">to_s</span> <span class="nb">name</span>

    <span class="k">def </span><span class="nf">make_single</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="nf">.to_s</span>
      <span class="n">new_name</span> <span class="o">=</span> <span class="o">[</span><span class="nb">self</span><span class="nf">.name</span><span class="p">,</span> <span class="nb">name</span><span class="o">]</span><span class="nf">.compact.join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

      <span class="n">new_token</span> <span class="o">=</span> <span class="nb">self</span><span class="nf">.clone</span>
      <span class="n">parent</span> <span class="o">=</span> <span class="nb">self</span>
      <span class="n">new_token</span><span class="nf">.instance_eval</span> <span class="k">do</span>
        <span class="vi">@name</span> <span class="o">=</span> <span class="n">new_name</span>
        <span class="vi">@parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="vi">@sub_tokens</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">end</span>

      <span class="n">sub_tokens</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span> <span class="o">=</span> <span class="n">new_token</span>

      <span class="n">new_token</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">make</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">shortname</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="n">names</span> <span class="o">=</span> <span class="nb">name</span><span class="nf">.split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
      <span class="n">names</span><span class="nf">.inject</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
        <span class="n">tok</span><span class="nf">.make_single</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">[]</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="nf">.to_s</span>

      <span class="nb">name</span><span class="nf">.split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="nf">.inject</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">tok</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
        <span class="n">tok</span><span class="nf">.sub_tokens</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span> <span class="o">||</span> <span class="n">tok</span><span class="nf">.make_single</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">sub_tokens</span>
      <span class="vi">@sub_tokens</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">ancestors</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">enum_for</span><span class="p">(</span><span class="ss">:ancestors</span><span class="p">)</span> <span class="k">unless</span> <span class="nb">block_given?</span>

      <span class="k">if</span> <span class="n">parent</span>
        <span class="k">yield</span> <span class="nb">self</span>
        <span class="n">parent</span><span class="nf">.ancestors</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">===</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
      <span class="n">immediate</span> <span class="o">=</span> <span class="k">if</span> <span class="nb">self</span><span class="nf">.class</span> <span class="o">==</span> <span class="n">other</span><span class="nf">.class</span>
        <span class="nb">self</span> <span class="o">==</span> <span class="n">other</span>
      <span class="k">else</span>
        <span class="nb">self</span><span class="nf">.name</span> <span class="o">==</span> <span class="n">other</span>
      <span class="k">end</span>

      <span class="n">immediate</span> <span class="o">||</span> <span class="o">!!</span><span class="p">(</span><span class="n">other</span><span class="nf">.parent</span> <span class="o">&amp;&amp;</span> <span class="nb">self</span> <span class="o">===</span> <span class="n">other</span><span class="nf">.parent</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">inspect</span>
      <span class="n">parts</span> <span class="o">=</span> <span class="o">[</span><span class="nb">name</span><span class="nf">.inspect</span><span class="o">]</span>
      <span class="n">parts</span> <span class="o">&lt;&lt;</span> <span class="n">shortname</span><span class="nf">.inspect</span> <span class="k">if</span> <span class="n">shortname</span>
      <span class="s2">&quot;#&lt;Token </span><span class="si">#{</span><span class="n">parts</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
    <span class="k">end</span>

    <span class="k">class </span><span class="o">&lt;&lt;</span> <span class="nb">self</span>
      <span class="k">def </span><span class="nf">base</span>
        <span class="vi">@base</span> <span class="o">||=</span> <span class="kp">new</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">get</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">name</span> <span class="k">if</span> <span class="nb">name</span><span class="nf">.is_a?</span> <span class="no">Token</span>

        <span class="n">base</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span>
      <span class="k">end</span>

      <span class="k">alias</span> <span class="o">[]</span> <span class="n">get</span>

      <span class="k">def </span><span class="nf">token</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">shortname</span><span class="p">)</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
        <span class="n">tok</span><span class="nf">.shortname</span> <span class="o">=</span> <span class="n">shortname</span>
        <span class="n">tok</span>
      <span class="k">end</span>

      <span class="k">def </span><span class="nf">each_token</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
        <span class="n">recurse</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span> <span class="o">|</span><span class="n">token</span><span class="o">|</span>
          <span class="n">b</span><span class="nf">.call</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
          <span class="n">token</span><span class="nf">.sub_tokens.each_value</span><span class="p">(</span><span class="o">&amp;</span><span class="n">recurse</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="n">base</span><span class="nf">.sub_tokens.each_value</span><span class="p">(</span><span class="o">&amp;</span><span class="n">recurse</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># XXX IMPORTANT XXX</span>
    <span class="c1"># For compatibility, this list must be kept in sync with</span>
    <span class="c1"># pygments.token.STANDARD_TYPES</span>
    <span class="n">token</span> <span class="s1">&#39;Text&#39;</span><span class="p">,</span>                        <span class="s1">&#39;&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Text.Whitespace&#39;</span><span class="p">,</span>             <span class="s1">&#39;w&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span>                       <span class="s1">&#39;err&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Other&#39;</span><span class="p">,</span>                       <span class="s1">&#39;x&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Keyword&#39;</span><span class="p">,</span>                     <span class="s1">&#39;k&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Keyword.Constant&#39;</span><span class="p">,</span>            <span class="s1">&#39;kc&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Keyword.Declaration&#39;</span><span class="p">,</span>         <span class="s1">&#39;kd&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Keyword.Namespace&#39;</span><span class="p">,</span>           <span class="s1">&#39;kn&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Keyword.Pseudo&#39;</span><span class="p">,</span>              <span class="s1">&#39;kp&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Keyword.Reserved&#39;</span><span class="p">,</span>            <span class="s1">&#39;kr&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Keyword.Type&#39;</span><span class="p">,</span>                <span class="s1">&#39;kt&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span>                        <span class="s1">&#39;n&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Attribute&#39;</span><span class="p">,</span>              <span class="s1">&#39;na&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Builtin&#39;</span><span class="p">,</span>                <span class="s1">&#39;nb&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Builtin.Pseudo&#39;</span><span class="p">,</span>         <span class="s1">&#39;bp&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Class&#39;</span><span class="p">,</span>                  <span class="s1">&#39;nc&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Constant&#39;</span><span class="p">,</span>               <span class="s1">&#39;no&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Decorator&#39;</span><span class="p">,</span>              <span class="s1">&#39;nd&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Entity&#39;</span><span class="p">,</span>                 <span class="s1">&#39;ni&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Exception&#39;</span><span class="p">,</span>              <span class="s1">&#39;ne&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Function&#39;</span><span class="p">,</span>               <span class="s1">&#39;nf&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Property&#39;</span><span class="p">,</span>               <span class="s1">&#39;py&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Label&#39;</span><span class="p">,</span>                  <span class="s1">&#39;nl&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Namespace&#39;</span><span class="p">,</span>              <span class="s1">&#39;nn&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Other&#39;</span><span class="p">,</span>                  <span class="s1">&#39;nx&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Tag&#39;</span><span class="p">,</span>                    <span class="s1">&#39;nt&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Variable&#39;</span><span class="p">,</span>               <span class="s1">&#39;nv&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Variable.Class&#39;</span><span class="p">,</span>         <span class="s1">&#39;vc&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Variable.Global&#39;</span><span class="p">,</span>        <span class="s1">&#39;vg&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Name.Variable.Instance&#39;</span><span class="p">,</span>      <span class="s1">&#39;vi&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Literal&#39;</span><span class="p">,</span>                     <span class="s1">&#39;l&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.Date&#39;</span><span class="p">,</span>                <span class="s1">&#39;ld&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span>              <span class="s1">&#39;s&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span><span class="p">,</span>     <span class="s1">&#39;sb&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Char&#39;</span><span class="p">,</span>         <span class="s1">&#39;sc&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Doc&#39;</span><span class="p">,</span>          <span class="s1">&#39;sd&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Double&#39;</span><span class="p">,</span>       <span class="s1">&#39;s2&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Escape&#39;</span><span class="p">,</span>       <span class="s1">&#39;se&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Heredoc&#39;</span><span class="p">,</span>      <span class="s1">&#39;sh&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Interpol&#39;</span><span class="p">,</span>     <span class="s1">&#39;si&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Other&#39;</span><span class="p">,</span>        <span class="s1">&#39;sx&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Regex&#39;</span><span class="p">,</span>        <span class="s1">&#39;sr&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Single&#39;</span><span class="p">,</span>       <span class="s1">&#39;s1&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.String.Symbol&#39;</span><span class="p">,</span>       <span class="s1">&#39;ss&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Literal.Number&#39;</span><span class="p">,</span>              <span class="s1">&#39;m&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.Number.Float&#39;</span><span class="p">,</span>        <span class="s1">&#39;mf&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.Number.Hex&#39;</span><span class="p">,</span>          <span class="s1">&#39;mh&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.Number.Integer&#39;</span><span class="p">,</span>      <span class="s1">&#39;mi&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.Number.Integer.Long&#39;</span><span class="p">,</span> <span class="s1">&#39;il&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Literal.Number.Oct&#39;</span><span class="p">,</span>          <span class="s1">&#39;mo&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Operator&#39;</span><span class="p">,</span>                    <span class="s1">&#39;o&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Operator.Word&#39;</span><span class="p">,</span>               <span class="s1">&#39;ow&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Punctuation&#39;</span><span class="p">,</span>                 <span class="s1">&#39;p&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span>                     <span class="s1">&#39;c&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Comment.Multiline&#39;</span><span class="p">,</span>           <span class="s1">&#39;cm&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Comment.Preproc&#39;</span><span class="p">,</span>             <span class="s1">&#39;cp&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Comment.Single&#39;</span><span class="p">,</span>              <span class="s1">&#39;c1&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Comment.Special&#39;</span><span class="p">,</span>             <span class="s1">&#39;cs&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Generic&#39;</span><span class="p">,</span>                     <span class="s1">&#39;g&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Deleted&#39;</span><span class="p">,</span>             <span class="s1">&#39;gd&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Emph&#39;</span><span class="p">,</span>                <span class="s1">&#39;ge&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Error&#39;</span><span class="p">,</span>               <span class="s1">&#39;gr&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Heading&#39;</span><span class="p">,</span>             <span class="s1">&#39;gh&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Inserted&#39;</span><span class="p">,</span>            <span class="s1">&#39;gi&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Output&#39;</span><span class="p">,</span>              <span class="s1">&#39;go&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Prompt&#39;</span><span class="p">,</span>              <span class="s1">&#39;gp&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Strong&#39;</span><span class="p">,</span>              <span class="s1">&#39;gs&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Subheading&#39;</span><span class="p">,</span>          <span class="s1">&#39;gu&#39;</span>
    <span class="n">token</span> <span class="s1">&#39;Generic.Traceback&#39;</span><span class="p">,</span>           <span class="s1">&#39;gt&#39;</span>

    <span class="n">token</span> <span class="s1">&#39;Generic.Lineno&#39;</span><span class="p">,</span>              <span class="s1">&#39;gl&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">class </span><span class="nc">Yielder</span>
    <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pr</span><span class="p">)</span>
      <span class="vi">@proc</span> <span class="o">=</span> <span class="n">pr</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">&lt;&lt;</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
      <span class="vi">@proc</span> <span class="o">&amp;&amp;</span> <span class="vi">@proc</span><span class="nf">.call</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class </span><span class="nc">InheritableHash</span> <span class="o">&lt;</span> <span class="no">Hash</span>
    <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="vi">@parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">[]</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
      <span class="n">_sup</span> <span class="o">=</span> <span class="k">super</span>
      <span class="k">return</span> <span class="n">_sup</span> <span class="k">if</span> <span class="n">own_keys</span><span class="nf">.include?</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

      <span class="n">_sup</span> <span class="o">||</span> <span class="n">parent</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">parent</span>
      <span class="vi">@parent</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">include?</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
      <span class="k">super</span> <span class="n">or</span> <span class="n">parent</span><span class="nf">.include?</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">each</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="n">keys</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="o">|</span>
        <span class="n">b</span><span class="nf">.call</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">self</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">alias</span> <span class="n">own_keys</span> <span class="n">keys</span>
    <span class="k">def </span><span class="nf">keys</span>
      <span class="n">keys</span> <span class="o">=</span> <span class="n">own_keys</span><span class="nf">.concat</span><span class="p">(</span><span class="n">parent</span><span class="nf">.keys</span><span class="p">)</span>
      <span class="n">keys</span><span class="nf">.uniq!</span>
      <span class="n">keys</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class </span><span class="nc">InheritableList</span>
    <span class="kp">include</span> <span class="no">Enumerable</span>

    <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="vi">@parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">parent</span>
      <span class="vi">@parent</span> <span class="o">||=</span> <span class="o">[]</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">each</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">enum_for</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">unless</span> <span class="nb">block_given?</span>

      <span class="n">parent</span><span class="nf">.each</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
      <span class="n">own_entries</span><span class="nf">.each</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">own_entries</span>
      <span class="vi">@own_entries</span> <span class="o">||=</span> <span class="o">[]</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">push</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
      <span class="n">own_entries</span> <span class="o">&lt;&lt;</span> <span class="n">o</span>
    <span class="k">end</span>
    <span class="k">alias</span> <span class="o">&lt;&lt;</span> <span class="n">push</span>
  <span class="k">end</span>

  <span class="c1"># shared methods for some indentation-sensitive lexers</span>
  <span class="k">module</span> <span class="nn">Indentation</span>
    <span class="k">def </span><span class="nf">reset!</span>
      <span class="k">super</span>
      <span class="vi">@block_state</span> <span class="o">=</span> <span class="vi">@block_indentation</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="k">end</span>

    <span class="c1"># push a state for the next indented block</span>
    <span class="k">def </span><span class="nf">starts_block</span><span class="p">(</span><span class="n">block_state</span><span class="p">)</span>
      <span class="vi">@block_state</span> <span class="o">=</span> <span class="n">block_state</span>
      <span class="vi">@block_indentation</span> <span class="o">=</span> <span class="vi">@last_indentation</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
      <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    starts_block </span><span class="si">#{</span><span class="n">block_state</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
      <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    block_indentation: </span><span class="si">#{</span><span class="vi">@block_indentation</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="c1"># handle a single indented line</span>
    <span class="k">def </span><span class="nf">indentation</span><span class="p">(</span><span class="n">indent_str</span><span class="p">)</span>
      <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    indentation </span><span class="si">#{</span><span class="n">indent_str</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
      <span class="n">debug</span> <span class="p">{</span> <span class="s2">&quot;    block_indentation: </span><span class="si">#{</span><span class="vi">@block_indentation</span><span class="nf">.inspect</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
      <span class="vi">@last_indentation</span> <span class="o">=</span> <span class="n">indent_str</span>

      <span class="c1"># if it&#39;s an indent and we know where to go next,</span>
      <span class="c1"># push that state.  otherwise, push content and</span>
      <span class="c1"># clear the block state.</span>
      <span class="k">if</span> <span class="p">(</span><span class="vi">@block_state</span> <span class="o">&amp;&amp;</span>
          <span class="n">indent_str</span><span class="nf">.start_with?</span><span class="p">(</span><span class="vi">@block_indentation</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
          <span class="n">indent_str</span> <span class="o">!=</span> <span class="vi">@block_indentation</span>
      <span class="p">)</span>
        <span class="n">push</span> <span class="vi">@block_state</span>
      <span class="k">else</span>
        <span class="vi">@block_state</span> <span class="o">=</span> <span class="vi">@block_indentation</span> <span class="o">=</span> <span class="kp">nil</span>
        <span class="n">push</span> <span class="ss">:content</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">def </span><span class="nc">self</span><span class="o">.</span><span class="nf">version</span>
    <span class="s2">&quot;0.2.5&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># stdlib</span>
<span class="nb">require</span> <span class="s1">&#39;pathname&#39;</span>

<span class="k">module</span> <span class="nn">Rouge</span>
  <span class="k">class </span><span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">def </span><span class="nf">highlight</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>
      <span class="n">lexer</span> <span class="o">=</span> <span class="no">Lexer</span><span class="nf">.find</span><span class="p">(</span><span class="n">lexer</span><span class="p">)</span> <span class="k">unless</span> <span class="n">lexer</span><span class="nf">.respond_to?</span> <span class="ss">:lex</span>
      <span class="k">raise</span> <span class="s2">&quot;unknown lexer </span><span class="si">#{</span><span class="n">lexer</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">unless</span> <span class="n">lexer</span>

      <span class="n">formatter</span> <span class="o">=</span> <span class="no">Formatter</span><span class="nf">.find</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span> <span class="k">unless</span> <span class="n">formatter</span><span class="nf">.respond_to?</span> <span class="ss">:format</span>
      <span class="k">raise</span> <span class="s2">&quot;unknown formatter </span><span class="si">#{</span><span class="n">formatter</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">unless</span> <span class="n">formatter</span>

      <span class="n">formatter</span><span class="nf">.format</span><span class="p">(</span><span class="n">lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">load_dir</span> <span class="o">=</span> <span class="no">Pathname</span><span class="nf">.new</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span><span class="nf">.dirname</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/version.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/util.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/text_analyzer.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/token.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexer.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/regex_lexer.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/template_lexer.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/text.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/diff.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/tex.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/markdown.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/yaml.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/sql.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/make.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/shell.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/viml.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/javascript.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/css.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/html.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/xml.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/php.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/haml.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/sass.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/scss.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/coffeescript.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/erb.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/handlebars.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/tcl.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/python.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/ruby.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/perl.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/factor.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/clojure.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/groovy.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/haskell.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/scheme.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/common_lisp.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/c.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/cpp.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/java.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/lexers/smalltalk.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/formatter.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/formatters/html.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/formatters/terminal256.rb&#39;</span><span class="p">)</span>

<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/theme.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/themes/thankful_eyes.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/themes/colorful.rb&#39;</span><span class="p">)</span>
<span class="nb">load</span> <span class="n">load_dir</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;rouge/themes/base16.rb&#39;</span><span class="p">)</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">HTML</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">HTML</span><span class="nf">.new</span> <span class="p">}</span>
  <span class="no">Token</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span>

  <span class="n">it</span> <span class="s1">&#39;formats a simple token stream&#39;</span> <span class="k">do</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">subject</span><span class="nf">.format</span><span class="p">(</span><span class="o">[[</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Name&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="o">]]</span><span class="p">)</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;&lt;pre class=&quot;highlight&quot;&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;/pre&gt;&#39;</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">Terminal256</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">Terminal256</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">&#39;renders a thing&#39;</span> <span class="k">do</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subject</span><span class="nf">.format</span><span class="p">(</span><span class="o">[[</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Text&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="o">]]</span><span class="p">)</span>

    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\e</span><span class="s2">[38;5;230mfoo</span><span class="se">\e</span><span class="s2">[39m&quot;</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexer</span> <span class="k">do</span>
  <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Lexing</span>

  <span class="n">it</span> <span class="s1">&#39;makes a simple lexer&#39;</span> <span class="k">do</span>
    <span class="n">a_lexer</span> <span class="o">=</span> <span class="no">Class</span><span class="nf">.new</span><span class="p">(</span><span class="no">Rouge</span><span class="o">::</span><span class="no">RegexLexer</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/a/</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span>
        <span class="n">rule</span> <span class="sr">/b/</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">token_A</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="ss">:A</span><span class="o">]</span>
    <span class="n">token_B</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="ss">:B</span><span class="o">]</span>

    <span class="c1"># consolidation</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">a_lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">)</span><span class="nf">.to_a</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.size</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span> <span class="o">==</span> <span class="o">[[</span><span class="n">token_A</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="o">]]</span> <span class="p">}</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">a_lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;abab&#39;</span><span class="p">)</span><span class="nf">.to_a</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.size</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span> <span class="o">==</span> <span class="o">[[</span><span class="n">token_A</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="n">token_B</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="o">]]</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;pushes and pops states&#39;</span> <span class="k">do</span>
    <span class="n">a_lexer</span> <span class="o">=</span> <span class="no">Class</span><span class="nf">.new</span><span class="p">(</span><span class="no">Rouge</span><span class="o">::</span><span class="no">RegexLexer</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">state</span> <span class="ss">:brace</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/b/</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span>
        <span class="n">rule</span> <span class="sr">/}/</span><span class="p">,</span> <span class="s1">&#39;Brace&#39;</span><span class="p">,</span> <span class="ss">:pop!</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/{/</span><span class="p">,</span> <span class="s1">&#39;Brace&#39;</span><span class="p">,</span> <span class="ss">:brace</span>
        <span class="n">rule</span> <span class="sr">/a/</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">a_lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;a{b}a&#39;</span><span class="p">)</span><span class="nf">.to_a</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.size</span> <span class="o">==</span> <span class="mi">5</span> <span class="p">}</span>

    <span class="c1"># failed parses</span>

    <span class="n">t</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span>
    <span class="n">assert</span> <span class="p">{</span>
      <span class="n">a_lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;{a}&#39;</span><span class="p">)</span><span class="nf">.to_a</span> <span class="o">==</span>
        <span class="o">[[</span><span class="n">t</span><span class="o">[</span><span class="s1">&#39;Brace&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="n">t</span><span class="o">[</span><span class="s1">&#39;Error&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="n">t</span><span class="o">[</span><span class="s1">&#39;Brace&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="o">]]</span>
    <span class="p">}</span>

    <span class="n">assert</span> <span class="p">{</span> <span class="n">a_lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span><span class="nf">.to_a</span> <span class="o">==</span> <span class="o">[[</span><span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Error&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="o">]]</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">a_lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="nf">.to_a</span> <span class="o">==</span> <span class="o">[[</span><span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Error&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="o">]]</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;does callbacks and grouping&#39;</span> <span class="k">do</span>
    <span class="n">callback_lexer</span> <span class="o">=</span> <span class="no">Class</span><span class="nf">.new</span><span class="p">(</span><span class="no">Rouge</span><span class="o">::</span><span class="no">RegexLexer</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/(a)(b)/</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
          <span class="n">group</span> <span class="s1">&#39;A&#39;</span>
          <span class="n">group</span> <span class="s1">&#39;B&#39;</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">callback_lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;ab&#39;</span><span class="p">)</span><span class="nf">.to_a</span>

    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.size</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="o">[</span><span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;A&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="o">[</span><span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;B&#39;</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="o">]</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;pops from the callback&#39;</span> <span class="k">do</span>
    <span class="n">callback_lexer</span> <span class="o">=</span> <span class="no">Class</span><span class="nf">.new</span><span class="p">(</span><span class="no">Rouge</span><span class="o">::</span><span class="no">RegexLexer</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/a/</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="ss">:a</span>
        <span class="n">rule</span> <span class="sr">/d/</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:a</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/b/</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="ss">:b</span>
      <span class="k">end</span>

      <span class="n">state</span> <span class="ss">:b</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/c/</span> <span class="k">do</span> <span class="o">|</span><span class="n">ss</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;C&#39;</span>
          <span class="n">pop!</span><span class="p">;</span> <span class="n">pop!</span> <span class="c1"># go back to the root</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">assert_no_errors</span> <span class="s1">&#39;abcd&#39;</span><span class="p">,</span> <span class="n">callback_lexer</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;supports stateful lexes&#39;</span> <span class="k">do</span>
    <span class="n">stateful</span> <span class="o">=</span> <span class="no">Class</span><span class="nf">.new</span><span class="p">(</span><span class="no">Rouge</span><span class="o">::</span><span class="no">RegexLexer</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/\d+/</span> <span class="k">do</span> <span class="o">|</span><span class="n">ss</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;digit&#39;</span>
          <span class="vi">@count</span> <span class="o">=</span> <span class="n">ss</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.to_i</span>
        <span class="k">end</span>

        <span class="n">rule</span> <span class="sr">/\+/</span> <span class="k">do</span> <span class="o">|</span><span class="n">ss</span><span class="o">|</span>
          <span class="vi">@count</span> <span class="o">+=</span> <span class="mi">1</span>
          <span class="n">token</span><span class="p">(</span><span class="vi">@count</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="p">?</span> <span class="s1">&#39;lt&#39;</span> <span class="p">:</span> <span class="s1">&#39;gt&#39;</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">stateful</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;4++&#39;</span><span class="p">)</span>
    <span class="n">types</span> <span class="o">=</span> <span class="n">result</span><span class="nf">.map</span> <span class="p">{</span> <span class="o">|</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">_</span><span class="p">)</span><span class="o">|</span> <span class="n">t</span><span class="nf">.name</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">types</span> <span class="o">==</span> <span class="sx">%w(digit lt gt)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;delegates&#39;</span> <span class="k">do</span>
    <span class="k">class </span><span class="nc">MasterLexer</span> <span class="o">&lt;</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">RegexLexer</span>
      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/a/</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span>
        <span class="n">rule</span> <span class="sr">/{(.*?)}/</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
          <span class="n">token</span> <span class="s1">&#39;brace&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span>
          <span class="n">delegate</span> <span class="no">BracesLexer</span><span class="nf">.new</span><span class="p">,</span> <span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
          <span class="n">token</span> <span class="s1">&#39;brace&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class </span><span class="nc">BracesLexer</span> <span class="o">&lt;</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">RegexLexer</span>
      <span class="n">state</span> <span class="ss">:root</span> <span class="k">do</span>
        <span class="n">rule</span> <span class="sr">/b/</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">assert_no_errors</span> <span class="s1">&#39;a{b}a&#39;</span><span class="p">,</span> <span class="no">MasterLexer</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="n">C</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="n">C</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.c&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.h&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-csrc&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Clojure</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Clojure</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.clj&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-clojure&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/x-clojure&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Coffeescript</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Coffeescript</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.coffee&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cakefile&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/coffeescript&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/env coffee&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">CommonLisp</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">CommonLisp</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.cl&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.lisp&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.el&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-common-lisp&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Cpp</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Cpp</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.cpp&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.c++&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.cc&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.cxx&#39;</span>

      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.hpp&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.h++&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.hh&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.hxx&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-c++hdr&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-c++src&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">CSS</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">CSS</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>
    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.css&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/css&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Diff</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Diff</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.diff&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.patch&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-diff&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-patch&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;-</span><span class="no">source</span><span class="sh">
diff --git a/lib/rouge.rb b/lib/rouge.rb
index d228e4b..560b687 100644
--- a/lib/rouge.rb
+++ b/lib/rouge.rb
@@ -13,6 +13,7 @@ module Rouge
 end
 
 load_dir = Pathname.new(__FILE__).dirname
+load load_dir.join(&#39;rouge/text_analyzer.rb&#39;)
 load load_dir.join(&#39;rouge/token.rb&#39;)
 load load_dir.join(&#39;rouge/lexer.rb&#39;)
 load load_dir.join(&#39;rouge/lexers/text.rb&#39;)
</span><span class="no">      source</span>

      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;-</span><span class="no">source</span><span class="sh">
--- a/lib/rouge.rb
+++ b/lib/rouge.rb
@@ -13,6 +13,7 @@ module Rouge
 end
 
 load_dir = Pathname.new(__FILE__).dirname
+load load_dir.join(&#39;rouge/text_analyzer.rb&#39;)
 load load_dir.join(&#39;rouge/token.rb&#39;)
 load load_dir.join(&#39;rouge/lexer.rb&#39;)
 load load_dir.join(&#39;rouge/lexers/text.rb&#39;)
</span><span class="no">      source</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">ERB</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">ERB</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.html.erb&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.eruby&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.rhtml&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;% foo %&gt;&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;%%&gt;&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Factor</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Factor</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.factor&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-factor&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/local/bin/factor&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Groovy</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Groovy</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.groovy&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-groovy&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Haml</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Haml</span><span class="nf">.new</span> <span class="p">}</span>
  <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Lexing</span>

  <span class="n">it</span> <span class="s1">&#39;lexes custom filters&#39;</span> <span class="k">do</span>
    <span class="n">lexer</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Haml</span><span class="nf">.new</span><span class="p">(</span><span class="ss">:filters</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:tex</span> <span class="o">=&gt;</span> <span class="s1">&#39;tex&#39;</span> <span class="p">})</span>

    <span class="n">assert_has_token</span> <span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;-</span><span class="no">tex</span><span class="p">,</span> <span class="n">lexer</span><span class="sh">
      :tex
        % this is a tex comment!
</span><span class="no">    tex</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.html.haml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.haml&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-haml&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Handlebars</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Handlebars</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.handlebars&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.hbs&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.mustache&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-handlebars&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Haskell</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Haskell</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.hs&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-haskell&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/env runhaskell&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">HTML</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">HTML</span><span class="nf">.new</span> <span class="p">}</span>
  <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Lexing</span>

  <span class="n">it</span> <span class="s1">&#39;lexes embedded script tags&#39;</span> <span class="k">do</span>
    <span class="n">assert_no_errors</span> <span class="s1">&#39;&lt;script&gt;x &amp;&amp; x &lt; y;&lt;/script&gt;&#39;</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.html&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.htm&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.xhtml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.xslt&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/xhtml+xml&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;!DOCTYPE html&gt;&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;-</span><span class="no">source</span><span class="sh">
        &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
        &lt;!DOCTYPE html
            PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
            &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
        &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
        &lt;/html&gt;
</span><span class="no">      source</span>

      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;-</span><span class="no">source</span><span class="sh">
        &lt;!DOCTYPE html PUBLIC
          &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
        &lt;html lang=&quot;ar&quot; dir=&quot;rtl&quot; xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
        &lt;/html&gt;
</span><span class="no">      source</span>

      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;html&gt;&lt;/html&gt;&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Java</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Java</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.java&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-java&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Javascript</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Javascript</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.js&#39;</span>
      <span class="n">assert_guess</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">JSON</span><span class="p">,</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.json&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/javascript&#39;</span>
      <span class="n">assert_guess</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">JSON</span><span class="p">,</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/env node&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/local/bin/jsc&#39;</span>
      <span class="n">assert_guess</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">JSON</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;{ &quot;foo&quot;: &quot;bar&quot; }&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Make</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Make</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.make&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;Makefile&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;makefile&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;Makefile.in&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;GNUmakefile&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-makefile&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;.PHONY: all&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Markdown</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Markdown</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.md&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.mkd&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.markdown&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-markdown&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Perl</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Perl</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.pl&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.pm&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-perl&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/x-perl&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/local/bin/perl&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;my $foo = 1;&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Python</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Python</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.py&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.pyw&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-python&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/x-python&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/env python&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/local/bin/python3&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/python2&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/python2.7&#39;</span>
      <span class="n">deny_guess</span>   <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/env python4&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Ruby</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Ruby</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.rb&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.ruby&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.rbw&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.gemspec&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;Rakefile&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;Guardfile&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;Gemfile&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-ruby&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/x-ruby&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/local/bin/ruby&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Scheme</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Scheme</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.scm&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.rkt&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.ss&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-scheme&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/x-scheme&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Shell</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Shell</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Lexing</span>
  <span class="n">it</span> <span class="s1">&#39;parses a basic shell string&#39;</span> <span class="k">do</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">subject</span><span class="nf">.lex</span><span class="p">(</span><span class="s1">&#39;foo=bar&#39;</span><span class="p">)</span><span class="nf">.to_a</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">tokens</span><span class="nf">.size</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">tokens</span><span class="nf">.first</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="nf">.name</span> <span class="o">==</span> <span class="s1">&#39;Name.Variable&#39;</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;parses /etc/bash.bashrc&#39;</span> <span class="k">do</span>
    <span class="n">assert_no_errors</span> <span class="no">File</span><span class="nf">.read</span><span class="p">(</span><span class="s1">&#39;/etc/bash.bashrc&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;parses case statements correctly&#39;</span> <span class="k">do</span>
    <span class="n">assert_no_errors</span> <span class="o">&lt;&lt;-</span><span class="no">sh</span><span class="sh">
      case $foo in
        a) echo &quot;LOL&quot; ;;
      esac
</span><span class="no">    sh</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;parses case statement with globs correctly&#39;</span> <span class="k">do</span>
    <span class="n">assert_no_errors</span> <span class="o">&lt;&lt;-</span><span class="no">sh</span><span class="sh">
      case $foo in
        a[b]) echo &quot;LOL&quot; ;;
      esac
</span><span class="no">    sh</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.sh&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.zsh&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.ksh&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.bash&#39;</span>
      <span class="n">deny_guess</span>   <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/x-shellscript&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/bin/bash&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;   #!   /bin/bash&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/env bash&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/env bash -i&#39;</span>
      <span class="n">deny_guess</span>   <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/bin/smash&#39;</span>
      <span class="c1"># not sure why you would do this, but hey, whatevs</span>
      <span class="n">deny_guess</span>   <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/bin/bash/python&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Smalltalk</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Smalltalk</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.st&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-smalltalk&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">SQL</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">SQL</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.sql&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-sql&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">TCL</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">TCL</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.tcl&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-tcl&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/x-tcl&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-script.tcl&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/env tclsh&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/jimsh&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;#!/usr/bin/wish&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">TeX</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">TeX</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.tex&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.toc&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.aux&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-tex&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-latex&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;\\documentclass{article}&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Text</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">Text</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.txt&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/plain&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-something-else&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;zorbl&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">VimL</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">VimL</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;mapping binary search&#39;</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:mapping</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">[[</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;aaa&#39;</span><span class="o">]</span><span class="p">,</span>
       <span class="o">[</span><span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="o">]</span><span class="p">,</span>
       <span class="o">[</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;ccc&#39;</span><span class="o">]]</span>
    <span class="p">}</span>

    <span class="n">it</span> <span class="s1">&#39;finds a likely mapping&#39;</span> <span class="k">do</span>
      <span class="n">likely</span> <span class="o">=</span> <span class="n">subject</span><span class="nf">.find_likely_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">)</span>
      <span class="n">assert</span> <span class="p">{</span> <span class="n">likely</span> <span class="o">==</span> <span class="o">[</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;aaa&#39;</span><span class="o">]</span> <span class="p">}</span>

      <span class="n">likely</span> <span class="o">=</span> <span class="n">subject</span><span class="nf">.find_likely_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span>
      <span class="n">assert</span> <span class="p">{</span> <span class="n">likely</span> <span class="o">==</span> <span class="o">[</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;aaa&#39;</span><span class="o">]</span> <span class="p">}</span>

      <span class="n">likely</span> <span class="o">=</span> <span class="n">subject</span><span class="nf">.find_likely_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="s1">&#39;bbbbb&#39;</span><span class="p">)</span>
      <span class="n">assert</span> <span class="p">{</span> <span class="n">likely</span> <span class="o">==</span> <span class="o">[</span><span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="o">]</span> <span class="p">}</span>

      <span class="n">likely</span> <span class="o">=</span> <span class="n">subject</span><span class="nf">.find_likely_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
      <span class="n">assert</span> <span class="p">{</span> <span class="n">likely</span> <span class="o">==</span> <span class="o">[</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;ccc&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.vim&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.vba&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;~/.vimrc&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;.exrc&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;.gvimrc&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;_vimrc&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;_gvimrc&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;_exrc&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-vim&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">XML</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">XML</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.xml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.xsl&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.rss&#39;</span>
      <span class="c1"># TODO: implement disambiguation for multiple types</span>
      <span class="c1"># This currently returns HTML</span>
      <span class="c1"># assert_guess :filename =&gt; &#39;foo.xslt&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.xsd&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.wsdl&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/xml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/xml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;image/svg+xml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/rss+xml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/atom+xml&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;xml&gt;&lt;/xml&gt;&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;!DOCTYPE xml&gt;&#39;</span>
      <span class="n">deny_guess</span>   <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">&#39;&lt;!DOCTYPE html&gt;&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">YAML</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subject</span><span class="p">)</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexers</span><span class="o">::</span><span class="no">YAML</span><span class="nf">.new</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;guessing&#39;</span> <span class="k">do</span>
    <span class="kp">include</span> <span class="no">Support</span><span class="o">::</span><span class="no">Guessing</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by filename&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.yml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo.yaml&#39;</span>
      <span class="n">assert_guess</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">&#39;.travis.yml&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by mimetype&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:mimetype</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/x-yaml&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;guesses by source&#39;</span> <span class="k">do</span>
      <span class="n">assert_guess</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">%YAML 1.2&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="nb">require</span> <span class="s1">&#39;rouge/plugins/redcarpet&#39;</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Plugins</span><span class="o">::</span><span class="no">Redcarpet</span> <span class="k">do</span>
  <span class="c1"># skip if redcarpet isn&#39;t loaded</span>
  <span class="k">next</span> <span class="k">unless</span> <span class="no">Object</span><span class="nf">.const_defined?</span> <span class="ss">:Redcarpet</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:redcarpet</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">Class</span><span class="nf">.new</span><span class="p">(</span><span class="no">Redcarpet</span><span class="o">::</span><span class="no">Render</span><span class="o">::</span><span class="no">HTML</span><span class="p">)</span> <span class="k">do</span>
      <span class="kp">include</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Plugins</span><span class="o">::</span><span class="no">Redcarpet</span>
    <span class="k">end</span>
  <span class="p">}</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:markdown</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">Redcarpet</span><span class="o">::</span><span class="no">Markdown</span><span class="nf">.new</span><span class="p">(</span><span class="n">redcarpet</span><span class="nf">.new</span><span class="p">,</span> <span class="ss">:fenced_code_blocks</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">it</span> <span class="s1">&#39;renders a thing&#39;</span> <span class="k">do</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">markdown</span><span class="nf">.render</span> <span class="o">&lt;&lt;-</span><span class="no">mkd</span><span class="sh">
``` javascript
var foo = 1;
```

``` shell
foo=1
```
</span><span class="no">    mkd</span>

    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.include?</span><span class="p">(</span><span class="sx">%&lt;&lt;pre class=&quot;highlight shell&quot;&gt;&gt;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.include?</span><span class="p">(</span><span class="sx">%&lt;&lt;pre class=&quot;highlight javascript&quot;&gt;&gt;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;guesses&#39;</span> <span class="k">do</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">markdown</span><span class="nf">.render</span> <span class="o">&lt;&lt;-</span><span class="no">mkd</span><span class="sh">
``` guess
&lt;xml&gt;an xml code block&lt;/xml&gt;
```
</span><span class="no">    mkd</span>

    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.include?</span><span class="p">(</span><span class="sx">%&lt;&lt;pre class=&quot;highlight xml&quot;&gt;&gt;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;passes options&#39;</span> <span class="k">do</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">markdown</span><span class="nf">.render</span> <span class="o">&lt;&lt;-</span><span class="no">mkd</span><span class="sh">
``` shell?k=v
foo=1
```
</span><span class="no">    mkd</span>

    <span class="c1"># TODO: test that an option is actually there</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.include?</span><span class="p">(</span><span class="sx">%&lt;&lt;pre class=&quot;highlight shell&quot;&gt;&gt;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;works when no language is provided&#39;</span> <span class="k">do</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">markdown</span><span class="nf">.render</span> <span class="o">&lt;&lt;-</span><span class="no">mkd</span><span class="sh">
```
#!/usr/bin/env ruby
$stdin.each { |l| $stdout.puts l.reverse }
```
</span><span class="no">    mkd</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">result</span><span class="nf">.include?</span><span class="p">(</span><span class="sx">%(&lt;pre class=&quot;highlight ruby&quot;&gt;)</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;bundler&#39;</span>
<span class="no">Bundler</span><span class="nf">.require</span>

<span class="nb">require</span> <span class="s1">&#39;rouge&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;minitest/spec&#39;</span>

<span class="no">Wrong</span><span class="nf">.config</span><span class="o">[</span><span class="ss">:color</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>

<span class="k">class </span><span class="nc">MiniTest</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">Wrong</span>
<span class="k">end</span>

<span class="no">Dir</span><span class="o">[</span><span class="no">File</span><span class="nf">.expand_path</span><span class="p">(</span><span class="s1">&#39;support/**/*.rb&#39;</span><span class="p">,</span> <span class="no">File</span><span class="nf">.dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">))</span><span class="o">]</span><span class="nf">.each</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="nb">require</span> <span class="n">f</span>
<span class="p">}</span>
<span class="k">module</span> <span class="nn">Support</span>
  <span class="k">module</span> <span class="nn">Guessing</span>
    <span class="k">def </span><span class="nf">assert_guess</span><span class="p">(</span><span class="n">type</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{})</span>
      <span class="k">if</span> <span class="n">type</span><span class="nf">.is_a?</span> <span class="no">Hash</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">type</span>
        <span class="n">type</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="k">end</span>

      <span class="n">type</span> <span class="o">||=</span> <span class="n">subject</span><span class="nf">.class</span>

      <span class="n">assert</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexer</span><span class="nf">.guess</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="n">type</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">deny_guess</span><span class="p">(</span><span class="n">type</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{})</span>
      <span class="k">if</span> <span class="n">type</span><span class="nf">.is_a?</span> <span class="no">Hash</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">type</span>
        <span class="n">type</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="k">end</span>

      <span class="n">type</span> <span class="o">||=</span> <span class="n">subject</span><span class="nf">.class</span>

      <span class="n">deny</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexer</span><span class="nf">.guess</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="n">type</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">Support</span>
  <span class="k">module</span> <span class="nn">Lexing</span>
    <span class="k">def </span><span class="nf">filter_by_token</span><span class="p">(</span><span class="n">tokname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="n">lexer</span> <span class="o">||=</span> <span class="n">subject</span>

      <span class="n">tokens</span> <span class="o">=</span> <span class="n">lexer</span><span class="nf">.lex</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

      <span class="n">tokens</span><span class="nf">.select</span> <span class="k">do</span> <span class="o">|</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span><span class="o">|</span>
        <span class="n">tok</span><span class="nf">.name.start_with?</span> <span class="n">tokname</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">deny_has_token</span><span class="p">(</span><span class="n">tokname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="n">deny</span> <span class="p">{</span> <span class="n">filter_by_token</span><span class="p">(</span><span class="n">tokname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="p">)</span><span class="nf">.any?</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">assert_has_token</span><span class="p">(</span><span class="n">tokname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
      <span class="n">assert</span> <span class="p">{</span> <span class="n">filter_by_token</span><span class="p">(</span><span class="n">tokname</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="p">)</span><span class="nf">.any?</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def </span><span class="nf">assert_no_errors</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
      <span class="n">deny_has_token</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Theme</span> <span class="k">do</span>
  <span class="k">def </span><span class="nf">squish</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="n">str</span><span class="nf">.strip.gsub</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;auto-fills css classes&#39;</span> <span class="k">do</span>
    <span class="k">class </span><span class="nc">MyTheme</span> <span class="o">&lt;</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">CSSTheme</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String&#39;</span><span class="p">,</span> <span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span>
      <span class="n">style</span> <span class="s1">&#39;Literal.String.Backtick&#39;</span><span class="p">,</span> <span class="ss">:italic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
    <span class="k">end</span>

    <span class="n">rendered</span> <span class="o">=</span> <span class="no">MyTheme</span><span class="nf">.new.render</span>

    <span class="c1"># should also style, for example, String.Char</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">rendered</span> <span class="o">=~</span> <span class="sr">/\.sc/</span> <span class="p">}</span>

    <span class="c1"># and it should only style String.Backtick once</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="n">rendered</span> <span class="o">=~</span> <span class="sr">/\.sb/</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="vg">$~</span><span class="nf">.size</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;renders a style&#39;</span> <span class="k">do</span>
    <span class="n">output</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Theme</span><span class="o">::</span><span class="no">Style</span><span class="o">[</span><span class="ss">:bold</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="o">]</span><span class="nf">.render</span><span class="p">(</span><span class="s1">&#39;.foo&#39;</span><span class="p">)</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">css</span><span class="sh">
      .foo {
        font-weight: bold;
      }
</span><span class="no">    css</span>

    <span class="n">assert</span> <span class="p">{</span> <span class="n">squish</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">==</span> <span class="n">squish</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">describe</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">&#39;has a name&#39;</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Text&#39;</span><span class="o">]</span><span class="nf">.name</span> <span class="o">==</span> <span class="s1">&#39;Text&#39;</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Literal.String&#39;</span><span class="o">]</span><span class="nf">.name</span> <span class="o">==</span> <span class="s1">&#39;Literal.String&#39;</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;compares equal values&#39;</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Foo.Bar&#39;</span><span class="o">]</span> <span class="o">===</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Foo.Bar&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="n">deny</span>   <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Foo.Bar&#39;</span><span class="o">]</span> <span class="o">===</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Foo.Baz&#39;</span><span class="o">]</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;compares children&#39;</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Foo&#39;</span><span class="o">]</span> <span class="o">===</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Foo.Bar&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="n">deny</span>   <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Foo.Bar&#39;</span><span class="o">]</span> <span class="o">===</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Foo&#39;</span><span class="o">]</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;has shortnames&#39;</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Name&#39;</span><span class="o">]</span><span class="nf">.shortname</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="p">}</span>
    <span class="n">assert</span> <span class="p">{</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;Literal.String.Backtick&#39;</span><span class="o">]</span><span class="nf">.shortname</span> <span class="o">==</span> <span class="s1">&#39;sb&#39;</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;calculates ancestors&#39;</span> <span class="k">do</span>
    <span class="nb">ancestors</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Token</span><span class="o">[</span><span class="s1">&#39;A.B.C.D&#39;</span><span class="o">]</span><span class="nf">.ancestors.map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span>

    <span class="n">assert</span> <span class="p">{</span> <span class="nb">ancestors</span> <span class="o">==</span> <span class="sx">%w(A.B.C.D A.B.C A.B A)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;bundler&#39;</span>
<span class="no">Bundler</span><span class="nf">.require</span>
<span class="nb">require</span> <span class="s1">&#39;rouge&#39;</span>

<span class="c1"># stdlib</span>
<span class="nb">require</span> <span class="s1">&#39;pathname&#39;</span>

<span class="k">class </span><span class="nc">VisualTestApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
  <span class="no">BASE</span> <span class="o">=</span> <span class="no">Pathname</span><span class="nf">.new</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span><span class="nf">.dirname</span>
  <span class="no">SAMPLES</span> <span class="o">=</span> <span class="no">BASE</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">)</span>

  <span class="n">configure</span> <span class="k">do</span>
    <span class="n">set</span> <span class="ss">:root</span><span class="p">,</span> <span class="no">BASE</span>
    <span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="no">BASE</span><span class="nf">.join</span><span class="p">(</span><span class="s1">&#39;templates&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">before</span> <span class="k">do</span>
    <span class="n">theme_class</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Theme</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:theme</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;thankful_eyes&#39;</span><span class="p">)</span>
    <span class="n">halt</span> <span class="mi">404</span> <span class="k">unless</span> <span class="n">theme_class</span>
    <span class="vi">@theme</span> <span class="o">=</span> <span class="n">theme_class</span><span class="nf">.new</span>
  <span class="k">end</span>

  <span class="n">get</span> <span class="s1">&#39;/:lexer&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">lexer_name</span><span class="o">|</span>
    <span class="n">lexer_class</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Lexer</span><span class="nf">.find</span><span class="p">(</span><span class="n">lexer_name</span><span class="p">)</span>
    <span class="n">halt</span> <span class="mi">404</span> <span class="k">unless</span> <span class="n">lexer_class</span>
    <span class="vi">@sample</span> <span class="o">=</span> <span class="no">File</span><span class="nf">.read</span><span class="p">(</span><span class="no">SAMPLES</span><span class="nf">.join</span><span class="p">(</span><span class="n">lexer_class</span><span class="nf">.tag</span><span class="p">))</span>

    <span class="n">lexer_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">params</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span>
      <span class="n">lexer_options</span><span class="o">[</span><span class="n">k</span><span class="nf">.to_sym</span><span class="o">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">end</span>

    <span class="n">formatter</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">HTML</span><span class="nf">.new</span><span class="p">(</span><span class="ss">:line_numbers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
    <span class="vi">@lexer</span> <span class="o">=</span> <span class="n">lexer_class</span><span class="nf">.new</span><span class="p">(</span><span class="n">lexer_options</span><span class="p">)</span>
    <span class="vi">@highlighted</span> <span class="o">=</span> <span class="no">Rouge</span><span class="nf">.highlight</span><span class="p">(</span><span class="vi">@sample</span><span class="p">,</span> <span class="vi">@lexer</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>

    <span class="n">erb</span> <span class="ss">:lexer</span>
  <span class="k">end</span>


  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
    <span class="vi">@samples</span> <span class="o">=</span> <span class="no">SAMPLES</span><span class="nf">.entries.reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="n">s</span><span class="nf">.basename.to_s</span> <span class="o">=~</span> <span class="sr">/^\.|~$/</span> <span class="p">}</span>
    <span class="vi">@samples</span><span class="nf">.map!</span><span class="p">(</span><span class="o">&amp;</span><span class="no">Rouge</span><span class="o">::</span><span class="no">Lexer</span><span class="nf">.method</span><span class="p">(</span><span class="ss">:find</span><span class="p">))</span>

    <span class="vi">@formatter</span> <span class="o">=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">HTML</span><span class="nf">.new</span><span class="p">(</span><span class="ss">:line_numbers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>

    <span class="n">erb</span> <span class="ss">:index</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="nb">puts</span> <span class="o">&lt;&lt;-</span><span class="no">msg</span><span class="sh">

============
Run `rackup` and visit localhost:9292/:lexer_name to visually test a lexer.
============

</span><span class="no">msg</span>
</pre>